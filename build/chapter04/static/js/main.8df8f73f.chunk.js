(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{37:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var o={};n.r(o),n.d(o,"MATERIALS_CONFIG",(function(){return h})),n.d(o,"studioConfig",(function(){return m})),n.d(o,"playerConfig",(function(){return f}));var r=n(8),a=n.n(r),i=n(11);function s(){return(s=Object(i.a)(a.a.mark((function e(t,n){var o,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("pageLoaded",t,o={CONSTANTS:n}),r=o.loaderAssets,i=l(t),e.next=6,r.loadAssets(i);case 6:o.assets=e.sent,u("beforeStartPlay",t,o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c,u=function(e,t,n){for(var o=0;o<t.length;++o){var r=t[o],a=r.key,i=r.constr;r.initStateKey===e&&(n[a]=new i(n))}},l=function(e){for(var t=[],n=0;n<e.length;++n)if(e[n].assetsToLoad&&e[n].assetsToLoad.length)for(var o=0;o<e[n].assetsToLoad.length;++o)t.push(e[n].assetsToLoad[o]);return t},h={iron:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:13192,specular:16777215,shininess:60,bumpMap:"botMap",bumpScale:.1,envMap:"ironEnv",reflectivity:.5,map:"botMap",skinning:!0}},wall:{mat:"MeshPhongMaterial",props:{color:4740457,emissive:10066329,map:"mapFloorOuter",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.1,specular:2236962}},road:{mat:"MeshPhongMaterial",props:{color:11710593,emissive:4473924,map:"mapFloorOuter2",bumpMap:"mapFloorOuter2",bumpScale:1,envMap:"skyBox",reflectivity:.4}}},m={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:1604947,strength:.7},sceneEnvironment:{fogNear:20,fogFar:500,color:1604947,backgroundImgKey:null},composerAddPass:"Saturate"},f={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e3,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:16777215,strength:5e3,pos:[0,50,5]}},d=n(1),b=n(2),p=n(0),g=n(19),v=n(20),y=function(){var e=null,t=null,n=null,o=null;return function(r,a){return new Promise((function(i){return function(r){return"obj"===r?e=e||new g.a:"glb"===r||"gltf"===r?n=n||new v.a:"img"===r?t=t||new p.TextureLoader:"cubeTextures"===r?o=o||new p.CubeTextureLoader:void 0}(a).load(r,i)}))}},w=function(){function e(){Object(d.a)(this,e),this.resources={},this._load=y()}return Object(b.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(n){var o=t._load,r=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(a.a.mark((function t(i){var c,u,l,h;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],u=c.key,l=c.path,h=c.type,t.next=4,o(l,h);case 4:r[u]=t.sent;case 5:if(++i,e[i]){t.next=10;break}n(r),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),j=function(){function e(){Object(d.a)(this,e),this._storage={}}return Object(b.a)(e,[{key:"emit",value:function(e){var t=this;return function(n){return O(t._storage)(e).forEach((function(e){return e(n)}))}}},{key:"subscribe",value:function(e){var t=this;return function(n){return O(t._storage)(e).push(n),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==n}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),O=function(e){return function(t){return e[t]=e[t]||[]}},_=n(3),x=n(14),k=n.n(x),C=n(9),S=n(10),T=n(6),M=(n(37),"en"),D=n(4),P=(c={ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}},function(e){return c[M]&&c[M][e]||e}),N=Object(C.b)((function(e){return Object(T.a)({},e.controls.infoPanelData)}))((function(e){return Object(D.jsxs)("div",{className:"info",children:[Object(D.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(D.jsxs)("div",{className:"info-inner",children:[Object(D.jsx)("p",{children:P(e.title)}),Object(D.jsx)("p",{children:P(e.topText)}),Object(D.jsx)("ul",{children:e.chapters.map((function(t,n){return Object(D.jsxs)("li",{children:[n+1,".\xa0",t.href?Object(D.jsx)("span",{children:Object(D.jsx)("a",{href:t.href,target:"blank",children:P(t.text)})}):Object(D.jsx)("span",{children:P(t.text)}),n===e.currentChapterIndex&&P(" (current)")]},n)}))}),Object(D.jsx)("p",{children:e.bottomText}),Object(D.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(D.jsxs)("li",{children:[P(e.text),Object(D.jsx)("a",{href:e.href,target:"blank",children:P(e.aText)})]},t)}))})]})]})})),A=(n(39),Object(C.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls}}))((function(e){var t=Object(_.useState)(!0),n=Object(S.a)(t,2),o=n[0],r=n[1];return Object(_.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&r(!0)}))})),Object(D.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&Object(D.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&o&&Object(D.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),r(!1)},children:"\u2752"}),!e.isInfo&&Object(D.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(D.jsx)(N,{})]})})));var F={dispatch:null},I=Object(C.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!F.dispatch&&(F.dispatch=e.dispatch),Object(D.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(D.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(D.jsx)(A,{gameContext:e.gameContext})]})})),E=n(12),L=n(22),U={isShowControls:!0,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"http://js.otrisovano.ru/factory/"},{text:"Brige",href:"http://js.otrisovano.ru/bridge/"},{text:"Cube",href:"http://js.otrisovano.ru/levels/"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var R=document.querySelector(".progress"),K=-100,q=!0;!function e(){q&&setTimeout((function(){0===++K&&(K-=100),R.style.marginLeft=K+"%",e()}),30)}();var B=function(){function e(t){Object(d.a)(this,e),t.dispatcher=F,this._root=t;var n=function(e){e.customStore||(e.customStore={});var t=Object(E.b)(Object(T.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(T.a)(Object(T.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(T.a)(Object(T.a)({},e),{},{infoPanelData:Object(T.a)(Object(T.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):Object(T.a)({},e)}},e.customStore)),n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||E.c;return Object(E.d)(t,n(Object(E.a)(L.a)))}(t);n&&k.a.render(Object(D.jsx)(C.a,{store:n,children:Object(D.jsx)(I,{gameContext:t})}),document.getElementById("root"))}return Object(b.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),n=document.querySelector(".progress-wrapper"),o=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,M=t),document.querySelector(".start-screen").style.display="none"};q=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),o(t)})),n.style.display="none"}}]),e}(),W=n(43),G=n(15),z=n(25),H=n(24),V=n(13),Q={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},X=n(23),Y=function(){function e(t){var n=this;Object(d.a)(this,e),this._root=t;var o=t.assets,r=t.emitter,a=t.CONSTANTS.studioConfig,i=a.canId,s=a.rendererCon,c=a.clearColor,u=a.amb;s.canvas=document.getElementById(i),this._renderer=new p.WebGLRenderer(s),this._renderer.setClearColor(c),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new p.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,h=l.color,m=l.fogNear,f=l.fogFar,b=l.backgroundImgKey;this._scene.background=o[b]||null,this._scene.fog=new p.Fog(h,m,f),this._lightA=null;var g=u.color,v=u.strength;this._lightA=new p.AmbientLight(g,v),this._scene.add(this._lightA),this._camera=null,this._camera=new p.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._camera.position.set(0,0,20);var y=new X.a(this._camera,this._renderer.domElement);y.target.set(0,0,0),y.update(),this._composer=new z.a(this._renderer);var w=new p.Mesh(new p.BoxGeometry(1,1,1),new p.MeshBasicMaterial({color:65280}));w.matrixAutoUpdate=!1,setTimeout((function(){}),2e3),this._scene.add(w);var j=function(){var e={width:window.innerWidth,height:window.innerHeight};n._renderer.setSize(e.width,e.height),n._composer.setSize(e.width,e.height),n._camera&&(n._camera.aspect=e.width/e.height,n._camera.updateProjectionMatrix())};window.addEventListener("resize",j),j(),this.addToScene=this._scene.add.bind(this._scene);r.subscribe("frameUpdate")((function(){n._camera&&n._composer.render(n._scene,n._camera)})),this._backgroundImgKey=t.CONSTANTS.studioConfig.sceneEnvironment.backgroundImgKey,r.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(b.a)(e,[{key:"setCamera",value:function(e){this._camera=e,this._composer.addPass(new H.a(this._scene,this._camera)),this._root.CONSTANTS.studioConfig.composerAddPass&&"Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new V.a(Q))}},{key:"changeEnvironment",value:function(e){this._changeFog(e),this._changeBackground(e)}},{key:"_changeFog",value:function(e){var t=this,n=e.fogNear,o=e.fogFar,r=e.color;if(this._scene.fog.near!==n||this._scene.fog.far!==o||this._scene.fog.color!==o){var a={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},i={color:new p.Color(r),near:n,far:o};new G.a(a).to(i,3e3).onUpdate((function(){t._scene.fog.color=a.color,t._scene.fog.near=a.near,t._scene.fog.far=a.far,t._lightA.color=a.color,t._renderer.setClearColor(a.color)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),J=function(){function e(t){Object(d.a)(this,e);var n=t.emitter,o={up:!1,down:!1,left:!1,right:!1},r={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=r,this.keys=o;var a=function(e,t){switch(e){case 38:case 87:r.up&&(o.up=t);break;case 40:case 83:r.down&&(o.down=t);break;case 37:case 65:o.left=t;break;case 39:case 68:o.right=t}n.emit("keyEvent")(o)};document.addEventListener("keydown",(function(e){return a(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return a(e.keyCode,!1)})),n.subscribe("mouseDown")((function(e){"butt-left"===e&&a(37,!0),"butt-right"===e&&a(39,!0),"butt-front"===e&&a(38,!0),"butt-back"===e&&a(40,!0)})),n.subscribe("mouseUp")((function(e){"butt-left"===e&&a(37,!1),"butt-right"===e&&a(39,!1),"butt-front"===e&&a(38,!1),"butt-back"===e&&a(40,!1)}))}return Object(b.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),Z=function(){function e(t){Object(d.a)(this,e);var n=t.studio,o=t.CONSTANTS.playerConfig,r=(o.startPos,o.startRot,o.cameraData),a=(o.frontObjPos,o.backObjPos,o.lightDataOne);this._camera=null,this._isBlocked=!0,this.mesh=new p.Object3D,this.mesh.position.fromArray([0,20,0]),this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new p.Object3D,this.bottomObj.position.fromArray([0,-2,0]),this.mesh.add(this.bottomObj),this.frontObj=new p.Object3D,this.frontObj.position.fromArray([0,0,-2]),this.mesh.add(this.frontObj),this.backObj=new p.Object3D,this.backObj.position.fromArray([0,0,2]),this.mesh.add(this.backObj);var i=r.fov,s=r.ratio,c=r.near,u=r.far;r.pos;this._camera=new p.PerspectiveCamera(i,s,c,u),this._camera.position.fromArray([0,0,2]),this.mesh.add(this._camera);var l=a.color,h=a.strenth,m=a.pos,f=new p.PointLight(l,h);f.position.fromArray(m),this.mesh.add(f),n.setCamera(this._camera),n.addToScene(this.mesh)}return Object(b.a)(e,[{key:"toggleBlocked",value:function(e){this._isBlocked=e}},{key:"toggleCanMove",value:function(e,t){this._isCanMove[e]=t}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,n){this.mesh.position.set(e,t,n)}}]),e}(),$=function(e,t){for(var n in e)e[n].wrapS&&(e[n].wrapS=e[n].wrapT=p.RepeatWrapping);var o=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],r={},a=function(n){r[n]=new p[t[n].mat](Object(T.a)({},t[n].props)),o.map((function(o){return t[n].props[o]&&(r[n][o]=e[t[n].props[o]])}))};for(var i in t)a(i);return r},ee=function(e,t){var n={};return e["level-rooms"].traverse((function(e){if(e.name.includes("level")){var o=new p.Mesh(e.geometry,t.wall);o.name=e.name,n[e.name]=o}if(e.name.includes("road_wall")){var r=new p.Mesh(e.geometry,t.road);r.name=e.name,n[e.name]=r}})),{rooms:{},allMeshes:n,collisionsBotsRooms:{}}},te=n.p+"static/media/level02.35a60911.obj",ne=n.p+"static/media/floor_outer_map.b9a0b868.jpg",oe=n.p+"static/media/floor_outer_map2.7501c480.jpg",re=n.p+"static/media/px.f288daa0.jpg",ae=n.p+"static/media/nx.30b9dafc.jpg",ie=n.p+"static/media/py.86e432e6.jpg",se=n.p+"static/media/ny.05500e5a.jpg",ce=n.p+"static/media/pz.7df5de11.jpg",ue=n.p+"static/media/nz.54e73079.jpg",le=function(){function e(){Object(d.a)(this,e),this._arrMeshes=[],this._vecStart=new p.Vector3,this._vecDir=new p.Vector3,this._rayCaster=new p.Raycaster(this._vecStart,this._vecDir)}return Object(b.a)(e,[{key:"setItemToCollision",value:function(e){this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,n){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var o=this._rayCaster.intersectObjects(this._arrMeshes);return o[0]&&o[0].distance<n?[!0,o[0]]:[!1,null]}}]),e}(),he=function(e,t,n){return new Promise((function(o){var r=0;!function a(){if((r+=.03)>1&&(r=1),e.quaternion.slerpQuaternions(t,n,r),1===r)return o();setTimeout(a,15)}()}))},me=[{key:"emitter",constr:j,initStateKey:"pageLoaded"},{key:"ui",constr:B,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(d.a)(this,e);var n=t.emitter,o=t.appWrapper;!o&&(o=document.querySelector(".app-wrapper")),n.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&r()}));var r=function(){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()},a=function(e){o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||n.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",a),a()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:w,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:function e(t){Object(d.a)(this,e);var n=t.emitter.emit("frameUpdate"),o={time:0,delta:0,count:0,oldTime:0},r=W.a((function(){return o}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){return n(e),e}),(function(e){return e.oldTime=e.time,e}),(function(e){return o=e}));!function e(){requestAnimationFrame(e),r(o)}()},initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(d.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return G.b()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:Y,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:J,initStateKey:"beforeStartPlay"},{key:"player",constr:Z,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(d.a)(this,e);var n=t.assets,o=t.CONSTANTS;t.materials=$(n,o.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"level",constr:function e(t){Object(d.a)(this,e);var n=t.studio,o=t.assets,r=t.materials,a=(t.systemCollisionFloor,t.systemCollisionItems,ee(o,r).allMeshes);for(var i in a)n.addToScene(a[i]);this.allMeshes=a},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:te,key:"level-rooms"},{type:"cubeTextures",path:[re,ae,ie,se,ce,ue],key:"skyBox"},{type:"img",path:ne,key:"mapFloorOuter",wrap:!0},{type:"img",path:oe,key:"mapFloorOuter2",wrap:!0}]},{key:"system_PlayerMoveOnLevel",constr:function e(t){Object(d.a)(this,e);var n=t.emitter,o=t.CONSTANTS,r=t.player,a=t.level,i=new le;for(var s in a.allMeshes)"road_wall"===s&&(a.allMeshes[s].userData.isWallWalking=!0),i.setItemToCollision(a.allMeshes[s]);var c=o.playerConfig,u=c.speed,l=c.speedDown,h=c.speedRot,m=!1;r.toggleBlocked=function(e){return m=e};var f=!1,b={},g=new p.Quaternion,v=new p.Quaternion,y=new p.Vector3(0,1,0),w=function(){g.copy(r.mesh.quaternion),v.setFromAxisAngle(y,Math.random()*Math.PI*2),m=!0,he(r.mesh,g,v).then((function(){r.mesh.up.copy(y),m=!1}))},j=function(e){var t=i.checkCollisions(r.mesh,r.frontObj,17),n=Object(S.a)(t,2),o=n[0],a=n[1];o?a.object.userData.isWallWalking&&function(e){g.copy(r.mesh.quaternion);var t=(new p.Vector3).addVectors(r.mesh.position,e.face.normal);r.mesh.lookAt(t),r.mesh.up.copy(e.face.normal),r.mesh.rotateX(Math.PI/2),v.copy(r.mesh.quaternion),r.mesh.setRotationFromQuaternion(g),m=!0,he(r.mesh,g,v).then((function(){m=!1}))}(a):r.mesh.translateZ(-u*e.count)};n.subscribe("keyEvent")((function(e){return b=e})),n.subscribe("frameUpdate")((function(e){f||(b.left&&r.mesh.rotateY(h*e.count),b.right&&r.mesh.rotateY(-h*e.count),m||(function(e){var t=i.checkCollisions(r.mesh,r.bottomObj,17.2),n=Object(S.a)(t,2),o=n[0],a=n[1];if(!o)return!r.mesh.up.equals(y)&&w(),void(r.mesh.position.y+=l*e.count);a.object.userData.isWallWalking||r.mesh.up.equals(y)?a.distance<16.5&&r.mesh.translateY(17-a.distance):w()}(e),b.up&&j(e),b.down&&function(e){var t=i.checkCollisions(r.mesh,r.backObj,17);Object(S.a)(t,1)[0]||r.mesh.translateZ(u*e.count)}(e)))})),n.subscribe("toggleDialog")((function(e){return f=e.isOpen}))},initStateKey:"beforeStartPlay"},{key:"starterPlay",constr:function e(t){Object(d.a)(this,e);var n=t.player;t.ui.showStartButton((function(){n.toggleBlocked(!1)}))},initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(me,o)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.8df8f73f.chunk.js.map