(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{37:function(e,t,n){},39:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"MATERIALS_CONFIG",(function(){return m})),n.d(r,"START_ENV_CONFIG",(function(){return h})),n.d(r,"studioConfig",(function(){return d})),n.d(r,"playerConfig",(function(){return f}));var o=n(8),a=n.n(o),s=n(11);function i(){return(i=Object(s.a)(a.a.mark((function e(t,n){var r,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u("pageLoaded",t,r={CONSTANTS:n}),o=r.loaderAssets,s=l(t),e.next=6,o.loadAssets(s);case 6:r.assets=e.sent,u("beforeStartPlay",t,r);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c,u=function(e,t,n){for(var r=0;r<t.length;++r){var o=t[r],a=o.key,s=o.constr;o.initStateKey===e&&(n[a]=new s(n))}},l=function(e){for(var t=[],n=0;n<e.length;++n)if(e[n].assetsToLoad&&e[n].assetsToLoad.length)for(var r=0;r<e[n].assetsToLoad.length;++r)t.push(e[n].assetsToLoad[r]);return t},m={wall:{mat:"MeshPhongMaterial",props:{color:3377271,emissive:161052535,map:"mapFloorOuter",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.3,shininess:60,specular:2236962}},groundTop:{mat:"MeshPhongMaterial",props:{color:11167334,emissive:11167334,map:"mapTop",bumpMap:"mapTop",bumpScale:1,envMap:"skyBox2",reflectivity:.5,specular:2236962}},road:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:6710886,map:"mapFloorOuter2",bumpMap:"mapFloorOuter2",bumpScale:1,envMap:"skyBox",reflectivity:.3}},skin:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:2267579,specular:16777215,shininess:60,bumpMap:"skin",bumpScale:.1,envMap:"skyBox2",reflectivity:.5,map:"skin",skinning:!0}}},h={fogNear:20,fogFar:500,color:4852293,backgroundImgKey:"skyBox2"},d={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:10874053,strength:.8},sceneEnvironment:{fogNear:-20,fogFar:0,color:4852293,backgroundImgKey:"skyBox2"},composerAddPass:"Saturate"},f={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e3,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:5592405,strength:0,pos:[0,400,5]}},p=n(1),b=n(2),g=n(0),v=n(19),y=n(20),j=function(){var e=null,t=null,n=null,r=null;return function(o,a){return new Promise((function(s){(function(o){return"obj"===o?e=e||new v.a:"glb"===o||"gltf"===o?n=n||new y.a:"img"===o?t=t||new g.TextureLoader:"cubeTextures"===o?r=r||new g.CubeTextureLoader:void 0})(a).load(o,s)}))}},w=function(){function e(){Object(p.a)(this,e),this.resources={},this._load=j()}return Object(b.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(n){var r=t._load,o=t.resources;function i(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(a.a.mark((function t(s){var c,u,l,m;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[s]){t.next=5;break}return c=e[s],u=c.key,l=c.path,m=c.type,t.next=4,r(l,m);case 4:o[u]=t.sent;case 5:if(++s,e[s]){t.next=10;break}n(o),t.next=12;break;case 10:return t.next=12,i(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i(0)}))}}]),e}(),_=function(){function e(){Object(p.a)(this,e),this._storage={}}return Object(b.a)(e,[{key:"emit",value:function(e){var t=this;return function(n){return O(t._storage)(e).forEach((function(e){return e(n)}))}}},{key:"subscribe",value:function(e){var t=this;return function(n){return O(t._storage)(e).push(n),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==n}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),O=function(e){return function(t){return e[t]=e[t]||[]}},k=n(3),C=n(14),x=n.n(C),S=n(9),T=n(10),M=n(6),P=(n(37),"en"),D=n(4),N=(c={ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}},function(e){return c[P]&&c[P][e]||e}),A=Object(S.b)((function(e){return Object(M.a)({},e.controls.infoPanelData)}))((function(e){return Object(D.jsxs)("div",{className:"info",children:[Object(D.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(D.jsxs)("div",{className:"info-inner",children:[Object(D.jsx)("p",{children:N(e.title)}),Object(D.jsx)("p",{children:N(e.topText)}),Object(D.jsx)("ul",{children:e.chapters.map((function(t,n){return Object(D.jsxs)("li",{children:[n+1,".\xa0",t.href?Object(D.jsx)("span",{children:Object(D.jsx)("a",{href:t.href,target:"blank",children:N(t.text)})}):Object(D.jsx)("span",{children:N(t.text)}),n===e.currentChapterIndex&&N(" (current)")]},n)}))}),Object(D.jsx)("p",{children:e.bottomText}),Object(D.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(D.jsxs)("li",{children:[N(e.text),Object(D.jsx)("a",{href:e.href,target:"blank",children:N(e.aText)})]},t)}))})]})]})})),E=(n(39),Object(S.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls}}))((function(e){var t=Object(k.useState)(!0),n=Object(T.a)(t,2),r=n[0],o=n[1];return Object(k.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&o(!0)}))})),Object(D.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&Object(D.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&r&&Object(D.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),o(!1)},children:"\u2752"}),!e.isInfo&&Object(D.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(D.jsx)(A,{})]})})));var F={dispatch:null},I=Object(S.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!F.dispatch&&(F.dispatch=e.dispatch),Object(D.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(D.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(D.jsx)(E,{gameContext:e.gameContext})]})})),L=n(12),R=n(22),U={isShowControls:!0,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"http://js.otrisovano.ru/factory/"},{text:"Brige",href:"http://js.otrisovano.ru/bridge/"},{text:"Cube",href:"http://js.otrisovano.ru/levels/"},{text:"Endways",href:"http://js.otrisovano.ru/endways/"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var K=document.querySelector(".progress"),B=-100,W=!0;!function e(){W&&setTimeout((function(){0===++B&&(B-=100),K.style.marginLeft=B+"%",e()}),30)}();var q=function(){function e(t){Object(p.a)(this,e),t.dispatcher=F,this._root=t;var n=function(e){e.customStore||(e.customStore={});var t=Object(L.b)(Object(M.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(M.a)(Object(M.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(M.a)(Object(M.a)({},e),{},{infoPanelData:Object(M.a)(Object(M.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):Object(M.a)({},e)}},e.customStore)),n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||L.c;return Object(L.d)(t,n(Object(L.a)(R.a)))}(t);n&&x.a.render(Object(D.jsx)(S.a,{store:n,children:Object(D.jsx)(I,{gameContext:t})}),document.getElementById("root"))}return Object(b.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),n=document.querySelector(".progress-wrapper"),r=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,P=t),document.querySelector(".start-screen").style.display="none"};W=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),r(t)})),n.style.display="none"}}]),e}(),z=n(43),G=n(15),H=n(25),V=n(24),Q=n(13),X={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},Y=n(23),J=function(){function e(t){var n=this;Object(p.a)(this,e),this._root=t;var r=t.assets,o=t.emitter,a=t.CONSTANTS.studioConfig,s=a.canId,i=a.rendererCon,c=a.clearColor,u=a.amb;i.canvas=document.getElementById(s),this._renderer=new g.WebGLRenderer(i),this._renderer.setClearColor(c),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new g.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,m=l.color,h=l.fogNear,d=l.fogFar,f=l.backgroundImgKey;this._scene.background=r[f]||null,this._scene.fog=new g.Fog(m,h,d),this._lightA=null;var b=u.color,v=u.strength;this._lightA=new g.AmbientLight(b,v),this._scene.add(this._lightA),this._playerCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var y=new Y.a(this._controlsCamera,this._renderer.domElement);y.target.set(0,0,0),y.update(),this._composer=new H.a(this._renderer),this._renderPass=new V.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&"Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new Q.a(X));var j=new g.Vector3,w=!0;o.subscribe("keyEvent")((function(e){e.o&&(w?(w=!1,n._renderPass.camera=n._controlsCamera,n._playerCamera.getWorldPosition(j),n._controlsCamera.position.x=j.x+100,n._controlsCamera.position.y=j.y+100,n._controlsCamera.position.z=j.z,y.target.set(j.x,j.y,j.z),y.update()):(w=!0,n._renderPass.camera=n._playerCamera))}));var _=function(){var e={width:window.innerWidth,height:window.innerHeight};n._renderer.setSize(e.width,e.height),n._composer.setSize(e.width,e.height),n._controlsCamera&&(n._controlsCamera.aspect=e.width/e.height,n._controlsCamera.updateProjectionMatrix()),n._playerCamera&&(n._playerCamera.aspect=e.width/e.height,n._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",_),_(),this.addToScene=this._scene.add.bind(this._scene),this.removeFromScene=this._scene.remove.bind(this._scene);o.subscribe("frameUpdate")((function(){n._composer.render(n._scene,n._controlsCamera)})),this._backgroundImgKey=t.CONSTANTS.studioConfig.sceneEnvironment.backgroundImgKey,o.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(b.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){var n=this,r=e.fogNear,o=e.fogFar,a=e.color;if(this._scene.fog.near!==r||this._scene.fog.far!==o||this._scene.fog.color!==o){var s={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},i={color:new g.Color(a),near:r,far:o};new G.a(s).to(i,3e3).onUpdate((function(){n._scene.fog.color=s.color,n._scene.fog.near=s.near,n._scene.fog.far=s.far,t?t.updateAmb&&(n._lightA.color=s.color):n._lightA.color=s.color,n._renderer.setClearColor(s.color)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),Z=function(){function e(t){Object(p.a)(this,e);var n=t.emitter,r={up:!1,down:!1,left:!1,right:!1,p:!1},o={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=o,this.keys=r;var a=function(e,t){switch(e){case 38:case 87:o.up&&(r.up=t);break;case 40:case 83:o.down&&(r.down=t);break;case 37:case 65:r.left=t;break;case 39:case 68:r.right=t;break;case 79:r.o=t;break;case 80:r.p=t}n.emit("keyEvent")(r)};document.addEventListener("keydown",(function(e){return a(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return a(e.keyCode,!1)})),n.subscribe("mouseDown")((function(e){"butt-left"===e&&a(37,!0),"butt-right"===e&&a(39,!0),"butt-front"===e&&a(38,!0),"butt-back"===e&&a(40,!0)})),n.subscribe("mouseUp")((function(e){"butt-left"===e&&a(37,!1),"butt-right"===e&&a(39,!1),"butt-front"===e&&a(38,!1),"butt-back"===e&&a(40,!1)}))}return Object(b.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),$=function(){function e(t){Object(p.a)(this,e);var n=t.studio,r=t.CONSTANTS.playerConfig,o=(r.startPos,r.startRot,r.cameraData),a=(r.frontObjPos,r.backObjPos,r.lightDataOne);this._camera=null,this._isBlocked=!0,this.mesh=new g.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new g.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new g.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new g.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var s=o.fov,i=o.ratio,c=o.near,u=o.far;o.pos;this._camera=new g.PerspectiveCamera(s,i,c,u),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera);var l=a.color,m=a.strenth,h=a.pos,d=new g.PointLight(l,m);d.position.fromArray(h),this.mesh.add(d),n.setCamera(this._camera),n.addToScene(this.mesh)}return Object(b.a)(e,[{key:"toggleBlocked",value:function(e){this._isBlocked=e}},{key:"toggleCanMove",value:function(e,t){this._isCanMove[e]=t}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,n){this.mesh.position.set(e,t,n)}}]),e}(),ee=function(e,t){for(var n in e)e[n].wrapS&&(e[n].wrapS=e[n].wrapT=g.RepeatWrapping);var r=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],o={},a=function(n){o[n]=new g[t[n].mat](Object(M.a)({},t[n].props)),r.map((function(r){return t[n].props[r]&&(o[n][r]=e[t[n].props[r]])}))};for(var s in t)a(s);return o},te=function(e,t){var n={},r={};return e["level-rooms"].traverse((function(e){var o=null;if(e.name.includes("level")&&((o="level_020_001"===e.name?new g.Mesh(e.geometry,t.groundTop):new g.Mesh(e.geometry,t.wall)).name=e.name,n[e.name]=o),e.name.includes("roadwall")&&((o=new g.Mesh(e.geometry,t.road)).name=e.name,o.userData.isWallWalking=!0,n[e.name]=o),e.name.includes("level")||e.name.includes("roadwall")){var a=e.name.split("_");a[1]&&o&&(r[+a[1]]||(r[+a[1]]=[]),o.userData.area=+a[1],r[+a[1]].push(o))}})),{allMeshes:n,areas:r}},ne=n.p+"static/media/level02.d499eb4b.obj",re=n.p+"static/media/floor_outer_map3.558e9646.jpg",oe=n.p+"static/media/floor_outer_map2.2bd99ce1.jpg",ae=n.p+"static/media/floor_outer_map.35e50f6e.jpg",se=n.p+"static/media/px.c5995c72.jpg",ie=n.p+"static/media/nx.04390d21.jpg",ce=n.p+"static/media/py.f7a76cc4.jpg",ue=n.p+"static/media/ny.4e15a317.jpg",le=n.p+"static/media/pz.7c1308f5.jpg",me=n.p+"static/media/nz.6287fe7d.jpg",he=n.p+"static/media/px.96d0b65f.jpg",de=n.p+"static/media/nx.8cbf039d.jpg",fe=n.p+"static/media/py.659ebc34.jpg",pe=n.p+"static/media/ny.09051a4e.jpg",be=n.p+"static/media/pz.a1539724.jpg",ge=n.p+"static/media/nz.0bc769f7.jpg",ve=function(){function e(){Object(p.a)(this,e),this._arrMeshes=[],this._vecStart=new g.Vector3,this._vecDir=new g.Vector3,this._rayCaster=new g.Raycaster(this._vecStart,this._vecDir)}return Object(b.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,n){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var r=this._rayCaster.intersectObjects(this._arrMeshes);return r[0]&&r[0].distance<n?[!0,r[0]]:[!1,null]}}]),e}(),ye=function(e,t,n){return new Promise((function(r){var o=0;!function a(){if((o+=.03)>1&&(o=1),e.quaternion.slerpQuaternions(t,n,o),1===o)return r();setTimeout(a,15)}()}))},je=function(e,t,n){var r=function(n,r){if(e[n])for(var o=0;o<e[n].length;++o){var a=e[n][o];"remove"===r&&t.removeFromScene(a),"add"===r&&t.addToScene(a)}},o=function(t,r){if(e[t])for(var o=0;o<e[t].length;++o){var a=e[t][o];"remove"===r&&n.removeItemFromCollision(a),"add"===r&&n.setItemToCollision(a)}};return function(e){console.log(e),r(e-4,"remove"),r(e-3,"remove"),r(e-2,"add"),r(e-1,"add"),r(e,"add"),r(e+1,"add"),r(e+2,"add"),r(e+3,"add"),o(e-3,"remove"),o(e-2,"remove"),o(e-1,"add"),o(e,"add"),o(e+1,"add"),o(e+2,"add")}},we=[{key:"emitter",constr:_,initStateKey:"pageLoaded"},{key:"ui",constr:q,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(p.a)(this,e);var n=t.emitter,r=t.appWrapper;!r&&(r=document.querySelector(".app-wrapper")),n.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&o()}));var o=function(){r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.msRequestFullscreen&&r.msRequestFullscreen()},a=function(e){r.style.width=window.innerWidth+"px",r.style.height=window.innerHeight+"px",r.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||n.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",a),a()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:w,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:function e(t){Object(p.a)(this,e);var n=t.emitter.emit("frameUpdate"),r={time:0,delta:0,count:0,oldTime:0},o=z.a((function(){return r}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){return n(e),e}),(function(e){return e.oldTime=e.time,e}),(function(e){return r=e}));!function e(){requestAnimationFrame(e),o(r)}()},initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(p.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return G.b()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:J,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:Z,initStateKey:"beforeStartPlay"},{key:"player",constr:$,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(p.a)(this,e);var n=t.assets,r=t.CONSTANTS;t.materials=ee(n,r.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"level",constr:function e(t){Object(p.a)(this,e);t.studio;var n=t.assets,r=t.materials,o=te(n,r),a=(o.allMeshes,o.areas);t.assets.areas=a},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:ne,key:"level-rooms"},{type:"cubeTextures",path:[se,ie,ce,ue,le,me],key:"skyBox"},{type:"cubeTextures",path:[he,de,fe,pe,be,ge],key:"skyBox2"},{type:"img",path:re,key:"mapFloorOuter",wrap:!0},{type:"img",path:oe,key:"mapFloorOuter2",wrap:!0},{type:"img",path:ae,key:"mapTop",wrap:!0}]},{key:"system_PlayerMoveOnLevel",constr:function e(t){Object(p.a)(this,e);var n=t.emitter,r=t.CONSTANTS,o=t.player,a=(t.level,t.assets),s=t.studio,i=0,c=new ve,u=je(a.areas,s,c);u(i);var l=r.playerConfig,m=l.speed,h=l.speedDown,d=l.speedRot,f=!1;o.toggleBlocked=function(e){return f=e};var b=!1,v={},y=new g.Quaternion,j=new g.Quaternion,w=new g.Vector3(0,1,0),_=function(){y.copy(o.mesh.quaternion),j.setFromAxisAngle(w,Math.random()*Math.PI*2),f=!0,ye(o.mesh,y,j).then((function(){o.mesh.up.copy(w),f=!1}))},O=function(e){var t=c.checkCollisions(o.mesh,o.frontObj,17),n=Object(T.a)(t,2),r=n[0],a=n[1];r&&a.object.userData.area!==i&&(i=a.object.userData.area,u(i)),r?a.object.userData.isWallWalking&&function(e){y.copy(o.mesh.quaternion);var t=(new g.Vector3).addVectors(o.mesh.position,e.face.normal);o.mesh.lookAt(t),o.mesh.up.copy(e.face.normal),o.mesh.rotateX(Math.PI/2),j.copy(o.mesh.quaternion),o.mesh.setRotationFromQuaternion(y),f=!0,ye(o.mesh,y,j).then((function(){f=!1}))}(a):o.mesh.translateZ(-m*e.count)};n.subscribe("keyEvent")((function(e){return v=e})),n.subscribe("frameUpdate")((function(e){b||(v.left&&o.mesh.rotateY(d*e.count),v.right&&o.mesh.rotateY(-d*e.count),f||(!function(e){var t=c.checkCollisions(o.mesh,o.bottomObj,17.2),n=Object(T.a)(t,2),r=n[0],a=n[1];if(r&&a.object.userData.area!==i&&(i=a.object.userData.area,u(i)),!(r&&17>a.distance))return r?void(a.object.userData.isWallWalking||o.mesh.up.equals(w)||_()):(!o.mesh.up.equals(w)&&_(),void(o.mesh.position.y+=h*e.count));o.mesh.translateY(17-a.distance)}(e),v.up&&O(e),v.down&&function(e){var t=c.checkCollisions(o.mesh,o.backObj,17);Object(T.a)(t,1)[0]||o.mesh.translateZ(m*e.count)}(e),v.p&&console.log("player.mesh.position.fromArray([".concat(o.mesh.position.x,", ").concat(o.mesh.position.y+25,", ").concat(o.mesh.position.z,"])"))))})),n.subscribe("toggleDialog")((function(e){return b=e.isOpen}))},initStateKey:"beforeStartPlay"},{key:"system_Monsters",constr:function e(t){Object(p.a)(this,e)},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:n.p+"static/media/monster.b2d77bee.obj",key:"monster"},{type:"img",path:n.p+"static/media/skin.74238fbf.jpg",key:"skin",wrap:!0}]},{key:"starterPlay",constr:function e(t){Object(p.a)(this,e);var n=t.player,r=t.ui,o=t.studio;t.dispatcher.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:3}),r.showStartButton((function(){n.toggleBlocked(!1),o.changeEnvironment(h,{updateAmb:!1})}))},initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return i.apply(this,arguments)}(we,r)}))}},[[41,1,2]]]);
//# sourceMappingURL=main.4c8a3869.chunk.js.map