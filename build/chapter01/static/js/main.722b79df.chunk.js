(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{39:function(e,t,o){},41:function(e,t,o){},42:function(e,t,o){},44:function(e,t,o){"use strict";o.r(t);var n={};o.r(n),o.d(n,"CURRENT_CHAPTER",(function(){return d})),o.d(n,"MATERIALS_CONFIG",(function(){return h})),o.d(n,"END_ENV",(function(){return p})),o.d(n,"studioConfig",(function(){return f})),o.d(n,"playerConfig",(function(){return b})),o.d(n,"BOT",(function(){return y})),o.d(n,"BOTS",(function(){return g}));var r=o(10),i=o.n(r),s=o(11);function a(){return(a=Object(s.a)(i.a.mark((function e(t,o){var n,r,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,n={CONSTANTS:o}),r=n.loaderAssets,s=l(t),e.next=6,r.loadAssets(s);case 6:n.assets=e.sent,c("beforeStartPlay",t,n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,o){for(var n=0;n<t.length;++n){var r=t[n],i=r.key,s=r.constr;r.initStateKey===e&&(o[i]=new s(o))}},l=function(e){for(var t=[],o=0;o<e.length;++o)if(e[o].assetsToLoad&&e[o].assetsToLoad.length)for(var n=0;n<e[o].assetsToLoad.length;++n)t.push(e[o].assetsToLoad[n]);return t},u=Math.PI,m=u/2,d=0,h={easyMaterial:{mat:"MeshBasicMaterial",props:{}},wall:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:0,map:"wallTexture",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.5,specular:2236962}},door:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:0,map:"doorTexture",bumpMap:"doorTexture",bumpScale:1,envMap:"skyBox",reflectivity:.5,specular:2236962}},bot:{mat:"MeshPhongMaterial",props:{color:10990770,map:"monster-skin",emissive:1645624,bumpMap:"monster-skin",bumpScale:.2,shininess:500,specular:16777215,skinning:!0}}},p={fogNear:-10,fogFar:0,color:927029,backgroundImgKey:null},f={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:13421823,strength:.6},clearColor:927029,sceneEnvironment:{fogNear:10,fogFar:80,color:927029,backgroundImgKey:null}},b={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:5,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[48,28,10],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e3,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:13421823,strength:.3,pos:[0,50,0]}},y={offsetWallCollision:5},g=[{name:"guard_01",pos:[-53,26.316999435,27],rot:0,keyWallToWalkCollisions:"collision_bot_guardsmall"},{name:"guard_Super_02",pos:[-39,45.317001,-112],rot:0,keyWallToWalkCollisions:"collision_bot_guardsuper"},{name:"master",pos:[-91,26.316999435,35],rot:m-1,keyWallToWalkCollisions:"collision_bot_lab"},{name:"scientist",pos:[31,64.3152008,-48],rot:m,keyWallToWalkCollisions:"collision_bot_sciensist"},{name:"engineer",pos:[-1,25.3152,-69],rot:u,keyWallToWalkCollisions:"collision_bot_engeneer"},{name:"programmer",pos:[25,64.3152008,-4],rot:0,keyWallToWalkCollisions:"collision_bot_programmer"},{name:"mechanic",pos:[11,25.3152,-8],rot:m,keyWallToWalkCollisions:"collision_bot_start"},{name:"scout",pos:[-49,26.316999435,172],rot:m,keyWallToWalkCollisions:"collision_bot_scout"}],v=o(1),_=o(2),O=o(0),j=o(20),C=o(21),w=function(){var e=null,t=null,o=null,n=null,r=null;return function(i,s){return new Promise((function(a){(function(i){return"obj"===i?e=e||new j.a:"glb"===i||"gltf"===i?o=o||new C.a:"img"===i?t=t||new O.TextureLoader:"cubeTextures"===i?n=n||new O.CubeTextureLoader:"soundMp3"===i?r=r||new O.AudioLoader:void 0})(s).load(i,a)}))}},k=function(){function e(){Object(v.a)(this,e),this.resources={},this._load=w()}return Object(_.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(o){var n=t._load,r=t.resources;function a(e){return c.apply(this,arguments)}function c(){return(c=Object(s.a)(i.a.mark((function t(s){var c,l,u,m;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[s]){t.next=5;break}return c=e[s],l=c.key,u=c.path,m=c.type,t.next=4,n(u,m);case 4:r[l]=t.sent;case 5:if(++s,e[s]){t.next=10;break}o(r),t.next=12;break;case 10:return t.next=12,a(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}a(0)}))}}]),e}(),S=function(){function e(){Object(v.a)(this,e),this._storage={}}return Object(_.a)(e,[{key:"emit",value:function(e){var t=this;return function(o){return D(t._storage)(e).forEach((function(e){return e(o)}))}}},{key:"subscribe",value:function(e){var t=this;return function(o){return D(t._storage)(e).push(o),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==o}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),D=function(e){return function(t){return e[t]=e[t]||[]}},x=o(4),I=o(16),T=o.n(I),M=o(7),P=o(9),B=o(5),E=(o(39),"en"),N=function(e){return function(t){return e[E]&&e[E][t]||t}},A=o(3),F=N({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),L=Object(M.b)((function(e){return Object(B.a)({},e.controls.infoPanelData)}))((function(e){return Object(A.jsxs)("div",{className:"info",children:[Object(A.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(A.jsxs)("div",{className:"info-inner",children:[Object(A.jsx)("p",{children:F(e.title)}),Object(A.jsx)("p",{children:F(e.topText)}),Object(A.jsx)("ul",{children:e.chapters.map((function(t,o){return Object(A.jsxs)("li",{children:[o+1,".\xa0",t.href?Object(A.jsx)("span",{children:Object(A.jsx)("a",{href:t.href,target:"blank",children:F(t.text)})}):Object(A.jsx)("span",{children:F(t.text)}),o===e.currentChapterIndex&&F(" (current)")]},o)}))}),Object(A.jsx)("p",{children:e.bottomText}),Object(A.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(A.jsxs)("li",{children:[F(e.text),Object(A.jsx)("a",{href:e.href,target:"blank",children:F(e.aText)})]},t)}))})]})]})})),W=(o(41),Object(M.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(x.useState)(!0),o=Object(P.a)(t,2),n=o[0],r=o[1];return Object(x.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&r(!0)}))})),Object(A.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(A.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(A.jsx)(A.Fragment,{children:"\u27fc"}):Object(A.jsx)(A.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(A.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(A.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(A.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(A.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&n&&Object(A.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),r(!1)},children:"\u2752"}),!e.isInfo&&Object(A.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(A.jsx)(L,{})]})})));var K={dispatch:null},U=Object(M.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!K.dispatch&&(K.dispatch=e.dispatch),Object(A.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(A.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(A.jsx)(W,{gameContext:e.gameContext})]})})),G=o(13),R=o(23),H={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var Y=document.querySelector(".progress"),q=-100,z=!0;!function e(){z&&setTimeout((function(){0===++q&&(q-=100),Y.style.marginLeft=q+"%",e()}),30)}();var V=function(){function e(t){Object(v.a)(this,e),t.dispatcher=K,this._root=t;var o=function(e){e.customStore||(e.customStore={});var t=Object(G.b)(Object(B.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(B.a)(Object(B.a)({},e),{},{infoPanelData:Object(B.a)(Object(B.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(B.a)(Object(B.a)({},e),{},{isMute:t.is}):Object(B.a)({},e)}},e.customStore)),o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||G.c;return Object(G.d)(t,o(Object(G.a)(R.a)))}(t);o&&T.a.render(Object(A.jsx)(M.a,{store:o,children:Object(A.jsx)(U,{gameContext:t})}),document.getElementById("root"))}return Object(_.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),o=document.querySelector(".progress-wrapper"),n=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,E=t),document.querySelector(".start-screen").style.display="none"};z=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),n(t)})),o.style.display="none"}}]),e}(),J={ru:{"I ...?":"\u042f ...?","You ...?":"\u0422\u044b ...?","MM ...?":"\u041c ...?","You is new droid.":"\u0422\u044b \u043d\u043e\u0432\u044b\u0439 \u0434\u0440\u043e\u0438\u0434.","I am mechanic. I create your body.":"\u041c\u0435\u0445\u0430\u043d\u0438\u043a. \u0414\u0435\u043b\u0430\u044e \u043a\u043e\u0440\u043f\u0443\u0441\u044b \u0434\u0440\u043e\u0438\u0434\u043e\u0432.","Go. Door is unblocked.... Beeeb.":"\u0418\u0434\u0438, \u0434\u0432\u0435\u0440\u044c \u0440\u0430\u0437\u0431\u043b\u043e\u043a\u0438\u0440\u043e\u0432\u0430\u043d\u0430.... \u0411\u0438\u0438\u0431.","Once .... Beeeb.. I set basic program in your memory.":"\u0421\u0435\u043a\u0443\u043d\u0434\u0443 .... \u0411\u0438\u0438\u0431.. \u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430 \u0432 \u043f\u0430\u043c\u044f\u0442\u044c \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u0430.","I am programmer.":"\u041f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u0443\u044e \u0434\u0440\u043e\u0438\u0434\u043e\u0432.","Go. Once... Beeeb.. Door to laboratory unblocked.":"\u0422\u044b \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u0434\u0442\u0438 \u0432 \u043e\u0442\u0434\u0435\u043b \u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f. \u0411\u0438\u0438\u0431.. \u0414\u043e\u0441\u0442\u0443\u043f \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d.","Once .. Beeeb! I give name to you. Droid_Id: 17543-06767-6767":"\u0421\u0435\u043a\u0443\u043d\u0434\u0443... \u0411\u0438\u0438\u0431. \u0422\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u043e\u0448\u043b\u043e \u0443\u0441\u043f\u0435\u0448\u043d\u043e.","I am engineer. I test new droids.":"\u0422\u0435\u0441\u0442\u0435\u0441\u0442\u0438\u0440\u043e\u0432\u0449\u0438\u043a, \u0442\u0435\u0441\u0442\u0438\u0440\u0443\u044e \u043d\u043e\u0432\u044b\u0445 \u0434\u0440\u043e\u0438\u0434\u043e\u0432.","Go.":"\u0418\u0434\u0438 \u043d\u0430 \u043f\u0440\u0438\u0435\u043c\u043a\u0443.","Droid_Id: 17543-06767-6767, Hmm.., marriage. crap.":"\u0421\u0435\u043a\u0443\u043d\u0434\u0443... \u0411\u0438\u0438\u0431. \u0425\u0430\u043b\u0442\u0443\u0440\u0430, \u0431\u0440\u0430\u043a ... \u041b\u0430\u0434\u043d\u043e \u0442\u044b \u0442\u0435\u043f\u0435\u0440\u044c \u0434\u0440\u043e\u0438\u0434_17543-06767-6767.","I am scientist. I check your abilities. ... garbage.":"\u041f\u0440\u0438\u0435\u043c\u0449\u0438\u043a. \u041f\u0440\u043e\u0432\u0435\u0440\u044f\u044e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u043e \u0441\u0431\u043e\u0440\u043a\u0438. ","Go to store. Doors unblocked.":"\u0418\u0434\u0438 \u043d\u0430 \u0441\u043a\u043b\u0430\u0434. \u0414\u043e\u0441\u0442\u0443\u043f \u0434\u0430\u043d.","I don\u2019t know anything, go to the boss. ... Beeeb. You have the accesses.":"\u041d\u0438\u0447\u0435\u0433\u043e \u0434\u043b\u044f \u0442\u0435\u0431\u044f \u043d\u0435\u0442, \u0438\u0434\u0438 \u0432 \u0448\u0442\u0430\u0431... \u0411\u0438\u0438\u0431. \u0421\u0442\u0430\u0442\u0443\u0441: \u043c\u043e\u0434\u0435\u043b\u044c \u0443\u043a\u043e\u043c\u043b\u0435\u043a\u0442\u043e\u0432\u0430\u043d\u0430.","You want see Boss. He is absent.":"\u0418\u0449\u0435\u0448\u044c \u0431\u043e\u0441\u0441\u0430, \u0435\u0433\u043e \u043d\u0435\u0442.","I am guard. I give you a secret mission.":"\u041f\u043e\u043c\u043e\u0448\u043d\u0438\u043a. \u042f \u0434\u0430\u044e \u0442\u0435\u0431\u0435 \u0441\u0435\u043a\u0440\u0435\u0442\u043d\u0443\u044e \u043c\u0438\u0441\u0441\u0438\u044e.","You must see all around base, and return. Doors unblocked.":"\u0422\u044b \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u0445\u043e\u0434\u0438\u0442\u044c \u043d\u0430 \u0440\u0430\u0437\u0432\u0435\u0434\u043a\u0443 \u0432\u043e\u043a\u0440\u0443\u0433 \u0431\u0430\u0437\u044b \u0438 \u0434\u043e\u043b\u043e\u0436\u0438\u0442\u044c. \u0412\u043f\u0435\u0440\u0435\u0434.","Droid_Id: 17543-06767-6767 with secret mission. I know.":"\u0422\u044b \u0434\u0440\u043e\u0438\u0434 \u0441 \u0432\u0430\u0436\u043d\u043e\u0439 \u0441\u0435\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u043c\u0438\u0441\u0441\u0438\u0435\u0439.","I am gateman. Beeeb... Door is opened! Good bye!":"\u041e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0437\u0430 \u0432\u043d\u0435\u0448\u043d\u0438\u0439 \u043f\u0435\u0440\u0438\u043c\u0435\u0442\u0440. \u0411\u0438\u0438\u0431... \u0414\u043e\u0441\u0442\u0443\u043f \u043a \u0432\u043e\u0440\u043e\u0442\u0430\u043c \u0434\u0430\u043d.","It does not matter.":"\u042d\u0442\u043e \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f.","I am scout. Crazy factory create droids and close gates. You alone in this desert.":"\u0414\u0440\u043e\u0438\u0434. \u0421\u0443\u043c\u043c\u0430\u0441\u0448\u0435\u0434\u0448\u0430\u044f \u0444\u0430\u0431\u0440\u0438\u043a\u0430 \u043a\u043b\u0435\u043f\u0430\u0435\u0442 \u0434\u0440\u043e\u0438\u0434\u043e\u0432, \u0434\u0430\u0435\u0442 \u0441\u0435\u043a\u0440\u0435\u0442\u0438\u043d\u044b\u0435 \u043c\u0438\u0441\u0441\u0438\u0438 \u0438 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u0432\u043e\u0440\u043e\u0442\u0430.","This is the end.":"\u042d\u0442\u043e \u0432\u0441\u0435. The end.",open:"\u0434\u0438\u0430\u043b\u043e\u0433",close:"\u0437\u0430\u043a\u0440\u044b\u0442\u044c"}},Z=N(J),X=Object(M.b)((function(e){return{replicies:e.dialogs.replicies,currentBotKey:e.dialogs.currentBotKey}}))((function(e){var t=e.replicies[e.currentBotKey].messages,o=t.map((function(e,t){return e.isDone?Object(A.jsxs)("div",{className:"marTop-small",children:[Object(A.jsx)("p",{className:"player",children:Z(e.player)}),Object(A.jsx)("p",{children:Z(e.nps)})]},t):Object(A.jsx)("div",{},t)})),n=t.map((function(t,o){return t.isDone?Object(A.jsx)("div",{},o):Object(A.jsx)("button",{onClick:function(){return e.dispatch({type:"CLICK_ON_PLAYER_PHRASE",currentBotKey:e.currentBotKey,phraseIndex:o})},children:Z(t.player)},o)}));return Object(A.jsxs)("div",{className:"messages-wrapper",children:[Object(A.jsx)("div",{className:"messages",children:o}),Object(A.jsx)("div",{className:"replicies",children:n})]})})),Q=(o(42),N(J));var $=Object(M.b)((function(e){return{isButtonDialog:e.dialogs.isButtonDialog,isCloseisButtonDialog:e.dialogs.isCloseisButtonDialog,isShowPalleteDialog:e.dialogs.isShowPalleteDialog,isShowFinalMessage:e.dialogs.isShowFinalMessage}}))((function(e){return Object(A.jsxs)(A.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(A.jsx)("div",{className:"dialog-wrapper",children:Object(A.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(A.jsx)(X,{}),(e.isButtonDialog||e.isShowPalleteDialog)&&Object(A.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"SHOW_PALLETE_DIALOG",is:!!e.isButtonDialog||e.isShowPalleteDialog&&!1})},style:{display:e.display},children:e.isButtonDialog&&Q("open")||e.isShowPalleteDialog&&Q("close")})]})}),e.isShowFinalMessage&&Object(A.jsx)("div",{className:"final-mess",children:Object(A.jsx)("button",{onClick:function(){window.location.replace("./../chapter02")},children:Q("Continue")})})]})})),ee={replicies:{mechanic:{isDone:!1,messages:[{player:"I ...?",nps:"You is new droid.",isDone:!1},{player:"You ...?",nps:"I am mechanic. I create your body.",isDone:!1},{player:"MM ...?",nps:"Go. Door is unblocked.... Beeeb.",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["factory"]}}}]},programmer:{isDone:!1,messages:[{player:"I ...?",nps:"Once .... Beeeb.. I set basic program in your memory.",isDone:!1},{player:"You ...?",nps:"I am programmer.",isDone:!1},{player:"MM ...?",nps:"Go. Once... Beeeb.. Door to laboratory unblocked.",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["fromLaboratory001"]}}}]},engineer:{isDone:!1,messages:[{player:"I ...?",nps:"Once .. Beeeb! I give name to you. Droid_Id: 17543-06767-6767",isDone:!1},{player:"You ...?",nps:"I am engineer. I test new droids.",isDone:!1},{player:"MM ...?",nps:"Go.",isDone:!1}]},scientist:{isDone:!1,messages:[{player:"I ...?",nps:"Droid_Id: 17543-06767-6767, Hmm.., marriage. crap.",isDone:!1},{player:"You ...?",nps:"I am scientist. I check your abilities. ... garbage.",isDone:!1},{player:"MM ...?",nps:"Go to store. Doors unblocked.",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["fromFactoryCorpus","toLab","toGarage"]}}}]},master:{isDone:!1,messages:[{player:"I ...?",nps:"I don\u2019t know anything, go to the boss. ... Beeeb. You have the accesses.",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["toBoss"]}}}]},guard_Super_02:{isDone:!1,messages:[{player:"I ...?",nps:"You want see Boss. He is absent.",isDone:!1},{player:"You ...?",nps:"I am guard. I give you a secret mission.",isDone:!1},{player:"MM ...?",nps:"You must see all around base, and return. Doors unblocked.",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["fromStore","fromSecurity","toArsenal"]}}}]},guard_01:{isDone:!1,messages:[{player:"I ...?",nps:"Droid_Id: 17543-06767-6767 with secret mission. I know.",isDone:!1},{player:"You ...?",nps:"I am gateman. Beeeb... Door is opened! Good bye!",isDone:!1,event:{type:"unblockDoor",data:{idDoor:["toWorld"]}}}]},scout:{isDone:!1,messages:[{player:"I ...?",nps:"It does not matter.",isDone:!1,event:{type:"blockDoor",data:{idDoor:["toWorld"]}}},{player:"You ...?",nps:"I am scout. Crazy factory create droids and close gates. You alone in this desert.",isDone:!1},{player:"MM ...?",nps:"This is the end.",isDone:!1}]}},isCloseisButtonDialog:!1,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,currentBotKey:null,currentLanguage:"en"},te=o(46),oe=o(17),ne=o(27),re=o(25),ie=o(15),se={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},ae=o(24),ce=function(){function e(t){var o=this;Object(v.a)(this,e),this._root=t;var n=t.assets,r=t.emitter,i=t.CONSTANTS.studioConfig,s=i.canId,a=i.rendererCon,c=i.clearColor,l=i.amb;a.canvas=document.getElementById(s),this._renderer=new O.WebGLRenderer(a),this._renderer.setClearColor(c),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new O.Scene;var u=t.CONSTANTS.studioConfig.sceneEnvironment,m=u.color,d=u.fogNear,h=u.fogFar,p=u.backgroundImgKey;this._scene.background=n[p]||null,this._scene.fog=new O.Fog(m,d,h),this._lightA=null;var f=l.color,b=l.strength;this._lightA=new O.AmbientLight(f,b),this._scene.add(this._lightA),this._playerCamera=new O.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new O.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var y=new ae.a(this._controlsCamera,this._renderer.domElement);y.target.set(0,0,0),y.update(),this._composer=new ne.a(this._renderer),this._renderPass=new re.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&"Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ie.a(se));var g=new O.Vector3,_=!0,j=null;r.subscribe("keyEvent")((function(e){e.o&&(_?(j=Object(B.a)({},o._scene.fog),o._scene.fog.near=1e3,o._scene.fog.far=2e3,_=!1,o._renderPass.camera=o._controlsCamera,o._playerCamera.getWorldPosition(g),o._controlsCamera.position.x=g.x+100,o._controlsCamera.position.y=g.y+100,o._controlsCamera.position.z=g.z,y.target.set(g.x,g.y,g.z),y.update()):(o._scene.fog.near=j.near,o._scene.fog.far=j.far,_=!0,o._renderPass.camera=o._playerCamera))}));var C=function(){var e={width:window.innerWidth,height:window.innerHeight};o._renderer.setSize(e.width,e.height),o._composer.setSize(e.width,e.height),o._controlsCamera&&(o._controlsCamera.aspect=e.width/e.height,o._controlsCamera.updateProjectionMatrix()),o._playerCamera&&(o._playerCamera.aspect=e.width/e.height,o._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",C),C(),this.addToScene=this._scene.add.bind(this._scene),this.removeFromScene=this._scene.remove.bind(this._scene);r.subscribe("frameUpdate")((function(){o._composer.render(o._scene,o._controlsCamera)})),this._backgroundImgKey=t.CONSTANTS.studioConfig.sceneEnvironment.backgroundImgKey,r.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(_.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){var o=this,n=e.fogNear,r=e.fogFar,i=e.color;if(this._scene.fog.near!==n||this._scene.fog.far!==r||this._scene.fog.color!==r){var s={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},a={color:new O.Color(i),near:n,far:r};new oe.a(s).to(a,t&&t.time||3e3).onUpdate((function(){o._scene.fog.color=s.color,o._scene.fog.near=s.near,o._scene.fog.far=s.far,t?t.updateAmb&&(o._lightA.color=s.color):o._lightA.color=s.color,o._renderer.setClearColor(s.color)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),le=function(){function e(t){Object(v.a)(this,e);var o=t.emitter,n={up:!1,down:!1,left:!1,right:!1,p:!1},r={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=r,this.keys=n;var i=function(e,t){switch(e){case 38:case 87:r.up&&(n.up=t);break;case 40:case 83:r.down&&(n.down=t);break;case 37:case 65:n.left=t;break;case 39:case 68:n.right=t;break;case 79:n.o=t;break;case 80:n.p=t}o.emit("keyEvent")(n)};document.addEventListener("keydown",(function(e){return i(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return i(e.keyCode,!1)})),o.subscribe("mouseDown")((function(e){"butt-left"===e&&i(37,!0),"butt-right"===e&&i(39,!0),"butt-front"===e&&i(38,!0),"butt-back"===e&&i(40,!0)})),o.subscribe("mouseUp")((function(e){"butt-left"===e&&i(37,!1),"butt-right"===e&&i(39,!1),"butt-front"===e&&i(38,!1),"butt-back"===e&&i(40,!1)}))}return Object(_.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ue=function(){function e(t){var o=this;Object(v.a)(this,e),this._root=t;var n=t.emitter,r=t.studio,i=t.CONSTANTS.playerConfig,s=i.startPos,a=i.startRot,c=i.cameraData,l=i.frontObjPos,u=i.backObjPos,m=i.lightDataOne,d=i.speed,h=i.offsetFromFloor,p=i.offsetFromFloorFactor,f=i.offsetWallCollision,b=i.speedDown,y=i.speedRot;this._camera=null;var g={},_=!1;this._isBlocked=!0,this._isCanMove={up:!0,down:!0},this._mainObj=new O.Object3D,this._mainObj.position.fromArray(s),this._mainObj.rotation.fromArray(a),this._mainObj.userData.type="player";var j=new O.Object3D;j.position.fromArray([0,-.05,0]),this._mainObj.add(j);var C=new O.Object3D;C.position.fromArray(l),this._mainObj.add(C),this.frontObj=C;var w=new O.Object3D;w.position.fromArray(u),this._mainObj.add(w),this.backObj=w;var k=c.fov,S=c.ratio,D=c.near,x=c.far,I=c.pos;this._camera=new O.PerspectiveCamera(k,S,D,x),this._camera.position.fromArray(I),this._mainObj.add(this._camera);var T=m.color,M=m.strenth,B=m.pos,E=new O.PointLight(T,M);E.position.fromArray(B),this._mainObj.add(E);n.subscribe("keyEvent")((function(e){return g=e})),n.subscribe("frameUpdate")((function(e){if(!_&&(g.left&&(o._mainObj.rotation.y+=y*e.count),g.right&&(o._mainObj.rotation.y-=y*e.count),!o._isBlocked)){if(o._root.systemCollisionFloor){var t=o._root.systemCollisionFloor.checkCollisions(o._mainObj,j,h),r=Object(P.a)(t,3),i=r[0],s=r[1];r[2];i?s<h-1&&o._mainObj.translateY(h-p-s):o._mainObj.position.y+=b}if(g){if(g.up){if(!o._isCanMove.up)return;if(o._root.systemCollisionItems){var a=o._root.systemCollisionItems.checkCollisions(o._mainObj,C,f);if(Object(P.a)(a,1)[0])return}o._mainObj.translateZ(-d*e.count),n.emit("playerMove")({pos:o._mainObj.position,dir:"up"})}if(g.down){if(!o._isCanMove.down)return;if(o._root.systemCollisionItems){var c=o._root.systemCollisionItems.checkCollisions(o._mainObj,w,f);if(Object(P.a)(c,1)[0])return}o._mainObj.translateZ(d*e.count),n.emit("playerMove")({pos:o._mainObj.position,dir:"down"})}g.p&&console.log(o._mainObj.position)}}})),n.subscribe("toggleDialog")((function(e){return _=e.isOpen})),r.setCamera(this._camera),r.addToScene(this._mainObj)}return Object(_.a)(e,[{key:"toggleBlocked",value:function(e){this._isBlocked=e}},{key:"toggleCanMove",value:function(e,t){this._isCanMove[e]=t}},{key:"getObj",value:function(){return this._mainObj}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,o){this._mainObj.position.set(e,t,o)}}]),e}(),me=function(){function e(t){Object(v.a)(this,e),this._root=t,this._arrMeshes=[],this._vecStart=new O.Vector3,this._vecDir=new O.Vector3,this._rayCaster=new O.Raycaster(this._vecStart,this._vecDir)}return Object(_.a)(e,[{key:"setItemToCollision",value:function(e){var t=e.mesh,o=e.itemKeyEmitCollision,n=void 0===o?null:o,r=e.isStopUnits,i=void 0===r||r;t.userData.itemKeyEmitCollision=n,t.userData.isStopUnits=i,this._arrMeshes.push(t)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,o){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var n=this._rayCaster.intersectObjects(this._arrMeshes);return n[0]&&n[0].distance<o&&(n[0].object.userData.itemKeyEmitCollision&&this._root.emitter.emit("collision")(Object(B.a)(Object(B.a)({},n[0].object.userData.itemKeyEmitCollision),{},{type2:e.userData.type})),n[0].object.userData.isStopUnits)?[!0,n[0].distance,n[0].point]:[!1,null]}}]),e}(),de=function(e,t){for(var o in e)e[o].wrapS&&(e[o].wrapS=e[o].wrapT=O.RepeatWrapping);var n=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],r={},i=function(o){r[o]=new O[t[o].mat](Object(B.a)({},t[o].props)),n.map((function(n){return t[o].props[n]&&(r[o][n]=e[t[o].props[n]])}))};for(var s in t)i(s);return r},he=o.p+"static/media/level_01.bcfccfd8.obj",pe=o.p+"static/media/wall.ccfc1f44.jpg",fe=o.p+"static/media/level-ray.2b82bfff.obj",be=function(e,t){return setTimeout(t,e)},ye=function(e,t,o,n,r,i){var s=16.666,a=r/s,c=(n-o)/a,l=0;!function o(){if(++l>a)return e[t]=n,void i();e[t]+=c,setTimeout(o,s)}()},ge=o(26),ve=function(e){return _e(e.map((function(e){return function(t){return function(){return e[0].apply(e,Object(ge.a)(e[1]).concat([t]))}}})))},_e=function(e){!function t(o){return e[o]&&e[o]((function(){return t(++o)}))()}(0)};var Oe=function(){function e(t){var o=this;Object(v.a)(this,e);var n=t.assets,r=t.materials,i=t.studio,s=t.emitter,a=t.systemCollisionItems;for(var c in this._doors={},n["level-rooms"].traverse((function(e){if(e.name.includes("doormesh_")){var t=e.name.split("_")[1];!o._doors[t]&&(o._doors[t]={}),o._doors[t].mesh=new O.Mesh(e.geometry,r.door),o._doors[t].state="closed",o._doors[t].access="denied",o._doors[t].mesh.userData={part:"mesh",type:"door",id:t}}})),this._doors)i.addToScene(this._doors[c].mesh),a&&a.setItemToCollision({mesh:this._doors[c].mesh,dist:7,itemKeyEmitCollision:{key:c,type:"door"},isStopUnits:!0});s.subscribe("collision")((function(e){"door"===e.type&&e.type2&&"player"===e.type2&&"confirm"===o._doors[e.key].access&&"closed"===o._doors[e.key].state&&o._openDoor(e.key)})),s.subscribe("unblockDoor")((function(e){for(var t=0;t<e.idDoor.length;t++)o._doors[e.idDoor[t]].access="confirm"})),s.subscribe("blockDoor")((function(e){for(var t=0;t<e.idDoor.length;t++)o._doors[e.idDoor[t]].access="denied"}))}return Object(_.a)(e,[{key:"_openDoor",value:function(e){var t=this;this._doors[e].state="opened",function(e){var t=e.prop,o=e.key,n=e.fromVal,r=e.offset,i=e.time,s=void 0===i?1e3:i,a=e.pause;ve([[ye,[t,o,n,n+r,s]],[be,[void 0===a?2e3:a]],[ye,[t,o,n+r,n,s]],[arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},[]]])}({prop:this._doors[e].mesh.position,key:"y",fromVal:this._doors[e].mesh.position.y,offset:15,time:500,pause:2e3},(function(){return t._doors[e].state="closed"}))}}]),e}(),je=o.p+"static/media/door.edd859db.jpg",Ce=Math.random;var we=function(e){var t=e.animations,o=new O.AnimationMixer(e.scene.children[1].children[1]),n=o.clipAction(t[0]);n.timeScale=.3;var r=o.clipAction(t[2]);r.timeScale=.7,r.play();var i={dialog:n,walk:r},s=null;return{update:function(e){o.update(e)},play:function(e){s!==e&&(s=e,o.stopAllAction(),i[e].play())}}},ke=function(e){var t=(Ce()*Math.PI*1.5+1.3)*Ce()<.5?1:-1,o=t/40,n=0;return function(){return e.rotation.y+=o,++n<40}},Se=function(e,t){var o=t?Math.min(t/.15,800*Ce()+300):null,n=0;return function(){return!!t&&(e.translateZ(.15),++n<o)}},De=function(e,t,o,n){var r=!1,i=xe(),s={rotate:ke,go:Se},a="rotate",c=null,l=function(o){o||("rotate"===a&&(o="go"),"go"===a&&(o="rotate")),a=o;var n=i.checkCollisions(e,t);c=s[o](e,Math.max(n-20,0))};return l(a),n.subscribe("frameUpdate")((function(){r&&!c()&&l()})),{start:function(){l("rotate"),r=!0},stop:function(){return r=!1},setItemToCollision:i.setItemToCollision,removeItemFromCollision:i.removeItemFromCollision,clearCollisions:i.clearCollisions}},xe=function(){var e=[],t=new O.Vector3,o=new O.Vector3,n=new O.Raycaster(t,o);return{setItemToCollision:function(t){e.push(t)},removeItemFromCollision:function(t){e=e.filter((function(e){return e!==t}))},clearCollisions:function(){e=[]},checkCollisions:function(r,i){r.getWorldPosition(t),i.getWorldPosition(o),o.sub(t);var s=n.intersectObjects(e,!0);return!!s[0]&&s[0].distance}}},Ie=o.p+"static/media/monster-animate3.f32b90f6.glb",Te=o.p+"static/media/monster-skin.64f3a049.jpg",Me=function(){function e(){Object(v.a)(this,e),this._itemWorldPos=new O.Vector3,this._mainCheckerWorldPos=new O.Vector3,this._arr=[]}return Object(_.a)(e,[{key:"setItemToCheck",value:function(e){this._arr.push(e)}},{key:"checkNear",value:function(e,t){e.getWorldPosition(this._mainCheckerWorldPos);for(var o=0;o<this._arr.length;++o){if(this._arr[o].userData.inScene)if(this._arr[o].getWorldPosition(this._itemWorldPos),this._itemWorldPos.distanceTo(this._mainCheckerWorldPos)<t)return[!0,this._arr[o].userData]}return[!1,null]}}]),e}(),Pe=[{key:"emitter",constr:S,initStateKey:"pageLoaded"},{key:"customUi",constr:function e(t){Object(v.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=$,t.customStore=function(e){return{dialogs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee,o=arguments.length>1?arguments[1]:void 0;if("BUTTON_DIALOG_TOGGLE"===o.type){var n=o.isButtonDialog,r=o.currentBotKey;return Object(B.a)(Object(B.a)({},t),{},{isButtonDialog:n,currentBotKey:r})}if("SHOW_PALLETE_DIALOG"===o.type)return e.player.toggleBlocked(o.is),Object(B.a)(Object(B.a)({},t),{},{isButtonDialog:!o.is,isShowPalleteDialog:o.is});if("CLICK_ON_PLAYER_PHRASE"===o.type){var i=JSON.parse(JSON.stringify(t.replicies));if(i[o.currentBotKey].messages[o.phraseIndex].isDone=!0,i[o.currentBotKey].messages[o.phraseIndex].event){var s=i[o.currentBotKey].messages[o.phraseIndex].event,a=s.type,c=s.data;console.log(a,c),"blockDoor"===a&&c.idDoor&&c.idDoor.length&&"toWorld"===c.idDoor[0]&&setTimeout((function(){e.player.toggleBlocked(!0),e.studio.changeEnvironment(p,{updateAmb:!1,time:1500}),setTimeout((function(){return e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),e.emitter.emit(a)(c)}for(var l=!0,u=0;u<i[o.currentBotKey].messages.length;++u)!1===i[o.currentBotKey].messages[u].isDone&&(l=!1);return i[o.currentBotKey].isDone=l,Object(B.a)(Object(B.a)({},t),{},{replicies:i,isCloseisButtonDialog:l})}return"SHOW_FINAL_MESSAGE"===o.type?Object(B.a)(Object(B.a)({},t),{},{isShowFinalMessage:!0}):t}}}(t),t.ui=new V(t)},initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(v.a)(this,e);var o=t.emitter,n=t.appWrapper;!n&&(n=document.querySelector(".app-wrapper")),o.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&r()}));var r=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},i=function(e){n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||o.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",i),i()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:k,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:function e(t){Object(v.a)(this,e);var o=t.emitter.emit("frameUpdate"),n={time:0,delta:0,count:0,oldTime:0},r=te.a((function(){return n}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){return o(e),e}),(function(e){return e.oldTime=e.time,e}),(function(e){return n=e}));!function e(){requestAnimationFrame(e),r(n)}()},initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(v.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return oe.b()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:ce,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:le,initStateKey:"beforeStartPlay"},{key:"player",constr:ue,initStateKey:"beforeStartPlay"},{key:"systemCollisionItems",constr:me,initStateKey:"beforeStartPlay"},{key:"systemCollisionFloor",constr:me,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(v.a)(this,e);var o=t.assets,n=t.CONSTANTS;t.materials=de(o,n.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"level",constr:function e(t){Object(v.a)(this,e);var o=t.assets,n=t.materials,r=t.studio,i=t.systemCollisionItems,s=t.systemCollisionFloor,a=t.CONSTANTS.playerConfig.offsetFromFloor,c={};o["level-rooms"].traverse((function(e){e.name.includes("room_")&&r.addToScene(new O.Mesh(e.geometry,n.wall)),e.name.includes("collision_bot")&&(c[e.name]=e)})),t.botsCustomWallsCollisions=c,o.levelCollisions.traverse((function(e){"wall_collision"===e.name&&i&&i.setItemToCollision({mesh:new O.Mesh(e.geometry,n.easyMaterial),dist:5,isStopUnits:!0}),"floor_collision"===e.name&&s&&s.setItemToCollision({mesh:new O.Mesh(e.geometry,n.easyMaterial),dist:a,isStopUnits:!0})}))},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:he,key:"level-rooms"},{type:"obj",path:fe,key:"levelCollisions"},{type:"img",path:pe,key:"wallTexture",wrap:!0}]},{key:"doors",constr:Oe,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"img",path:je,key:"doorTexture",wrap:!1}]},{key:"bots",constr:function e(t){var o=this;Object(v.a)(this,e);var n=t.assets,r=t.materials,i=t.studio,s=t.emitter;this.bots={},t.CONSTANTS.BOTS.forEach((function(e){var s=function(e,t,o,n){var r=n.emitter,i=new O.Group,s=we(e);s.play("walk");var a=e.scene.children[1];a.children[1].material=t,a.position.set(0,-8,0);var c=new O.Object3D;c.position.set(0,0,1),i.add(c),i.add(a);var l=!1,u=De(i,c,20,r);u.setItemToCollision(n.botsCustomWallsCollisions[o.keyWallToWalkCollisions]),u.start();var m=new O.Mesh(new O.BoxGeometry(6,6,6),new O.MeshBasicMaterial);return m.position.y=-5,m.visible=!1,i.add(m),n.systemCollisionItems.setItemToCollision({mesh:m}),{mesh:i,isUpdate:l,update:function(e){l||s.update(e.delta)},stay:function(e){u.stop(),s.play("dialog");var t=new O.Vector3;t.copy(e),t.y=i.position.y,i.lookAt(t)},walk:function(){u.start(),s.play("walk")},startUpdate:function(){l||(l=!0,u.play(),s.play("walk"))},stopUpdate:function(){l&&(l=!1,u.stop())}}}(function(e){var t={animations:e.animations,scene:e.scene.clone(!0)},o={};e.scene.traverse((function(e){e.isSkinnedMesh&&(o[e.name]=e)}));var n={},r={};for(var i in t.scene.traverse((function(e){e.isBone&&(n[e.name]=e),e.isSkinnedMesh&&(r[e.name]=e)})),o){for(var s=o[i].skeleton,a=r[i],c=[],l=0;l<s.bones.length;++l){var u=n[s.bones[l].name];c.push(u)}a.bind(new O.Skeleton(c,s.boneInverses),a.matrixWorld)}return t}(n.bot),r.bot,e,t);s.mesh.position.set(e.pos[0],e.pos[1],e.pos[2]),s.mesh.rotation.y=e.rot,s.name=e.name,i.addToScene(s.mesh),s.mesh.userData.inScene=!0,s.mesh.userData.key=e.name,o.bots[e.name]=s})),s.subscribe("frameUpdate")((function(e){for(var t in o.bots)o.bots[t].update(e)}))},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"glb",path:Ie,key:"bot"},{type:"img",path:Te,key:"monster-skin"}]},{key:"playerNearBot",constr:function e(t){Object(v.a)(this,e);var o=t.player,n=t.bots,r=t.emitter,i=new Me,s=new Me;for(var a in n.bots)i.setItemToCheck(n.bots[a].mesh),s.setItemToCheck(n.bots[a].mesh);var c={up:o.frontObj,down:o.backObj},l=null;r.subscribe("playerMove")((function(e){var t=e.dir,s=i.checkNear(c[t],20),a=Object(P.a)(s,2),u=a[0],m=a[1];u?l||(l=m.key,n.bots[l].stay(o._mainObj.position),r.emit("nearBot")({isNearBot:!0,botKey:l})):l&&(n.bots[l].walk(o._mainObj.position),l=null,r.emit("nearBot")({isNearBot:!1,botKey:l}))}))},initStateKey:"beforeStartPlay"},{key:"adderActions",constr:function e(t){Object(v.a)(this,e);var o=t.player,n=t.ui,r=t.dispatcher,i=t.emitter;r.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:0}),n.showStartButton((function(){return o.toggleBlocked(!1)})),i.subscribe("nearBot")((function(e){var t=e.isNearBot,o=e.botKey;r.dispatch({type:"BUTTON_DIALOG_TOGGLE",isButtonDialog:t,currentBotKey:o})}))},initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return a.apply(this,arguments)}(Pe,n)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.722b79df.chunk.js.map