(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{40:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var o={};a.r(o),a.d(o,"SIZE_QUADRANT",(function(){return m})),a.d(o,"LOCATIONS_QUADRANTS",(function(){return b})),a.d(o,"MATERIALS_CONFIG",(function(){return y})),a.d(o,"CONFIG_FOR_INIT",(function(){return A})),a.d(o,"lCol",(function(){return v})),a.d(o,"lW",(function(){return O})),a.d(o,"ENV_START",(function(){return g})),a.d(o,"ENV_NORMAL",(function(){return j})),a.d(o,"ENV_RED",(function(){return w})),a.d(o,"ENV_RED_NEAR",(function(){return M})),a.d(o,"ENV_END",(function(){return C})),a.d(o,"START_ENV_CONFIG",(function(){return _})),a.d(o,"ENV_CONFIG_WORD_1",(function(){return S})),a.d(o,"ENV_CONFIG_WORD_2",(function(){return x})),a.d(o,"studioConfig",(function(){return k})),a.d(o,"playerConfig",(function(){return R}));var n=a(9),r=a.n(n),s=a(12);function i(){return(i=Object(s.a)(r.a.mark((function e(t,a){var o,n,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p("pageLoaded",t,o={CONSTANTS:a}),n=o.loaderAssets,s=c(t),e.next=6,n.loadAssets(s);case 6:o.assets=e.sent,p("beforeStartPlay",t,o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var p=function(e,t,a){for(var o=0;o<t.length;++o){var n=t[o],r=n.key,s=n.constr;n.initStateKey===e&&(a[r]=new s(a))}},c=function(e){for(var t=[],a=0;a<e.length;++a)if(e[a].assetsToLoad&&e[a].assetsToLoad.length)for(var o=0;o<e[a].assetsToLoad.length;++o)t.push(e[a].assetsToLoad[o]);return t},u=a(0),l=[1,1,1],h=([].concat(l,l,l,l,l,l),[.5,1,0]),d=([].concat(h,h,h,h,h,h),[1,1,0]),f=([].concat(d,d,d,d,d,d),{iron:{mat:"MeshPhongMaterial",props:{color:13421772,lightMap:"ironAO",lightMapIntensity:.35,normalMap:"ironNormal",normalScale:new u.Vector2(.2,.2),envMap:"skyBox3",reflectivity:.02,shininess:100,specular:131585,vertexColors:!0}},iron2:{mat:"MeshPhongMaterial",props:{color:16711680,lightMap:"ironAO",lightMapIntensity:.35,normalMap:"ironNormal",normalScale:new u.Vector2(.1,.1),envMap:"skyBox3",reflectivity:.02,shininess:100,specular:131585,vertexColors:!0}},floorMat1:{mat:"MeshPhongMaterial",props:{color:16777215,map:"mapTop",bumpMap:"mapTop",bumpScale:2,reflectivity:.1,shininess:.01,specular:16777215,emissive:5592405}},body:{mat:"MeshPhongMaterial",props:{color:16777215,envMap:"skyBox3",reflectivity:3,specular:16777215}},bodyRed:{mat:"MeshPhongMaterial",props:{color:11141120,envMap:"skyBox3",emissive:7798784,reflectivity:.01,specular:16711680}},bodyWhite:{mat:"MeshPhongMaterial",props:{color:16777215,envMap:"skyBox3",emissive:2236962,reflectivity:.5,specular:16777215}},bodyShadow:{mat:"MeshBasicMaterial",props:{color:2236976,transparent:!0,alphaMap:"bodyDropShadow",opacity:1}},whiteBasic:{mat:"MeshBasicMaterial",props:{color:16777215}},whiteBasic2:{mat:"MeshBasicMaterial",props:{color:11184810}}}),m=5e3,b={"3_-3":"location01","-3_-3":"location02","3_3":"location03","100_1000":"locationToFinish"},y=f,A={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},v=[.3,1,.3],O=.2,g={fogNear:0,fogFar:0,colorFog:4544609,colorBack:4544609,backgroundImgKey:null},j={fogNear:0,fogFar:1e3,colorFog:4544609,colorBack:4544609,backgroundImgKey:null},w={fogNear:0,fogFar:1e3,colorFog:8912896,colorBack:65793,backgroundImgKey:null},M={fogNear:0,fogFar:40,colorFog:8912896,colorBack:65793,backgroundImgKey:null},C={fogNear:0,fogFar:0,colorFog:65793,colorBack:65793,backgroundImgKey:null},_={fogNear:0,fogFar:0,color:4852294,backgroundImgKey:null},S={fogNear:0,fogFar:1e3,color:4544609,backgroundImgKey:null},x={fogNear:1500,fogFar:3e3,color:0,backgroundImgKey:"skyBox"},k={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:.1},sceneEnvironment:_,composerAddPass:"Saturate"},R={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startPos:[0,-45,150],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:5592405,strength:1,dist:0,decay:.001,pos:[0,10,0]}},I=a(2),E=a(3),T=a(21),P=a(22),D=function(){var e=null,t=null,a=null,o=null,n=null;return function(r,s){return new Promise((function(i){(function(r){return"obj"===r?e=e||new T.a:"glb"===r||"gltf"===r?a=a||new P.a:"img"===r?t=t||new u.TextureLoader:"cubeTextures"===r?o=o||new u.CubeTextureLoader:"soundMp3"===r?n=n||new u.AudioLoader:void 0})(s).load(r,i)}))}},N=function(){function e(){Object(I.a)(this,e),this.resources={},this._load=D()}return Object(E.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(a){var o=t._load,n=t.resources;function i(e){return p.apply(this,arguments)}function p(){return(p=Object(s.a)(r.a.mark((function t(s){var p,c,u,l;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[s]){t.next=5;break}return p=e[s],c=p.key,u=p.path,l=p.type,t.next=4,o(u,l);case 4:n[c]=t.sent;case 5:if(++s,e[s]){t.next=10;break}a(n),t.next=12;break;case 10:return t.next=12,i(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i(0)}))}}]),e}(),F=function(){function e(){Object(I.a)(this,e),this._storage={}}return Object(E.a)(e,[{key:"emit",value:function(e){var t=this;return function(a){return L(t._storage)(e).forEach((function(e){return e(a)}))}}},{key:"subscribe",value:function(e){var t=this;return function(a){return L(t._storage)(e).push(a),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==a}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),L=function(e){return function(t){return e[t]=e[t]||[]}},B=a(4),z=a(46),G=function(){function e(){var t=this;Object(I.a)(this,e),this._subscribers=[];var a={time:0,delta:0,count:0,oldTime:0},o=z.a((function(){return a}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var a=0;a<t._subscribers.length;++a)t._subscribers[a](Object(B.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return a=e}));!function e(){requestAnimationFrame(e),o(a)}()}return Object(E.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),W=a(8),U=a(27),q=a(24),K=a(17),Q={uniforms:{tDiffuse:{value:null},effect:{value:0}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nuniform float effect;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  vec3 col = vec3(texel);\n  col *= sin(col.r * 100. * effect);\n  gl_FragColor = (texel * texel * texel) * vec4(3.) + vec4(col, 1.);\n}"},V=a(23),H=function(){function e(t){var a=this;Object(I.a)(this,e),this._root=t;var o=t.assets,n=t.emitter,r=t.CONSTANTS.studioConfig,s=r.canId,i=r.rendererCon;i.canvas=document.getElementById(s),this._renderer=new u.WebGLRenderer(i),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new u.Scene;var p=t.CONSTANTS.studioConfig.sceneEnvironment,c=p.color,l=p.fogNear,h=p.fogFar,d=p.backgroundImgKey;this._scene.background=o[d]||null,this._scene.fog=new u.Fog(c,l,h),this._lightA=new u.AmbientLight(4544609,.4),this._scene.add(this._lightA),this._playerCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var f=new V.a(this._controlsCamera,this._renderer.domElement);f.target.set(0,0,0),f.update(),this._composer=new U.a(this._renderer),this._renderPass=new q.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._shader=new K.a(Q),this._composer.addPass(this._shader);var m=new u.Vector3,b=!0,y=null;n.subscribe("keyEvent")((function(e){e.o&&(b?(y=Object(B.a)({},a._scene.fog),a._scene.fog.near=1e4,a._scene.fog.far=2e4,b=!1,a._renderPass.camera=a._controlsCamera,a._playerCamera.getWorldPosition(m),a._controlsCamera.position.x=m.x+100,a._controlsCamera.position.y=m.y+100,a._controlsCamera.position.z=m.z,f.target.set(m.x,m.y,m.z),f.update()):(a._scene.fog.near=y.near,a._scene.fog.far=y.far,b=!0,a._renderPass.camera=a._playerCamera))}));var A=function(){var e={width:window.innerWidth,height:window.innerHeight};a._renderer.setSize(e.width,e.height),a._composer.setSize(e.width,e.height),a._controlsCamera&&(a._controlsCamera.aspect=e.width/e.height,a._controlsCamera.updateProjectionMatrix()),a._playerCamera&&(a._playerCamera.aspect=e.width/e.height,a._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",A),A(),this.addToScene=function(e){return a._scene.add(e)},this.removeFromScene=function(e){return a._scene.remove(e)},this.drawFrame=function(){a._composer.render(a._scene,a._controlsCamera)},n.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)})),console.log(this._shader)}return Object(E.a)(e,[{key:"setCamera",value:function(e){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){var a=this,o=e.fogNear,n=e.fogFar,r=e.colorFog;if(this._scene.fog.near!==o||this._scene.fog.far!==n||this._scene.fog.color!==n){var s={colorFog:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},i={colorFog:new u.Color(r),near:o,far:n};new W.b(s).to(i,t&&t.time||3e3).onUpdate((function(){a._scene.fog.color=s.colorFog,a._scene.fog.near=s.near,a._scene.fog.far=s.far})).onComplete((function(){a._renderer.setClearColor(e.colorBack)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}},{key:"setEffectStrength",value:function(e){this._shader.uniforms.effect.value=e}}]),e}(),Y=function(){function e(t){Object(I.a)(this,e);var a=t.emitter,o={up:!1,down:!1,left:!1,right:!1,p:!1},n={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=n,this.keys=o;var r=function(e,t){switch(e){case 38:case 87:n.up&&(o.up=t);break;case 40:case 83:n.down&&(o.down=t);break;case 37:case 65:o.left=t;break;case 39:case 68:o.right=t;break;case 79:o.o=t;break;case 80:o.p=t}a.emit("keyEvent")(o)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),a.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),a.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(E.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),J=function(){function e(t){Object(I.a)(this,e);var a=t.studio,o=t.CONSTANTS.playerConfig,n=o.cameraData,r=o.lightDataOne;this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new u.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new u.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new u.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new u.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var s=n.fov,i=n.ratio,p=n.near,c=n.far;if(this._camera=new u.PerspectiveCamera(s,i,p,c),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),r){var l=r.color,h=r.strenth,d=r.pos,f=new u.PointLight(l,h);f.position.fromArray(d),this.mesh.add(f)}a.setCamera(this._camera),a.addToScene(this.mesh)}return Object(E.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,a){this.mesh.position.set(e,t,a)}}]),e}(),Z=function(e,t){for(var a in e)e[a].wrapS&&(e[a].wrapS=e[a].wrapT=u.RepeatWrapping);var o=["bumpMap","envMap","map","normalMap","lightMap","aoMap","alphaMap"],n={},r=function(a){n[a]=new u[t[a].mat](Object(B.a)({},t[a].props)),o.map((function(o){return t[a].props[o]&&(n[a][o]=e[t[a].props[o]])}))};for(var s in t)r(s);return n},X=a.p+"static/media/mapGround.8bd68b3e.jpg",$="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAKAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAUEBAZEhknFxcnMiYfJjIuJiYmJi4+NTU1NTU+REFBQUFBQUREREREREREREREREREREREREREREREREREREREARUZGSAcICYYGCY2JiAmNkQ2Kys2REREQjVCRERERERERERERERERERERERERERERERERERERERERERERERERET/wAARCAEAAP8DASIAAhEBAxEB/8QAUAABAQEBAQAAAAAAAAAAAAAAAAECAwYBAQAAAAAAAAAAAAAAAAAAAAAQAQEBAAAAAAAAAAAAAAAAAAABEREBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A8YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgigALhgILhgIjSAgqAAAAAAAAAAAAAAAAAAAKACi4CYuLi4CYY1i4DGGN4mAxhjeM4DKNYgIigIAAAAAAAAAAAAAAqKAosAkakJGpAJFxZGsBnFxrFwGMTHTEwHPEsdMSwHKxLHSxmwHNG6yCIqAAAAAAAAAAAAAoKCxqMxuAsjUhI1ICyLhI0CYuKAmJjQDOM2NpYDnYzY6WMWA52M1us0GUWoCAAAAAAAAAAAAqxFgNRuMxuA1G4zGoDUVIoCgAACJVKDFYrpWKDFYrdYoMVGqyCAAAAAAAAAAAArUZWA3G4xG4DcbjEagNRUigoAAACCUErFbrFBisVusUGay1WQQAAAAAAAAAAAFWIoNRuOcbgOkajnK3KDcaYlaBVQBUABKJaCVitWsWgzWatZoM1FqAgAAAAAAAAAAACooNRYysB0lalc5WpQdJWtc5WpQb1dY00G9TWdNBdS1NZtBbWLS1m0C1mlQEBAAAAAAAAAAAAAAAVUAalalYXQbla1z1dB001jTQb01jTQa1LWdTQW1NTUAQAEAAAAAAAAAAAAAAABUAVWVBdXWQGtXWQGtTUAXU1AFQQFQAAAAAAAAAAAAAAAAAAAAAAAUQBRAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH/9k=",ee=a.p+"static/media/posx.be2d83a2.jpg",te=a.p+"static/media/negx.d016c8e7.jpg",ae=a.p+"static/media/posy.01cfd221.jpg",oe=a.p+"static/media/negy.f01f8356.jpg",ne=a.p+"static/media/posz.ef37b8e1.jpg",re=a.p+"static/media/negz.f346a80a.jpg",se=a(13),ie=function(){function e(){Object(I.a)(this,e),this._arrMeshes=[],this._vecStart=new u.Vector3,this._vecDir=new u.Vector3,this._rayCaster=new u.Raycaster(this._vecStart,this._vecDir)}return Object(E.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,a){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var o=this._rayCaster.intersectObjects(this._arrMeshes);return o[0]&&o[0].distance<a?[!0,o[0]]:[!1,null]}}]),e}(),pe=function(){function e(t){var a=this;Object(I.a)(this,e);var o=t.emitter,n=t.CONSTANTS,r=t.player,s=new ie,i=n.playerConfig,p=i.speed,c=i.speedRot,u=!0;r.toggleBlocked=function(e){return u=e},this.isCanMove={forward:!0,back:!0},r.toggleCanMove=function(e,t){return a.isCanMove[e]=t},this.isFreeze=!1;var l={};this.update=function(e){a.isFreeze||(l.left&&r.mesh.rotateY(c*e.count),l.right&&r.mesh.rotateY(-c*e.count),u||(l.up&&a.isCanMove.forward&&function(e){var t=s.checkCollisions(r.mesh,r.frontObj,17),a=Object(se.a)(t,2),n=a[0],i=a[1];n?i.object.userData.type&&"alert"===i.object.userData.type&&o.emit("collision")(i.object.userData.event):(r.mesh.translateZ(-p*e.count),o.emit("playerMove")("forward"))}(e),l.down&&a.isCanMove.back&&function(e){var t=s.checkCollisions(r.mesh,r.backObj,17);Object(se.a)(t,1)[0]||(r.mesh.translateZ(p*e.count),o.emit("playerMove")("back"))}(e),l.p&&console.log("player.mesh.position.fromArray([".concat(r.mesh.position.x,", ").concat(r.mesh.position.y,", ").concat(r.mesh.position.z,"])"))))},o.subscribe("keyEvent")((function(e){l=e})),this._collisionsWalls=s}return Object(E.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),ce=function(){function e(t){var a=this;Object(I.a)(this,e),this._root=t;var o=t.emitter,n=t.player;this._itemsToCheck=[],o.subscribe("playerMove")((function(){for(var e=0;e<a._itemsToCheck.length;++e){var t=n.mesh.position.distanceTo(a._itemsToCheck[e].position);if(!a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<a._itemsToCheck[e].userData.nearPlayerItemNear)return a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>a._itemsToCheck[e].userData.nearPlayerItemNear&&(a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(E.a)(e,[{key:"setItemToCheck",value:function(e,t,a,o){for(var n=0;n<this._itemsToCheck.length;++n)if(e===this._itemsToCheck[n])return;t&&(e.userData.nearPlayerItemKey=t),a&&(e.userData.nearPlayerItemNear=a),o&&(e.userData.nearPlayerItemFar=o),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),ue=a(1),le=Float32Array;function he(e,t,a){return(a=a||new le(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a}function de(e,t){t=t||new le(3);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return a>1e-5&&(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a),t}function fe(e,t,a){return(a=a||new le(3))[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a}function me(e,t){var a=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return a*a+o*o+n*n}function be(e,t){t=t||new le(16);var a=e[0],o=e[1],n=e[2],r=e[3],s=e[4],i=e[5],p=e[6],c=e[7],u=e[8],l=e[9],h=e[10],d=e[11],f=e[12],m=e[13],b=e[14],y=e[15],A=h*y,v=b*d,O=p*y,g=b*c,j=p*d,w=h*c,M=n*y,C=b*r,_=n*d,S=h*r,x=n*c,k=p*r,R=u*m,I=f*l,E=s*m,T=f*i,P=s*l,D=u*i,N=a*m,F=f*o,L=a*l,B=u*o,z=a*i,G=s*o,W=A*i+g*l+j*m-(v*i+O*l+w*m),U=v*o+M*l+S*m-(A*o+C*l+_*m),q=O*o+C*i+x*m-(g*o+M*i+k*m),K=w*o+_*i+k*l-(j*o+S*i+x*l),Q=1/(a*W+s*U+u*q+f*K);return t[0]=Q*W,t[1]=Q*U,t[2]=Q*q,t[3]=Q*K,t[4]=Q*(v*s+O*u+w*f-(A*s+g*u+j*f)),t[5]=Q*(A*a+C*u+_*f-(v*a+M*u+S*f)),t[6]=Q*(g*a+M*s+k*f-(O*a+C*s+x*f)),t[7]=Q*(j*a+S*s+x*u-(w*a+_*s+k*u)),t[8]=Q*(R*c+T*d+P*y-(I*c+E*d+D*y)),t[9]=Q*(I*r+N*d+B*y-(R*r+F*d+L*y)),t[10]=Q*(E*r+F*c+z*y-(T*r+N*c+G*y)),t[11]=Q*(D*r+L*c+G*d-(P*r+B*c+z*d)),t[12]=Q*(E*h+D*b+I*p-(P*b+R*p+T*h)),t[13]=Q*(L*b+R*n+F*h-(N*h+B*b+I*n)),t[14]=Q*(N*p+G*b+T*n-(z*b+E*n+F*p)),t[15]=Q*(z*h+P*n+B*p-(L*p+G*h+D*n)),t}var ye,Ae={copy:function(e,t){return(t=t||new le(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,a,o){o=o||new le(16);var n=de(he(e,t)),r=de(fe(a,n)),s=de(fe(n,r));return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=0,o[4]=s[0],o[5]=s[1],o[6]=s[2],o[7]=0,o[8]=n[0],o[9]=n[1],o[10]=n[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},addVectors:function(e,t,a){return(a=a||new le(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},subtractVectors:he,scaleVector:function(e,t,a){return(a=a||new le(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},distance:function(e,t){return Math.sqrt(me(e,t))},distanceSq:me,normalize:de,compose:function(e,t,a,o){o=o||new le(16);var n=t[0],r=t[1],s=t[2],i=t[3],p=n+n,c=r+r,u=s+s,l=n*p,h=n*c,d=n*u,f=r*c,m=r*u,b=s*u,y=i*p,A=i*c,v=i*u,O=a[0],g=a[1],j=a[2];return o[0]=(1-(f+b))*O,o[1]=(h+v)*O,o[2]=(d-A)*O,o[3]=0,o[4]=(h-v)*g,o[5]=(1-(l+b))*g,o[6]=(m+y)*g,o[7]=0,o[8]=(d+A)*j,o[9]=(m-y)*j,o[10]=(1-(l+f))*j,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},cross:fe,decompose:function(e,t,a,o){var n=Ae.length(e.slice(0,3)),r=Ae.length(e.slice(4,7)),s=Ae.length(e.slice(8,11));(function(e){var t=e[0],a=e[1],o=e[2],n=e[3],r=e[4],s=e[5],i=e[6],p=e[7],c=e[8],u=e[9],l=e[10],h=e[11],d=e[12],f=e[13],m=e[14],b=e[15],y=l*b,A=m*h,v=i*b,O=m*p,g=i*h,j=l*p,w=o*b,M=m*n,C=o*h,_=l*n,S=o*p,x=i*n;return 1/(t*(y*s+O*u+g*f-(A*s+v*u+j*f))+r*(A*a+w*u+_*f-(y*a+M*u+C*f))+c*(v*a+M*s+S*f-(O*a+w*s+x*f))+d*(j*a+C*s+x*u-(g*a+_*s+S*u)))})(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];var i=Ae.copy(e),p=1/n,c=1/r,u=1/s;i[0]*=p,i[1]*=p,i[2]*=p,i[4]*=c,i[5]*=c,i[6]*=c,i[8]*=u,i[9]*=u,i[10]*=u,function(e,t){var a=e[0],o=e[4],n=e[8],r=e[1],s=e[5],i=e[9],p=e[2],c=e[6],u=e[10],l=a+s+u;if(l>0){var h=.5/Math.sqrt(l+1);t[3]=.25/h,t[0]=(c-i)*h,t[1]=(n-p)*h,t[2]=(r-o)*h}else if(a>s&&a>u){var d=2*Math.sqrt(1+a-s-u);t[3]=(c-i)/d,t[0]=.25*d,t[1]=(o+r)/d,t[2]=(n+p)/d}else if(s>u){var f=2*Math.sqrt(1+s-a-u);t[3]=(n-p)/f,t[0]=(o+r)/f,t[1]=.25*f,t[2]=(i+c)/f}else{var m=2*Math.sqrt(1+u-a-s);t[3]=(r-o)/m,t[0]=(n+p)/m,t[1]=(i+c)/m,t[2]=.25*m}}(i,a),o[0]=n,o[1]=r,o[2]=s},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new le(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new le(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,a,o,n,r,s){return(s=s||new le(16))[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/(o-a),s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2/(n-r),s[11]=0,s[12]=(e+t)/(e-t),s[13]=(a+o)/(a-o),s[14]=(n+r)/(n-r),s[15]=1,s},frustum:function(e,t,a,o,n,r,s){var i=t-e,p=o-a,c=r-n;return(s=s||new le(16))[0]=2*n/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*n/p,s[6]=0,s[7]=0,s[8]=(e+t)/i,s[9]=(o+a)/p,s[10]=-(r+n)/c,s[11]=-1,s[12]=0,s[13]=0,s[14]=-2*n*r/c,s[15]=0,s},perspective:function(e,t,a,o,n){n=n||new le(16);var r=Math.tan(.5*Math.PI-.5*e),s=1/(a-o);return n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(a+o)*s,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o*s*2,n[15]=0,n},translation:function(e,t,a,o){return(o=o||new le(16))[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=e,o[13]=t,o[14]=a,o[15]=1,o},translate:function(e,t,a,o,n){n=n||new le(16);var r=e[0],s=e[1],i=e[2],p=e[3],c=e[4],u=e[5],l=e[6],h=e[7],d=e[8],f=e[9],m=e[10],b=e[11],y=e[12],A=e[13],v=e[14],O=e[15];return e!==n&&(n[0]=r,n[1]=s,n[2]=i,n[3]=p,n[4]=c,n[5]=u,n[6]=l,n[7]=h,n[8]=d,n[9]=f,n[10]=m,n[11]=b),n[12]=r*t+c*a+d*o+y,n[13]=s*t+u*a+f*o+A,n[14]=i*t+l*a+m*o+v,n[15]=p*t+h*a+b*o+O,n},xRotation:function(e,t){t=t||new le(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=o,t[7]=0,t[8]=0,t[9]=-o,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new le(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=0,t[2]=-o,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=o,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new le(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=o,t[2]=0,t[3]=0,t[4]=-o,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,a){a=a||new le(16);var o=e[4],n=e[5],r=e[6],s=e[7],i=e[8],p=e[9],c=e[10],u=e[11],l=Math.cos(t),h=Math.sin(t);return a[4]=l*o+h*i,a[5]=l*n+h*p,a[6]=l*r+h*c,a[7]=l*s+h*u,a[8]=l*i-h*o,a[9]=l*p-h*n,a[10]=l*c-h*r,a[11]=l*u-h*s,e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},yRotate:function(e,t,a){a=a||new le(16);var o=e[0],n=e[1],r=e[2],s=e[3],i=e[8],p=e[9],c=e[10],u=e[11],l=Math.cos(t),h=Math.sin(t);return a[0]=l*o-h*i,a[1]=l*n-h*p,a[2]=l*r-h*c,a[3]=l*s-h*u,a[8]=l*i+h*o,a[9]=l*p+h*n,a[10]=l*c+h*r,a[11]=l*u+h*s,e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},zRotate:function(e,t,a){a=a||new le(16);var o=e[0],n=e[1],r=e[2],s=e[3],i=e[4],p=e[5],c=e[6],u=e[7],l=Math.cos(t),h=Math.sin(t);return a[0]=l*o+h*i,a[1]=l*n+h*p,a[2]=l*r+h*c,a[3]=l*s+h*u,a[4]=l*i-h*o,a[5]=l*p-h*n,a[6]=l*c-h*r,a[7]=l*u-h*s,e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},axisRotation:function(e,t,a){a=a||new le(16);var o=e[0],n=e[1],r=e[2],s=Math.sqrt(o*o+n*n+r*r),i=(o/=s)*o,p=(n/=s)*n,c=(r/=s)*r,u=Math.cos(t),l=Math.sin(t),h=1-u;return a[0]=i+(1-i)*u,a[1]=o*n*h+r*l,a[2]=o*r*h-n*l,a[3]=0,a[4]=o*n*h-r*l,a[5]=p+(1-p)*u,a[6]=n*r*h+o*l,a[7]=0,a[8]=o*r*h+n*l,a[9]=n*r*h-o*l,a[10]=c+(1-c)*u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},axisRotate:function(e,t,a,o){o=o||new le(16);var n=t[0],r=t[1],s=t[2],i=Math.sqrt(n*n+r*r+s*s),p=(n/=i)*n,c=(r/=i)*r,u=(s/=i)*s,l=Math.cos(a),h=Math.sin(a),d=1-l,f=p+(1-p)*l,m=n*r*d+s*h,b=n*s*d-r*h,y=n*r*d-s*h,A=c+(1-c)*l,v=r*s*d+n*h,O=n*s*d+r*h,g=r*s*d-n*h,j=u+(1-u)*l,w=e[0],M=e[1],C=e[2],_=e[3],S=e[4],x=e[5],k=e[6],R=e[7],I=e[8],E=e[9],T=e[10],P=e[11];return o[0]=f*w+m*S+b*I,o[1]=f*M+m*x+b*E,o[2]=f*C+m*k+b*T,o[3]=f*_+m*R+b*P,o[4]=y*w+A*S+v*I,o[5]=y*M+A*x+v*E,o[6]=y*C+A*k+v*T,o[7]=y*_+A*R+v*P,o[8]=O*w+g*S+j*I,o[9]=O*M+g*x+j*E,o[10]=O*C+g*k+j*T,o[11]=O*_+g*R+j*P,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},scaling:function(e,t,a,o){return(o=o||new le(16))[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},scale:function(e,t,a,o,n){return(n=n||new le(16))[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n[3]=t*e[3],n[4]=a*e[4],n[5]=a*e[5],n[6]=a*e[6],n[7]=a*e[7],n[8]=o*e[8],n[9]=o*e[9],n[10]=o*e[10],n[11]=o*e[11],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},multiply:function(e,t,a){a=a||new le(16);var o=t[0],n=t[1],r=t[2],s=t[3],i=t[4],p=t[5],c=t[6],u=t[7],l=t[8],h=t[9],d=t[10],f=t[11],m=t[12],b=t[13],y=t[14],A=t[15],v=e[0],O=e[1],g=e[2],j=e[3],w=e[4],M=e[5],C=e[6],_=e[7],S=e[8],x=e[9],k=e[10],R=e[11],I=e[12],E=e[13],T=e[14],P=e[15];return a[0]=o*v+n*w+r*S+s*I,a[1]=o*O+n*M+r*x+s*E,a[2]=o*g+n*C+r*k+s*T,a[3]=o*j+n*_+r*R+s*P,a[4]=i*v+p*w+c*S+u*I,a[5]=i*O+p*M+c*x+u*E,a[6]=i*g+p*C+c*k+u*T,a[7]=i*j+p*_+c*R+u*P,a[8]=l*v+h*w+d*S+f*I,a[9]=l*O+h*M+d*x+f*E,a[10]=l*g+h*C+d*k+f*T,a[11]=l*j+h*_+d*R+f*P,a[12]=m*v+b*w+y*S+A*I,a[13]=m*O+b*M+y*x+A*E,a[14]=m*g+b*C+y*k+A*T,a[15]=m*j+b*_+y*R+A*P,a},inverse:be,transformVector:function(e,t,a){a=a||new le(4);for(var o=0;o<4;++o){a[o]=0;for(var n=0;n<4;++n)a[o]+=t[n]*e[4*n+o]}return a},transformPoint:function(e,t,a){a=a||new le(3);var o=t[0],n=t[1],r=t[2],s=o*e[3]+n*e[7]+r*e[11]+e[15];return a[0]=(o*e[0]+n*e[4]+r*e[8]+e[12])/s,a[1]=(o*e[1]+n*e[5]+r*e[9]+e[13])/s,a[2]=(o*e[2]+n*e[6]+r*e[10]+e[14])/s,a},transformDirection:function(e,t,a){a=a||new le(3);var o=t[0],n=t[1],r=t[2];return a[0]=o*e[0]+n*e[4]+r*e[8],a[1]=o*e[1]+n*e[5]+r*e[9],a[2]=o*e[2]+n*e[6]+r*e[10],a},transformNormal:function(e,t,a){a=a||new le(3);var o=be(e),n=t[0],r=t[1],s=t[2];return a[0]=n*o[0]+r*o[1]+s*o[2],a[1]=n*o[4]+r*o[5]+s*o[6],a[2]=n*o[8]+r*o[9]+s*o[10],a},setDefaultType:function(e){var t=le;return le=e,t}},ve=Math.random,Oe=function(e,t){return e+ve()*(t-e)},ge=function(e,t,a,o){return[].concat(Object(ue.a)(e),Object(ue.a)(t),Object(ue.a)(a),Object(ue.a)(e),Object(ue.a)(a),Object(ue.a)(o))},je=function(e,t,a,o){return[].concat(Object(ue.a)(e),Object(ue.a)(t),Object(ue.a)(a),Object(ue.a)(e),Object(ue.a)(a),Object(ue.a)(o))},we=function(e){return[].concat(Object(ue.a)(e),Object(ue.a)(e),Object(ue.a)(e),Object(ue.a)(e),Object(ue.a)(e),Object(ue.a)(e))},Me=function(e,t){var a=Math.atan(t/e);return e<0&&t>0&&(a=Math.PI-Math.abs(a)),e<0&&t<=0&&(a=Math.PI+Math.abs(a)),a},Ce=function(e,t,a,o,n,r,s){var i=t[0]-e[0],p=a[1]-e[1],c=Oe(.3*i,.7*i),u=Oe(.3*p,.7*p);s&&(c=i*s,u=p*s);var l=e[0]+(i-c)/2,h=t[0]-(i-c)/2,d=e[1]+(p-u)/2,f=a[1]-(p-u)/2,m=[l,d,e[2]],b=[h,d,e[2]],y=[h,f,e[2]],A=[l,f,e[2]],v=[];return v.push.apply(v,Object(ue.a)(ge(m,b,y,A)).concat(Object(ue.a)(ge(e,t,b,m)),Object(ue.a)(ge(b,t,a,y)),Object(ue.a)(ge(A,y,a,o)),Object(ue.a)(ge(e,m,A,o)))),{vArr:v,cArr:_e(n,r),uArr:[].concat(Object(ue.a)(je([.5,.5],[1,.5],[1,1],[.5,1])),Object(ue.a)(je([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(ue.a)(je([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(ue.a)(je([.1,.9],[.4,.9],[.5,1],[0,1])),Object(ue.a)(je([0,.5],[.1,.6],[.1,.9],[0,1])))}},_e=function(e,t){return[].concat(Object(ue.a)(we(e)),Object(ue.a)(we(t)),Object(ue.a)(we(t)),Object(ue.a)(we(t)),Object(ue.a)(we(t)))},Se=function(e,t){for(var a=Ae.yRotation(t),o=0;o<e.length;o+=3){var n=Ae.transformPoint(a,[e[o+0],e[o+1],e[o+2],1]);e[o+0]=n[0],e[o+1]=n[1],e[o+2]=n[2]}},xe=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=Ae.translation(t,a,o),r=0;r<e.length;r+=3){var s=Ae.transformPoint(n,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=s[0],e[r+1]=s[1],e[r+2]=s[2]}},ke=function(e,t,a,o){for(var n=Ae.scaling(t,a,o),r=0;r<e.length;r+=3){var s=Ae.transformPoint(n,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=s[0],e[r+1]=s[1],e[r+2]=s[2]}},Re=function(e){for(var t=0;t<e.length;t+=18){var a=e[t],o=e[t+1],n=e[t+2],r=e[t+3],s=e[t+3+1],i=e[t+3+2],p=e[t+12],c=e[t+12+1],u=e[t+12+2],l=e[t+15],h=e[t+15+1],d=e[t+15+2];e[t]=r,e[t+1]=s,e[t+2]=i,e[t+3]=a,e[t+3+1]=o,e[t+3+2]=n,e[t+12]=l,e[t+12+1]=h,e[t+12+2]=d,e[t+15]=p,e[t+15+1]=c,e[t+15+2]=u}},Ie=[1,1,1],Ee=[].concat(Ie,Ie,Ie,Ie,Ie,Ie),Te=57,Pe=59,De=12,Ne=30,Fe=63,Le=1.5,Be=[0,0,1,0,1,1,0,0,1,1,0,1],ze=function(e){var t=[],a=[],o=[],n=[],r=e.p0,s=e.p1,i=e.arr,p=e.colorRoom,c=s[0]-r[0],u=r[1]-s[1],l=Math.sqrt(c*c+u*u),h=i.length>0,d=qe({l:l,leftOffset:!0,rightOffset:!0,segment:h?"top":"full",colorRoom:p}),f=Me(c,u);if(Se(d.v,f),xe(d.v,r[0],-61,r[1]),t.push.apply(t,Object(ue.a)(d.v)),a.push.apply(a,Object(ue.a)(d.c)),n.push.apply(n,Object(ue.a)(d.u)),Se(d.b,f),xe(d.b,r[0],-61,r[1]),o.push.apply(o,Object(ue.a)(d.b)),i&&i.length>0)for(var m=0;m<i.length;++m){var b=i[m],y=b.p0,A=b.p1,v=A[0]-y[0],O=y[1]-A[1],g=Math.sqrt(v*v+O*O),j=qe({l:g,leftOffset:0===m,rightOffset:m===i.length-1,segment:"bottom",colorRoom:p}),w=Me(v,O);Se(j.v,w),xe(j.v,y[0],-61,y[1]),t.push.apply(t,Object(ue.a)(j.v)),a.push.apply(a,Object(ue.a)(j.c)),n.push.apply(n,Object(ue.a)(j.u)),Se(j.b,w),xe(j.b,y[0],-61,y[1]),o.push.apply(o,Object(ue.a)(j.b))}return{v:t,c:a,b:o,u:n}},Ge=[0,-.000699999975040555,20.271699905395508,0,.9347000122070312,20.271699905395508,0,1.8353999853134155,17.028799057006836,0,7.440899848937988,17.028799057006836,0,7.844900131225586,19.12459945678711,0,8.748000144958496,19.12459945678711,0,9.527199745178223,13.83530044555664,0,20.66309928894043,13.83530044555664,0,21.29990005493164,17.426300048828125,0,23.96380043029785,17.426300048828125,0,24.70680046081543,10.646400451660156,0,67.68000030517578,10.646400451660156,0,67.68000030517578,13.190500259399414,0,70.5458984375,13.190500259399414,0,70.5458984375,4.975500106811523,0,72.16529846191406,4.975500106811523,0,72.16529846191406,2.640399932861328,0,82.96610260009766,2.6317999362945557,0,88,14.853300094604492,0,110,14.853300094604492],We=[1,1,1],Ue=[].concat(We,We,We,We,We,We),qe=function(e){var t=e.l,a=e.leftOffset,o=e.rightOffset,n=e.segment,r=e.colorRoom,s=[].concat(Object(ue.a)(r),Object(ue.a)(r),Object(ue.a)(r),Object(ue.a)(r),Object(ue.a)(r),Object(ue.a)(r)),i=[],p=[],c=[],u=[],l=-1;if("bottom"===n||"full"===n){var h=function(e){var t=e.l,a=e.colorRoom,o=e.leftOffset,n=e.rightOffset,r=o,s=t-n,i=[].concat(Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a)),p=[],c=[],u=[];if(t<30&&(c.push.apply(c,Object(ue.a)(ge([r,Te,De],[s,Te,De],[s,Pe,De],[r,Pe,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([r,52,2],[s,52,2],[s,Te,De],[r,Te,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1)),t>30){var l=t-(o+n),h=.2*l,d=o+l/2;c.push.apply(c,Object(ue.a)(ge([d-h,Ne,13],[d+h,Ne,13],[d+h,Fe,13],[d-h,Fe,13]))),p.push.apply(p,Object(ue.a)(i)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d-h-Le,28.5,14],[d+h+Le,28.5,14],[d+h,Ne,13],[d-h,Ne,13]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d-h-Le,27.5,2],[d+h+Le,27.5,2],[d+h+Le,28.5,14],[d-h-Le,28.5,14]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d+h,Ne,13],[d+h+Le,28.5,14],[d+h+Le,64.5,14],[d+h,Fe,13]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d+h+Le,28.5,14],[d+h+Le,27.5,2],[d+h+Le,65.5,2],[d+h+Le,64.5,14]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d-h-Le,28.5,14],[d-h,Ne,13],[d-h,Fe,13],[d-h-Le,64.5,14]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d-h-Le,27.5,2],[d-h-Le,28.5,14],[d-h-Le,64.5,14],[d-h-Le,64.5,2]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d-h,Fe,13],[d+h,Fe,13],[d+h+Le,64.5,14],[d-h-Le,64.5,14]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([r,Te,De],[d-h-Le,Te,De],[d-h-Le,Pe,De],[r,Pe,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([r,52,2],[d-h-Le,52,2],[d-h-Le,Te,De],[r,Te,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d+h+Le,Te,De],[s,Te,De],[s,Pe,De],[d+h+Le,Pe,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1),c.push.apply(c,Object(ue.a)(ge([d+h+Le,52,2],[s,52,2],[s,Te,De],[d+h+Le,Te,De]))),p.push.apply(p,Object(ue.a)(Ee)),u.push(0,0,1,0,1,1,0,0,1,1,0,1)}return{v:c,c:p,u:u}}({l:t,colorRoom:r,leftOffset:a?11:0,rightOffset:o?11:0});i.push.apply(i,Object(ue.a)(h.c)),p.push.apply(p,Object(ue.a)(h.v)),u.push.apply(u,Object(ue.a)(h.u))}for(var d=3;d<Ge.length;d+=3)++l,"top"===n&&l<11||"bottom"===n&&l>10||(0!==l||"bottom"!==n&&"full"!==n||c.push.apply(c,Object(ue.a)(ge([-3.6,Ge[d+1-3],Ge[d+2-3]],[t+3.6,Ge[d+1-3],Ge[d+2-3]],[t+3.6,30,Ge[d+2]],[-3.6,30,Ge[d+2]]))),p.push.apply(p,Object(ue.a)(ge([0,Ge[d+1-3],Ge[d+2-3]],[t,Ge[d+1-3],Ge[d+2-3]],[t,Ge[d+1],Ge[d+2]],[0,Ge[d+1],Ge[d+2]]))),u.push.apply(u,Be),2===l||6===l||16===l?i.push.apply(i,Object(ue.a)(s)):i.push.apply(i,Object(ue.a)(Ue)));if("top"===n||"full"===n){var f=a?25:7,m=o?25:7,b=Math.floor((t-(f+m))/30),y=87,A=80,v=12.5,O=(t-(f+m))/b;if(b>0)for(var g=0;g<b+1;++g){var j=f+g*O,w=Ce([j-5,A,v],[j+5,A,v],[j+5,y,v],[j-5,y,v],r,We,.5);p.push.apply(p,Object(ue.a)(w.vArr)),i.push.apply(i,Object(ue.a)(w.cArr)),u.push.apply(u,Object(ue.a)(w.uArr)),p.push.apply(p,Object(ue.a)(ge([j-5,72,1.8],[j+5,72,1.8],[j+5,A,v],[j-5,A,v]))),u.push.apply(u,Be),p.push.apply(p,Object(ue.a)(ge([j-5,72,1.8],[j-5,A,v],[j-5,y,v],[j-5,y,1.8]))),u.push.apply(u,Be),p.push.apply(p,Object(ue.a)(ge([j+5,A,v],[j+5,72,1.8],[j+5,y,1.8],[j+5,y,v]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),i.push.apply(i,Object(ue.a)(Ue)),i.push.apply(i,Object(ue.a)(Ue))}}if("full"===n||"bottom"===n){var M=a?30:8,C=o?30:8,_=Math.floor((t-(M+C))/20),S=21,x=8.7,k=(t-(M+C))/_;if(_>0)for(var R=0;R<_+1;++R){var I=M+R*k;p.push.apply(p,Object(ue.a)(ge([I-3+2,x,15],[I+3-2,x,15],[I+3,S,16.5],[I-3,S,16.5]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([I-3+2-1.5,x,10],[I-3+2,x,15],[I-3,S,16.5],[I-3-1.5,S,10]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([I+3-2,x,15],[I+3-2+1.5,x,10],[I+3+1.5,S,10],[I+3,S,16.5]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([I-3,x,14.5],[I+3,x,14.5],[I+3+3,S,16],[I-3-3,S,16]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([I-3-1,x,11],[I-3,x,14.5],[I-3-3,S,16],[I-3-3-1,S,11]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([I+3,x,14.5],[I+3+1,x,11],[I+3+3+1,S,11],[I+3+3,S,16]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue))}var E=a?22:2,T=o?22:2,P=Math.floor((t-(E+T))/10),D=8.3,N=.6,F=(t-(E+T))/P;if(P>0)for(var L=0;L<P+1;++L){var B=E+L*F;p.push.apply(p,Object(ue.a)(ge([B-1,N,18.5],[B+1,N,18.5],[B+1,D,18],[B-1,D,18]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([B-1,N,11],[B-1,N,18.5],[B-1,D,18],[B-1,D,11]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue)),p.push.apply(p,Object(ue.a)(ge([B+1,N,18.5],[B+1,N,11],[B+1,D,11],[B+1,D,18]))),u.push.apply(u,Be),i.push.apply(i,Object(ue.a)(Ue))}}return{v:p,c:i,b:c,u:u}},Ke=[1,1,1],Qe=[].concat(Ke,Ke,Ke,Ke,Ke,Ke),Ve=[0,0,1,0,1,1,0,0,1,1,0,1],He=null,Ye=null;ye=[0,-2.6953001022338867,22.33769989013672,0,3.8533999919891357,21.921899795532227,0,5.635499954223633,21.284500122070312,0,19.557199478149414,20.037200927734375,0,20.696800231933594,20.980899810791016,0,25.771099090576172,21.85650062561035,0,27.770299911499023,20.32659912109375,0,27.770299911499023,19.798900604248047,0,61.1713981628418,19.746400833129883,0,61.1713981628418,20.36400032043457,0,63.55139923095703,22.07699966430664,0,65.46749877929688,21.3710994720459,0,65.95809936523438,22.83650016784668,0,67.88800048828125,22.83650016784668,0,67.8865966796875,21.539499282836914,0,77.65049743652344,21.539499282836914,0,77.66819763183594,24.958099365234375,0,79.78269958496094,24.83370018005371,0,81.02649688720703,27.694400787353516,0,82.51909637451172,27.943199157714844,0,82.51909637451172,26.699399948120117,0,106.7477035522461,26.699399948120117,0,106.7477035522461,28.06760025024414,0,108.36470031738281,28.06760025024414];var Je=function(e,t,a){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"simple";null===He&&(He=Object(ue.a)(ye),Se(He,-Math.PI/4),xe(He,12,0,5),Ye=Object(ue.a)(ye),Se(Ye,Math.PI/4),xe(Ye,-12,0,5));for(var n=[],r=[],s=[],i=[],p=-1,c=3;c<ye.length;c+=3)++p,"bigDoor"!==o&&p>12||(3===c&&"bigDoor"===o&&(n.push.apply(n,Object(ue.a)(ge([0,-3,10],[a/2,-3,10],[a/2,1,10],[0,1,10]))),r.push.apply(r,Object(ue.a)(Qe)),i.push.apply(i,Ve),n.push.apply(n,Object(ue.a)(ge([0,1,10],[a/2,1,10],[a/2,1,0],[0,1,0]))),r.push.apply(r,Object(ue.a)(Qe)),i.push.apply(i,Ve)),n.push.apply(n,Object(ue.a)(ge([He[c-3],He[c+1-3],0],[He[c-3],He[c+1-3],He[c+2-3]],[He[c],He[c+1],He[c+2]],[He[c],He[c+1],0]))),i.push.apply(i,Ve),r.push.apply(r,Object(ue.a)(Qe)),n.push.apply(n,Object(ue.a)(ge([He[c-3],He[c+1-3],He[c+2-3]],[Ye[c-3],Ye[c+1-3],Ye[c+2-3]],[Ye[c],Ye[c+1],Ye[c+2]],[He[c],He[c+1],He[c+2]]))),i.push.apply(i,Ve),r.push.apply(r,Object(ue.a)(Qe)),p<12?(n.push.apply(n,Object(ue.a)(ge([Ye[c-3],Ye[c+1-3],Ye[c+2-3]],[Ye[c-3],Ye[c+1-3],0],[Ye[c],Ye[c+1],0],[Ye[c],Ye[c+1],Ye[c+2]]))),i.push.apply(i,Ve),r.push.apply(r,Object(ue.a)(Qe))):(n.push.apply(n,Object(ue.a)(ge([Ye[c-3],Ye[c+1-3],Ye[c+2-3]],[a/2,Ye[c+1-3],Ye[c+2-3]],[a/2,Ye[c+1],Ye[c+2]],[Ye[c],Ye[c+1],Ye[c+2]]))),i.push.apply(i,Ve),r.push.apply(r,Object(ue.a)(Qe))),11===p&&(n.push.apply(n,Object(ue.a)(ge([Ye[c],Ye[c+1],0],[a/2,Ye[c+1],0],[a/2,Ye[c+1],Ye[c+2]],[Ye[c],Ye[c+1],Ye[c+2]]))),i.push.apply(i,Ve),r.push.apply(r,Object(ue.a)(Qe))),0===p&&s.push.apply(s,Object(ue.a)(ge([Ye[c-3],0,Ye[c-1]],[Ye[c-3],0,-Ye[c-1]],[Ye[c-3],50,-Ye[c-1]],[Ye[c-3],50,Ye[c-1]]))));var u=[].concat(n);Re(u),ke(u,-1,1,1),xe(u,a,0,0),n.push.apply(n,Object(ue.a)(u)),i.push.apply(i,i);var l=[].concat(r);r.push.apply(r,Object(ue.a)(l));var h=[].concat(n);Re(h),ke(h,1,1,-1),n.push.apply(n,Object(ue.a)(h)),r.push.apply(r,r),i.push.apply(i,i);var d=[].concat(s);return Re(d),ke(d,-1,1,1),xe(d,a,0,0),s.push.apply(s,Object(ue.a)(d)),{v:n,c:r,b:s,u:i}},Ze=[1,1,1],Xe=[].concat(Ze,Ze,Ze,Ze,Ze,Ze),$e=[0,0,0],et=([].concat($e,$e,$e,$e,$e,$e),[0,0,1,0,1,1,0,0,1,1,0,1]),tt=null,at=null,ot=[0,-28.033300399780273,18.110000610351562,0,24.523099899291992,16.341800689697266,0,26.22130012512207,15.079400062561035,0,73.4574966430664,15.079400062561035,0,89.42109680175781,30.165700912475586,0,108.39409637451172,30.165700912475586],nt=function(e){tt||(tt=[].concat(ot),Se(tt,-Math.PI/4),at=[].concat(ot),Se(at,Math.PI/4));for(var t=[],a=[],o=[],n=[],r=[],s=e.p1[0]-e.p0[0],i=e.p0[1]-e.p1[1],p=Math.sqrt(s*s+i*i),c=3;c<ot.length;c+=3)t.push.apply(t,Object(ue.a)(ge([tt[c-3],tt[c-2],tt[c-1]],[at[c-3]+p,at[c-2],at[c-1]],[at[c]+p,at[c+1],at[c+2]],[tt[c],tt[c+1],tt[c+2]]))),o.push.apply(o,et),a.push.apply(a,Object(ue.a)(Xe)),3===c&&r.push.apply(r,Object(ue.a)(ge([tt[c-3]-2,0,tt[c-1]+2],[at[c-3]+p+2,0,at[c-1]+2],[at[c]+p+2,30,at[c+2]+2],[tt[c]-2,30,tt[c+2]+2])));var u=Me(s,i);return Se(t,u),xe(t,e.p0[0],-62,e.p0[1]),Se(r,u),xe(r,e.p0[0],-62,e.p0[1]),Se(n,u),xe(n,e.p0[0],-62,e.p0[1]),{v:t,c:a,u:o,v2:n,c2:[],u2:[],b:r}},rt=null,st=function(e){var t=e.v,a=e.c,o=void 0===a?null:a,n=e.mat,r=void 0===n?null:n,s=e.u,i=void 0===s?null:s,p=new u.BufferGeometry,c=new Float32Array(t);if(p.setAttribute("position",new u.BufferAttribute(c,3)),o){var l=new Float32Array(o);p.setAttribute("color",new u.BufferAttribute(l,3))}if(i){var h=new Float32Array(i);p.setAttribute("uv",new u.BufferAttribute(h,2))}p.computeVertexNormals(),r||rt||(rt=new u.MeshPhongMaterial({color:16777215,vertexColors:!0}));var d=r||rt;return new u.Mesh(p,d)},it=3e3,pt=3e3,ct=0,ut=function(){return++ct},lt={id:ut(),walls:{n:{id:ut(),p0:[0,0],p1:[pt,0]},e:{id:ut(),p0:[pt,0],p1:[pt,it]},s:{id:ut(),p0:[0,it],p1:[pt,it]},w:{id:ut(),p0:[0,0],p1:[0,it]}}},ht=function(){var e=null;!function t(a){for(var o=function(o){var n=a[o].walls.s.p1[0]-a[o].walls.s.p0[0],r=a[o].walls.e.p1[1]-a[o].walls.e.p0[1];if(n<800&&r<800&&Math.random()<.5&&(a[o].notDivide=!0),a[o].notDivide)return"continue";var s=function(e){var t=e.walls,a=!1,o=!1,n=null;if(t.s.p1[0]-t.s.p0[0]>250&&(a=!0,n="x"),t.e.p1[1]-t.e.p0[1]>250&&(o=!0,n="z"),a&&o&&(n=Math.random()<.5?"x":"z"),!n)return null;var r=[];if("x"===n){var s=(t.s.p1[0]-t.s.p0[0])*(.3+.4*Math.random())+t.s.p0[0];r.push({id:ut(),walls:{n:{id:ut(),p0:Object(ue.a)(t.n.p0),p1:[s,t.n.p1[1]]},e:{id:ut(),p0:[s,t.e.p0[1]],p1:[s,t.e.p1[1]]},s:{id:ut(),p0:Object(ue.a)(t.s.p0),p1:[s,t.s.p1[1]]},w:{id:ut(),p0:Object(ue.a)(t.w.p0),p1:Object(ue.a)(t.w.p1)}}},{id:ut(),walls:{n:{id:ut(),p0:[s,t.n.p0[1]],p1:Object(ue.a)(t.n.p1)},e:{id:ut(),p0:Object(ue.a)(t.e.p0),p1:Object(ue.a)(t.e.p1)},s:{id:ut(),p0:[s,t.s.p0[1]],p1:Object(ue.a)(t.s.p1)},w:{id:ut(),p0:[s,t.w.p0[1]],p1:[s,t.w.p1[1]]}}})}if("z"===n){var i=(t.e.p1[1]-t.e.p0[1])*(.3+.4*Math.random())+t.e.p0[1];r.push({id:ut(),walls:{n:{id:ut(),p0:Object(ue.a)(t.n.p0),p1:Object(ue.a)(t.n.p1)},e:{id:ut(),p0:Object(ue.a)(t.e.p0),p1:[t.e.p1[0],i]},s:{id:ut(),p0:[t.s.p0[0],i],p1:[t.s.p1[0],i]},w:{id:ut(),p0:Object(ue.a)(t.w.p0),p1:[t.w.p0[0],i]}}},{id:ut(),walls:{n:{id:ut(),p0:[t.n.p0[0],i],p1:[t.n.p1[0],i]},e:{id:ut(),p0:[t.e.p0[0],i],p1:Object(ue.a)(t.e.p1)},s:{id:ut(),p0:Object(ue.a)(t.s.p0),p1:Object(ue.a)(t.s.p1)},w:{id:ut(),p0:[t.w.p0[0],i],p1:Object(ue.a)(t.w.p1)}}})}return r}(a[o]);if(!s)return"continue";var i=a.filter((function(e){return e.id!==a[o].id}));return i.push.apply(i,Object(ue.a)(s)),e=i,{v:void t(i)}},n=0;n<a.length;++n){var r=o(n);if("continue"!==r&&"object"===typeof r)return r.v}}([lt]);for(var t=0;t<e.length;++t)for(var a=e[t].walls.s,o=e[t].walls.e,n=0;n<e.length;++n)if(e[t].id!==e[n].id){var r=e[n].walls.n,s=[Math.max(a.p0[0],r.p0[0]),Math.min(a.p1[0],r.p1[0])];if(r.p0[1]===a.p0[1]&&s[0]>=a.p0[0]&&s[0]<=a.p1[0]&&s[1]>=a.p0[0]&&s[1]<=a.p1[0]&&s[0]>=r.p0[0]&&s[0]<=r.p1[0]&&s[1]>=r.p0[0]&&s[1]<=r.p1[0]){var i=s[1]-s[0];if(i>60){var p={id:ut(),x0:s[0]+i/2-15,x1:s[0]+i/2+15};a.doors||(a.doors=[]),a.doors.push(p),r.doors||(r.doors=[]),r.doors.push(p)}}var c=e[n].walls.w,u=[Math.max(c.p0[1],o.p0[1]),Math.min(c.p1[1],o.p1[1])];if(c.p0[0]===o.p0[0]&&u[0]>=o.p0[1]&&u[0]<=o.p1[1]&&u[1]>=o.p0[1]&&u[1]<=o.p1[1]&&u[0]>=c.p0[1]&&u[0]<=c.p1[1]&&u[1]>=c.p0[1]&&u[1]<=c.p1[1]){var l=u[1]-u[0];if(l>60){var h=1e14*Math.random();o.doors||(o.doors=[]),o.doors.push({id:h,z0:u[0]+l/2-15,z1:u[0]+l/2+15}),c.doors||(c.doors=[]),c.doors.push({id:h,z0:u[0]+l/2-15,z1:u[0]+l/2+15})}}}for(var d=[],f=0;f<e.length;++f){var m=e[f].walls.n;if(0===m.p0[1]){var b=[m.p0[0],m.p1[0]],y=b[1]-b[0];if(y>60){var A={id:ut(),x0:b[0]+y/2-15,x1:b[0]+y/2+15,keyMode:"bigDoor"};m.doors||(m.doors=[]),m.doors.push(A),d.push(A)}}}for(var v=0;v<e.length;++v){var O=e[v].walls.n;if(O.doors){O.doors.sort((function(e,t){return e.x0-t.x0})),O.wallSegments=[];for(var g=0;g<O.doors.length;++g)0===g&&O.wallSegments.push({p0:Object(ue.a)(O.p0),p1:[O.doors[g].x0,O.p0[1]]}),O.doors[g-1]&&O.wallSegments.push({p0:[O.doors[g-1].x1,O.p0[1]],p1:[O.doors[g].x0,O.p0[1]]}),g===O.doors.length-1&&O.wallSegments.push({p0:[O.doors[O.doors.length-1].x1,O.p0[1]],p1:Object(ue.a)(O.p1)})}var j=e[v].walls.s;if(j.doors){j.doors.sort((function(e,t){return e.x0-t.x0})),j.wallSegments=[];for(var w=j.doors.length-1;w>-1;--w)w===j.doors.length-1&&j.wallSegments.push({p0:Object(ue.a)(j.p1),p1:[j.doors[w].x1,j.p1[1]]}),j.doors[w-1]&&j.wallSegments.push({p0:[j.doors[w].x0,j.p1[1]],p1:[j.doors[w-1].x1,j.p1[1]]}),0===w&&j.wallSegments.push({p0:[j.doors[w].x0,j.p1[1]],p1:Object(ue.a)(j.p0)})}var M=e[v].walls.e;if(M.doors){M.doors.sort((function(e,t){return e.z0-t.z0})),M.wallSegments=[];for(var C=0;C<M.doors.length;++C)0===C&&M.wallSegments.push({p0:Object(ue.a)(M.p0),p1:[M.p0[0],M.doors[C].z0]}),M.doors[C-1]&&M.wallSegments.push({p0:[M.p0[0],M.doors[C-1].z1],p1:[M.p0[0],M.doors[C].z0]}),C===M.doors.length-1&&M.wallSegments.push({p0:[M.p0[0],M.doors[C].z1],p1:Object(ue.a)(M.p1)})}var _=e[v].walls.w;if(_.doors){_.doors.sort((function(e,t){return e.z0-t.z0})),_.wallSegments=[];for(var S=_.doors.length-1;S>-1;--S)S===_.doors.length-1&&_.wallSegments.push({p0:Object(ue.a)(_.p1),p1:[_.p1[0],_.doors[S].z1]}),_.doors[S-1]&&_.wallSegments.push({p0:[_.p1[0],_.doors[S].z0],p1:[_.p1[0],_.doors[S-1].z1]}),0===S&&_.wallSegments.push({p0:[_.p1[0],_.doors[S].z0],p1:Object(ue.a)(_.p0)})}}for(var x=[],k=[],R=0;R<e.length;++R){var I=[.4*Math.random(),.4*Math.random(),.4*Math.random()],E=e[R].walls.n,T={p0:E.p0,p1:E.p1,arr:[],colorRoom:I};if(E.wallSegments)for(var P=0;P<E.wallSegments.length;++P)T.arr.push(E.wallSegments[P]);k.push(T);var D=e[R].walls.s,N={p0:D.p1,p1:D.p0,arr:[],colorRoom:I};if(D.wallSegments)for(var F=0;F<D.wallSegments.length;++F)N.arr.push(D.wallSegments[F]);k.push(N);var L=e[R].walls.e,z={p0:L.p0,p1:L.p1,arr:[],colorRoom:I};if(L.wallSegments)for(var G=0;G<L.wallSegments.length;++G)z.arr.push(L.wallSegments[G]);k.push(z);var W=e[R].walls.w,U={p0:W.p1,p1:W.p0,arr:[],colorRoom:I};if(W.wallSegments)for(var q=0;q<W.wallSegments.length;++q)U.arr.push(W.wallSegments[q]);k.push(U);var K={p0:D.p0,p1:D.p1,p2:E.p1,p3:E.p0,colorRoom:I};x.push(K)}for(var Q={},V=0;V<e.length;++V)for(var H in e[V].walls)if(e[V].walls[H].doors)for(var Y=0;Y<e[V].walls[H].doors.length;++Y){var J=null,Z=null;"n"!==H&&"s"!==H||(Z=e[V].walls[H].p0[1]),"e"!==H&&"w"!==H||(J=e[V].walls[H].p0[0]),Q[e[V].walls[H].doors[Y].id]=Object(B.a)(Object(B.a)({},e[V].walls[H].doors[Y]),{},{dir:H,x:J,z:Z})}for(var X in Q)Q[X].x0?(Q[X].l=Q[X].x1-Q[X].x0,Q[X].p0=[Q[X].x0,Q[X].z],Q[X].p1=[Q[X].x1,Q[X].z],Q[X].angle=0):(Q[X].l=Q[X].z1-Q[X].z0,Q[X].p0=[Q[X].x,Q[X].z0],Q[X].p1=[Q[X].x,Q[X].z1],Q[X].angle=-Math.PI/2);var $=JSON.parse(JSON.stringify(lt)),ee=[];for(var te in $.walls){if("n"===te){d.sort((function(e,t){return e.x0-t.x0}));for(var ae=d.length-1;ae>-1;--ae)ae===d.length-1&&ee.push({p0:Object(ue.a)($.walls[te].p1),p1:[d[ae].x1+10,$.walls[te].p1[1]]}),d[ae-1]&&ee.push({p0:[d[ae].x0-10,$.walls[te].p1[1]],p1:[d[ae-1].x1+10,$.walls[te].p1[1]]}),0===ae&&ee.push({p0:[d[ae].x0-10,$.walls[te].p1[1]],p1:Object(ue.a)($.walls[te].p0)})}"s"===te&&ee.push({p0:$.walls[te].p0,p1:$.walls[te].p1}),"e"===te&&ee.push({p0:$.walls[te].p1,p1:$.walls[te].p0}),"w"===te&&ee.push({p0:$.walls[te].p0,p1:$.walls[te].p1})}return{arrOuterWalls:ee,doors:Q,arrWallsPrepared:k,floors:x,roomsArr:e}},dt=[0,0,1,0,1,1,0,0,1,1,0,1],ft=-61,mt=-64,bt=[1,1,1],yt=[].concat(bt,bt,bt,bt,bt,bt),At=function(e,t,a){e.colorRoom[0]*=1.2,e.colorRoom[1]*=1.2,e.colorRoom[2]*=1.2;for(var o=[].concat(Object(ue.a)(e.colorRoom),Object(ue.a)(e.colorRoom),Object(ue.a)(e.colorRoom),Object(ue.a)(e.colorRoom),Object(ue.a)(e.colorRoom),Object(ue.a)(e.colorRoom)),n=[].concat(Object(ue.a)(t),Object(ue.a)(t),Object(ue.a)(t),Object(ue.a)(t),Object(ue.a)(t),Object(ue.a)(t)),r=([].concat(Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a),Object(ue.a)(a)),[]),s=[],i=[],p=[],c=[],u=[],l=30,h=35,d=e.p1[0]-h-(e.p0[0]+h),f=e.p2[1]+h-(e.p1[1]-h),m=Math.ceil(Math.abs(d/100)),b=Math.ceil(Math.abs(f/100)),y=d/m,A=f/b,v=0;v<m;++v)for(var O=0;O<b;++O)r.push.apply(r,Object(ue.a)(ge([e.p0[0]+h+v*y,ft,e.p0[1]-h+O*A],[e.p0[0]+h+(v+1)*y,ft,e.p0[1]-h+O*A],[e.p0[0]+h+(v+1)*y,ft,e.p0[1]-h+(O+1)*A],[e.p0[0]+h+v*y,ft,e.p0[1]-h+(O+1)*A]))),s.push.apply(s,Object(ue.a)(n)),i.push.apply(i,dt);return r.push.apply(r,Object(ue.a)(ge([e.p0[0]+l,ft,e.p0[1]-l],[e.p0[0]+h,ft,e.p0[1]-h],[e.p3[0]+h,ft,e.p3[1]+h],[e.p3[0]+l,ft,e.p3[1]+l]))),s.push.apply(s,Object(ue.a)(o)),i.push.apply(i,dt),p.push.apply(p,Object(ue.a)(ge([e.p0[0]+l,mt,e.p0[1]-l],[e.p0[0]+h,mt,e.p0[1]-h],[e.p3[0]+h,mt,e.p3[1]+h],[e.p3[0]+l,mt,e.p3[1]+l]))),c.push.apply(c,Object(ue.a)(n)),u.push.apply(u,dt),r.push.apply(r,Object(ue.a)(ge([e.p0[0]+l,ft,e.p0[1]-l],[e.p1[0]-l,ft,e.p1[1]-l],[e.p1[0]-h,ft,e.p1[1]-h],[e.p0[0]+h,ft,e.p0[1]-h]))),s.push.apply(s,Object(ue.a)(o)),i.push.apply(i,dt),p.push.apply(p,Object(ue.a)(ge([e.p0[0]+l,mt,e.p0[1]-l],[e.p1[0]-l,mt,e.p1[1]-l],[e.p1[0]-h,mt,e.p1[1]-h],[e.p0[0]+h,mt,e.p0[1]-h]))),c.push.apply(c,Object(ue.a)(n)),u.push.apply(u,dt),r.push.apply(r,Object(ue.a)(ge([e.p3[0]+h,ft,e.p3[1]+h],[e.p2[0]-h,ft,e.p2[1]+h],[e.p2[0]-l,ft,e.p2[1]+l],[e.p3[0]+l,ft,e.p3[1]+l]))),s.push.apply(s,Object(ue.a)(o)),i.push.apply(i,dt),p.push.apply(p,Object(ue.a)(ge([e.p3[0]+h,mt,e.p3[1]+h],[e.p2[0]-h,mt,e.p2[1]+h],[e.p2[0]-l,mt,e.p2[1]+l],[e.p3[0]+l,mt,e.p3[1]+l]))),c.push.apply(c,Object(ue.a)(n)),u.push.apply(u,dt),r.push.apply(r,Object(ue.a)(ge([e.p1[0]-h,ft,e.p1[1]-h],[e.p1[0]-l,ft,e.p1[1]-l],[e.p2[0]-l,ft,e.p2[1]+l],[e.p2[0]-h,ft,e.p3[1]+h]))),s.push.apply(s,Object(ue.a)(o)),i.push.apply(i,dt),p.push.apply(p,Object(ue.a)(ge([e.p1[0]-h,mt,e.p1[1]-h],[e.p1[0]-l,mt,e.p1[1]-l],[e.p2[0]-l,mt,e.p2[1]+l],[e.p2[0]-h,mt,e.p3[1]+h]))),c.push.apply(c,Object(ue.a)(n)),u.push.apply(u,dt),r.push.apply(r,Object(ue.a)(ge([e.p0[0],ft,e.p0[1]],[e.p1[0],ft,e.p1[1]],[e.p1[0]-l,ft,e.p1[1]-l],[e.p0[0]+l,ft,e.p0[1]-l]))),s.push.apply(s,Object(ue.a)(yt)),i.push.apply(i,dt),r.push.apply(r,Object(ue.a)(ge([e.p1[0]-l,ft,e.p1[1]-l],[e.p1[0],ft,e.p1[1]],[e.p2[0],ft,e.p2[1]],[e.p2[0]-l,ft,e.p2[1]+l]))),s.push.apply(s,Object(ue.a)(yt)),i.push.apply(i,dt),r.push.apply(r,Object(ue.a)(ge([e.p3[0],ft,e.p3[1]],[e.p3[0]+l,ft,e.p3[1]+l],[e.p2[0]-l,ft,e.p2[1]+l],[e.p2[0],ft,e.p2[1]]))),s.push.apply(s,Object(ue.a)(yt)),i.push.apply(i,dt),r.push.apply(r,Object(ue.a)(ge([e.p0[0],ft,e.p0[1]],[e.p0[0]+l,ft,e.p0[1]-l],[e.p3[0]+l,ft,e.p2[1]+l],[e.p3[0],ft,e.p3[1]]))),s.push.apply(s,Object(ue.a)(yt)),i.push.apply(i,dt),{v:r,c:s,u:i,c2:c,v2:p,u2:u,b:[]}},vt=[1,1,1],Ot=[].concat(vt,vt,vt,vt,vt,vt),gt=[0,0,0],jt=([].concat(gt,gt,gt,gt,gt,gt),function(e){var t=e.materials,a=e.studio,o=e.system_PlayerMoveOnLevel,n=new u.Mesh(new u.PlaneGeometry(1e4,1e4),t.floorMat1);t.floorMat1.map.repeat.set(180,180),n.rotation.x=-Math.PI/2,n.position.y=-62;var r=function(e){for(var t=ht(),a=t.arrOuterWalls,o=t.doors,n=t.arrWallsPrepared,r=t.floors,s=t.roomsArr,i=[],p=0;p<s.length;++p)Math.abs(s[p].walls.n.p1[0]-s[p].walls.n.p0[0])>300&&Math.abs(s[p].walls.e.p1[1]-s[p].walls.e.p0[1])>300&&i.push(s[p]);for(var c=[],u=[],l=[],h=[],d=[],f=[],m=[],b=0;b<n.length;++b){var y=ze(n[b]);c.push.apply(c,Object(ue.a)(y.v)),u.push.apply(u,Object(ue.a)(y.c)),l.push.apply(l,Object(ue.a)(y.b)),h.push.apply(h,Object(ue.a)(y.u))}for(var A in o){var v=Je(e,null,o[A].l,o[A].keyMode||null);Se(v.v,o[A].angle),xe(v.v,o[A].p0[0],-61,o[A].p0[1]),c.push.apply(c,Object(ue.a)(v.v)),Se(v.b,o[A].angle),xe(v.b,o[A].p0[0],-61,o[A].p0[1]),l.push.apply(l,Object(ue.a)(v.b)),h.push.apply(h,Object(ue.a)(v.u)),u.push.apply(u,Object(ue.a)(v.c)),"n"===o[A].dir&&0===o[A].p0[1]||(d.push.apply(d,Object(ue.a)(v.v)),f.push.apply(f,Object(ue.a)(v.c)),m.push.apply(m,Object(ue.a)(v.u)))}for(var O=0;O<a.length;++O){var g=nt(a[O]);c.push.apply(c,Object(ue.a)(g.v)),u.push.apply(u,Object(ue.a)(g.c)),l.push.apply(l,Object(ue.a)(g.b)),h.push.apply(h,Object(ue.a)(g.u)),d.push.apply(d,Object(ue.a)(g.v2)),f.push.apply(f,Object(ue.a)(g.c2)),m.push.apply(m,Object(ue.a)(g.u2))}for(var j=0;j<r.length;++j){var w=At(r[j],vt,[0,1,0]);c.push.apply(c,Object(ue.a)(w.v)),u.push.apply(u,Object(ue.a)(w.c)),h.push.apply(h,Object(ue.a)(w.u)),d.push.apply(d,Object(ue.a)(w.v2)),f.push.apply(f,Object(ue.a)(w.c2)),m.push.apply(m,Object(ue.a)(w.u2))}for(var M=0;M<r.length;++M)for(var C=r[M],_=C.p1[0]-C.p0[0],S=C.p2[1]-C.p1[1],x=Math.ceil(Math.abs(_/100)),k=Math.ceil(Math.abs(S/100)),R=_/x,I=S/k,E=0;E<x;++E)for(var T=0;T<k;++T){var P=ge([C.p0[0]+E*R,30,C.p2[1]-T*I],[C.p0[0]+(E+1)*R,30,C.p2[1]-T*I],[C.p0[0]+(E+1)*R,30,C.p2[1]-(T+1)*I],[C.p0[0]+E*R,30,C.p2[1]-(T+1)*I]);c.push.apply(c,Object(ue.a)(P)),u.push.apply(u,Object(ue.a)(Ot)),h.push(0,0,1,0,1,1,0,0,1,1,0,1)}var D=st({v:c,c:u,u:h,mat:e.materials.iron});e.studio.addToScene(D);var N=st({v:d,c:f,u:m,mat:e.materials.iron2}),F=st({v:l});return F.visible=!1,e.studio.addToScene(F),{mesh:D,mCollision:F,roomsArr:s,toNormal:function(){e.studio.removeFromScene(N),e.studio.addToScene(D)},toNotWalls:function(){e.studio.removeFromScene(D),e.studio.addToScene(N)},getCoordsForFinalBox:function(e,t){for(var a=0,o=0,n=null,r=0;r<i.length;++r)Math.abs(e-i[r].walls.n.p0[0])>a&&Math.abs(t-i[r].walls.n.p0[1])>o&&(n=i[r],a=Math.abs(e-i[r].walls.n.p0[0]),o=Math.abs(t-i[r].walls.n.p0[1]));return n?{x:n.walls.n.p0[0]+(n.walls.n.p1[0]-n.walls.n.p0[0])/2,z:n.walls.e.p0[1]+(n.walls.e.p1[1]-n.walls.e.p0[1])/2}:null}}}(e);console.log(e.assets.endWayModel);var s=new u.Mesh(e.assets.endWayModel.children[0].geometry,e.materials.bodyRed);s.position.y=-62;var i=e.assets.endWayModel.children[1];i.visible=!1,s.add(i);var p=new u.Object3D;return p.position.set(0,0,-35),s.add(p),{addWorld:function(){o.addItemToPlayerCollision(n),o.addItemToPlayerCollision(r.mCollision),a.addToScene(n)},removeWorld:function(){o.removeItemFromPlayerCollision(n),a.removeFromScene(n)},roomsArr:r.roomsArr,toNormal:function(){r.toNormal()},toNotWalls:function(){r.toNotWalls(),e.studio.removeFromScene(n)},setEndWayPos:function(t,a,o){s.position.x=t,s.position.y=a,s.position.z=o,e.studio.addToScene(s)},getCoordsForFinalBox:r.getCoordsForFinalBox,centralItemBounds:i,endItemObj:p}}),wt=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=[],n=0;n<e;++n)for(var r=Math.random()*t,s=Math.random()*Math.PI*2,i=Math.random()*Math.PI*2,p=Math.sin(s)*r,c=Math.sin(i)*Math.random()*50,u=Math.cos(s)*r,l=0;l<3;++l)o.push(p+Math.random()*a,c+Math.random()*a,u+Math.random()*a);return o},Mt=function(e){var t=e.walls.n.p0[0],a=e.walls.n.p1[0],o=e.walls.e.p0[1],n=a-t,r=e.walls.e.p1[1]-o;return{x:t+.2*n+Math.random()*n*.6,z:o+.2*r+Math.random()*r*.6}},Ct=function(e){return new Promise((function(t){return setTimeout(t,e)}))},_t=null,St=function(e,t,a){_t=a.position.y;var o=new u.Object3D;o.position.copy(t.position),o.position.y=0,o.rotation.copy(t.rotation);var n=new u.Object3D;n.position.copy(a.position),n.position.y=0,n.rotation.copy(a.rotation);var r=n.quaternion.clone();n.lookAt(o.position);var s=n.quaternion.clone(),i=o.quaternion.clone();i,o.lookAt(n.position),o.rotateX(.2),o.rotateOnWorldAxis(new u.Vector3(0,1,0),Math.PI);var p=o.quaternion.clone();return new Promise((function(e){var o={phase:0};new W.b(o).to({phase:1},1500).onUpdate((function(){t.quaternion.slerpQuaternions(i,p,o.phase),a.quaternion.slerpQuaternions(r,s,o.phase),a.position.y=_t-10*o.phase})).onComplete((function(){new W.b({phase:0}).to({phase:1},500).onUpdate((function(){a.translateZ(.2)})).onComplete((function(){e()})).start()})).start()}))},xt=function(e,t){var a=e.quaternion.clone(),o=new u.Object3D;o.position.copy(e.position),o.position.y=0;var n=new u.Object3D;n.position.copy(t.position),n.position.y=0,o.lookAt(n.position),o.rotateOnWorldAxis(new u.Vector3(0,1,0),Math.PI);var r=o.quaternion.clone();return new Promise((function(t){var o={phase:0};new W.b(o).to({phase:1},1500).onUpdate((function(){e.quaternion.slerpQuaternions(a,r,o.phase)})).onComplete(t).start()}))};function kt(){return(kt=Object(s.a)(r.a.mark((function e(t,a){var o,n,s,i,p;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.worldReal,n=t.statue,s=t.player,i=t.studio,(p=t.system_PlayerMoveOnLevel).toggleFreeze(!0),o.setEndWayPos(a[0],-61,a[1]),i.changeEnvironment(M,{time:1500}),e.next=6,St(0,s.mesh,n.m);case 6:return o.toNotWalls(),p.toggleFreeze(!1),i.changeEnvironment(w,{time:1500}),e.next=11,xt(s.mesh,o.endItemObj);case 11:return n.hide(),e.next=14,Ct(3e3);case 14:n.m.position.y=_t,n.m.position.y=_t,n.m.position.z=6e3;case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Rt=function(e){var t=e.player;return new Promise((function(e){var a={z:t.mesh.position.z};new W.b(a).easing(W.a.Quadratic.Out).to({z:-300},4e3).onUpdate((function(){t.mesh.position.z=a.z})).onComplete((function(){e()})).start()}))};function It(){return(It=Object(s.a)(r.a.mark((function e(t){var a,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.worldReal,t.statue,a=t.player,o=t.studio,t.system_PlayerMoveOnLevel,a.mesh.position.set(1060.4553029932501,-40,-500),a.mesh.rotation.y=Math.PI,o.changeEnvironment(j,{time:15e3}),e.next=6,Rt(t);case 6:a.toggleBlocked(!1);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Et=function(e,t,a){var o=t.position.clone(),n=a.position.clone();n.z-=20,n.y+=5;var r=t.quaternion.clone(),s=new u.Object3D;s.rotation.x=-Math.PI/2,s.rotation.y+=Math.PI;var i=s.quaternion.clone();return new Promise((function(e){var a={phase:0};new W.b(a).to({phase:1},1500).onUpdate((function(){t.quaternion.slerpQuaternions(r,i,a.phase),t.position.lerpVectors(o,n,a.phase)})).onComplete(e).start()}))},Tt=function(e){var t=e.position.clone(),a=e.position.clone();return a.y=1e3,new Promise((function(o){var n={phase:0};new W.b(n).to({phase:1},500).onUpdate((function(){e.position.lerpVectors(t,a,n.phase)})).onComplete(o).start()}))};function Pt(){return(Pt=Object(s.a)(r.a.mark((function e(t){var a,o,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.worldReal,a=t.statue,o=t.player,n=t.studio,t.system_PlayerMoveOnLevel,console.log("!!!-endPipeLine"),e.next=4,Et(0,o.mesh,a.m);case 4:return e.next=6,Tt(o.mesh);case 6:return n.changeEnvironment(C,{time:3e3}),e.next=9,Ct(5e3);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Dt,Nt={x:0,z:0},Ft=function(e,t,a){1===e?(t.statue.toWhite(),t.points.m.visible=!0):(t.statue.toBlack(),t.points.m.visible=!1);var o={phase:0===e?1:0};new W.b(o).easing(W.a.Quadratic.Out).to({phase:0===e?0:1},1e3).onUpdate((function(){t.studio.setEffectStrength(o.phase)})).onComplete(a).start()},Lt=function(e){var t=function(){};return{update:function(){console.log("logger !!!"),t()},onComplete:function(e){return t=e}}},Bt=[(Dt=6,function(e){var t=0,a=function(){};return{update:function(){console.log("room walk",t),++t===Dt&&Ft(1,e,a)},onComplete:function(e){a=e}}}),function(e){var t=e.statue,a=e.player,o=e.emitter,n=0,r=function(){},s=null,i=!0,p=o.subscribe("playerMove")((function(e){i&&Math.abs(a.mesh.position.x-t.m.position.x)<45&&Math.abs(a.mesh.position.z-t.m.position.z)<45&&(t.hide(),clearTimeout(s),i=!1)}));return{update:function(a){console.log("room walk - appear hide",n),clearTimeout(s),0===n&&Ft(0,e,(function(){})),s=setTimeout((function(){var o=Mt(a);t.appear(o.x,o.z),i=!0,s=setTimeout((function(){i=!1,t.hide()}),3e3*Math.random()),5===++n&&Ft(1,e,(function(){p(),r()}))}),3e3*Math.random())},onComplete:function(e){r=e},name:"updateRoomsStatueHide"}},function(e){var t=e.statue,a=e.player,o=e.emitter,n=0,r=function(){},s=null,i=!0,p=o.subscribe("playerMove")((function(e){i&&Math.abs(a.mesh.position.x-t.m.position.x)<45&&Math.abs(a.mesh.position.z-t.m.position.z)<45&&(t.hide(),i=!1)}));return{update:function(a){console.log("room walk - appear, hide near",n),clearTimeout(s),1===n&&Ft(0,e,(function(){})),s=setTimeout((function(){var o=Mt(a);t.appear(o.x,o.z),i=!0,5===++n&&Ft(1,e,(function(){t.hide(),setTimeout((function(){t.m.position.z=5e3}),2e3),p(),r()}))}),5e3*Math.random())},onComplete:function(e){r=e},name:"updateRoomsStatueNotHide"}},function(e){var t=e.statue,a=e.system_PlayerMoveOnLevel,o=0,n=function(){};return a.addItemToPlayerCollision(t.mCollision),{update:function(e){console.log("room walk - appear hot hide",o),setTimeout((function(){var a=Mt(e);t.appear(a.x,a.z),5===++o&&n()}),5e3*Math.random())},onComplete:function(e){n=e},name:"updateRoomsStatueNotHideCollision"}},function(e){var t=function(){},a=e.statue,o=e.emitter,n=e.player,r=e.worldReal,s=o.subscribe("playerMove")((function(o){Math.abs(n.mesh.position.x-a.m.position.x)>20||Math.abs(n.mesh.position.z-a.m.position.z)>20||(s(),(Nt=r.getCoordsForFinalBox(n.mesh.position.x,n.mesh.position.z))&&function(e,t){return kt.apply(this,arguments)}(e,[Nt.x,Nt.z]).then((function(){Ft(1,e,(function(){t()}))})))}));return{update:function(e){var t=Mt(e);a.appear(t.x,t.z)},onComplete:function(e){t=e},name:"addEndStone"}},Lt,function(e){var t=function(){},a=e.statue,o=e.emitter,n=e.player,r=e.worldReal,s=e.studio,i=e.system_PlayerMoveOnLevel;r.toNotWalls(),a.toRed(),s.changeEnvironment(w,{time:100}),a.m.position.set(Nt.x,-43.5,Nt.z),i.addItemToPlayerCollision(r.centralItemBounds),a.m.rotation.set(0,0,0),a.m.rotation.x=-Math.PI/2-.027,a.appear();var p=new u.Vector3,c=o.subscribe("playerMove")((function(a){r.endItemObj.getWorldPosition(p),Math.abs(n.mesh.position.x-p.x)>30||Math.abs(n.mesh.position.z-p.z)>30||(c(),function(e){return Pt.apply(this,arguments)}(e).then((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"}),t()})))}));return{update:function(e){},onComplete:function(e){t=e},name:"setStatueOnEndStone"}},Lt],zt=a(6),Gt=a(18),Wt=a.n(Gt),Ut=a(10),qt=(a(40),"en"),Kt=function(e){return function(t){return e[qt]&&e[qt][t]||t}},Qt=a(5),Vt=Kt({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a",Machine:"\u041c\u0430\u0448\u0438\u043d\u0430",Rooms:"\u041a\u043e\u043c\u043d\u0430\u0442\u044b","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),Ht=Object(Ut.b)((function(e){return Object(B.a)({},e.controls.infoPanelData)}))((function(e){return Object(Qt.jsxs)("div",{className:"info",children:[Object(Qt.jsx)("button",{className:"control-small butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),Object(Qt.jsxs)("div",{className:"info-inner",children:[Object(Qt.jsx)("p",{children:Vt(e.title)}),Object(Qt.jsx)("p",{children:Vt(e.topText)}),Object(Qt.jsx)("ul",{children:e.chapters.map((function(t,a){return Object(Qt.jsxs)("li",{children:[a+1,".\xa0",t.href?Object(Qt.jsx)("span",{children:Object(Qt.jsx)("a",{href:t.href,target:"blank",children:Vt(t.text)})}):Object(Qt.jsx)("span",{children:Vt(t.text)}),a===e.currentChapterIndex&&Vt(" (current)")]},a)}))}),Object(Qt.jsx)("p",{children:e.bottomText}),Object(Qt.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(Qt.jsxs)("li",{children:[Vt(e.text),Object(Qt.jsx)("a",{href:e.href,target:"blank",children:Vt(e.aText)})]},t)}))})]})]})})),Yt=(a(42),Object(Ut.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(zt.useState)(!0),a=Object(se.a)(t,2),o=a[0],n=a[1];return Object(zt.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&n(!0)}))})),Object(Qt.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(Qt.jsx)("button",{className:"".concat(e.isMute?"butt-sound-n":"butt-sound"," control-small"),onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})}}),e.isShowControls&&Object(Qt.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")}}),e.isShowControls&&Object(Qt.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")}}),e.isShowControls&&Object(Qt.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")}}),e.isShowControls&&Object(Qt.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")}}),e.isShowControls&&o&&Object(Qt.jsx)("button",{className:"butt-fullscreen control-small",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),n(!1)}}),!e.isInfo&&Object(Qt.jsx)("button",{className:"butt-info control-small",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),e.isInfo&&Object(Qt.jsx)(Ht,{})]})})));var Jt={dispatch:null},Zt=Object(Ut.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!Jt.dispatch&&(Jt.dispatch=e.dispatch),Object(Qt.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(Qt.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(Qt.jsx)(Yt,{gameContext:e.gameContext})]})})),Xt=a(15),$t=a(26),ea={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"Machine",href:"./../chapter05"},{text:"Rooms",href:"./../chapter06"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var ta=document.querySelector(".progress"),aa=-100,oa=!0;!function e(){oa&&setTimeout((function(){0===++aa&&(aa-=100),ta.style.marginLeft=aa+"%",e()}),30)}();var na=function(){function e(t){Object(I.a)(this,e),t.dispatcher=Jt,this._root=t;var a=function(e){e.customStore||(e.customStore={});var t=Object(Xt.b)(Object(B.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ea,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(B.a)(Object(B.a)({},e),{},{infoPanelData:Object(B.a)(Object(B.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(B.a)(Object(B.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(B.a)(Object(B.a)({},e),{},{isMute:t.is}):Object(B.a)({},e)}},e.customStore)),a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Xt.c;return Object(Xt.d)(t,a(Object(Xt.a)($t.a)))}(t);a&&Wt.a.render(Object(Qt.jsx)(Ut.a,{store:a,children:Object(Qt.jsx)(Zt,{gameContext:t})}),document.getElementById("root"))}return Object(E.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),a=document.querySelector(".progress-wrapper"),o=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,qt=t),document.querySelector(".start-screen").style.display="none"};oa=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),o(t)})),a.style.display="none"}}]),e}(),ra=(a(43),{ru:{"What's happening?":"\u0427\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442?","I'm generating the Great Recursion. I need a component. Deliver it to me.":"\u042f \u0433\u0435\u043d\u0435\u0440\u044e \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u044e. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430. \u0414\u043e\u0441\u0442\u0430\u0432\u044c \u043c\u043d\u0435 \u0435\u0435.","Alright. Where can I find this component?":"\u0425\u043e\u0440\u043e\u0448\u043e. \u0413\u0434\u0435 \u043c\u043d\u0435 \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443?","I updated the location mark in your car, follow it.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435, \u0441\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","I'll be back.":"\u042f \u0432\u0435\u0440\u043d\u0443\u0441\u044c.","For the glory of Recursion.":"\u0412\u043e \u0441\u043b\u0430\u0432\u0443 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438.","Do you have a Great Recursion Component?":"\u0423 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438?","I will generate you a Great Component for the Great Recursion. I need a Component.":"\u042f \u0441\u0433\u0435\u043d\u0435\u0440\u044e \u0442\u0435\u0431\u0435 \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430.","Where can I find it?":"\u0413\u0434\u0435 \u043c\u043d\u0435 \u0435\u0435 \u043d\u0430\u0439\u0442\u0438?","I updated the location mark in the car.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u043c\u0430\u0448\u0438\u043d\u0435.","..Component.. ?":"..\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430..?","Yes. I have finished generating the Component for the Great Component of the Great Recursion.":"\u0414\u0430. \u042f \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b \u0433\u0435\u043d\u0435\u0440\u0438\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438.","I need to deliver it to generate the Great Component.":"\u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0435\u0435 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","The location mark in your car has been updated. It will point to the Component of the Great Component.":"\u0423\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d. \u041e\u043d \u0443\u043a\u0430\u0436\u0435\u0442 \u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","Is my car the key to Components?":"\u041c\u043e\u044f \u043c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u043a\u043b\u044e\u0447 \u043a \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c?","Your Car is the main Iterator. Follow it.":"\u0422\u0432\u043e\u044f \u041c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0418\u0442\u0435\u0440\u0430\u0442\u043e\u0440. \u0421\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",drive:"\u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435",exit:"\u0432\u044b\u0439\u0442\u0438","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),sa=Kt(ra),ia=Object(Ut.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(Qt.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(Qt.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:sa(t.q)},Math.floor(1e5*Math.random()))}))})})),pa=Kt(ra),ca=Object(Ut.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(Qt.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(Qt.jsxs)("div",{children:[Object(Qt.jsx)("div",{className:"q",children:pa(e.q)}),Object(Qt.jsx)("div",{className:"a",children:pa(e.a)})]},Math.floor(1e5*Math.random()))}))})})),ua=Kt(ra);var la=Object(Ut.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocationOfList:e.ui.currentLocationOfList,locationsList:e.ui.locationsList}}))((function(e){return Object(Qt.jsxs)(Qt.Fragment,{children:[!e.isShowFinalMessage&&e.isButtonDialog&&!e.isShowPalleteDialog&&Object(Qt.jsx)("button",{className:"control control-enter",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!0})}}),e.isShowPalleteDialog&&Object(Qt.jsx)("div",{className:"dialog-wrapper",children:Object(Qt.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(Qt.jsxs)("div",{className:"messages-wrapper",children:[Object(Qt.jsx)(ca,{}),Object(Qt.jsx)(ia,{})]}),e.isButtonDialog&&Object(Qt.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?ua("close dialog"):ua("open dialog")})]})}),e.isShowButtonDrawCar&&Object(Qt.jsx)("button",{className:"control ".concat("exit"===e.valButtonDrawCar?"control-exit":"control-enter"),onClick:function(){return e.dispatch({type:"CLICK_DRAW"})}}),e.isShowFinalMessage&&Object(Qt.jsx)("div",{className:"final-mess",children:ua("To be continued")})]})})),ha=a(7),da={location01:"location02",location02:"location03",location03:"locationToFinish"},fa={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"drive",currentLocation:null,phrasesData:{location01:{isComplete:!1,phraseIndex:0,phrases:[{q:"What's happening?",a:"I'm generating the Great Recursion. I need a component. Deliver it to me.",event:"nextReply"},{q:"Alright. Where can I find this component?",a:"I updated the location mark in your car, follow it.",event:"nextReply"},{q:"I'll be back.",a:"For the glory of Recursion.",event:"close"}]},location02:{isComplete:!1,phraseIndex:0,phrases:[{q:"Do you have a Great Recursion Component?",a:"I will generate you a Great Component for the Great Recursion. I need a Component.",event:"nextReply"},{q:"Where can I find it?",a:"I updated the location mark in the car.",event:"close"}]},location03:{isComplete:!1,phraseIndex:0,phrases:[{q:"..Component.. ?",a:"Yes. I have finished generating the Component for the Great Component of the Great Recursion.",event:"nextReply"},{q:"I need to deliver it to generate the Great Component.",a:"The location mark in your car has been updated. It will point to the Component of the Great Component.",event:"nextReply"},{q:"Is my car the key to Components?",a:"Your Car is the main Iterator. Follow it.",event:"close"}]}},isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1},ma=a.p+"static/media/broken_down_concrete2_Normal-dx.4c6af83f.jpg",ba=a.p+"static/media/broken_down_concrete2_ao.dc08dd3d.jpg",ya=a.p+"static/media/broken_down_concrete2_albedo.7ac3a0c4.jpg",Aa=a.p+"static/media/body.6c7c86fe.obj",va=a.p+"static/media/endWay.020a585a.obj",Oa=(a.p,a.p+"static/media/ambient_loop.850fdeef.mp3"),ga=a.p+"static/media/steps.47eecadc.mp3",ja=a.p+"static/media/symbol.6aad208c.mp3",wa=[{key:"emitter",constr:F,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(I.a)(this,e);var a=t.emitter,o=t.appWrapper;!o&&(o=document.querySelector(".app-wrapper")),a.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&n()}));var n=function(){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()},r=function(e){o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||a.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:N,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:G,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(I.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return W.c()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:H,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:Y,initStateKey:"beforeStartPlay"},{key:"player",constr:J,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:ce,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(I.a)(this,e);var a=t.assets,o=t.CONSTANTS;t.materials=Z(a,o.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"system_PlayerMoveOnLevel",constr:pe,initStateKey:"beforeStartPlay"},{key:"system_Sound",constr:function(){function e(t){var a=this;Object(I.a)(this,e);var o=new u.AudioListener;t.player.getCamera().add(o),this._sound=new u.Audio(o),this._sound.setBuffer(t.assets.soundAmbient),this._sound.setLoop(!0),this._sound.setVolume(.35),this._soundSteps=new u.Audio(o),this._soundSteps.setBuffer(t.assets.soundStep),this._soundSteps.setLoop(!0),this._soundSteps.setVolume(.5),this._statue=new u.PositionalAudio(o),this._statue.setBuffer(t.assets.soundStatue),this._statue.setRefDistance(200),this._statue.setVolume(1),this._isMuted=!1,t.emitter.subscribe("toggleSound")((function(e){a._isMuted=e,e?a._sound.isPlaying&&a._sound.stop():a._sound.play()})),this._timer=null}return Object(E.a)(e,[{key:"playAmbient",value:function(){this._sound.play()}},{key:"startSteps",value:function(){this._isMuted||this._soundSteps.play()}},{key:"stopSteps",value:function(){this._isMuted||this._soundSteps.stop()}},{key:"setMeshStatue",value:function(e){e.add(this._statue)}},{key:"playStatue",value:function(){this._isMuted||this._statue.play()}}]),e}(),initStateKey:"beforeStartPlay",assetsToLoad:[{type:"soundMp3",path:Oa,key:"soundAmbient"},{type:"soundMp3",path:ga,key:"soundStep"},{type:"soundMp3",path:ja,key:"soundStatue"}]},{key:"customUi",constr:function e(t){Object(I.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=la,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fa,a=arguments.length>1?arguments[1]:void 0;if("TOGGLE_BUTTON_DIALOG"===a.type){var o=a.keyPerson.split("_")[1],n=[];if(t.phrasesData[o])for(var r=t.phrasesData[o],s=r.phraseIndex,i=r.phrases,p=0;p<s;++p)n.push(i[p]);return Object(B.a)(Object(B.a)({},t),{},{isButtonDialog:a.is,currentLocation:o,userReplicies:[],botAnswers:n})}if("TOGGLE_DIALOG"===a.type){var c=[];if(e.player.toggleBlocked(a.isShowPalleteDialog),a.isShowPalleteDialog){var u=t.phrasesData[t.currentLocation],l=u.isComplete,h=u.phraseIndex,d=u.phrases;c=l?[]:[d[h]]}return setTimeout((function(){return e.dispatcher.dispatch({type:"TOGGLE_CONTROLS",is:!a.isShowPalleteDialog})})),Object(B.a)(Object(B.a)({},t),{},{isShowPalleteDialog:a.isShowPalleteDialog,userReplicies:c})}if("CLICK_PHRASE"===a.type)return Object(B.a)(Object(B.a)({},t),{},{botAnswers:[].concat(Object(ue.a)(t.botAnswers),[a.phrase]),userReplicies:[]});if("PHRASE_EVENT"===a.type){var f=a.phrase.event;if("nextReply"===f){var m=t.phrasesData[t.currentLocation],b=m.phraseIndex+1,y=[m.phrases[b]];return Object(B.a)(Object(B.a)({},t),{},{phrasesData:Object(B.a)(Object(B.a)({},t.phrasesData),{},Object(ha.a)({},t.currentLocation,Object(B.a)(Object(B.a)({},t.phrasesData[t.currentLocation]),{},{phraseIndex:b}))),userReplicies:y})}if("close"===f){var A=t.phrasesData[t.currentLocation].phraseIndex+1;return setTimeout((function(){e.dispatcher.dispatch({type:"SELECT_LOCATION",location:da[t.currentLocation]})}),50),Object(B.a)(Object(B.a)({},t),{},{userReplicies:[],phrasesData:Object(B.a)(Object(B.a)({},t.phrasesData),{},Object(ha.a)({},t.currentLocation,Object(B.a)(Object(B.a)({},t.phrasesData[t.currentLocation]),{},{isComplete:!0,phraseIndex:A}))),isButtonDialog:!0})}}return"TOGGLE_BUTTON_DRAW_CAR"===a.type?Object(B.a)(Object(B.a)({},t),{},{isShowButtonDrawCar:a.is}):"CLICK_DRAW"===a.type?"drive"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(B.a)(Object(B.a)({},t),{},{valButtonDrawCar:"exit"})):(e.actions.clickMachineExit(),Object(B.a)(Object(B.a)({},t),{},{valButtonDrawCar:"drive"})):"OPEN_LOCATIONS_LIST"===a.type?Object(B.a)(Object(B.a)({},t),{},{isLocationListOpened:!0}):"SELECT_LOCATION"===a.type?(e.actions.changeTargetLocation({key:a.location}),Object(B.a)(Object(B.a)({},t),{},{isLocationListOpened:!1,currentLocationOfList:a.location})):"SHOW_FINAL_MESSAGE"===a.type?Object(B.a)(Object(B.a)({},t),{},{isShowFinalMessage:!0}):t}}}(t);var a=new na(t);t.ui=a},initStateKey:"pageLoaded"},{key:"actions",constr:function e(t){var a=this;Object(I.a)(this,e),this._root=t;var o=this._root,n=o.dispatcher,r=o.frameUpdater,s=o.studio,i=o.system_PlayerMoveOnLevel,p=o.player,c=o.ui,l=o.system_Sound;n.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:5}),n.dispatch({type:"ENABLE_CONTROL_SOUND"}),this._worldReal=jt(t),this._worldReal.addWorld(),t.worldReal=this._worldReal;var h=function(e){var t=e.assets.bodyModel.children[0],a=new u.Mesh(t.geometry,e.materials.body),o=new u.Mesh(new u.PlaneGeometry(20,20),e.materials.bodyShadow);o.rotation.x=-Math.PI/2,o.position.y=.1,o.position.z=-.8,a.add(o);var n=new u.Mesh(new u.BoxGeometry(10,140,10),e.materials.bodyShadow);a.add(n),n.visible=!1,e.system_Sound&&e.system_Sound.setMeshStatue&&e.system_Sound.setMeshStatue(a);var r=[wt(a.geometry.attributes.position.array.length/9,200*Math.random(),0),wt(a.geometry.attributes.position.array.length/9,50*Math.random(),Math.random()+1),wt(a.geometry.attributes.position.array.length/9,20*Math.random(),Math.random()+2),Object(ue.a)(t.geometry.attributes.position.array)],s=[Object(ue.a)(t.geometry.attributes.position.array),wt(a.geometry.attributes.position.array.length/9,15*Math.random(),Math.random()+2),wt(a.geometry.attributes.position.array.length/9,2*Math.random(),Math.random()+1),wt(a.geometry.attributes.position.array.length/9,Math.random(),0)],i=function(e,t,n,s){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},p=300,c=null;return function n(s){if(t[s]){var u={v:0};c=new W.b(u).to({v:1},p).onUpdate((function(){for(var n=0;n<a.geometry.attributes.position.array.length;++n)a.geometry.attributes.position.array[n]=u.v*t[s][n]+(1-u.v)*t[s-1][n];"show"===e&&s===r.length-1&&(o.material.opacity=u.v),"hide"===e&&1===s&&(o.material.opacity=1-u.v),a.geometry.attributes.position.needsUpdate=!0})).onComplete((function(){n(s+1)})).start()}else i()}(1),setTimeout((function(){(n||s)&&(o.material.opacity=0,a.position.x=n,a.position.z=s,a.rotation.y=Math.random()*Math.PI*2)}),50),function(){c.stop()}},p=function(){},c=!1;return{m:a,mCollision:n,update:function(){},appear:function(t,a){e.system_Sound.playStatue(),p(),p=i("show",r,t,a,(function(){}))},hide:function(){e.system_Sound.playStatue(),p(),p=i("hide",s,null,null,(function(){}))},invert:function(){a.material=c?e.materials.body:e.materials.bodyRed,a.material.needsUpdate=!0,c=!c},toRed:function(){a.material=e.materials.bodyRed,a.material.needsUpdate=!0},toBlack:function(){a.material=e.materials.body,a.material.needsUpdate=!0},toWhite:function(){a.material=e.materials.bodyWhite,a.material.needsUpdate=!0}}}(t);h.m.position.x=1e3,h.m.position.z=3e3,h.m.position.y=-61,h.m.rotation.y=Math.PI,s.addToScene(h.m),t.statue=h;var d=function(e){for(var t=.05,a=.025,o=new u.PointsMaterial({fog:!1,size:35,color:0,alphaTest:0,map:e.assets.flareSrc,depthTest:!0,transparent:!0,alphaMap:e.assets.flareSrc,vertexColors:!0,side:u.DoubleSide}),n=[0,-25,-0],r=[],s=function(){return{spdX:Math.random()*t-a,spdY:Math.random()*t-a,spdZ:Math.random()*t-a,spdAlpha:.005*Math.random()+.0025,isMustStartHide:!1,countIterations:Math.floor(3*Math.random()+1)}},i=[],p=[],c=0;c<1e3;c++){var l=3e3*Math.random(),h=25*Math.random()+n[1],d=3e3*Math.random()+200+n[2];i.push(l,h,d),p.push(0,0,0,1),r.push(Object(B.a)({index:c},s()))}var f=new u.BufferGeometry;return f.setAttribute("position",new u.Float32BufferAttribute(i,3)),f.setAttribute("color",new u.Float32BufferAttribute(p,4)),{m:new u.Points(f,o),stop:function(){},start:function(){},setCenterPos:function(e,t,a){},update:function(){for(var e=0;e<r.length;++e){var t=r[e];f.attributes.position.array[3*e]+=t.spdX,f.attributes.position.array[3*e+1]+=t.spdY,f.attributes.position.array[3*e+2]+=t.spdZ,t.isMustStartHide||(f.attributes.color.array[4*e+3]+=t.spdAlpha,f.attributes.color.array[4*e+3]>1&&(t.isMustStartHide=!0)),t.isMustStartHide&&(f.attributes.color.array[4*e+3]-=t.spdAlpha,f.attributes.color.array[4*e+3]<=0&&(t.isMustStartHide=!1,t.countIterations--,0===t.countIterations&&(Object.assign(t,s()),f.attributes.position.array[3*e]=3e3*Math.random(),f.attributes.position.array[3*e+1]=25*Math.random()-12.5+n[1],f.attributes.position.array[3*e+2]=3e3*Math.random()+200))),f.attributes.position.needsUpdate=!0,f.attributes.color.needsUpdate=!0}}}}(t);d.m.visible=!1,s.addToScene(d.m),t.points=d;var f=function(e,t){for(var a={},o=0;o<t.length;++o)a[t[o].id]=t[o];var n=[],r=null,s=null;return e.emitter.subscribe("playerMove")((function(t){if("forward"===t){var o=e.player.mesh.position,i=o.x,p=o.z;for(var c in a)if(a[c].walls.e.p0[1]<p&&a[c].walls.e.p1[1]>p&&a[c].walls.n.p0[0]<i&&a[c].walls.n.p1[0]>i){if(r!==(s=c)){r=s;for(var u=0;u<n.length;++u)n[u](a[c])}break}}})),{onChangeRoom:function(e){return n.push(e),function(){n=n.filter((function(t){return t!==e}))}}}}(t,this._worldReal.roomsArr),m=null;!function e(a){Bt[a]?(console.log("stateIndex: ",a,Bt[a].name),(m=Bt[a](t)).onComplete((function(){e(a+1)}))):console.log("pipeline-complete")}(0),f.onChangeRoom((function(e){m.update(e)}));var b=!1,y=null;t.emitter.subscribe("playerMove")((function(){b||(b=!0,l.startSteps()),clearTimeout(y),y=setTimeout((function(){b=!1,l.stopSteps()}),100),d.setCenterPos(p.mesh.position.x,p.mesh.position.y,p.mesh.position.z)})),r.on((function(e){W.c(),i.update(e),d.update(),s.drawFrame()})),s.changeEnvironment(g,{time:1}),c.showStartButton((function(){(function(e){return It.apply(this,arguments)})(t).then(),a._root.system_Sound&&a._root.system_Sound.playAmbient()}))},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"cubeTextures",path:[ee,te,ae,oe,ne,re],key:"skyBox3"},{type:"img",path:X,key:"mapTop",wrap:!0},{type:"img",path:ma,key:"ironNormal",wrap:!0},{type:"img",path:ya,key:"ironAlbedo",wrap:!0},{type:"img",path:ba,key:"ironAO",wrap:!0},{type:"obj",path:Aa,key:"bodyModel"},{type:"img",path:$,key:"bodyDropShadow"},{type:"obj",path:va,key:"endWayModel"},{type:"img",path:$,key:"flareSrc"}]}];window.addEventListener("load",(function(){return function(e,t){return i.apply(this,arguments)}(wa,o)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.93cd7755.chunk.js.map