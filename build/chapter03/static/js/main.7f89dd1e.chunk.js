(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{38:function(e,t,o){},40:function(e,t,o){},41:function(e,t,o){},43:function(e,t,o){"use strict";o.r(t);var n={};o.r(n),o.d(n,"MATERIALS_CONFIG",(function(){return h})),o.d(n,"S",(function(){return d})),o.d(n,"H",(function(){return m})),o.d(n,"FRAME_UPDATE",(function(){return f})),o.d(n,"FLOORS_CONF",(function(){return p})),o.d(n,"studioConfig",(function(){return v})),o.d(n,"playerConfig",(function(){return b}));var a=o(4),r=o(10),i=o.n(r),s=o(12);function l(){return(l=Object(s.a)(i.a.mark((function e(t,o){var n,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,n={CONSTANTS:o}),a=n.loaderAssets,r=u(t),e.next=6,a.loadAssets(r);case 6:n.assets=e.sent,c("beforeStartPlay",t,n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,o){for(var n=0;n<t.length;++n){var a=t[n],r=a.key,i=a.constr;a.initStateKey===e&&(o[r]=new i(o))}},u=function(e){for(var t=[],o=0;o<e.length;++o)if(e[o].assetsToLoad&&e[o].assetsToLoad.length)for(var n=0;n<e[o].assetsToLoad.length;++n)t.push(e[o].assetsToLoad[n]);return t},h={iron:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:13192,specular:16777215,shininess:60,bumpMap:"botMap",bumpScale:.1,envMap:"ironEnv",reflectivity:.5,map:"botMap",skinning:!0}},wall:{mat:"MeshPhongMaterial",props:{color:17510,emissive:16777215,map:"mapFloorOuter",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.5,specular:2236962}},green:{mat:"MeshPhongMaterial",props:{color:17510,emissive:16777215,map:"mapFloorOuter",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.5}},road:{mat:"MeshPhongMaterial",props:{color:10556063,emissive:10556063,map:"mapFloorOuter",bumpMap:"mapFloorOuter",bumpScale:1,envMap:"skyBox",reflectivity:.5}}},d=175.335,m=70,f="FRAME_UPDATE",p={"-2":{outer:{fogNear:-200,fogFar:500,color:1582461},corridorLight:{fogNear:-40,fogFar:150,color:7012460},default:{fogNear:-40,fogFar:150,color:8914344}},"-1":{start:{fogNear:0,fogFar:5,color:1582461},outer:{fogNear:20,fogFar:500,color:1582461},back:{fogNear:20,fogFar:500,color:1582461,backgroundImgKey:"skyBox"},firstRoomLight:{fogNear:-40,fogFar:150,color:9054},corridorLight:{fogNear:-40,fogFar:150,color:7012460},default:{fogNear:-40,fogFar:150,color:3019147}},0:{default:{fogNear:-40,fogFar:150,color:3950848}},1:{default:{fogNear:-40,fogFar:150,color:933458}},2:{default:{fogNear:0,fogFar:80,color:661347}},3:{default:{fogNear:0,fogFar:80,color:680768}},4:{default:{fogNear:0,fogFar:80,color:11272192}}},v={canId:"webgl-canvas",rendererCon:{antialias:!0},clearColor:p[-1].outer.color,backgroundColor:p[-1].outer.color,amb:{color:p[-1].outer.color,strength:.7},sceneEnvironment:{color:p[-1].start.color,fogNear:p[-1].start.fogNear,fogFar:p[-1].start.fogFar,backgroundImgKey:null},composerAddPass:"Saturate"},b={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[100,-78,1e3],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e3,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1],lightDataOne:{color:16777215,strength:5e3,pos:[0,50,5]}},g={ru:{"Hello there!":"\u041f\u0440\u0438\u0432\u0435\u0442 !","Good day, carbon-based life form.":"\u0414\u0435\u043d\u044c \u0434\u043e\u0431\u0440\u044b\u0439, \u043a\u0440\u0435\u043c\u043d\u0438\u0435\u0432\u0430\u044f \u0444\u043e\u0440\u043c\u0430 \u0436\u0438\u0437\u043d\u0438.","What is this place ?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","This is an entrance to the entropic hyper-maze.":"\u042d\u0442\u043e \u0432\u0445\u043e\u0434 \u0432 \u044d\u043d\u0442\u0440\u043e\u043f\u0438\u0439\u043d\u044b\u0439 \u0433\u0438\u043f\u0435\u0440-\u043a\u0443\u0431.","And what happens if I enter it ?":"\u0427\u0442\u043e \u0431\u0443\u0434\u0435\u0442, \u0435\u0441\u043b\u0438 \u044f \u0432\u043e\u0439\u0434\u0443 \u0432 \u043d\u0435\u0433\u043e?","This place is waiting.":"\u041a\u0443\u0431 \u043f\u0440\u0438\u043c\u0435\u0442 \u0442\u0435\u0431\u044f.","Say, where do these corridors lead ?":"\u041a\u0443\u0434\u0430 \u0432\u0435\u0434\u0443\u0442 \u044d\u0442\u0438 \u043a\u043e\u0440\u0438\u0434\u043e\u0440\u044b ?","They will lead you to the end.":"\u041e\u043d\u0438 \u043f\u0440\u0438\u0432\u0435\u0434\u0443\u0442 \u0442\u0435\u0431\u044f \u043a \u0444\u0438\u043d\u0430\u043b\u0443.","Ooook, I'm heading in then.":"\u042f \u043f\u043e\u0448\u0435\u043b \u0434\u0430\u043b\u044c\u0448\u0435.","We will meet again.":"\u041c\u044b \u0435\u0449\u0435 \u0443\u0432\u0438\u0434\u0438\u043c\u0441\u044f.","What do you do here ?":"\u0427\u0442\u043e \u0442\u044b \u0437\u0434\u0435\u0441\u044c \u0434\u0435\u043b\u0430\u0435\u0448\u044c ?","Collecting the energy of the night.":"\u0421\u043e\u0431\u0438\u0440\u0430\u044e \u044d\u043d\u0435\u0440\u0433\u0438\u044e \u043d\u043e\u0447\u0438.","Can you tell me which way is out of here ?":"\u0412 \u043a\u0430\u043a\u0443\u044e \u0441\u0442\u043e\u0440\u043e\u043d\u0443 \u043c\u043d\u0435 \u0438\u0434\u0442\u0438 ?","It is about the journey, not the destination":"\u0417\u0434\u0435\u0441\u044c \u043d\u0435\u0442 \u0441\u0442\u043e\u0440\u043e\u043d. \u0417\u0434\u0435\u0441\u044c \u0432\u0430\u0436\u043d\u0430 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u0438\u043d\u0430 \u043f\u0443\u0442\u0438.","Hey, it looks like I'm walking in circles.":"\u042f \u0443\u0436\u0435 \u0434\u043e\u043b\u0433\u043e \u0438\u0434\u0443.","You have walked long enough.":"\u0422\u044b \u043f\u0440\u043e\u0448\u0435\u043b \u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u0443\u0440\u043e\u0432\u043d\u044f.","Meaning?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442?","The way to the next level is open to you.":"\u0422\u0435\u0431\u0435 \u043e\u0442\u043a\u0440\u044b\u0442 \u043f\u0443\u0442\u044c \u043d\u0430 \u043e\u0434\u043d\u0443 \u0441\u0442\u0443\u043f\u0435\u043d\u044c \u0432\u044b\u0448\u0435.",'Hi, I heard I can find the "end" around here?':"\u042f \u0438\u0449\u0443 \u0444\u0438\u043d\u0430\u043b.","Yes, I told you this is where the corridors lead.":"\u042f \u043f\u043e\u043c\u043d\u044e \u043e \u0442\u0432\u043e\u0435\u043c \u043f\u0443\u0442\u0438.","Man, you all look the same.":"\u0412\u044b \u0432\u0441\u0435 \u0442\u0430\u043a \u043f\u043e\u0445\u043e\u0436\u0438.","Soooo, is that you again ?":"\u042d\u0442\u043e \u0441\u043d\u043e\u0432\u0430 \u0442\u044b?","Yes. All of me are myself.":"\u0414\u0430, \u043c\u044b \u0432\u0441\u0435 \u0435\u0434\u0438\u043d\u044b.","Yeah, just like those corridors.":"\u0422\u0443\u0442 \u0432\u0441\u0435 \u043a\u043e\u0440\u0438\u0434\u043e\u0440\u044b \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0442\u0441\u044f.","The meaning of everything is in being whole.":"\u0421\u0443\u0442\u044c \u0432\u0441\u0435\u0433\u043e \u0432 \u0435\u0434\u0438\u043d\u043e\u043c.","Am I there yet?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0435\u0449\u0435 \u0438\u0434\u0442\u0438.","The sign will be given when you are.":"\u0422\u0435\u0431\u0435 \u0431\u0443\u0434\u0435\u0442 \u0437\u043d\u0430\u043a, \u043a\u043e\u0433\u0434\u0430 \u0442\u044b \u0431\u0443\u0434\u0435\u0448\u044c \u0433\u043e\u0442\u043e\u0432.","How do I know what it is?":"\u041a\u0430\u043a \u044f \u0443\u0437\u043d\u0430\u044e \u044d\u0442\u043e\u0442 \u0437\u043d\u0430\u043a.","I will give it to you.":"\u042f \u043f\u043e\u0434\u0430\u043c \u0435\u0433\u043e.","That's the same exact corridor with you again.":"\u042d\u0442\u043e \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0439 \u0441\u0435\u0433\u043c\u0435\u043d\u0442 \u043a\u043e\u0440\u0438\u0434\u043e\u0440\u0430 \u0441 \u0442\u043e\u0431\u043e\u0439.","You are ready for the next level.":"\u0422\u044b \u0433\u043e\u0442\u043e\u0432 \u043a \u043d\u043e\u0432\u043e\u043c\u0443 \u0443\u0440\u043e\u0432\u043d\u044e.","Hey man, seriously, how do I get out of here ?":"\u041f\u0440\u0438\u0432\u0435\u0442 \u0441\u043d\u043e\u0432\u0430. \u041a\u0430\u043a \u0432\u044b\u0431\u0440\u0430\u0442\u044c\u0441\u044f. \u0423\u0436\u0435 \u043d\u0430\u0434\u043e\u0435\u043b\u043e.","You have not reached the end.":"\u0422\u044b \u043d\u0435 \u043f\u043e\u0441\u0442\u0438\u0433 \u0434\u0437\u0435\u043d.","We'll how do you reach it ?":"\u0422\u044b-\u0442\u043e \u043a\u0430\u043a \u0432\u044b\u0445\u043e\u0434\u0438\u0448\u044c \u043d\u0430 \u043f\u043e\u0432\u0435\u0440\u0445\u043d\u043e\u0441\u0442\u044c?","I have my way.":"\u0423 \u043c\u0435\u043d\u044f \u0441\u0432\u043e\u0439 \u043f\u0443\u0442\u044c.","So how's your way btw ?":"\u0422\u044b \u0432\u0441\u0435 \u043d\u0430 \u0441\u0432\u043e\u0435\u043c \u043f\u0443\u0442\u0438?","It is like yourself.":"\u041a\u0430\u043a \u0438 \u0442\u044b.","And how long you've been on it ?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0442\u044b \u043d\u0430 \u043d\u0435\u043c?","These walls can hear us.":"\u042d\u0442\u0438 \u0441\u0442\u0435\u043d\u044b \u043d\u0430\u0441 \u0441\u043b\u044b\u0448\u0430\u0442.","I think you're weighing this corridor down.":"\u041c\u043d\u0435 \u043a\u0430\u0436\u0435\u0442\u0441\u044f, \u0442\u044b \u0438\u0434\u0435\u0448\u044c \u0432 \u043d\u0430\u0433\u0440\u0443\u0437\u043a\u0443 \u043a \u044d\u0442\u043e\u043c\u0443 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0443 \u043a\u043e\u0440\u0438\u0434\u043e\u0440\u0430.","The next level is open to you.":"\u0422\u0435\u0431\u0435 \u043e\u0442\u043a\u0440\u044b\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c.","Look bud, next level or not, nothing's changed at all !":"\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f.","Except the number of steps.":"\u041c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0440\u043e\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u0448\u0430\u0433\u043e\u0432.","So this place counts steps ?":"\u042d\u0442\u043e \u043c\u0435\u0441\u0442\u043e \u0441\u0447\u0438\u0442\u0430\u0435\u0442 \u0448\u0430\u0433\u0438?","This is place is waiting.":"\u042d\u0442\u043e \u043c\u0435\u0441\u0442\u043e \u0436\u0434\u0435\u0442.","How long have you been here ?":"\u041a\u0430\u043a \u0434\u0430\u0432\u043d\u043e \u0442\u044b \u0437\u0434\u0435\u0441\u044c?","How long is irrelevant. What matters is the journey.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u043c\u0435\u0435\u0442 \u043b\u0438\u0448\u044c \u043f\u0443\u0442\u044c.","Then why aren't you on one?":"\u041d\u043e \u0442\u044b \u0436\u0435 \u043d\u0435 \u0438\u0434\u0435\u0448\u044c.","With you walking for both of us, I do not have to.":"\u0417\u0430\u0442\u043e \u0442\u044b \u043a\u0430\u0436\u0434\u044b\u0439 \u0440\u0430\u0437 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0448\u044c \u043c\u0438\u043c\u043e.","Look, just make a new level, please.":"\u0421\u0434\u0435\u043b\u0430\u0439 \u043d\u043e\u0432\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c.","You are ready. It is waiting for you.":"\u0422\u044b \u0433\u043e\u0442\u043e\u0432 - \u043d\u043e\u0432\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0436\u0434\u0435\u0442 \u0442\u0435\u0431\u044f.","Wait, you are this place! You control all its fragments.":"\u0422\u044b \u0438 \u0435\u0441\u0442\u044c \u044d\u0442\u043e \u043c\u0435\u0441\u0442\u043e. \u0422\u044b \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0448\u044c \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430\u043c\u0438.","You have almost reached the end.":"\u0422\u044b \u043f\u043e\u0447\u0442\u0438 \u0434\u043e\u0448\u0435\u043b \u0434\u043e \u043a\u0440\u0430\u044f.","Why do you do this ?":"\u0417\u0430\u0447\u0435\u043c \u0442\u0435\u0431\u0435 \u044d\u0442\u043e?","It is my way to warp space. More movement. More fragments.":"\u042d\u0442\u043e \u0441\u043f\u043e\u0441\u043e\u0431 \u0441\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u0441\u0442\u0432\u043e. \u0411\u043e\u043b\u044c\u0448\u0435 \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f. \u0411\u043e\u043b\u044c\u0448\u0435 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432.","How many people have been through here ?":"\u041a\u0430\u043a \u043c\u043d\u043e\u0433\u043e \u043f\u0443\u0442\u043d\u0438\u043a\u043e\u0432 \u043f\u043e\u043f\u0430\u0434\u0430\u043b\u043e \u0441\u044e\u0434\u0430?","Many are still here.":"\u041c\u043d\u043e\u0433\u0438\u0435 \u0438\u0437 \u043d\u0438\u0445 \u0434\u043e \u0441\u0438\u0445 \u043f\u043e\u0440 \u0442\u0443\u0442.","So where are they?":"\u041f\u043e\u0447\u0435\u043c\u0443 \u044f \u0438\u0445 \u043d\u0435 \u0432\u0441\u0442\u0440\u0435\u0442\u0438\u043b?","Everyone has a different system of fragments.":"\u0423 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u0441\u0432\u043e\u044f \u0441\u0438\u0441\u0442\u0435\u043c\u0430 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u043e\u0432.","Will you let me out ?":"\u0422\u044b \u0432\u044b\u043f\u0443\u0441\u0442\u0438\u0448\u044c \u043c\u0435\u043d\u044f?","All ways lead to the end.":"\u0412\u0441\u0435 \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u0441\u0432\u0435\u0442\u0430 \u043e\u0442\u043a\u0440\u044b\u0442\u044b \u0442\u0435\u0431\u0435.","I wanna meet the others.":"\u042f \u0445\u043e\u0447\u0443 \u0432\u0441\u0442\u0440\u0435\u0442\u0438\u0442\u044c \u0434\u0440\u0443\u0433\u0438\u0445.","The next level is waiting for you.":"\u0422\u0435\u0431\u0435 \u043e\u0442\u043a\u0440\u044b\u0442 \u043d\u043e\u0432\u044b\u0439 \u0443\u0440\u043e\u0432\u0435\u043d\u044c.","Everything's looped here.":"\u042f \u0432\u0438\u0436\u0443 \u0437\u0430\u0440\u0435\u0432\u043e?","Everything is looped with small differences.":"\u042d\u0442\u043e \u0437\u0430\u0440\u0435\u0432\u043e \u043f\u0440\u043e\u0441\u0432\u0435\u0442\u043b\u0435\u043d\u0438\u044f. \u0422\u044b \u0431\u043b\u0438\u0437\u043e\u043a","How many levels even are there ?":"\u0412\u0441\u0435 \u043a\u043e\u0440\u0438\u0434\u043e\u0440\u044b \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0442\u0441\u044f.","It all depends on you.":"\u0412\u0441\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0435\u0442\u0441\u044f \u0441 \u043d\u0435\u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0440\u0430\u0437\u043d\u0438\u0446\u0435\u0439.","That's it, I'm done.":"\u0412\u0441\u0435 \u043c\u043e\u0439 \u043f\u0443\u0442\u044c \u043e\u043a\u043e\u043d\u0447\u0435\u043d.","Have you reached your journey's end ?":"\u0422\u044b \u043e\u0442\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0448\u044c\u0441\u044f \u0438\u0434\u0442\u0438?","Yes, you mad bastard! I have !":"\u0414\u0430, \u0442\u044b \u0431\u0435\u0437\u0443\u043c\u0435\u043d.","Then I am giving you the sign.":"\u042f \u043e\u0441\u0432\u043e\u0431\u043e\u0436\u0434\u0430\u044e \u0442\u0435\u0431\u044f.","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","Level completed":"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d",open:"\u043f\u0443\u0441\u043a"}},y=o(1),_=o(2),w=o(0),j=o(21),O=o(22),S=function(){var e=null,t=null,o=null,n=null;return function(a,r){return new Promise((function(i){return function(a){return"obj"===a?e=e||new j.a:"glb"===a||"gltf"===a?o=o||new O.a:"img"===a?t=t||new w.TextureLoader:"cubeTextures"===a?n=n||new w.CubeTextureLoader:void 0}(r).load(a,i)}))}},N=function(){function e(){Object(y.a)(this,e),this.resources={},this._load=S()}return Object(_.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(o){var n=t._load,a=t.resources;function r(e){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(i.a.mark((function t(s){var l,c,u,h;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[s]){t.next=5;break}return l=e[s],c=l.key,u=l.path,h=l.type,t.next=4,n(u,h);case 4:a[c]=t.sent;case 5:if(++s,e[s]){t.next=10;break}o(a),t.next=12;break;case 10:return t.next=12,r(s);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r(0)}))}}]),e}(),C=function(){function e(){Object(y.a)(this,e),this._storage={}}return Object(_.a)(e,[{key:"emit",value:function(e){var t=this;return function(o){return k(t._storage)(e).forEach((function(e){return e(o)}))}}},{key:"subscribe",value:function(e){var t=this;return function(o){return k(t._storage)(e).push(o),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==o}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),k=function(e){return function(t){return e[t]=e[t]||[]}},A=o(5),x=o(17),E=o.n(x),R=o(7),I=o(11),T=(o(38),"en"),M=function(e){return function(t){return e[T]&&e[T][t]||t}},D=o(3),F=M({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),L=Object(R.b)((function(e){return Object(a.a)({},e.controls.infoPanelData)}))((function(e){return Object(D.jsxs)("div",{className:"info",children:[Object(D.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(D.jsxs)("div",{className:"info-inner",children:[Object(D.jsx)("p",{children:F(e.title)}),Object(D.jsx)("p",{children:F(e.topText)}),Object(D.jsx)("ul",{children:e.chapters.map((function(t,o){return Object(D.jsxs)("li",{children:[o+1,".\xa0",t.href?Object(D.jsx)("span",{children:Object(D.jsx)("a",{href:t.href,target:"blank",children:F(t.text)})}):Object(D.jsx)("span",{children:F(t.text)}),o===e.currentChapterIndex&&F(" (current)")]},o)}))}),Object(D.jsx)("p",{children:e.bottomText}),Object(D.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(D.jsxs)("li",{children:[F(e.text),Object(D.jsx)("a",{href:e.href,target:"blank",children:F(e.aText)})]},t)}))})]})]})})),P=(o(40),Object(R.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls}}))((function(e){var t=Object(A.useState)(!0),o=Object(I.a)(t,2),n=o[0],a=o[1];return Object(A.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&a(!0)}))})),Object(D.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&Object(D.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(D.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&n&&Object(D.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),a(!1)},children:"\u2752"}),!e.isInfo&&Object(D.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(D.jsx)(L,{})]})})));var Q={dispatch:null},Y=Object(R.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!Q.dispatch&&(Q.dispatch=e.dispatch),Object(D.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(D.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(D.jsx)(P,{gameContext:e.gameContext})]})})),U=o(14),B=o(24),G={isShowControls:!0,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"http://js.otrisovano.ru/factory/"},{text:"Brige",href:"http://js.otrisovano.ru/bridge/"},{text:"Cube",href:"http://js.otrisovano.ru/levels/"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var q=document.querySelector(".progress"),H=-100,W=!0;!function e(){W&&setTimeout((function(){0===++H&&(H-=100),q.style.marginLeft=H+"%",e()}),30)}();var K=function(){function e(t){Object(y.a)(this,e),t.dispatcher=Q,this._root=t;var o=function(e){e.customStore||(e.customStore={});var t=Object(U.b)(Object(a.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:G,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(a.a)(Object(a.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(a.a)(Object(a.a)({},e),{},{infoPanelData:Object(a.a)(Object(a.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):Object(a.a)({},e)}},e.customStore)),o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||U.c;return Object(U.d)(t,o(Object(U.a)(B.a)))}(t);o&&E.a.render(Object(D.jsx)(R.a,{store:o,children:Object(D.jsx)(Y,{gameContext:t})}),document.getElementById("root"))}return Object(_.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),o=document.querySelector(".progress-wrapper"),n=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,T=t),document.querySelector(".start-screen").style.display="none"};W=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),n(t)})),o.style.display="none"}}]),e}(),V=(o(41),M(g)),z=Object(R.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(D.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(D.jsx)("button",{onClick:function(){var o;(o=e.dispatch,{clickPhrase:function(e){o({type:"CLICK_PHRASE",phrase:e}),setTimeout((function(){o({type:"PHRASE_EVENT",phrase:e})}),1e3)}}).clickPhrase(t)},children:V(t.q)},Math.floor(1e5*Math.random()))}))})})),Z=M(g),J=Object(R.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(D.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(D.jsxs)("div",{children:[Object(D.jsx)("div",{className:"q",children:Z(e.q)}),Object(D.jsx)("div",{className:"a",children:Z(e.a)})]},Math.floor(1e5*Math.random()))}))})})),X=M(g);var $=Object(R.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog}}))((function(e){return Object(D.jsxs)(D.Fragment,{children:[(e.isButtonDialog||e.isShowPalleteDialog)&&Object(D.jsx)("div",{className:"dialog-wrapper",children:Object(D.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(D.jsxs)("div",{className:"messages-wrapper",children:[Object(D.jsx)(J,{}),Object(D.jsx)(z,{})]}),e.isButtonDialog&&Object(D.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?X("close dialog"):X("open dialog")})]})}),e.isShowFinalMessage&&Object(D.jsx)("div",{className:"info",children:Object(D.jsx)("div",{className:"info-inner final-message",children:Object(D.jsx)("p",{children:X("Level completed")})})})]})})),ee=o(8),te={sceneEnvironment:{color:p[-1].start.color,fogNear:p[-1].start.fogNear,fogFar:p[-1].start.fogFar,backgroundImgKey:null},playerQuadrant:{oldDialogPlayerQuadrant:[0,0,-50],oldQuadrant:[0,0,0],newQuadrant:[0,0,0],counter:null},level:{isStartCorridorShow:!0},isShowFinalMessage:!1,botAnswers:[],userReplicies:[],history:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,botIndex:-1,phraseIndex:0,phrasesData:[{phrases:[{q:"Hello there!",a:"Good day, carbon-based life form.",event:"nextReply",levelEvent:null},{q:"What is this place ?",a:"This is an entrance to the entropic hyper-maze.",event:"nextReply",levelEvent:null},{q:"And what happens if I enter it ?",a:"This place is waiting.",event:"close",levelEvent:null}]},{phrases:[{q:"Say, where do these corridors lead ?",a:"They will lead you to the end.",event:"nextReply",levelEvent:null},{q:"Ooook, I'm heading in then.",a:"We will meet again.",event:"close",levelEvent:null}]},{phrases:[{q:"What do you do here ?",a:"Collecting the energy of the night.",event:"nextReply",levelEvent:null},{q:"Can you tell me which way is out of here ?",a:"It is about the journey, not the destination",event:"close",levelEvent:null}]},{phrases:[{q:"Hey, it looks like I'm walking in circles.",a:"You have walked long enough.",event:"nextReply",levelEvent:null},{q:"Meaning?",a:"The way to the next level is open to you.",event:"close",levelEvent:"addStairs"}]},{phrases:[{q:'Hi, I heard I can find the "end" around here?',a:"Yes, I told you this is where the corridors lead.",event:"nextReply",levelEvent:null},{q:"Man, you all look the same.",a:"We will meet again.",event:"close",levelEvent:null}]},{phrases:[{q:"Soooo, is that you again ?",a:"Yes. All of me are myself.",event:"nextReply",levelEvent:null},{q:"Yeah, just like those corridors.",a:"The meaning of everything is in being whole.",event:"close",levelEvent:null}]},{phrases:[{q:"Am I there yet?",a:"The sign will be given when you are.",event:"nextReply",levelEvent:null},{q:"How do I know what it is?",a:"I will give it to you.",event:"close",levelEvent:null}]},{phrases:[{q:"That's the same exact corridor with you again.",a:"You are ready for the next level.",event:"close",levelEvent:"addStairs"}]},{phrases:[{q:"Hey man, seriously, how do I get out of here ?",a:"You have not reached the end.",event:"nextReply",levelEvent:null},{q:"We'll how do you reach it ?",a:"I have my way.",event:"close",levelEvent:null}]},{phrases:[{q:"So how's your way btw ?",a:"It is like yourself.",event:"nextReply",levelEvent:null},{q:"And how long you've been on it ?",a:"These walls can hear us.",event:"close",levelEvent:null}]},{phrases:[{q:"I think you're weighing this corridor down.",a:"The next level is open to you.",event:"close",levelEvent:"addStairs"}]},{phrases:[{q:"Look bud, next level or not, nothing's changed at all !",a:"Except the number of steps.",event:"nextReply",levelEvent:null},{q:"So this place counts steps ?",a:"This is place is waiting.",event:"close",levelEvent:null}]},{phrases:[{q:"How long have you been here ?",a:"How long is irrelevant. What matters is the journey.",event:"nextReply",levelEvent:null},{q:"Then why aren't you on one?",a:"With you walking for both of us, I do not have to.",event:"close",levelEvent:null}]},{phrases:[{q:"Look, just make a new level, please.",a:"You are ready. It is waiting for you.",event:"close",levelEvent:"addStairs"}]},{phrases:[{q:"Wait, you are this place! You control all its fragments.",a:"You have almost reached the end.",event:"nextReply",levelEvent:null},{q:"Why do you do this ?",a:"It is my way to warp space. More movement. More fragments.",event:"close",levelEvent:null}]},{phrases:[{q:"How many people have been through here ?",a:"Many are still here.",event:"nextReply",levelEvent:null},{q:"So where are they?",a:"Everyone has a different system of fragments.",event:"close",levelEvent:null}]},{phrases:[{q:"Will you let me out ?",a:"All ways lead to the end.",event:"nextReply",levelEvent:null},{q:"I wanna meet the others.",a:"The next level is waiting for you.",event:"close",levelEvent:"addStairs"}]},{phrases:[{q:"Everything's looped here.",a:"Everything is looped with small differences.",event:"nextReply",levelEvent:null},{q:"How many levels even are there ?",a:"It all depends on you.",event:"close",levelEvent:null}]},{phrases:[{q:"That's it, I'm done.",a:"Have you reached your journey's end ?",event:"nextReply",levelEvent:null},{q:"Yes, you mad bastard! I have !",a:"Then I am giving you the sign.",event:"close",levelEvent:"addWell"}]}]},oe=o(45),ne=o(18),ae=o(26),re=o(25),ie=o(16),se={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},le=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var n=t.assets,a=t.emitter,r=t.CONSTANTS.studioConfig,i=r.canId,s=r.rendererCon,l=r.clearColor,c=r.amb;s.canvas=document.getElementById(i),this._renderer=new w.WebGLRenderer(s),this._renderer.setClearColor(l),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new w.Scene;var u=t.CONSTANTS.studioConfig.sceneEnvironment,h=u.color,d=u.fogNear,m=u.fogFar,f=u.backgroundImgKey;this._scene.background=n[f]||null,this._scene.fog=new w.Fog(h,d,m),this._lightA=null;var p=c.color,v=c.strength;this._lightA=new w.AmbientLight(p,v),this._scene.add(this._lightA),this._camera=null,this._composer=new ae.a(this._renderer);var b=function(){var e={width:window.innerWidth,height:window.innerHeight};o._renderer.setSize(e.width,e.height),o._composer.setSize(e.width,e.height),o._camera&&(o._camera.aspect=e.width/e.height,o._camera.updateProjectionMatrix())};window.addEventListener("resize",b),b(),this.addToScene=this._scene.add.bind(this._scene);a.subscribe("frameUpdate")((function(){return o._camera&&o._composer.render(o._scene,o._camera)})),this._backgroundImgKey=t.CONSTANTS.studioConfig.sceneEnvironment.backgroundImgKey,a.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(_.a)(e,[{key:"setCamera",value:function(e){this._camera=e,this._composer.addPass(new re.a(this._scene,this._camera)),this._root.CONSTANTS.studioConfig.composerAddPass&&"Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ie.a(se))}},{key:"changeEnvironment",value:function(e){this._changeFog(e),this._changeBackground(e)}},{key:"_changeFog",value:function(e){var t=this,o=e.fogNear,n=e.fogFar,a=e.color;if(this._scene.fog.near!==o||this._scene.fog.far!==n||this._scene.fog.color!==n){var r={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},i={color:new w.Color(a),near:o,far:n};new ne.a(r).to(i,3e3).onUpdate((function(){t._scene.fog.color=r.color,t._scene.fog.near=r.near,t._scene.fog.far=r.far,t._lightA.color=r.color,t._renderer.setClearColor(r.color)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),ce=function(){function e(t){Object(y.a)(this,e);var o=t.emitter,n={up:!1,down:!1,left:!1,right:!1},a={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=a,this.keys=n;var r=function(e,t){switch(e){case 38:case 87:a.up&&(n.up=t);break;case 40:case 83:a.down&&(n.down=t);break;case 37:case 65:n.left=t;break;case 39:case 68:n.right=t}o.emit("keyEvent")(n)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),o.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),o.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(_.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ue=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var n=t.emitter,a=t.studio,r=t.CONSTANTS.playerConfig,i=r.startPos,s=r.startRot,l=r.cameraData,c=r.frontObjPos,u=r.backObjPos,h=r.lightDataOne,d=r.speed,m=r.offsetFromFloor,f=r.offsetFromFloorFactor,p=r.offsetWallCollision,v=r.speedDown,b=r.speedRot;this._camera=null;var g={},_=!1;this._isBlocked=!0,this._isCanMove={up:!0,down:!0},this._mainObj=new w.Object3D,this._mainObj.position.fromArray(i),this._mainObj.rotation.fromArray(s),this._mainObj.userData.type="player";var j=new w.Object3D;j.position.fromArray([0,-.05,0]),this._mainObj.add(j);var O=new w.Object3D;O.position.fromArray(c),this._mainObj.add(O),this.frontObj=O;var S=new w.Object3D;S.position.fromArray(u),this._mainObj.add(S),this.backObj=S;var N=l.fov,C=l.ratio,k=l.near,A=l.far,x=l.pos;this._camera=new w.PerspectiveCamera(N,C,k,A),this._camera.position.fromArray(x),this._mainObj.add(this._camera);var E=h.color,R=h.strenth,T=h.pos,M=new w.PointLight(E,R);M.position.fromArray(T),this._mainObj.add(M);n.subscribe("keyEvent")((function(e){return g=e})),n.subscribe("frameUpdate")((function(e){if(!_&&(g.left&&(o._mainObj.rotation.y+=b*e.count),g.right&&(o._mainObj.rotation.y-=b*e.count),!o._isBlocked)){if(o._root.systemCollisionFloor){var t=o._root.systemCollisionFloor.checkCollisions(o._mainObj,j,m),a=Object(I.a)(t,3),r=a[0],i=a[1],s=a[2];r?i<m-f&&(o._mainObj.position.y=s.y+m):o._mainObj.position.y+=v}if(g){if(g.up){if(!o._isCanMove.up)return;if(o._root.systemCollisionItems){var l=o._root.systemCollisionItems.checkCollisions(o._mainObj,O,p);if(Object(I.a)(l,1)[0])return}o._mainObj.translateZ(-d*e.count),n.emit("playerMove")({pos:o._mainObj.position,dir:"up"})}if(g.down){if(!o._isCanMove.down)return;if(o._root.systemCollisionItems){var c=o._root.systemCollisionItems.checkCollisions(o._mainObj,S,p);if(Object(I.a)(c,1)[0])return}o._mainObj.translateZ(d*e.count),n.emit("playerMove")({pos:o._mainObj.position,dir:"down"})}}}})),n.subscribe("toggleDialog")((function(e){return _=e.isOpen})),a.setCamera(this._camera),a.addToScene(this._mainObj)}return Object(_.a)(e,[{key:"toggleBlocked",value:function(e){this._isBlocked=e}},{key:"toggleCanMove",value:function(e,t){this._isCanMove[e]=t}},{key:"getObj",value:function(){return this._mainObj}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,o){this._mainObj.position.set(e,t,o)}}]),e}(),he=function(e,t){for(var o in e)e[o].wrapS&&(e[o].wrapS=e[o].wrapT=w.RepeatWrapping);var n=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],r={},i=function(o){r[o]=new w[t[o].mat](Object(a.a)({},t[o].props)),n.map((function(n){return t[o].props[n]&&(r[o][n]=e[t[o].props[n]])}))};for(var s in t)i(s);return r},de=["room_02","room_03","room_04","room_05"],me=["outer_walls","outer_floor","outer_road"],fe=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var n=t.emitter,a=t.studio,r=t.assets,i=t.materials,s=t.systemCollisionFloor,l=t.systemCollisionItems,c=pe(r,i),u=c.rooms,h=c.allMeshes,d=c.collisionsBotsRooms;this._instanceRooms=u,this.collisionsBotsRooms=d,this._group=new w.Group,a.addToScene(this._group),this._objRooms={},this._state="normal",n.subscribe("changeLevelMode")((function(e){console.log("changeLevelMode",e),o._state=e})),this._createRoom([0,-1,0],"room_02"),this._createRoom([0,-1,-1],"room_02"),this._createRoom([-1,-1,0],"room_02"),this._createRoom([1,-1,0],"room_02"),this._startL={};for(var f=0;f<me.length;++f){var p=h[me[f]].clone();s.setItemToCollision({mesh:p}),l.setItemToCollision({mesh:p}),this._group.add(p),p.position.set(0,-1*m,0),this._startL[me[f]]=p}this._wentLevels=0,this._flagIsSpecial=!1;var v=te.playerQuadrant,b=v.oldQuadrant,g=v.newQuadrant;this._saveOldQuadrant=b,this._saveNewQuadrant=g,this._saveIsStartCorridorShow=te.level.isStartCorridorShow}return Object(_.a)(e,[{key:"changeQuadrant",value:function(e){console.log(e);var t=this._root,o=t.systemCollisionFloor,n=t.systemCollisionItems,a=t.emitter;if(this._saveIsStartCorridorShow&&this._saveIsStartCorridorShow!==e.level.isStartCorridorShow){for(var r in this._saveIsStartCorridorShow=!1,this._startL)o.removeItemFromCollision(this._startL[r]),n.removeItemFromCollision(this._startL[r]),this._group.remove(this._startL[r]);a.emit("removeStartBots")()}var i=e.playerQuadrant,s=i.oldQuadrant,l=i.newQuadrant,c=i.counter;if(this._saveOldQuadrant[0]!==s[0]||this._saveOldQuadrant[1]!==s[1]||this._saveOldQuadrant[2]!==s[2]||this._saveNewQuadrant[0]!==l[0]||this._saveNewQuadrant[1]!==l[1]||this._saveNewQuadrant[2]!==l[2]){this._saveOldQuadrant=Object(ee.a)(s),this._saveNewQuadrant=Object(ee.a)(l);var u=de[Math.floor(Math.random()*de.length)];c&&(this._wentLevels=c(this._wentLevels),this._flagIsSpecial?this._flagIsSpecial=!1:(this._wentLevels<3?this._state="normal":this._wentLevels<100?"normal"===this._state&&(this._state="addBot"):this._state="addStairs","addBot"===this._state&&(u="room_01",this._flagIsSpecial=!0),"addStairs"===this._state&&(u="room_06",this._flagIsSpecial=!0),"addWell"===this._state&&(u="room_07")));var h=s,d=l;d[0]<h[0]&&(console.log("----------- west"),this._removeRoom([h[0]+1,h[1],h[2]]),this._objRooms["r_".concat(d[0]+1,"_").concat(d[1],"_").concat(d[2])]=this._objRooms["r_".concat(h[0],"_").concat(h[1],"_").concat(h[2])],this._createRoom([h[0]-2,h[1],h[2]],u),this._removeRoom([h[0],h[1],h[2]-1]),this._createRoom([d[0],d[1],d[2]-1],u),this._removeRoom([h[0],h[1],h[2]+1]),this._createRoom([d[0],d[1],d[2]+1],u)),d[0]>h[0]&&(console.log("----------- east"),this._removeRoom([h[0]-1,h[1],h[2]]),this._objRooms["r_".concat(d[0]-1,"_").concat(d[1],"_").concat(d[2])]=this._objRooms["r_".concat(h[0],"_").concat(h[1],"_").concat(h[2])],this._createRoom([h[0]+2,h[1],h[2]],u),this._removeRoom([h[0],h[1],h[2]-1]),this._createRoom([d[0],d[1],d[2]-1],u),this._removeRoom([h[0],h[1],h[2]+1]),this._createRoom([d[0],d[1],d[2]+1],u)),d[2]<h[2]&&(console.log("-----------north"),this._removeRoom([h[0],h[1],h[2]+1]),this._objRooms["r_".concat(d[0],"_").concat(d[1],"_").concat(d[2]+1)]=this._objRooms["r_".concat(h[0],"_").concat(h[1],"_").concat(h[2])],this._createRoom([h[0],h[1],h[2]-2],u),this._removeRoom([h[0]-1,h[1],h[2]]),this._createRoom([d[0]-1,d[1],d[2]],u),this._removeRoom([h[0]+1,h[1],h[2]]),this._createRoom([d[0]+1,d[1],d[2]],u)),d[2]>h[2]&&(console.log("-----------south"),this._removeRoom([h[0],h[1],h[2]-1]),this._objRooms["r_".concat(d[0],"_").concat(d[1],"_").concat(d[2]-1)]=this._objRooms["r_".concat(h[0],"_").concat(h[1],"_").concat(h[2])],this._createRoom([h[0],h[1],h[2]+2],u),this._removeRoom([h[0]-1,h[1],h[2]]),this._createRoom([d[0]-1,d[1],d[2]],u),this._removeRoom([h[0]+1,h[1],h[2]]),this._createRoom([d[0]+1,d[1],d[2]],u)),(d[1]>h[1]||d[1]<h[1])&&(console.log("-----------top"),this._removeRoom([h[0],h[1],h[2]-1]),this._createRoom([d[0],d[1],d[2]-1]),this._removeRoom([h[0],h[1],h[2]+1]),this._createRoom([d[0],d[1],d[2]+1]),this._removeRoom([h[0]-1,h[1],h[2]]),this._createRoom([d[0]-1,d[1],d[2]]),this._removeRoom([h[0]+1,h[1],h[2]]),this._createRoom([d[0]+1,d[1],d[2]]))}}},{key:"_createRoom",value:function(e,t){var o=this._root,n=o.emitter,a=o.systemCollisionFloor,r=o.systemCollisionItems,i=t||de[Math.floor(Math.random()*de.length)],s="r_".concat(e[0],"_").concat(e[1],"_").concat(e[2]),l=this._instanceRooms[i].clone();l.position.set(e[0]*d,e[1]*m,e[2]*d),a.setItemToCollision({mesh:l}),r.setItemToCollision({mesh:l}),this._group.add(l),this._objRooms[s]=l,n.emit("levelChanged")({typeLevelChange:"createRoom",instanceKey:i,objKey:s,kv:e,isAddBot:"room_01"===i}),"room_06"===i&&this._createRoom([e[0],e[1]+1,e[2]],"room_dummy")}},{key:"_removeRoom",value:function(e){var t=this._root,o=t.emitter,n=t.systemCollisionFloor,a=t.systemCollisionItems,r="r_".concat(e[0],"_").concat(e[1],"_").concat(e[2]);if(this._objRooms[r]){var i=this._objRooms[r].name;this._group.remove(this._objRooms[r]),a.removeItemFromCollision(this._objRooms[r]),n.removeItemFromCollision(this._objRooms[r]),delete this._objRooms[r],o.emit("levelChanged")({typeLevelChange:"destroyRoom",instanceKey:i,objKey:r,kv:e,isRemoveBot:"room_01"===i}),"room_dummy"===i&&this._removeRoom([e[0],e[1]-1,e[2]]),"room_06"===i&&this._removeRoom([e[0],e[1]+1,e[2]])}}}]),e}(),pe=function(e,t){var o={},n={},a={};return e["level-rooms"].traverse((function(e){if(e.name.includes("room_")){var r=new w.Mesh(e.geometry,t.wall);n[e.name]=r,r.name=e.name,o[e.name]=r}if(e.name.includes("collision_")){var i=new w.Mesh(e.geometry);a[e.name]=i,i.name=e.name,o[e.name]=i}if(e.name.includes("outer_walls")){var s=new w.Mesh(e.geometry,t.wall);s.name=e.name,o[e.name]=s}if(e.name.includes("outer_road")){var l=new w.Mesh(e.geometry,t.green);l.name=e.name,o[e.name]=l}if(e.name.includes("outer_floor")){var c=new w.Mesh(e.geometry,t.road);c.name=e.name,o[e.name]=c}})),{rooms:n,allMeshes:o,collisionsBotsRooms:a}},ve=o.p+"static/media/level-rooms.5251ade2.obj",be=o.p+"static/media/floor_outer_map.35e50f6e.jpg",ge=o.p+"static/media/px.2be78f43.jpg",ye=o.p+"static/media/nx.b2401269.jpg",_e=o.p+"static/media/py.659ebc34.jpg",we=o.p+"static/media/ny.462f1251.jpg",je=o.p+"static/media/pz.8ea5ba14.jpg",Oe=o.p+"static/media/nz.7f255b96.jpg",Se={x:55,z:75},Ne=function(){function e(){Object(y.a)(this,e),this.inScene=!1,this._state="go",this._targetAngle=null,this.container=new w.Group,this.mesh=new w.Group,this.mesh.position.x=Se.x,this.mesh.position.z=Se.z,this.mesh.rotation.y=Math.random()*(2*Math.PI),this.container.add(this.mesh),this._objFrom=new w.Object3D,this.mesh.add(this._objFrom),this._objTo=new w.Object3D,this._objTo.position.set(0,0,1),this.mesh.add(this._objTo);var t=function(e){var t={animations:e.animations,scene:e.scene.clone(!0)},o={};e.scene.traverse((function(e){e.isSkinnedMesh&&(o[e.name]=e)}));var n={},a={};for(var r in t.scene.traverse((function(e){e.isBone&&(n[e.name]=e),e.isSkinnedMesh&&(a[e.name]=e)})),o){for(var i=o[r].skeleton,s=a[r],l=[],c=0;c<i.bones.length;++c){var u=n[i.bones[c].name];l.push(u)}s.bind(new w.Skeleton(l,i.boneInverses),s.matrixWorld)}return t}(e.botScene);this.model=t.scene.children[0],this.model.children[1].material=e.botMaterial,this._animations=e.botScene.animations,this._mixer=new w.AnimationMixer(this.model.children[1]),this._walkAction=this._mixer.clipAction(this._animations[1]),this._walkAction.play(),this._walkAction.timeScale=.7,this._speakAction=this._mixer.clipAction(this._animations[0]),this._speakAction.timeScale=.4,this.mesh.add(this.model)}return Object(_.a)(e,[{key:"update",value:function(e){this._mixer.update(e.delta),this._componentCollision&&this._updateState()}},{key:"setCollisionMesh",value:function(e){this._collisionMeshes=[e],this.container.add(e),e.material.visible=!1,this._componentCollision=Ce(this._objFrom,this._objTo,7,this._collisionMeshes)}},{key:"removeCollisionMesh",value:function(){this._collisionMeshes=null,this._componentCollision=null}},{key:"prepareToSay",value:function(e){this._state="say",this._walkAction.stop(),this._speakAction.play(),this.mesh.lookAt(e.x,this.container.position.y,e.z)}},{key:"_updateState",value:function(){"go"===this._state&&(this._componentCollision.check()?this._startRotate():this.mesh.translateZ(.05));"rotate"===this._state&&(this.mesh.rotation.y+=this._targetAngle-this.mesh.rotation.y<0?-.01:.01,this.mesh.rotation.y%=2*Math.PI,Math.abs(this.mesh.rotation.y-this._targetAngle)<.5&&this._startGo())}},{key:"_startGo",value:function(){this._state="go",this._walkAction.play(),this._speakAction.stop()}},{key:"_startRotate",value:function(){this._state="rotate",this._targetAngle=(this.mesh.rotation.y+1.5+4*Math.random())%(2*Math.PI)}}]),e}();Ne.botScene=null,Ne.botMaterial=null;var Ce=function(e,t,o,n){var a=new w.Vector3,r=new w.Vector3;return{check:function(){return t.getWorldPosition(r),e.getWorldPosition(a),r.sub(a),!!new w.Raycaster(a,r,0,20).intersectObject(n[0],!0)[0]}}},ke=175.335,Ae=o.p+"static/media/botMap.972e276e.png",xe=o.p+"static/media/botAnim2.47b6030d.glb",Ee=o.p+"static/media/posx.be2d83a2.jpg",Re=o.p+"static/media/negx.d016c8e7.jpg",Ie=o.p+"static/media/posy.01cfd221.jpg",Te=o.p+"static/media/negy.f01f8356.jpg",Me=o.p+"static/media/posz.ef37b8e1.jpg",De=o.p+"static/media/negz.f346a80a.jpg",Fe=[{oldState:"outer",newState:"corridor",oldQuadrant:[0,-2,4],newQuadrant:[0,-2,3],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"corridorLight",backgroundImg:!1}]},{oldState:"corridor",newState:"outer",oldQuadrant:[0,-2,3],newQuadrant:[0,-2,4],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"outer"}]},{oldState:"corridor",newState:"firstRoom",oldQuadrant:[0,-1,2],newQuadrant:[0,-1,1],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"firstRoomLight"}]},{oldState:"firstRoom",newState:"corridor",oldQuadrant:[0,-1,1],newQuadrant:[0,-1,2],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"corridorLight"}]},{oldState:"firstRoom",newState:"playLevel",oldQuadrant:[0,-1,0],newQuadrant:[0,-1,"ANY_MINUS_ONE"],emitData:[{type:"DESTROY_START_CORRIDOR"},{type:"CHANGE_QUADRANT"}]},{oldState:"firstRoom",newState:"playLevel",oldQuadrant:[0,-1,0],newQuadrant:["ANY_MINUS_ONE",-1,0],emitData:[{type:"DESTROY_START_CORRIDOR"},{type:"CHANGE_QUADRANT"}]},{oldState:"firstRoom",newState:"playLevel",oldQuadrant:[0,-1,0],newQuadrant:["ANY_PLUS_ONE",-1,0],emitData:[{type:"DESTROY_START_CORRIDOR"},{type:"CHANGE_QUADRANT"}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY","ANY_PLUS_ONE","ANY"],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"default"},{type:"CHANGE_QUADRANT",counter:function(){return 0}}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY","ANY_MINUS_ONE","ANY"],emitData:[{type:"CHANGE_ENVIRONMENT",environmentMode:"default"},{type:"CHANGE_QUADRANT",counter:function(){return 100}}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY","ANY","ANY_MINUS_ONE"],emitData:[{type:"CHANGE_QUADRANT",counter:function(e){return++e}}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY_MINUS_ONE","ANY","ANY"],emitData:[{type:"CHANGE_QUADRANT",counter:function(e){return++e}}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY_PLUS_ONE","ANY","ANY"],emitData:[{type:"CHANGE_QUADRANT",counter:function(e){return++e}}]},{oldState:"playLevel",newState:"playLevel",oldQuadrant:["ANY","ANY","ANY"],newQuadrant:["ANY","ANY","ANY_PLUS_ONE"],emitData:[{type:"CHANGE_QUADRANT",counter:function(e){return++e}}]}],Le="outer",Pe=function(e,t){for(var o=0;o<Fe.length;++o){var n=Qe(Object(ee.a)(e),Object(ee.a)(t),Object(a.a)(Object(a.a)({},Fe[o]),{},{oldQuadrant:Object(ee.a)(Fe[o].oldQuadrant),newQuadrant:Object(ee.a)(Fe[o].newQuadrant)}));if(n)return n}return{levelState:Le}},Qe=function(e,t,o){var n=o.oldState,r=o.newState,i=o.oldQuadrant,s=o.newQuadrant,l=o.emitData;if(Le===n&&("ANY"===i[0]&&(i[0]=e[0]),"ANY"===i[1]&&(i[1]=e[1]),"ANY"===i[2]&&(i[2]=e[2]),"ANY"===s[0]&&(s[0]=t[0]),"ANY"===s[1]&&(s[1]=t[1]),"ANY"===s[2]&&(s[2]=t[2]),"ANY_PLUS_ONE"===s[0]&&(s[0]=e[0]+1),"ANY_PLUS_ONE"===s[1]&&(s[1]=e[1]+1),"ANY_PLUS_ONE"===s[2]&&(s[2]=e[2]+1),"ANY_MINUS_ONE"===s[0]&&(s[0]=e[0]-1),"ANY_MINUS_ONE"===s[1]&&(s[1]=e[1]-1),"ANY_MINUS_ONE"===s[2]&&(s[2]=e[2]-1),i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]))return Le=r,l.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{levelState:Le,oldQuadrant:Object(ee.a)(i),newQuadrant:Object(ee.a)(s)})}))},Ye=function(){var e=[];return{update:function(t){var o=t.x,n=t.y,a=t.z,r=[Math.floor(o/d),Math.floor(n/m),Math.floor(a/d)];if(r[0]!==e[0]||r[1]!==e[1]||r[2]!==e[2]){var i={isChanged:!0,currentQuadrant:r,oldQuadrant:e};return e=[].concat(r),i}return{isChanged:!1}}}},Ue=function(){function e(){Object(y.a)(this,e),this._itemWorldPos=new w.Vector3,this._mainCheckerWorldPos=new w.Vector3,this._arr=[]}return Object(_.a)(e,[{key:"setItemToCheck",value:function(e){this._arr.push(e)}},{key:"checkNear",value:function(e,t){e.getWorldPosition(this._mainCheckerWorldPos);for(var o=0;o<this._arr.length;++o){if(this._arr[o].userData.inScene)if(this._arr[o].getWorldPosition(this._itemWorldPos),this._itemWorldPos.distanceTo(this._mainCheckerWorldPos)<t)return[!0,this._arr[o].userData]}return[!1,null]}}]),e}(),Be=function(){function e(t){Object(y.a)(this,e),this._root=t,this._arrMeshes=[],this._vecStart=new w.Vector3,this._vecDir=new w.Vector3,this._rayCaster=new w.Raycaster(this._vecStart,this._vecDir)}return Object(_.a)(e,[{key:"setItemToCollision",value:function(e){var t=e.mesh,o=e.itemKeyEmitCollision,n=void 0===o?null:o,a=e.isStopUnits,r=void 0===a||a;t.userData.itemKeyEmitCollision=n,t.userData.isStopUnits=r,this._arrMeshes.push(t)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,o){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var n=this._rayCaster.intersectObjects(this._arrMeshes);return n[0]&&n[0].distance<o&&(n[0].object.userData.itemKeyEmitCollision&&this._root.emitter.emit("collision")(Object(a.a)(Object(a.a)({},n[0].object.userData.itemKeyEmitCollision),{},{type2:e.userData.type})),n[0].object.userData.isStopUnits)?[!0,n[0].distance,n[0].point]:[!1,null]}}]),e}(),Ge=[{key:"emitter",constr:C,initStateKey:"pageLoaded"},{key:"customUi",constr:function e(t){Object(y.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=$,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,o=arguments.length>1?arguments[1]:void 0;if("TOGGLE_FINAL_MESSAGE"===o.type)return Object(a.a)(Object(a.a)({},t),{},{isShowFinalMessage:o.mode,isShowControls:!1});if("CHANGE_ENVIRONMENT"===o.type){var n=o.newQuadrant,r=o.environmentMode;if(!p[n[1]])return t;var i=p[n[1]][r],s=i.fogNear,l=i.fogFar,c=i.color,u=i.backgroundImgKey;return e.studio.changeEnvironment({fogNear:s,fogFar:l,color:c,backgroundImgKey:u}),Object(a.a)(Object(a.a)({},t),{},{sceneEnvironment:{fogNear:s,fogFar:l,color:c,backgroundImgKey:u}})}if("CHANGE_QUADRANT"===o.type){var h=Object(a.a)(Object(a.a)({},t),{},{playerQuadrant:Object(a.a)(Object(a.a)({},t.playerQuadrant),o)});return e.level.changeQuadrant(h),h}if("DESTROY_START_CORRIDOR"===o.type)return Object(a.a)(Object(a.a)({},t),{},{level:Object(a.a)(Object(a.a)({},t.level),{},{isStartCorridorShow:!1})});if("CLICK_PHRASE"===o.type)return Object(a.a)(Object(a.a)({},t),{},{botAnswers:[].concat(Object(ee.a)(t.botAnswers),[o.phrase]),userReplicies:[]});if("PHRASE_EVENT"===o.type){var d=o.phrase,m=d.event,f=d.levelEvent;if(f&&e.emitter.emit("changeLevelMode")(f),"nextReply"===m){var v=[t.phrasesData[t.botIndex].phrases[t.phraseIndex+1]];return Object(a.a)(Object(a.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:v})}if("close"===m)return Object(a.a)(Object(a.a)({},t),{},{userReplicies:[],isButtonDialog:!0,playerQuadrant:Object(a.a)(Object(a.a)({},t.playerQuadrant),{},{oldDialogPlayerQuadrant:Object(ee.a)(t.playerQuadrant.newQuadrant)})})}if("TOGGLE_DIALOG"===o.type){var b=!1,g=t.playerQuadrant,y=g.oldDialogPlayerQuadrant,_=g.newQuadrant;if(y[0]===_[0]&&y[1]===_[1]&&y[2]===_[2]||(b=!0),!b)return Object(a.a)(Object(a.a)({},t),{},{isShowPalleteDialog:o.isShowPalleteDialog,isButtonDialog:!0});var w=0,j=t.botIndex+1,O=!1,S=t.phrasesData[j]?[t.phrasesData[j].phrases[w]]:[];return Object(a.a)(Object(a.a)({},t),{},{userReplicies:S,botAnswers:[],isShowPalleteDialog:o.isShowPalleteDialog,isButtonDialog:O,isCanChangeBotIndex:!1,botIndex:j,phraseIndex:w})}return"TOGGLE_BUTTON"===o.type?Object(a.a)(Object(a.a)({},t),{},{isButtonDialog:o.isButtonDialog}):t}}}(t);var o=new K(t);t.ui=o},initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(y.a)(this,e);var o=t.emitter,n=t.appWrapper;!n&&(n=document.querySelector(".app-wrapper")),o.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&a()}));var a=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},r=function(e){n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||o.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:N,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:function e(t){Object(y.a)(this,e);var o=t.emitter.emit("frameUpdate"),n={time:0,delta:0,count:0,oldTime:0},a=oe.a((function(){return n}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){return o(e),e}),(function(e){return e.oldTime=e.time,e}),(function(e){return n=e}));!function e(){requestAnimationFrame(e),a(n)}()},initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(y.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return ne.b()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:le,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:ce,initStateKey:"beforeStartPlay"},{key:"player",constr:ue,initStateKey:"beforeStartPlay"},{key:"systemCollisionFloor",constr:Be,initStateKey:"beforeStartPlay"},{key:"systemCollisionItems",constr:Be,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(y.a)(this,e);var o=t.assets,n=t.CONSTANTS;t.materials=he(o,n.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"level",constr:fe,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:ve,key:"level-rooms"},{type:"cubeTextures",path:[ge,ye,_e,we,je,Oe],key:"skyBox"},{type:"img",path:be,key:"mapFloorOuter",wrap:!0}]},{key:"bots",constr:function e(t){Object(y.a)(this,e);var o=t.assets,n=t.emitter,a=(t.store,t.studio),r=t.materials;Ne.botMaterial=r.iron,Ne.botScene=o.bot;var i=new w.Group;a.addToScene(i);var s=[];this.arrBots=s;var l=null;t.level&&t.level.collisionsBotsRooms&&(l=t.level.collisionsBotsRooms);for(var c=0;c<5;++c){var u=new Ne;i.add(u.container),u.container.position.set(30*c-30,-92,750),u.inScene="aaa",l&&u.setCollisionMesh(l.collision_r_01.clone()),s.push(u)}n.subscribe("frameUpdate")((function(e){for(var t=0;t<s.length;++t)s[t].inScene&&s[t].update(e)})),n.subscribe("removeStartBots")((function(){for(var e=0;e<s.length;++e)s[e].inScene=null,s[e].container.position.y=-1e4,s[e].removeCollisionMesh()})),n.subscribe("levelChanged")((function(e){var t=e.objKey,o=e.kv,n=e.isAddBot,a=e.isRemoveBot;if(n)for(var r=0;r<s.length;++r)if(!s[r].inScene){s[r].inScene=t,s[r].container.position.set(o[0]*ke,70*o[1]+14,o[2]*ke),l&&s[r].setCollisionMesh(l.collision_r_01.clone());break}if(a)for(var i=0;i<s.length;++i)s[i].inScene===t&&(s[i].inScene=null,s[i].container.position.y=-1e4,s[i].removeCollisionMesh())}))},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"glb",path:xe,key:"bot"},{type:"img",path:Ae,key:"botMap"},{type:"cubeTextures",path:[Ee,Re,Ie,Te,Me,De],key:"ironEnv"}]},{key:"changerQuadrant",constr:function e(t){Object(y.a)(this,e);var o=t.emitter,n=t.dispatcher,r=Ye();o.subscribe("playerMove")((function(e){var t=e.pos,o=r.update(t),i=o.currentQuadrant,s=o.oldQuadrant;if(o.isChanged){var l=Pe(s,i);l.length&&l.forEach((function(e){return n.dispatch(Object(a.a)({},e))}))}}))},initStateKey:"beforeStartPlay"},{key:"playerInBot",constr:function e(t){Object(y.a)(this,e);for(var o=t.bots,n=t.emitter,a=t.dispatcher,r=new Ue(t),i=0;i<o.arrBots.length;++i)r.setItemToCheck(o.arrBots[i].mesh);var s=new w.Vector3;n.subscribe("playerMove")((function(e){for(var t=0;t<o.arrBots.length;++t)if(o.arrBots[t].inScene){o.arrBots[t].mesh.getWorldPosition(s);var n=s.distanceTo(e.pos);"say"===o.arrBots[t]._state&&n>30?(a.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),o.arrBots[t]._startRotate()):"say"!==o.arrBots[t]._state&&n<30&&(o.arrBots[t].prepareToSay(e.pos),a.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!0}))}}))},initStateKey:"beforeStartPlay"},{key:"starterPlay",constr:function e(t){Object(y.a)(this,e);var o=t.player,n=t.ui,a=t.dispatcher;a.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:2}),n.showStartButton((function(){a.dispatch({type:"CHANGE_ENVIRONMENT",newQuadrant:[0,-1,-50],environmentMode:"back"}),o.toggleBlocked(!1)}))},initStateKey:"beforeStartPlay"},{key:"enderPlay",constr:function e(t){Object(y.a)(this,e);var o=t.player,n=t.emitter,a=t.dispatcher,r=o.getObj(),i=r.position.y,s=0,l=!1;n.subscribe("frameUpdate")((function(){i>r.position.y?(++s,i=r.position.y):s=0,s>800&&!l&&(l=!0,setTimeout((function(){var e;(e=a.dispatch,{startPlay:function(){return e({type:"CHANGE_ENVIRONMENT",newQuadrant:[0,-1,-50],environmentMode:"outer"})},startFinalFog:function(){return e({type:"CHANGE_ENVIRONMENT",newQuadrant:[0,-1,-50],environmentMode:"start"})}}).startFinalFog(),setTimeout((function(){(function(e){return{toggleFinalMessage:function(t){return e({type:"TOGGLE_FINAL_MESSAGE",mode:t})}}})(a.dispatch).toggleFinalMessage(!0)}),6e3)}),1e4))}))},initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return l.apply(this,arguments)}(Ge,Object(a.a)(Object(a.a)({},n),{},{TRANSLATE_WORLDS:g}))}))}},[[43,1,2]]]);
//# sourceMappingURL=main.7f89dd1e.chunk.js.map