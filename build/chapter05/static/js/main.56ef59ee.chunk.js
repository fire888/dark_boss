(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{40:function(e,t,o){},42:function(e,t,o){},44:function(e,t,o){},45:function(e,t,o){"use strict";o.r(t);var n={};o.r(n),o.d(n,"SIZE_QUADRANT",(function(){return u})),o.d(n,"LOCATIONS_QUADRANTS",(function(){return h})),o.d(n,"CONFIG_FOR_INIT",(function(){return d})),o.d(n,"MATERIALS_CONFIG",(function(){return p})),o.d(n,"studioConfig",(function(){return m})),o.d(n,"playerConfig",(function(){return f}));var r=o(11),a=o.n(r),i=o(12);function s(){return(s=Object(i.a)(a.a.mark((function e(t,o){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,n={CONSTANTS:o}),r=n.loaderAssets,i=l(t),e.next=6,r.loadAssets(i);case 6:n.assets=e.sent,c("beforeStartPlay",t,n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,o){for(var n=0;n<t.length;++n){var r=t[n],a=r.key,i=r.constr;r.initStateKey===e&&(o[a]=new i(o))}},l=function(e){for(var t=[],o=0;o<e.length;++o)if(e[o].assetsToLoad&&e[o].assetsToLoad.length)for(var n=0;n<e[o].assetsToLoad.length;++n)t.push(e[o].assetsToLoad[n]);return t},u=2e3,h={"0_0":"location01","0_-3":"location02","3_-1":"location03"},d={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},p={wallVirtual:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:0}},wallVirtualColor:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:0,bumpMap:"mapParams",bumpScale:.1,specular:2236962,vertexColors:!0}},car:{mat:"MeshPhongMaterial",props:{color:0,emissive:0,envMap:"skyBox",reflectivity:.5,shininess:.5,specular:16777215}}},m={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},composerAddPass:"Saturate2"},f={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},b=o(1),v=o(3),y=o(0),_=o(21),g=o(22),O=function(){var e=null,t=null,o=null,n=null,r=null;return function(a,i){return new Promise((function(s){(function(a){return"obj"===a?e=e||new _.a:"glb"===a||"gltf"===a?o=o||new g.a:"img"===a?t=t||new y.TextureLoader:"cubeTextures"===a?n=n||new y.CubeTextureLoader:"soundMp3"===a?r=r||new y.AudioLoader:void 0})(i).load(a,s)}))}},j=function(){function e(){Object(b.a)(this,e),this.resources={},this._load=O()}return Object(v.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(o){var n=t._load,r=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(a.a.mark((function t(i){var c,l,u,h;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,n(u,h);case 4:r[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}o(r),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),w=function(){function e(){Object(b.a)(this,e),this._storage={}}return Object(v.a)(e,[{key:"emit",value:function(e){var t=this;return function(o){return C(t._storage)(e).forEach((function(e){return e(o)}))}}},{key:"subscribe",value:function(e){var t=this;return function(o){return C(t._storage)(e).push(o),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==o}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),C=function(e){return function(t){return e[t]=e[t]||[]}},S=o(5),k=o(17),M=o.n(k),T=o(8),x=o(10),P=o(6),D=(o(40),"en"),L=function(e){return function(t){return e[D]&&e[D][t]||t}},I=o(4),A=L({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),N=Object(T.b)((function(e){return Object(P.a)({},e.controls.infoPanelData)}))((function(e){return Object(I.jsxs)("div",{className:"info",children:[Object(I.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(I.jsxs)("div",{className:"info-inner",children:[Object(I.jsx)("p",{children:A(e.title)}),Object(I.jsx)("p",{children:A(e.topText)}),Object(I.jsx)("ul",{children:e.chapters.map((function(t,o){return Object(I.jsxs)("li",{children:[o+1,".\xa0",t.href?Object(I.jsx)("span",{children:Object(I.jsx)("a",{href:t.href,target:"blank",children:A(t.text)})}):Object(I.jsx)("span",{children:A(t.text)}),o===e.currentChapterIndex&&A(" (current)")]},o)}))}),Object(I.jsx)("p",{children:e.bottomText}),Object(I.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(I.jsxs)("li",{children:[A(e.text),Object(I.jsx)("a",{href:e.href,target:"blank",children:A(e.aText)})]},t)}))})]})]})})),F=(o(42),Object(T.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(S.useState)(!0),o=Object(x.a)(t,2),n=o[0],r=o[1];return Object(S.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&r(!0)}))})),Object(I.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(I.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(I.jsx)(I.Fragment,{children:"\u27fc"}):Object(I.jsx)(I.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(I.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(I.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(I.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(I.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&n&&Object(I.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),r(!1)},children:"\u2752"}),!e.isInfo&&Object(I.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(I.jsx)(N,{})]})})));var E={dispatch:null},B=Object(T.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!E.dispatch&&(E.dispatch=e.dispatch),Object(I.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(I.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(I.jsx)(F,{gameContext:e.gameContext})]})})),R=o(15),G=o(24),z={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var U=document.querySelector(".progress"),W=-100,K=!0;!function e(){K&&setTimeout((function(){0===++W&&(W-=100),U.style.marginLeft=W+"%",e()}),30)}();var q=function(){function e(t){Object(b.a)(this,e),t.dispatcher=E,this._root=t;var o=function(e){e.customStore||(e.customStore={});var t=Object(R.b)(Object(P.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(P.a)(Object(P.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(P.a)(Object(P.a)({},e),{},{infoPanelData:Object(P.a)(Object(P.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(P.a)(Object(P.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(P.a)(Object(P.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(P.a)(Object(P.a)({},e),{},{isMute:t.is}):Object(P.a)({},e)}},e.customStore)),o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||R.c;return Object(R.d)(t,o(Object(R.a)(G.a)))}(t);o&&M.a.render(Object(I.jsx)(T.a,{store:o,children:Object(I.jsx)(B,{gameContext:t})}),document.getElementById("root"))}return Object(v.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),o=document.querySelector(".progress-wrapper"),n=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,D=t),document.querySelector(".start-screen").style.display="none"};K=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),n(t)})),o.style.display="none"}}]),e}(),V=o(47),H=function(){function e(){var t=this;Object(b.a)(this,e),this._subscribers=[];var o={time:0,delta:0,count:0,oldTime:0},n=V.a((function(){return o}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var o=0;o<t._subscribers.length;++o)t._subscribers[o](Object(P.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return o=e}));!function e(){requestAnimationFrame(e),n(o)}()}return Object(v.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),Q=o(19),Z=o(28),Y=o(26),J=o(14),X={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},$={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},ee=o(25),te=function(){function e(t){var o=this;Object(b.a)(this,e),this._root=t;t.assets;var n=t.emitter,r=t.CONSTANTS.studioConfig,a=r.canId,i=r.rendererCon,s=(r.clearColor,r.amb);i.canvas=document.getElementById(a),this._renderer=new y.WebGLRenderer(i),this._renderer.setClearColor(11184810),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new y.Scene;s.color,s.strength;this._lightA=new y.AmbientLight(16777215,.2),this._scene.add(this._lightA);var c=new y.DirectionalLight(16777215,.5);c.position.set(1,1,.5),this._scene.add(c),this._playerCamera=new y.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new y.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var l=new ee.a(this._controlsCamera,this._renderer.domElement);l.target.set(0,0,0),l.update(),this._composer=new Z.a(this._renderer),this._renderPass=new Y.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new J.a(X)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new J.a($)));var u=new y.Vector3,h=!0;n.subscribe("keyEvent")((function(e){e.o&&(h?(h=!1,o._renderPass.camera=o._controlsCamera,o._playerCamera.getWorldPosition(u),o._controlsCamera.position.x=u.x+100,o._controlsCamera.position.y=u.y+100,o._controlsCamera.position.z=u.z,l.target.set(u.x,u.y,u.z),l.update()):(o._scene.fog.near=null.near,o._scene.fog.far=null.far,h=!0,o._renderPass.camera=o._playerCamera))}));var d=function(){var e={width:window.innerWidth,height:window.innerHeight};o._renderer.setSize(e.width,e.height),o._composer.setSize(e.width,e.height),o._controlsCamera&&(o._controlsCamera.aspect=e.width/e.height,o._controlsCamera.updateProjectionMatrix()),o._playerCamera&&(o._playerCamera.aspect=e.width/e.height,o._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",d),d(),this.addToScene=function(e){return o._scene.add(e)},this.removeFromScene=function(e){return o._scene.remove(e)},this.drawFrame=function(){o._composer.render(o._scene,o._controlsCamera)},n.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(v.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),oe=function(){function e(t){Object(b.a)(this,e);var o=t.emitter,n={up:!1,down:!1,left:!1,right:!1,p:!1},r={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=r,this.keys=n;var a=function(e,t){switch(e){case 38:case 87:r.up&&(n.up=t);break;case 40:case 83:r.down&&(n.down=t);break;case 37:case 65:n.left=t;break;case 39:case 68:n.right=t;break;case 79:n.o=t;break;case 80:n.p=t}o.emit("keyEvent")(n)};document.addEventListener("keydown",(function(e){return a(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return a(e.keyCode,!1)})),o.subscribe("mouseDown")((function(e){"butt-left"===e&&a(37,!0),"butt-right"===e&&a(39,!0),"butt-front"===e&&a(38,!0),"butt-back"===e&&a(40,!0)})),o.subscribe("mouseUp")((function(e){"butt-left"===e&&a(37,!1),"butt-right"===e&&a(39,!1),"butt-front"===e&&a(38,!1),"butt-back"===e&&a(40,!1)}))}return Object(v.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ne=function(){function e(t){Object(b.a)(this,e);var o=t.studio,n=t.CONSTANTS.playerConfig,r=(n.startPos,n.startRot,n.cameraData),a=(n.frontObjPos,n.backObjPos,n.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new y.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new y.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new y.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new y.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=r.fov,s=r.ratio,c=r.near,l=r.far;r.pos;if(this._camera=new y.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),a){var u=a.color,h=a.strenth,d=a.pos,p=new y.PointLight(u,h);p.position.fromArray(d),this.mesh.add(p)}o.setCamera(this._camera),o.addToScene(this.mesh)}return Object(v.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,o){this.mesh.position.set(e,t,o)}}]),e}(),re=function(e,t){for(var o in e)e[o].wrapS&&(e[o].wrapS=e[o].wrapT=y.RepeatWrapping);var n=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],r={},a=function(o){r[o]=new y[t[o].mat](Object(P.a)({},t[o].props)),n.map((function(n){return t[o].props[n]&&(r[o][n]=e[t[o].props[n]])}))};for(var i in t)a(i);return r},ae=function(e,t){var o={};return e["level-rooms"].traverse((function(e){e.geometry&&(o[e.name]=e,e.material=t.wallVirtual),e.name.includes("level")&&("level_000_000"===e.name&&(new y.Mesh(e.geometry,t.wallVirtual).name=e.name),"level_001_000"===e.name&&(new y.Mesh(e.geometry,t.wallVirtual).name=e.name))})),{items:o}},ie=o.p+"static/media/level.21832d73.obj",se=o.p+"static/media/floor_outer_map3.558e9646.jpg",ce=(o.p,o.p+"static/media/map01.48219503.jpg"),le=o.p+"static/media/floor_outer_map.35e50f6e.jpg",ue=o.p+"static/media/txt1.b67888d5.jpg",he=o.p+"static/media/px.8a9030e7.jpg",de=o.p+"static/media/nx.dc0a1bc7.jpg",pe=o.p+"static/media/py.ed7a276e.jpg",me=o.p+"static/media/ny.75a01d7a.jpg",fe=o.p+"static/media/pz.3cf6bf7f.jpg",be=o.p+"static/media/nz.c24a9aad.jpg",ve=o.p+"static/media/px.96d0b65f.jpg",ye=o.p+"static/media/nx.8cbf039d.jpg",_e=o.p+"static/media/py.659ebc34.jpg",ge=o.p+"static/media/ny.09051a4e.jpg",Oe=o.p+"static/media/pz.a1539724.jpg",je=o.p+"static/media/nz.0bc769f7.jpg",we=function(){function e(){Object(b.a)(this,e),this._arrMeshes=[],this._vecStart=new y.Vector3,this._vecDir=new y.Vector3,this._rayCaster=new y.Raycaster(this._vecStart,this._vecDir)}return Object(v.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,o){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var n=this._rayCaster.intersectObjects(this._arrMeshes);return n[0]&&n[0].distance<o?[!0,n[0]]:[!1,null]}}]),e}(),Ce=function(){function e(t){var o=this;Object(b.a)(this,e);var n=t.assets,r=t.CONSTANTS,a=t.emitter,i=t.materials,s=(t.system_Level,r.CONFIG_FOR_INIT.currentSceneConfig.carProps),c=s.position,l=s.rotation;this._model=n.car.children[0],this._model.material=i.car,this._camera=new y.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=28,this._model.add(this._camera),this._model.position.fromArray(c),this._model.rotation.fromArray(l),this._collision=n.carCollision.children[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new y.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new y.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){o._compass=function(e){e.assets;var t=e.studio,o=e.system_Level._items.arrow,n=new y.Mesh(new y.BoxGeometry(10,10,10),new y.MeshBasicMaterial({color:16711680}));n.position.set(-500,-30,-500),t.addToScene(n);var r=new y.Mesh(new y.BoxGeometry(10,10,10),new y.MeshBasicMaterial({color:16711680}));return r.position.set(0,0,0),t.addToScene(n),new y.Vector3,{addToParent:function(e){e.add(o)},setArrowPosition:function(e,t,n){o.position.set(e,t,n)},setTargetPosition:function(e){n.position.copy(e)},update:function(){r.position.copy(o.parent.position),r.lookAt(n.position),o.parent.position.z<n.position.z?o.rotation.y=-o.parent.rotation.y+r.rotation.y:o.rotation.y=-o.parent.rotation.y-r.rotation.y+Math.PI}}}(t),o._compass.addToParent(o._model),o._compass.setArrowPosition(0,23,-11.5),o.setTargetPosition=function(e){o._compass.setTargetPosition(e),o._compass.update()}})),this._collisionsWalls=new we;var u=function(e,t){var n=o._collisionsWalls.checkCollisions(o._model,e,t);return Object(x.a)(n,1)[0]};this.isFreeze=!0;var h={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!o.isFreeze){if(o._spd<0&&(u(o._frontObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),o._spd>0&&(u(o._backObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),h.up&&(o._spd-=o._acc),h.down&&(o._spd+=o._acc),Math.abs(o._spd)>.001){o._spd>0&&(o._spd-=o._deceleration,o._spd<0&&(o._spd=0)),o._spd<0&&(o._spd+=o._deceleration,o._spd>0&&(o._spd=0)),o._spd=Math.min(o._maxSpdBack,Math.max(o._maxSpdFront,o._spd));var t=Math.min(1,Math.max(0,Math.abs(o._spd)));h.left&&(o._spd<0&&(o._model.rotation.y+=o._spdRot*t),o._spd>0&&(o._model.rotation.y-=o._spdRot*t)),h.right&&(o._spd<0&&(o._model.rotation.y-=o._spdRot*t),o._spd>0&&(o._model.rotation.y+=o._spdRot*t))}else o._spd=0;o._isCarStay&&0!==o._spd&&(o._isCarStay=!1,o._onChangeStateIsStay("carStart")),o._isCarStay||0!==o._spd||(o._isCarStay=!0,o._onChangeStateIsStay("carStop"))}},a.subscribe("keyEvent")((function(e){return h=e}))}return Object(v.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}}]),e}(),Se=o.p+"static/media/car.8c016cb9.obj",ke=o.p+"static/media/car_collision.66478aff.obj",Me=o.p+"static/media/body.bb8da675.obj",Te=function(){function e(t){var o=this;Object(b.a)(this,e);var n=t.emitter,r=t.CONSTANTS,a=t.player;t.assets,t.studio;a.mesh.position.fromArray([0,0,0]);var i=new we,s=r.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;a.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},a.toggleCanMove=function(e,t){return o.isCanMove[e]=t},this.isFreeze=!1;var d={};this.update=function(e){o.isFreeze||(d.left&&a.mesh.rotateY(u*e.count),d.right&&a.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(a.mesh,a.bottomObj,17.2),o=Object(x.a)(t,2),n=o[0],r=o[1];n&&17>r.distance?a.mesh.translateY(17-r.distance):n||(a.mesh.position.y+=l*e.count)}(e),d.up&&o.isCanMove.forward&&function(e){var t=i.checkCollisions(a.mesh,a.frontObj,17),o=Object(x.a)(t,2),r=o[0],s=o[1];r?s.object.userData.type&&"alert"===s.object.userData.type&&n.emit("collision")(s.object.userData.event):(a.mesh.translateZ(-c*e.count),n.emit("playerMove")("forward"))}(e),d.down&&o.isCanMove.back&&function(e){var t=i.checkCollisions(a.mesh,a.backObj,17);Object(x.a)(t,1)[0]||(a.mesh.translateZ(c*e.count),n.emit("playerMove")("back"))}(e),d.p&&console.log("player.mesh.position.fromArray([".concat(a.mesh.position.x,", ").concat(a.mesh.position.y,", ").concat(a.mesh.position.z,"])"))))},n.subscribe("keyEvent")((function(e){return d=e})),this._collisionsWalls=i}return Object(v.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),xe=function(){function e(t){var o=this;Object(b.a)(this,e),this._root=t;var n=t.emitter,r=t.player;this._itemsToCheck=[],n.subscribe("playerMove")((function(){for(var e=0;e<o._itemsToCheck.length;++e){var t=r.mesh.position.distanceTo(o._itemsToCheck[e].position);if(!o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<o._itemsToCheck[e].userData.nearPlayerItemNear)return o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void n.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>o._itemsToCheck[e].userData.nearPlayerItemNear&&(o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,n.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(v.a)(e,[{key:"setItemToCheck",value:function(e,t,o,n){for(var r=0;r<this._itemsToCheck.length;++r)if(e===this._itemsToCheck[r])return;t&&(e.userData.nearPlayerItemKey=t),o&&(e.userData.nearPlayerItemNear=o),n&&(e.userData.nearPlayerItemFar=n),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),Pe=function(e,t){for(var o=[],n=e-1;n<e+2;++n)for(var r=t-1;r<t+2;++r)o.push(n+"_"+r);return o},De=function(e,t){for(var o=[],n=0;n<e.length;++n){for(var r=!1,a=0;a<t.length;++a)e[n]===t[a]&&(r=!0);r||o.push(e[n])}return o},Le=o(27),Ie=o(2),Ae=Float32Array;function Ne(e,t,o){return(o=o||new Ae(3))[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],o}function Fe(e,t){t=t||new Ae(3);var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return o>1e-5&&(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t}function Ee(e,t,o){return(o=o||new Ae(3))[0]=e[1]*t[2]-e[2]*t[1],o[1]=e[2]*t[0]-e[0]*t[2],o[2]=e[0]*t[1]-e[1]*t[0],o}function Be(e,t){var o=e[0]-t[0],n=e[1]-t[1],r=e[2]-t[2];return o*o+n*n+r*r}function Re(e,t){t=t||new Ae(16);var o=e[0],n=e[1],r=e[2],a=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],m=e[12],f=e[13],b=e[14],v=e[15],y=d*v,_=b*p,g=c*v,O=b*l,j=c*p,w=d*l,C=r*v,S=b*a,k=r*p,M=d*a,T=r*l,x=c*a,P=u*f,D=m*h,L=i*f,I=m*s,A=i*h,N=u*s,F=o*f,E=m*n,B=o*h,R=u*n,G=o*s,z=i*n,U=y*s+O*h+j*f-(_*s+g*h+w*f),W=_*n+C*h+M*f-(y*n+S*h+k*f),K=g*n+S*s+T*f-(O*n+C*s+x*f),q=w*n+k*s+x*h-(j*n+M*s+T*h),V=1/(o*U+i*W+u*K+m*q);return t[0]=V*U,t[1]=V*W,t[2]=V*K,t[3]=V*q,t[4]=V*(_*i+g*u+w*m-(y*i+O*u+j*m)),t[5]=V*(y*o+S*u+k*m-(_*o+C*u+M*m)),t[6]=V*(O*o+C*i+x*m-(g*o+S*i+T*m)),t[7]=V*(j*o+M*i+T*u-(w*o+k*i+x*u)),t[8]=V*(P*l+I*p+A*v-(D*l+L*p+N*v)),t[9]=V*(D*a+F*p+R*v-(P*a+E*p+B*v)),t[10]=V*(L*a+E*l+G*v-(I*a+F*l+z*v)),t[11]=V*(N*a+B*l+z*p-(A*a+R*l+G*p)),t[12]=V*(L*d+N*b+D*c-(A*b+P*c+I*d)),t[13]=V*(B*b+P*r+E*d-(F*d+R*b+D*r)),t[14]=V*(F*c+z*b+I*r-(G*b+L*r+E*c)),t[15]=V*(G*d+A*r+R*c-(B*c+z*d+N*r)),t}var Ge={copy:function(e,t){return(t=t||new Ae(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,o,n){n=n||new Ae(16);var r=Fe(Ne(e,t)),a=Fe(Ee(o,r)),i=Fe(Ee(r,a));return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=i[0],n[5]=i[1],n[6]=i[2],n[7]=0,n[8]=r[0],n[9]=r[1],n[10]=r[2],n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},addVectors:function(e,t,o){return(o=o||new Ae(3))[0]=e[0]+t[0],o[1]=e[1]+t[1],o[2]=e[2]+t[2],o},subtractVectors:Ne,scaleVector:function(e,t,o){return(o=o||new Ae(3))[0]=e[0]*t,o[1]=e[1]*t,o[2]=e[2]*t,o},distance:function(e,t){return Math.sqrt(Be(e,t))},distanceSq:Be,normalize:Fe,compose:function(e,t,o,n){n=n||new Ae(16);var r=t[0],a=t[1],i=t[2],s=t[3],c=r+r,l=a+a,u=i+i,h=r*c,d=r*l,p=r*u,m=a*l,f=a*u,b=i*u,v=s*c,y=s*l,_=s*u,g=o[0],O=o[1],j=o[2];return n[0]=(1-(m+b))*g,n[1]=(d+_)*g,n[2]=(p-y)*g,n[3]=0,n[4]=(d-_)*O,n[5]=(1-(h+b))*O,n[6]=(f+v)*O,n[7]=0,n[8]=(p+y)*j,n[9]=(f-v)*j,n[10]=(1-(h+m))*j,n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n},cross:Ee,decompose:function(e,t,o,n){var r=Ge.length(e.slice(0,3)),a=Ge.length(e.slice(4,7)),i=Ge.length(e.slice(8,11));(function(e){var t=e[0],o=e[1],n=e[2],r=e[3],a=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],p=e[12],m=e[13],f=e[14],b=e[15],v=h*b,y=f*d,_=s*b,g=f*c,O=s*d,j=h*c,w=n*b,C=f*r,S=n*d,k=h*r,M=n*c,T=s*r;return 1/(t*(v*i+g*u+O*m-(y*i+_*u+j*m))+a*(y*o+w*u+k*m-(v*o+C*u+S*m))+l*(_*o+C*i+M*m-(g*o+w*i+T*m))+p*(j*o+S*i+T*u-(O*o+k*i+M*u)))})(e)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=Ge.copy(e),c=1/r,l=1/a,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var o=e[0],n=e[4],r=e[8],a=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=o+i+u;if(h>0){var d=.5/Math.sqrt(h+1);t[3]=.25/d,t[0]=(l-s)*d,t[1]=(r-c)*d,t[2]=(a-n)*d}else if(o>i&&o>u){var p=2*Math.sqrt(1+o-i-u);t[3]=(l-s)/p,t[0]=.25*p,t[1]=(n+a)/p,t[2]=(r+c)/p}else if(i>u){var m=2*Math.sqrt(1+i-o-u);t[3]=(r-c)/m,t[0]=(n+a)/m,t[1]=.25*m,t[2]=(s+l)/m}else{var f=2*Math.sqrt(1+u-o-i);t[3]=(a-n)/f,t[0]=(r+c)/f,t[1]=(s+l)/f,t[2]=.25*f}}(s,o),n[0]=r,n[1]=a,n[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new Ae(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new Ae(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,o,n,r,a,i){return(i=i||new Ae(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(n-o),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(r-a),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(o+n)/(o-n),i[14]=(r+a)/(r-a),i[15]=1,i},frustum:function(e,t,o,n,r,a,i){var s=t-e,c=n-o,l=a-r;return(i=i||new Ae(16))[0]=2*r/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*r/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(n+o)/c,i[10]=-(a+r)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*r*a/l,i[15]=0,i},perspective:function(e,t,o,n,r){r=r||new Ae(16);var a=Math.tan(.5*Math.PI-.5*e),i=1/(o-n);return r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(o+n)*i,r[11]=-1,r[12]=0,r[13]=0,r[14]=o*n*i*2,r[15]=0,r},translation:function(e,t,o,n){return(n=n||new Ae(16))[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=t,n[14]=o,n[15]=1,n},translate:function(e,t,o,n,r){r=r||new Ae(16);var a=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],d=e[7],p=e[8],m=e[9],f=e[10],b=e[11],v=e[12],y=e[13],_=e[14],g=e[15];return e!==r&&(r[0]=a,r[1]=i,r[2]=s,r[3]=c,r[4]=l,r[5]=u,r[6]=h,r[7]=d,r[8]=p,r[9]=m,r[10]=f,r[11]=b),r[12]=a*t+l*o+p*n+v,r[13]=i*t+u*o+m*n+y,r[14]=s*t+h*o+f*n+_,r[15]=c*t+d*o+b*n+g,r},xRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),n=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),n=Math.sin(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),n=Math.sin(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,o){o=o||new Ae(16);var n=e[4],r=e[5],a=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),d=Math.sin(t);return o[4]=h*n+d*s,o[5]=h*r+d*c,o[6]=h*a+d*l,o[7]=h*i+d*u,o[8]=h*s-d*n,o[9]=h*c-d*r,o[10]=h*l-d*a,o[11]=h*u-d*i,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},yRotate:function(e,t,o){o=o||new Ae(16);var n=e[0],r=e[1],a=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),d=Math.sin(t);return o[0]=h*n-d*s,o[1]=h*r-d*c,o[2]=h*a-d*l,o[3]=h*i-d*u,o[8]=h*s+d*n,o[9]=h*c+d*r,o[10]=h*l+d*a,o[11]=h*u+d*i,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},zRotate:function(e,t,o){o=o||new Ae(16);var n=e[0],r=e[1],a=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),d=Math.sin(t);return o[0]=h*n+d*s,o[1]=h*r+d*c,o[2]=h*a+d*l,o[3]=h*i+d*u,o[4]=h*s-d*n,o[5]=h*c-d*r,o[6]=h*l-d*a,o[7]=h*u-d*i,e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},axisRotation:function(e,t,o){o=o||new Ae(16);var n=e[0],r=e[1],a=e[2],i=Math.sqrt(n*n+r*r+a*a),s=(n/=i)*n,c=(r/=i)*r,l=(a/=i)*a,u=Math.cos(t),h=Math.sin(t),d=1-u;return o[0]=s+(1-s)*u,o[1]=n*r*d+a*h,o[2]=n*a*d-r*h,o[3]=0,o[4]=n*r*d-a*h,o[5]=c+(1-c)*u,o[6]=r*a*d+n*h,o[7]=0,o[8]=n*a*d+r*h,o[9]=r*a*d-n*h,o[10]=l+(1-l)*u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},axisRotate:function(e,t,o,n){n=n||new Ae(16);var r=t[0],a=t[1],i=t[2],s=Math.sqrt(r*r+a*a+i*i),c=(r/=s)*r,l=(a/=s)*a,u=(i/=s)*i,h=Math.cos(o),d=Math.sin(o),p=1-h,m=c+(1-c)*h,f=r*a*p+i*d,b=r*i*p-a*d,v=r*a*p-i*d,y=l+(1-l)*h,_=a*i*p+r*d,g=r*i*p+a*d,O=a*i*p-r*d,j=u+(1-u)*h,w=e[0],C=e[1],S=e[2],k=e[3],M=e[4],T=e[5],x=e[6],P=e[7],D=e[8],L=e[9],I=e[10],A=e[11];return n[0]=m*w+f*M+b*D,n[1]=m*C+f*T+b*L,n[2]=m*S+f*x+b*I,n[3]=m*k+f*P+b*A,n[4]=v*w+y*M+_*D,n[5]=v*C+y*T+_*L,n[6]=v*S+y*x+_*I,n[7]=v*k+y*P+_*A,n[8]=g*w+O*M+j*D,n[9]=g*C+O*T+j*L,n[10]=g*S+O*x+j*I,n[11]=g*k+O*P+j*A,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},scaling:function(e,t,o,n){return(n=n||new Ae(16))[0]=e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=t,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},scale:function(e,t,o,n,r){return(r=r||new Ae(16))[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=t*e[3],r[4]=o*e[4],r[5]=o*e[5],r[6]=o*e[6],r[7]=o*e[7],r[8]=n*e[8],r[9]=n*e[9],r[10]=n*e[10],r[11]=n*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},multiply:function(e,t,o){o=o||new Ae(16);var n=t[0],r=t[1],a=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],d=t[9],p=t[10],m=t[11],f=t[12],b=t[13],v=t[14],y=t[15],_=e[0],g=e[1],O=e[2],j=e[3],w=e[4],C=e[5],S=e[6],k=e[7],M=e[8],T=e[9],x=e[10],P=e[11],D=e[12],L=e[13],I=e[14],A=e[15];return o[0]=n*_+r*w+a*M+i*D,o[1]=n*g+r*C+a*T+i*L,o[2]=n*O+r*S+a*x+i*I,o[3]=n*j+r*k+a*P+i*A,o[4]=s*_+c*w+l*M+u*D,o[5]=s*g+c*C+l*T+u*L,o[6]=s*O+c*S+l*x+u*I,o[7]=s*j+c*k+l*P+u*A,o[8]=h*_+d*w+p*M+m*D,o[9]=h*g+d*C+p*T+m*L,o[10]=h*O+d*S+p*x+m*I,o[11]=h*j+d*k+p*P+m*A,o[12]=f*_+b*w+v*M+y*D,o[13]=f*g+b*C+v*T+y*L,o[14]=f*O+b*S+v*x+y*I,o[15]=f*j+b*k+v*P+y*A,o},inverse:Re,transformVector:function(e,t,o){o=o||new Ae(4);for(var n=0;n<4;++n){o[n]=0;for(var r=0;r<4;++r)o[n]+=t[r]*e[4*r+n]}return o},transformPoint:function(e,t,o){o=o||new Ae(3);var n=t[0],r=t[1],a=t[2],i=n*e[3]+r*e[7]+a*e[11]+e[15];return o[0]=(n*e[0]+r*e[4]+a*e[8]+e[12])/i,o[1]=(n*e[1]+r*e[5]+a*e[9]+e[13])/i,o[2]=(n*e[2]+r*e[6]+a*e[10]+e[14])/i,o},transformDirection:function(e,t,o){o=o||new Ae(3);var n=t[0],r=t[1],a=t[2];return o[0]=n*e[0]+r*e[4]+a*e[8],o[1]=n*e[1]+r*e[5]+a*e[9],o[2]=n*e[2]+r*e[6]+a*e[10],o},transformNormal:function(e,t,o){o=o||new Ae(3);var n=Re(e),r=t[0],a=t[1],i=t[2];return o[0]=r*n[0]+a*n[1]+i*n[2],o[1]=r*n[4]+a*n[5]+i*n[6],o[2]=r*n[8]+a*n[9]+i*n[10],o},setDefaultType:function(e){var t=Ae;return Ae=e,t}},ze=(Math.floor,Math.random),Ue=(Math.PI,Math.sin,Math.cos,function(e,t){return e+ze()*(t-e)}),We=function(e,t,o,n){return[].concat(Object(Ie.a)(e),Object(Ie.a)(t),Object(Ie.a)(o),Object(Ie.a)(e),Object(Ie.a)(o),Object(Ie.a)(n))},Ke=function(e,t,o,n){return[].concat(Object(Ie.a)(e),Object(Ie.a)(t),Object(Ie.a)(o),Object(Ie.a)(e),Object(Ie.a)(o),Object(Ie.a)(n))},qe=function(e){return[].concat(Object(Ie.a)(e),Object(Ie.a)(e),Object(Ie.a)(e),Object(Ie.a)(e),Object(Ie.a)(e),Object(Ie.a)(e))},Ve=function(e,t,o,n){var r=t[0]-e[0],a=o[1]-e[1],i=Ue(.3*r,.7*r),s=Ue(.3*a,.7*a),c=e[0]+(r-i)/2,l=t[0]-(r-i)/2,u=e[1]+(a-s)/2,h=o[1]-(a-s)/2,d=[c,u,e[2]],p=[l,u,e[2]],m=[l,h,e[2]],f=[c,h,e[2]],b=[];return b.push.apply(b,Object(Ie.a)(We(d,p,m,f)).concat(Object(Ie.a)(We(e,t,p,d)),Object(Ie.a)(We(p,t,o,m)),Object(Ie.a)(We(f,m,o,n)),Object(Ie.a)(We(e,d,f,n)))),b},He=function(e,t){return[].concat(Object(Ie.a)(qe(e)),Object(Ie.a)(qe(t)),Object(Ie.a)(qe(t)),Object(Ie.a)(qe(t)),Object(Ie.a)(qe(t)))},Qe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Ge.yRotation(r);a=Ge.translate(a,t,o,n);for(var i=0;i<e.length;i+=3){var s=Ge.transformPoint(a,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},Ze=function(e,t){for(var o=Ge.yRotation(t),n=0;n<e.length;n+=3){var r=Ge.transformPoint(o,[e[n+0],e[n+1],e[n+2],1]);e[n+0]=r[0],e[n+1]=r[1],e[n+2]=r[2]}},Ye=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=Ge.translation(t,o,n),a=0;a<e.length;a+=3){var i=Ge.transformPoint(r,[e[a+0],e[a+1],e[a+2],1]);e[a+0]=i[0],e[a+1]=i[1],e[a+2]=i[2]}},Je=(Math.floor,Math.random,Math.PI,Math.sin,Math.cos,function(e){var t=e.color1,o=void 0===t?[.2,.1,.1]:t,n=e.color2,r=void 0===n?[1,1,1]:n,a=e.rBase,i=void 0===a?5:a,s=e.hBase,c=void 0===s?5:s,l=e.hBaseToTrunk,u=void 0===l?1:l,h=e.hCapital,d=void 0===h?2:h,p=e.rCapital,m=void 0===p?6:p,f=e.hTrunkToCapital,b=void 0===f?1:f,v=e.hTrunk,y=void 0===v?300:v,_=e.rTrunk,g=void 0===_?3:_,O=Object(Ie.a)(We([-i,0,i],[i,0,i],[i,c,i],[-i,c,i])),j=Object(Ie.a)(qe(o)),w=Ke([.5,0],[1,0],[1,.5],[.5,.5]),C=Object(Ie.a)(We([-i,c,i],[i,c,i],[g,c+u,g],[-g,c+u,g])),S=Object(Ie.a)(qe(r)),k=Ke([0,0],[.5,0],[.5,.5],[0,.5]),M=c+u,T=function(e){for(var t=e.h,o=void 0===t?2:t,n=e.h2,r=void 0===n?30:n,a=e.r,i=void 0===a?10:a,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],d=r-o,p=o;d>0;){var m=Ue(.5,10),f=Ue(.5,4),b=Ue(.5,4),v=Ue(.5,.2),y=m+f+b+v;(d-=y)>5&&h.push({h0:p,h01:p+m,h02:p+m+f,h03:p+m+f+b,h04:p+m+f+b+v,r:Ue(1,10)}),p+=y}var _=[],g=[],O=[];if(0===h.length)_.push.apply(_,Object(Ie.a)(We([-i,o,i],[i,o,i],[i,r,i],[-i,r,i]))),g.push.apply(g,Object(Ie.a)(qe(c))),O.push.apply(O,Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var j=0;j<h.length;++j)_.push.apply(_,Object(Ie.a)(Ve([-i,h[j].h0,i],[i,h[j].h0,i],[i,h[j].h01,i],[-i,h[j].h01,i]))),g.push.apply(g,Object(Ie.a)(He(c,u))),O.push.apply(O,Object(Ie.a)(Ke([.5,.5],[1,.5],[1,1],[.5,1])).concat(Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])))),_.push.apply(_,Object(Ie.a)(We([-i,h[j].h01,i],[i,h[j].h01,i],[h[j].r,h[j].h02,h[j].r],[-h[j].r,h[j].h02,h[j].r]))),g.push.apply(g,Object(Ie.a)(qe(u))),O.push.apply(O,Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1]))),_.push.apply(_,Object(Ie.a)(We([-h[j].r,h[j].h02,h[j].r],[h[j].r,h[j].h02,h[j].r],[h[j].r,h[j].h03,h[j].r],[-h[j].r,h[j].h03,h[j].r]))),g.push.apply(g,Object(Ie.a)(qe(c))),O.push.apply(O,Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1]))),_.push.apply(_,Object(Ie.a)(We([-h[j].r,h[j].h03,h[j].r],[h[j].r,h[j].h03,h[j].r],[i,h[j].h04,i],[-i,h[j].h04,i]))),g.push.apply(g,Object(Ie.a)(qe(u))),O.push.apply(O,Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])));_.push.apply(_,Object(Ie.a)(Ve([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,r,i],[-i,r,i]))),g.push.apply(g,Object(Ie.a)(He(u,c))),O.push.apply(O,Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ie.a)(Ke([0,.5],[.5,.5],[.5,1],[0,1]))))}return{vert:_,col:g,uv:O}}({color1:o,color2:r,h:c+u,h2:y+c+u,r:g}),x=T.vert,P=T.col,D=T.uv;M+=y;var L=Object(Ie.a)(We([-g,M,g],[g,M,g],[m,M+b,m],[-m,M+b,m]));M+=b;var I=Object(Ie.a)(We([-m,M,m],[m,M,m],[m,M+d,m],[-m,M+d,m])),A=Ke([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(Ie.a)(O),Object(Ie.a)(C),Object(Ie.a)(x),Object(Ie.a)(L),Object(Ie.a)(I)),frontColors:[].concat(Object(Ie.a)(j),Object(Ie.a)(S),Object(Ie.a)(P),Object(Ie.a)(S),Object(Ie.a)(j)),frontUV:[].concat(Object(Ie.a)(w),Object(Ie.a)(k),Object(Ie.a)(D),Object(Ie.a)(w),Object(Ie.a)(A))}}),Xe=(Math.floor,Math.random,Math.PI,Math.sin,Math.cos,Math.PI,Math.sin,Math.cos,[1,.1,.1]),$e=[1,1,1],et=function(e){var t=e.h,o=void 0===t?30:t,n=e.arc,r=void 0!==n&&n,a=[],i=[],s=[];if(r){var c=function(e){for(var t=e.color1,o=void 0===t?[.2,.1,.1]:t,n=e.color2,r=void 0===n?[1,1,1]:n,a=e.hStart,i=void 0===a?5:a,s=e.fullH,c=void 0===s?25:s,l=e.r,u=void 0===l?5:l,h=e.wCol,d=void 0===h?3:h,p=(e.zBridge,e.w),m=(void 0===p?40:p)-2*u,f=i,b=i+c,v=Object(Ie.a)(We([-d,f,u],[d,f,u],[d,b,u],[-d,b,u])),y=Object(Ie.a)(qe(r)),_=Object(Ie.a)(qe(o)),g=Ke([0,.5],[.5,.5],[.5,1],[0,1]),O=[].concat(Object(Ie.a)(We([-d,f,-u],[-d,f,u],[-d,b,u],[-d,b,-u])),Object(Ie.a)(We([d,f,u],[d,f,-u],[d,b,-u],[d,b,u]))),j=[].concat(Object(Ie.a)(We([2-d,f,-u],[-d,f,-u],[-d,b,-u],[2-d,b,-u])),Object(Ie.a)(We([d,f,-u],[d-2,f,-u],[d-2,b,-u],[d,b,-u]))),w=[],C=[],S=[],k=2-d,M=d-2,T=10,x=m/T,P=0;P<T;++P){var D=(1-Math.sin((P+1)/T*Math.PI))*c*.7+6,L=(1-Math.sin(P/T*Math.PI))*c*.7+6,I=-u;P+1>5&&(I=-u-m),w.push(k,b-D,-u-(P+1)*x,k,b-L,-u-P*x,k,b,I),C.push.apply(C,Object(Ie.a)(o).concat(Object(Ie.a)(o),Object(Ie.a)(o))),S.push(0,0,0,0,0,0),w.push(M,b-L,-u-P*x,M,b-D,-u-(P+1)*x,M,b,I),C.push.apply(C,Object(Ie.a)(o).concat(Object(Ie.a)(o),Object(Ie.a)(o))),S.push(0,0,0,0,0,0),w.push.apply(w,Object(Ie.a)(We([M,b-L,-u-P*x],[k,b-L,-u-P*x],[k,b-D,-u-(P+1)*x],[M,b-D,-u-(P+1)*x]))),C.push.apply(C,Object(Ie.a)(_)),S.push.apply(S,Object(Ie.a)(Ke([0,0],[0,0],[0,0],[0,0])))}return w.push(k,b-6,-u-x*T/2,k,b,-u,k,b,-u-x*T),C.push.apply(C,Object(Ie.a)(o).concat(Object(Ie.a)(o),Object(Ie.a)(o))),S.push(0,0,0,0,0,0),w.push(M,b-6,-u-x*T/2,M,b,-u-x*T,M,b,-u),C.push.apply(C,Object(Ie.a)(o).concat(Object(Ie.a)(o),Object(Ie.a)(o))),S.push(0,0,0,0,0,0),{vArc:[].concat(Object(Ie.a)(v),Object(Ie.a)(O),Object(Ie.a)(j),w),cArc:[].concat(Object(Ie.a)(y),Object(Ie.a)(y),Object(Ie.a)(y),Object(Ie.a)(y),Object(Ie.a)(y),C),uvArc:[].concat(Object(Ie.a)(g),Object(Ie.a)(g),Object(Ie.a)(g),Object(Ie.a)(g),Object(Ie.a)(g),S)}}(Object(P.a)({hStart:o+7.5,color1:Xe,color2:$e},r));a=c.vArc,i=c.cArc,s=c.uvArc}var l=Je({hTrunk:o,color1:Xe,color2:$e}),u=l.frontVert,h=l.frontColors,d=l.frontUV,p=Object(Ie.a)(u);Qe(p,0,0,0,Math.PI/2);var m=Object(Ie.a)(u);Qe(m,0,0,0,-Math.PI/2);var f=Object(Ie.a)(u);return Qe(f,0,0,0,Math.PI),{vResult:[].concat(Object(Ie.a)(u),Object(Ie.a)(p),Object(Ie.a)(m),Object(Ie.a)(f),Object(Ie.a)(a)),cResult:[].concat(Object(Ie.a)(h),Object(Ie.a)(h),Object(Ie.a)(h),Object(Ie.a)(h),Object(Ie.a)(i)),uvResult:[].concat(Object(Ie.a)(d),Object(Ie.a)(d),Object(Ie.a)(d),Object(Ie.a)(d),Object(Ie.a)(s))}},tt=function(e){Object(Le.a)(e);for(var t=[],o=[],n=[],r=function(){var e=[];return function t(o){if(!(o>1)){if(0===o)e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h:0});else for(var n=100*Math.random()*o+15,r=Math.floor(10*Math.random())+5,a=0;a<r;++a)e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(a/r*Math.PI*2)*n,z:Math.cos(a/r*Math.PI*2)*n,angle:a/r*(2*Math.PI),h:0,arc:{w:n}});t(++o)}}(0),e}(),a=50*Math.random()+10,i=0;i<r.length;++i){var s=r[i],c=s.x,l=s.z,u=s.angle,h=s.arc,d=et({h:a,arc:h}),p=d.vResult,m=d.cResult,f=d.uvResult;Ze(p,u),Ye(p,c,0,l,u),t.push.apply(t,Object(Ie.a)(p)),o.push.apply(o,Object(Ie.a)(m)),n.push.apply(n,Object(Ie.a)(f))}return{vertices:new Float32Array(t),colors:new Float32Array(o),uv:new Float32Array(n)}},ot=function(e){var t=e.materials.wallVirtualColor,o=function(){var e=new y.BufferGeometry,t=tt({}),o=t.vertices,n=t.colors,r=t.uv;return e.setAttribute("position",new y.BufferAttribute(o,3)),e.setAttribute("color",new y.BufferAttribute(n,3)),r&&e.setAttribute("uv",new y.BufferAttribute(r,2)),e.computeVertexNormals(),e}();return new y.Mesh(o,t)},nt=function(){function e(t){var o=this;Object(b.a)(this,e),this._root=t;var n=this._root,r=n.emitter,a=n.car,i=n.dispatcher,s=n.frameUpdater,c=n.studio,l=(n.player,n.system_PlayerMoveOnLevel);i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),i.dispatch({type:"ENABLE_CONTROL_SOUND"}),a.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),r.subscribe("checkNear")((function(e){console.log("checkNear",e),"nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),"nearPerson"===e.item&&console.log("checkNear nearPerson !!!!!!",e)}));var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.floor(t/e),r=Math.floor(o/e),a=n+"_"+r,i=Pe(n,r);return{checkChanged:function(t,o){var n=Math.floor(t/e),r=Math.floor(o/e),s=n+"_"+r;if(s===a)return!1;var c=a;a=s;var l=i;i=Pe(n,r);var u=De(i,l),h=De(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:a,currentEnv:i}}}}(u,a._model.position.x,a._model.position.z),p=d.getCurrent();this._changerLocations=rt(this._root),this._changerLevelTresh=at(this._root),this._changerLevelTresh.createTresh(p.currentEnv),s.on((function(e){if(l.update(e),!a.isFreeze){a.update(e);var t=d.checkChanged(a._model.position.x,a._model.position.z);if(t&&(console.log("quadrants data",t),o._changerLevelTresh.updateTrash(t.removedQs,t.addedQs),h[t.oldKey]&&o._changerLocations.removeLocationFromScene(h[t.oldKey]),h[t.newKey])){var n=t.newKey.split("_"),r=+n[0]*u+u/2,i=+n[1]*u+u/2;o._changerLocations.addLocationToScene(h[t.newKey],r,i)}}c.drawFrame()})),this._startPlay()}return Object(v.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,o=e.system_PlayerMoveOnLevel,n=e.car;o.toggleFreeze(!0),n.toggleFreeze(!1),t.setCamera(n.getCamera())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,o=e.player,n=e.studio,r=e.car,a=r.getPosition(),i=r.getQuaternion();n.setCamera(o.getCamera()),r.toggleFreeze(!0),t.toggleFreeze(!1),o.setToPos(a.x,o.mesh.position.y,a.z),o.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key,o=null;for(var n in h)h[n]===t&&(o=n);if(o){var r=o.split("_"),a=+r[0]*u+u/2,i=+r[1]*u+u/2;this._root.car.setTargetPosition(new y.Vector3(a,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,o=e.ui,n=e.studio,r=e.car,a=e.system_Level,i=e.system_PlayerMoveOnLevel;e.system_PlayerNearLevelItems.setItemToCheck(r.getModel(),"nearStarterDrawCar",28),n.addToScene(r.getModel()),i.addItemToPlayerCollision(r.getCollision()),setTimeout((function(){var e=0,t=null;for(var o in h)0===e&&(t=o),++e;var n=t.split("_"),a=+n[0]*u+u/2,i=+n[1]*u+u/2;r.setTargetPosition(new y.Vector3(a,0,i))}),500),a._items.body.position.fromArray([-20,-60,-50]),a._items.body.rotation.fromArray([0,2,0]),n.addToScene(a._items.body),o.showStartButton((function(){t.toggleBlocked(!1)}))}}]),e}(),rt=function(e){var t=e.studio,o=e.car,n=e.system_Level,r=e.system_PlayerMoveOnLevel,a=e.system_PlayerNearLevelItems;for(var i in h){var s=new y.Mesh(new y.BoxGeometry(55,1e3,55),new y.MeshBasicMaterial({color:16711680})),c=i.split("_");s.position.set(+c[0]*u+u/2,4100,+c[1]*u+u/2),t.addToScene(s)}setTimeout((function(){for(var e in h){var o=e.split("_"),r=+o[0]*u+u/2,a=+o[1]*u+u/2;n.locations[h[e]].mesh.position.set(r,0,a),t.addToScene(n.locations[h[e]].mesh)}}),500);return{removeLocationFromScene:function(e){var i=n.locations[e],s=i.mesh,c=i.carCollision,l=i.personCollision;r.removeItemFromPlayerCollision(s),t.removeFromScene(c),o.removeCollisionForDraw(c),t.removeFromScene(l),a.removeItemFromCheck(l)},addLocationToScene:function(e,i,s){var c=n.locations[e],l=c.mesh,u=c.carCollision,h=c.personOffset,d=c.personCollision;l.position.set(i,0,s),r.addItemToPlayerCollision(l),u.position.set(i,0,s),t.addToScene(u),o.setCollisionForDraw(u),d.position.set(h[0]+i,h[1],h[2]+s),t.addToScene(d),a.setItemToCheck(d,"nearPerson_"+e,28)}}},at=function(e){var t=e.studio,o=e.car,n=e.system_PlayerMoveOnLevel,r=e.materials,a=[],i=ot(e);console.log("!!!",i),i.position.set(0,-60,-40),t.addToScene(i);var s=new y.BoxGeometry(45,50,45),c=r.wallVirtual,l=new y.PlaneGeometry(u,u),h=function(r){for(var i=0;i<r.length;++i){var h=r[i].split("_"),d=+h[0]*u,p=+h[1]*u,m=new y.Mesh(l,c);m.rotation.x=-Math.PI/2,m.position.set(d,-62,p),t.addToScene(m),a.push({mesh:m,keyLocation:r[i],type:"floor"}),n.addItemToPlayerCollision(m);for(var f=Math.floor(10*Math.random()),b=0;b<f;++b){console.log("!!!!!!!!!!!!!!!!! new tresh");var v=ot(e);v.position.set(d+Math.random()*u,-60,p+Math.random()*u),t.addToScene(v),n.addItemToPlayerCollision(v);var _=new y.Mesh(s,c);_.visible=!1,_.position.copy(v.position),t.addToScene(_),o.setCollisionForDraw(_),a.push({mesh:v,meshCollision:_,keyLocation:r[i],type:"trash"})}}};return{updateTrash:function(e,r){!function(e){for(var r=[],i=0;i<e.length;++i)for(var s=0;s<a.length;++s)e[i]===a[s].keyLocation&&r.push(a[s]);a=a.filter((function(t){for(var o=0;o<e.length;++o)if(t.keyLocation===e[o])return!1;return!0}));for(var c=0;c<r.length;++c){var l=r[c],u=l.mesh,h=l.meshCollision;t.removeFromScene(u),n.removeItemFromPlayerCollision(u),h&&(t.removeFromScene(h),o.removeCollisionForDraw(h)),r[c].mesh.geometry.dispose(),delete r[c].mesh,delete r[c].meshCollision}}(e),h(r)},createTresh:function(e){h(e)}}},it=(o(44),{ru:{"What is this place?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","It's The Great Way to the surface.":"\u042d\u0442\u043e \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0435\u0440\u0445.","Who are you?":"\u041a\u0442\u043e \u0442\u044b?","I help The Creator.":"\u042f \u043f\u043e\u043c\u043e\u0433\u0430\u044e \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044e.","What are you doing?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Don't distract me, I have to dig the tunnel.":"\u041d\u0435 \u043e\u0442\u0432\u043b\u0435\u043a\u0430\u0439, \u043c\u043d\u0435 \u043d\u0430\u0434\u043e \u043a\u043e\u043f\u0430\u0442\u044c \u0442\u0443\u043d\u043d\u0435\u043b\u044c.","Such enormous dungeons...":"\u0422\u0430\u043a\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u043e\u0434\u0437\u0435\u043c\u0435\u043b\u044c\u044f...","The Creator gave the order to dig.":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0438\u043a\u0430\u0437\u0430\u043b \u043a\u043e\u043f\u0430\u0442\u044c. ","How long have you been digging?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0432\u044b \u043a\u043e\u043f\u0430\u043b\u0438? ","Time does not matter, the goal is what's important.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0430\u0436\u043d\u0430 \u0446\u0435\u043b\u044c. ","What do you do here?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Long ago, the Creator fell under the ground. He created us and gave us an assignment to dig.":"\u0414\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0422\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b\u0441\u044f \u043f\u043e\u0434 \u0437\u0435\u043c\u043b\u044e. \u041e\u043d \u0441\u043e\u0437\u0434\u0430\u043b \u043d\u0430\u0441 \u0438 \u0434\u0430\u043b \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043f\u0430\u0442\u044c. ","But you already dug the way out...":"\u041d\u043e \u0432\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u0432\u044b\u0445\u043e\u0434 ...","When we dug a tunnel, The Creator went through it.":"\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u043f\u0443\u0442\u044c, \u0442\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0448\u0435\u043b \u043f\u043e \u043d\u0435\u043c\u0443.","And...":"\u0418...","We are made to dig. And we keep on doing it. We believe that he will return to us.":"\u041c\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u043f\u0430\u0442\u044c. \u0418 \u043c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c. \u041c\u044b \u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043e\u043d \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043a \u043d\u0430\u043c. ","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),st=L(it),ct=Object(T.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(I.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(I.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:st(t.q)},Math.floor(1e5*Math.random()))}))})})),lt=L(it),ut=Object(T.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(I.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(I.jsxs)("div",{children:[Object(I.jsx)("div",{className:"q",children:lt(e.q)}),Object(I.jsx)("div",{className:"a",children:lt(e.a)})]},Math.floor(1e5*Math.random()))}))})})),ht=L(it);var dt=Object(T.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocation:e.ui.currentLocation,locationsList:e.ui.locationsList}}))((function(e){return Object(I.jsxs)(I.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(I.jsx)("div",{className:"dialog-wrapper",children:Object(I.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(I.jsxs)("div",{className:"messages-wrapper",children:[Object(I.jsx)(ut,{}),Object(I.jsx)(ct,{})]}),e.isButtonDialog&&Object(I.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?ht("close dialog"):ht("open dialog")})]})}),e.isShowButtonDrawCar&&Object(I.jsx)("div",{className:"dialog-wrapper",children:Object(I.jsx)("div",{className:"dialog-content",children:Object(I.jsx)("button",{className:"draw-car-button",onClick:function(){return e.dispatch({type:"CLICK_DRAW"})},children:ht(e.valButtonDrawCar)})})}),e.isShowButtonToggleOpenLocationsList&&!e.isLocationListOpened&&Object(I.jsx)("button",{className:"open-locations-car-button",onClick:function(){return e.dispatch({type:"OPEN_LOCATIONS_LIST"})},children:e.currentLocation}),e.isLocationListOpened&&Object(I.jsx)("div",{className:"list-locations",children:Object(I.jsx)("div",{children:e.locationsList.map((function(t){return Object(I.jsxs)("button",{onClick:function(){return e.dispatch({type:"SELECT_LOCATION",location:t})},children:[t,e.currentLocation===t&&"___v"]},Math.floor(1e6*Math.random()))}))})}),e.isShowFinalMessage&&Object(I.jsx)("div",{className:"final-mess",children:ht("To be continued")})]})})),pt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"draw car",currentBot:null,phraseIndex:0,isDialogComplete:!1,isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocation:"location01",locationsList:["location01","location02","location03"]},mt=[{key:"emitter",constr:w,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(b.a)(this,e);var o=t.emitter,n=t.appWrapper;!n&&(n=document.querySelector(".app-wrapper")),o.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&r()}));var r=function(){n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()},a=function(e){n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||o.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",a),a()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:j,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:H,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(b.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return Q.a()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:te,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:oe,initStateKey:"beforeStartPlay"},{key:"player",constr:ne,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:xe,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(b.a)(this,e);var o=t.assets,n=t.CONSTANTS;t.materials=re(o,n.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"car",constr:Ce,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:Se,key:"car"},{type:"obj",path:ke,key:"carCollision"}]},{key:"system_Level",constr:function e(t){Object(b.a)(this,e),this._root=t;var o=t.assets,n=t.materials,r=ae(o,n).items;this._items=r,console.log("system_level_items",this._items),r.body.material=n.car,this._items.location_collision_01.visible=!1,this._items.location_collision_02.visible=!1,this._items.location_collision_03.visible=!1;var a=new y.Mesh(new y.BoxGeometry(15,15,15),new y.MeshBasicMaterial({color:16776960}));this._items.location01_person.geometry.computeBoundingSphere();var i=[this._items.location01_person.geometry.boundingSphere.center.x,this._items.location01_person.geometry.boundingSphere.center.y,this._items.location01_person.geometry.boundingSphere.center.z];this._items.location02_person.geometry.computeBoundingSphere();var s=[this._items.location02_person.geometry.boundingSphere.center.x,this._items.location02_person.geometry.boundingSphere.center.y,this._items.location02_person.geometry.boundingSphere.center.z];this._items.location03_person.geometry.computeBoundingSphere();var c=[this._items.location03_person.geometry.boundingSphere.center.x,this._items.location03_person.geometry.boundingSphere.center.y,this._items.location03_person.geometry.boundingSphere.center.z];this.locations={location01:{mesh:this._items.location01,carCollision:this._items.location_collision_01,personOffset:i,personCollision:a},location02:{mesh:this._items.location02,carCollision:this._items.location_collision_02,personOffset:s,personCollision:a},location03:{mesh:this._items.location03,carCollision:this._items.location_collision_03,personOffset:c,personCollision:a}}},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:ie,key:"level-rooms"},{type:"obj",path:Me,key:"body"},{type:"cubeTextures",path:[he,de,pe,me,fe,be],key:"skyBox"},{type:"cubeTextures",path:[ve,ye,_e,ge,Oe,je],key:"skyBox2"},{type:"img",path:se,key:"mapFloorOuter",wrap:!0},{type:"img",path:le,key:"mapTop",wrap:!0},{type:"img",path:ce,key:"mapVirtual",wrap:!0},{type:"img",path:ue,key:"mapParams"}]},{key:"system_PlayerMoveOnLevel",constr:Te,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(b.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=dt,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pt,o=arguments.length>1?arguments[1]:void 0;if("OPEN_LOCATIONS_LIST"===o.type)return Object(P.a)(Object(P.a)({},t),{},{isLocationListOpened:!0});if("SELECT_LOCATION"===o.type)return e.actions.changeTargetLocation({key:o.location}),Object(P.a)(Object(P.a)({},t),{},{isLocationListOpened:!1,currentLocation:o.location});if("CLICK_PHRASE"===o.type)return Object(P.a)(Object(P.a)({},t),{},{botAnswers:[].concat(Object(Ie.a)(t.botAnswers),[o.phrase]),userReplicies:[]});if("PHRASE_EVENT"===o.type){var n=o.phrase,r=n.event;if(n.levelEvent,"nextReply"===r){var a=[t.phrasesData[t.currentBot][t.phraseIndex+1]];return Object(P.a)(Object(P.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:a})}if("close"===r)return 20===t.currentBot&&setTimeout((function(){e.dispatcher.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),e.dispatcher.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!1}),e.player.toggleBlocked(!0),setTimeout((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),Object(P.a)(Object(P.a)({},t),{},{userReplicies:[],isDialogComplete:!0,isButtonDialog:!0})}if("TOGGLE_DIALOG"===o.type){var i=[];return e.player.toggleBlocked(o.isShowPalleteDialog),o.isShowPalleteDialog&&(i=t.isDialogComplete?[]:[t.phrasesData[t.currentBot][t.phraseIndex]]),Object(P.a)(Object(P.a)({},t),{},{isShowPalleteDialog:o.isShowPalleteDialog,userReplicies:i})}if("TOGGLE_BUTTON"===o.type){var s=t.botAnswers,c=t.phraseIndex,l=t.isDialogComplete;return o.currentBot&&o.currentBot!==t.currentBot&&(s=[],c=0,l=!1),Object(P.a)(Object(P.a)({},t),{},{phraseIndex:c,currentBot:o.currentBot||t.currentBot,isButtonDialog:o.isButtonDialog,isDialogComplete:l,botAnswers:s})}return"SHOW_FINAL_MESSAGE"===o.type?Object(P.a)(Object(P.a)({},t),{},{isShowFinalMessage:!0}):"TOGGLE_BUTTON_DRAW_CAR"===o.type?Object(P.a)(Object(P.a)({},t),{},{isShowButtonDrawCar:o.is}):"CLICK_DRAW"===o.type?"draw car"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(P.a)(Object(P.a)({},t),{},{valButtonDrawCar:"exit car"})):(e.actions.clickMachineExit(),Object(P.a)(Object(P.a)({},t),{},{valButtonDrawCar:"draw car"})):t}}}(t);var o=new q(t);t.ui=o},initStateKey:"pageLoaded"},{key:"actions",constr:nt,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(mt,n)}))}},[[45,1,2]]]);
//# sourceMappingURL=main.56ef59ee.chunk.js.map