(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{39:function(e,t,o){},41:function(e,t,o){},43:function(e,t,o){},44:function(e,t,o){"use strict";o.r(t);var a={};o.r(a),o.d(a,"SIZE_QUADRANT",(function(){return u})),o.d(a,"LOCATIONS_QUADRANTS",(function(){return h})),o.d(a,"CONFIG_FOR_INIT",(function(){return p})),o.d(a,"lCol",(function(){return b})),o.d(a,"lW",(function(){return m})),o.d(a,"MATERIALS_CONFIG",(function(){return d})),o.d(a,"START_ENV_CONFIG",(function(){return f})),o.d(a,"studioConfig",(function(){return O})),o.d(a,"playerConfig",(function(){return j}));var n=o(11),r=o.n(n),i=o(12);function s(){return(s=Object(i.a)(r.a.mark((function e(t,o){var a,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,a={CONSTANTS:o}),n=a.loaderAssets,i=l(t),e.next=6,n.loadAssets(i);case 6:a.assets=e.sent,c("beforeStartPlay",t,a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,o){for(var a=0;a<t.length;++a){var n=t[a],r=n.key,i=n.constr;n.initStateKey===e&&(o[r]=new i(o))}},l=function(e){for(var t=[],o=0;o<e.length;++o)if(e[o].assetsToLoad&&e[o].assetsToLoad.length)for(var a=0;a<e[o].assetsToLoad.length;++a)t.push(e[o].assetsToLoad[a]);return t},u=5e3,h={"0_0":"location01","0_-3":"location02","3_-1":"location03"},p={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},b=[.3,1,.3],m=.2,d={wallVirtual:{mat:"MeshStandardMaterial",props:{color:16711935,emissive:0}},wallVirtualColor:{mat:"MeshBasicMaterial",props:{color:16777215,emissive:4369,map:"mapParams",bumpMap:"mapParams",bumpScale:.1,specular:255,vertexColors:!0}},car:{mat:"MeshPhongMaterial",props:{color:255,emissive:0,reflectivity:.5,shininess:.5,specular:16777215}},floorMat:{mat:"MeshBasicMaterial",props:{color:26112}},testRed:{mat:"MeshBasicMaterial",props:{color:16711680}}},f={fogNear:1e3,fogFar:3e3,color:0,backgroundImgKey:"skyBox"},O={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},sceneEnvironment:f,composerAddPass:"Saturate"},j={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},v=o(2),y=o(3),g=o(1),_=o(21),C=o(22),w=function(){var e=null,t=null,o=null,a=null,n=null;return function(r,i){return new Promise((function(s){(function(r){return"obj"===r?e=e||new _.a:"glb"===r||"gltf"===r?o=o||new C.a:"img"===r?t=t||new g.TextureLoader:"cubeTextures"===r?a=a||new g.CubeTextureLoader:"soundMp3"===r?n=n||new g.AudioLoader:void 0})(i).load(r,s)}))}},S=function(){function e(){Object(v.a)(this,e),this.resources={},this._load=w()}return Object(y.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(o){var a=t._load,n=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(r.a.mark((function t(i){var c,l,u,h;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,a(u,h);case 4:n[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}o(n),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),T=function(){function e(){Object(v.a)(this,e),this._storage={}}return Object(y.a)(e,[{key:"emit",value:function(e){var t=this;return function(o){return M(t._storage)(e).forEach((function(e){return e(o)}))}}},{key:"subscribe",value:function(e){var t=this;return function(o){return M(t._storage)(e).push(o),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==o}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),M=function(e){return function(t){return e[t]=e[t]||[]}},x=o(5),k=o(17),P=o.n(k),A=o(8),L=o(10),D=o(6),I=(o(39),"en"),E=function(e){return function(t){return e[I]&&e[I][t]||t}},B=o(4),N=E({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),F=Object(A.b)((function(e){return Object(D.a)({},e.controls.infoPanelData)}))((function(e){return Object(B.jsxs)("div",{className:"info",children:[Object(B.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(B.jsxs)("div",{className:"info-inner",children:[Object(B.jsx)("p",{children:N(e.title)}),Object(B.jsx)("p",{children:N(e.topText)}),Object(B.jsx)("ul",{children:e.chapters.map((function(t,o){return Object(B.jsxs)("li",{children:[o+1,".\xa0",t.href?Object(B.jsx)("span",{children:Object(B.jsx)("a",{href:t.href,target:"blank",children:N(t.text)})}):Object(B.jsx)("span",{children:N(t.text)}),o===e.currentChapterIndex&&N(" (current)")]},o)}))}),Object(B.jsx)("p",{children:e.bottomText}),Object(B.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(B.jsxs)("li",{children:[N(e.text),Object(B.jsx)("a",{href:e.href,target:"blank",children:N(e.aText)})]},t)}))})]})]})})),R=(o(41),Object(A.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(x.useState)(!0),o=Object(L.a)(t,2),a=o[0],n=o[1];return Object(x.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&n(!0)}))})),Object(B.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(B.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(B.jsx)(B.Fragment,{children:"\u27fc"}):Object(B.jsx)(B.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(B.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(B.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(B.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(B.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&a&&Object(B.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),n(!1)},children:"\u2752"}),!e.isInfo&&Object(B.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(B.jsx)(F,{})]})})));var G={dispatch:null},z=Object(A.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!G.dispatch&&(G.dispatch=e.dispatch),Object(B.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(B.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(B.jsx)(R,{gameContext:e.gameContext})]})})),W=o(15),U=o(24),K={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var V=document.querySelector(".progress"),q=-100,H=!0;!function e(){H&&setTimeout((function(){0===++q&&(q-=100),V.style.marginLeft=q+"%",e()}),30)}();var Q=function(){function e(t){Object(v.a)(this,e),t.dispatcher=G,this._root=t;var o=function(e){e.customStore||(e.customStore={});var t=Object(W.b)(Object(D.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(D.a)(Object(D.a)({},e),{},{infoPanelData:Object(D.a)(Object(D.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(D.a)(Object(D.a)({},e),{},{isMute:t.is}):Object(D.a)({},e)}},e.customStore)),o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||W.c;return Object(W.d)(t,o(Object(W.a)(U.a)))}(t);o&&P.a.render(Object(B.jsx)(A.a,{store:o,children:Object(B.jsx)(z,{gameContext:t})}),document.getElementById("root"))}return Object(y.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),o=document.querySelector(".progress-wrapper"),a=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,I=t),document.querySelector(".start-screen").style.display="none"};H=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),a(t)})),o.style.display="none"}}]),e}(),Z=o(46),X=function(){function e(){var t=this;Object(v.a)(this,e),this._subscribers=[];var o={time:0,delta:0,count:0,oldTime:0},a=Z.a((function(){return o}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var o=0;o<t._subscribers.length;++o)t._subscribers[o](Object(D.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return o=e}));!function e(){requestAnimationFrame(e),a(o)}()}return Object(y.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),Y=o(19),J=o(27),$=o(26),ee=o(14),te={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},oe={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},ae=o(25),ne=function(){function e(t){var o=this;Object(v.a)(this,e),this._root=t;var a=t.assets,n=t.emitter,r=t.CONSTANTS.studioConfig,i=r.canId,s=r.rendererCon,c=(r.clearColor,r.amb);s.canvas=document.getElementById(i),this._renderer=new g.WebGLRenderer(s),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new g.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,u=l.color,h=l.fogNear,p=l.fogFar,b=l.backgroundImgKey;this._scene.background=a[b]||null,this._scene.fog=new g.Fog(u,h,p);c.color,c.strength;this._lightA=new g.AmbientLight(16777215,.2),this._scene.add(this._lightA);var m=new g.DirectionalLight(16777215,.6);m.position.set(1,1,.5),this._scene.add(m);var d=new g.DirectionalLight(16777215,.4);d.position.set(-1,-.1,-.4),this._scene.add(d),this._playerCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var f=new ae.a(this._controlsCamera,this._renderer.domElement);f.target.set(0,0,0),f.update(),this._composer=new J.a(this._renderer),this._renderPass=new $.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(te)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(oe)));var O=new g.Vector3,j=!0;n.subscribe("keyEvent")((function(e){e.o&&(j?(j=!1,o._renderPass.camera=o._controlsCamera,o._playerCamera.getWorldPosition(O),o._controlsCamera.position.x=O.x+100,o._controlsCamera.position.y=O.y+100,o._controlsCamera.position.z=O.z,f.target.set(O.x,O.y,O.z),f.update()):(j=!0,o._renderPass.camera=o._playerCamera))}));var y=function(){var e={width:window.innerWidth,height:window.innerHeight};o._renderer.setSize(e.width,e.height),o._composer.setSize(e.width,e.height),o._controlsCamera&&(o._controlsCamera.aspect=e.width/e.height,o._controlsCamera.updateProjectionMatrix()),o._playerCamera&&(o._playerCamera.aspect=e.width/e.height,o._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",y),y(),this.addToScene=function(e){return o._scene.add(e)},this.removeFromScene=function(e){return o._scene.remove(e)},this.drawFrame=function(){o._composer.render(o._scene,o._controlsCamera)},n.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(y.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),re=function(){function e(t){Object(v.a)(this,e);var o=t.emitter,a={up:!1,down:!1,left:!1,right:!1,p:!1},n={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=n,this.keys=a;var r=function(e,t){switch(e){case 38:case 87:n.up&&(a.up=t);break;case 40:case 83:n.down&&(a.down=t);break;case 37:case 65:a.left=t;break;case 39:case 68:a.right=t;break;case 79:a.o=t;break;case 80:a.p=t}o.emit("keyEvent")(a)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),o.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),o.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(y.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ie=function(){function e(t){Object(v.a)(this,e);var o=t.studio,a=t.CONSTANTS.playerConfig,n=(a.startPos,a.startRot,a.cameraData),r=(a.frontObjPos,a.backObjPos,a.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new g.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new g.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new g.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new g.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=n.fov,s=n.ratio,c=n.near,l=n.far;n.pos;if(this._camera=new g.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),r){var u=r.color,h=r.strenth,p=r.pos,b=new g.PointLight(u,h);b.position.fromArray(p),this.mesh.add(b)}o.setCamera(this._camera),o.addToScene(this.mesh)}return Object(y.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,o){this.mesh.position.set(e,t,o)}}]),e}(),se=function(e,t){for(var o in e)e[o].wrapS&&(e[o].wrapS=e[o].wrapT=g.RepeatWrapping);var a=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],n={},r=function(o){n[o]=new g[t[o].mat](Object(D.a)({},t[o].props)),a.map((function(a){return t[o].props[a]&&(n[o][a]=e[t[o].props[a]])}))};for(var i in t)r(i);return n},ce=function(e,t){var o={};return e["level-rooms"].traverse((function(e){e.geometry&&(o[e.name]=e,e.material=t.wallVirtual),e.name.includes("level")&&("level_000_000"===e.name&&(new g.Mesh(e.geometry,t.wallVirtual).name=e.name),"level_001_000"===e.name&&(new g.Mesh(e.geometry,t.wallVirtual).name=e.name))})),{items:o}},le=o.p+"static/media/level.21832d73.obj",ue=o.p+"static/media/floor_outer_map3.558e9646.jpg",he=(o.p,o.p+"static/media/map01.48219503.jpg"),pe=o.p+"static/media/floor_outer_map.35e50f6e.jpg",be=o.p+"static/media/txt1.b67888d5.jpg",me=(o.p,o.p+"static/media/nx.a038c501.jpg"),de=(o.p,o.p,o.p,o.p,o.p+"static/media/px.96d0b65f.jpg"),fe=o.p+"static/media/nx.8cbf039d.jpg",Oe=o.p+"static/media/py.659ebc34.jpg",je=o.p+"static/media/ny.09051a4e.jpg",ve=o.p+"static/media/pz.a1539724.jpg",ye=o.p+"static/media/nz.0bc769f7.jpg",ge=function(){function e(){Object(v.a)(this,e),this._arrMeshes=[],this._vecStart=new g.Vector3,this._vecDir=new g.Vector3,this._rayCaster=new g.Raycaster(this._vecStart,this._vecDir)}return Object(y.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,o){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var a=this._rayCaster.intersectObjects(this._arrMeshes);return a[0]&&a[0].distance<o?[!0,a[0]]:[!1,null]}}]),e}(),_e=function(){function e(t){var o=this;Object(v.a)(this,e);var a=t.assets,n=t.CONSTANTS,r=t.emitter,i=t.materials,s=(t.system_Level,n.CONFIG_FOR_INIT.currentSceneConfig.carProps),c=s.position,l=s.rotation;this._model=a.car.children[0],this._model.material=i.car,this._camera=new g.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=28,this._model.add(this._camera),this._model.position.fromArray(c),this._model.rotation.fromArray(l),this._collision=a.carCollision.children[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new g.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new g.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){o._compass=function(e){e.assets;var t=e.studio,o=e.system_Level._items.arrow;o.material=e.materials.car;var a=new g.Mesh(new g.BoxGeometry(10,10,10),new g.MeshBasicMaterial({color:16711680}));a.position.set(-500,-30,-500),t.addToScene(a);var n=new g.Mesh(new g.BoxGeometry(10,10,10),new g.MeshBasicMaterial({color:16711680}));return n.position.set(0,0,0),t.addToScene(a),new g.Vector3,{addToParent:function(e){e.add(o)},setArrowPosition:function(e,t,a){o.position.set(e,t,a)},setTargetPosition:function(e){a.position.copy(e)},update:function(){n.position.copy(o.parent.position),n.lookAt(a.position),o.parent.position.z<a.position.z?o.rotation.y=-o.parent.rotation.y+n.rotation.y:o.rotation.y=-o.parent.rotation.y-n.rotation.y+Math.PI}}}(t),o._compass.addToParent(o._model),o._compass.setArrowPosition(0,23,-11.5),o.setTargetPosition=function(e){o._compass.setTargetPosition(e),o._compass.update()}})),this._collisionsWalls=new ge;var u=function(e,t){var a=o._collisionsWalls.checkCollisions(o._model,e,t);return Object(L.a)(a,1)[0]};this.isFreeze=!0;var h={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!o.isFreeze){if(o._spd<0&&(u(o._frontObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),o._spd>0&&(u(o._backObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),h.up&&(o._spd-=o._acc),h.down&&(o._spd+=o._acc),Math.abs(o._spd)>.001){o._spd>0&&(o._spd-=o._deceleration,o._spd<0&&(o._spd=0)),o._spd<0&&(o._spd+=o._deceleration,o._spd>0&&(o._spd=0)),o._spd=Math.min(o._maxSpdBack,Math.max(o._maxSpdFront,o._spd));var t=Math.min(1,Math.max(0,Math.abs(o._spd)));h.left&&(o._spd<0&&(o._model.rotation.y+=o._spdRot*t),o._spd>0&&(o._model.rotation.y-=o._spdRot*t)),h.right&&(o._spd<0&&(o._model.rotation.y-=o._spdRot*t),o._spd>0&&(o._model.rotation.y+=o._spdRot*t))}else o._spd=0;o._isCarStay&&0!==o._spd&&(o._isCarStay=!1,o._onChangeStateIsStay("carStart")),o._isCarStay||0!==o._spd||(o._isCarStay=!0,o._onChangeStateIsStay("carStop"))}},r.subscribe("keyEvent")((function(e){return h=e}))}return Object(y.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}}]),e}(),Ce=o.p+"static/media/car.8c016cb9.obj",we=o.p+"static/media/car_collision.66478aff.obj",Se=o.p+"static/media/body.bb8da675.obj",Te=function(){function e(t){var o=this;Object(v.a)(this,e);var a=t.emitter,n=t.CONSTANTS,r=t.player;t.assets,t.studio;r.mesh.position.fromArray([0,0,0]);var i=new ge,s=n.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;r.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},r.toggleCanMove=function(e,t){return o.isCanMove[e]=t},this.isFreeze=!1;var p={};this.update=function(e){o.isFreeze||(p.left&&r.mesh.rotateY(u*e.count),p.right&&r.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(r.mesh,r.bottomObj,17.2),o=Object(L.a)(t,2),a=o[0],n=o[1];a&&17>n.distance?r.mesh.translateY(17-n.distance):a||(r.mesh.position.y+=l*e.count)}(e),p.up&&o.isCanMove.forward&&function(e){var t=i.checkCollisions(r.mesh,r.frontObj,17),o=Object(L.a)(t,2),n=o[0],s=o[1];n?s.object.userData.type&&"alert"===s.object.userData.type&&a.emit("collision")(s.object.userData.event):(r.mesh.translateZ(-c*e.count),a.emit("playerMove")("forward"))}(e),p.down&&o.isCanMove.back&&function(e){var t=i.checkCollisions(r.mesh,r.backObj,17);Object(L.a)(t,1)[0]||(r.mesh.translateZ(c*e.count),a.emit("playerMove")("back"))}(e),p.p&&console.log("player.mesh.position.fromArray([".concat(r.mesh.position.x,", ").concat(r.mesh.position.y,", ").concat(r.mesh.position.z,"])"))))},a.subscribe("keyEvent")((function(e){return p=e})),this._collisionsWalls=i}return Object(y.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),Me=function(){function e(t){var o=this;Object(v.a)(this,e),this._root=t;var a=t.emitter,n=t.player;this._itemsToCheck=[],a.subscribe("playerMove")((function(){for(var e=0;e<o._itemsToCheck.length;++e){var t=n.mesh.position.distanceTo(o._itemsToCheck[e].position);if(!o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<o._itemsToCheck[e].userData.nearPlayerItemNear)return o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void a.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>o._itemsToCheck[e].userData.nearPlayerItemNear&&(o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,a.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(y.a)(e,[{key:"setItemToCheck",value:function(e,t,o,a){for(var n=0;n<this._itemsToCheck.length;++n)if(e===this._itemsToCheck[n])return;t&&(e.userData.nearPlayerItemKey=t),o&&(e.userData.nearPlayerItemNear=o),a&&(e.userData.nearPlayerItemFar=a),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),xe=function(e,t){for(var o=[],a=e-1;a<e+2;++a)for(var n=t-1;n<t+2;++n)o.push(a+"_"+n);return o},ke=function(e,t){for(var o=[],a=0;a<e.length;++a){for(var n=!1,r=0;r<t.length;++r)e[a]===t[r]&&(n=!0);n||o.push(e[a])}return o},Pe=o(0),Ae=Float32Array;function Le(e,t,o){return(o=o||new Ae(3))[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],o}function De(e,t){t=t||new Ae(3);var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return o>1e-5&&(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t}function Ie(e,t,o){return(o=o||new Ae(3))[0]=e[1]*t[2]-e[2]*t[1],o[1]=e[2]*t[0]-e[0]*t[2],o[2]=e[0]*t[1]-e[1]*t[0],o}function Ee(e,t){var o=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return o*o+a*a+n*n}function Be(e,t){t=t||new Ae(16);var o=e[0],a=e[1],n=e[2],r=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],p=e[10],b=e[11],m=e[12],d=e[13],f=e[14],O=e[15],j=p*O,v=f*b,y=c*O,g=f*l,_=c*b,C=p*l,w=n*O,S=f*r,T=n*b,M=p*r,x=n*l,k=c*r,P=u*d,A=m*h,L=i*d,D=m*s,I=i*h,E=u*s,B=o*d,N=m*a,F=o*h,R=u*a,G=o*s,z=i*a,W=j*s+g*h+_*d-(v*s+y*h+C*d),U=v*a+w*h+M*d-(j*a+S*h+T*d),K=y*a+S*s+x*d-(g*a+w*s+k*d),V=C*a+T*s+k*h-(_*a+M*s+x*h),q=1/(o*W+i*U+u*K+m*V);return t[0]=q*W,t[1]=q*U,t[2]=q*K,t[3]=q*V,t[4]=q*(v*i+y*u+C*m-(j*i+g*u+_*m)),t[5]=q*(j*o+S*u+T*m-(v*o+w*u+M*m)),t[6]=q*(g*o+w*i+k*m-(y*o+S*i+x*m)),t[7]=q*(_*o+M*i+x*u-(C*o+T*i+k*u)),t[8]=q*(P*l+D*b+I*O-(A*l+L*b+E*O)),t[9]=q*(A*r+B*b+R*O-(P*r+N*b+F*O)),t[10]=q*(L*r+N*l+G*O-(D*r+B*l+z*O)),t[11]=q*(E*r+F*l+z*b-(I*r+R*l+G*b)),t[12]=q*(L*p+E*f+A*c-(I*f+P*c+D*p)),t[13]=q*(F*f+P*n+N*p-(B*p+R*f+A*n)),t[14]=q*(B*c+z*f+D*n-(G*f+L*n+N*c)),t[15]=q*(G*p+I*n+R*c-(F*c+z*p+E*n)),t}var Ne={copy:function(e,t){return(t=t||new Ae(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,o,a){a=a||new Ae(16);var n=De(Le(e,t)),r=De(Ie(o,n)),i=De(Ie(n,r));return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=0,a[4]=i[0],a[5]=i[1],a[6]=i[2],a[7]=0,a[8]=n[0],a[9]=n[1],a[10]=n[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},addVectors:function(e,t,o){return(o=o||new Ae(3))[0]=e[0]+t[0],o[1]=e[1]+t[1],o[2]=e[2]+t[2],o},subtractVectors:Le,scaleVector:function(e,t,o){return(o=o||new Ae(3))[0]=e[0]*t,o[1]=e[1]*t,o[2]=e[2]*t,o},distance:function(e,t){return Math.sqrt(Ee(e,t))},distanceSq:Ee,normalize:De,compose:function(e,t,o,a){a=a||new Ae(16);var n=t[0],r=t[1],i=t[2],s=t[3],c=n+n,l=r+r,u=i+i,h=n*c,p=n*l,b=n*u,m=r*l,d=r*u,f=i*u,O=s*c,j=s*l,v=s*u,y=o[0],g=o[1],_=o[2];return a[0]=(1-(m+f))*y,a[1]=(p+v)*y,a[2]=(b-j)*y,a[3]=0,a[4]=(p-v)*g,a[5]=(1-(h+f))*g,a[6]=(d+O)*g,a[7]=0,a[8]=(b+j)*_,a[9]=(d-O)*_,a[10]=(1-(h+m))*_,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},cross:Ie,decompose:function(e,t,o,a){var n=Ne.length(e.slice(0,3)),r=Ne.length(e.slice(4,7)),i=Ne.length(e.slice(8,11));(function(e){var t=e[0],o=e[1],a=e[2],n=e[3],r=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],b=e[12],m=e[13],d=e[14],f=e[15],O=h*f,j=d*p,v=s*f,y=d*c,g=s*p,_=h*c,C=a*f,w=d*n,S=a*p,T=h*n,M=a*c,x=s*n;return 1/(t*(O*i+y*u+g*m-(j*i+v*u+_*m))+r*(j*o+C*u+T*m-(O*o+w*u+S*m))+l*(v*o+w*i+M*m-(y*o+C*i+x*m))+b*(_*o+S*i+x*u-(g*o+T*i+M*u)))})(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=Ne.copy(e),c=1/n,l=1/r,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var o=e[0],a=e[4],n=e[8],r=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=o+i+u;if(h>0){var p=.5/Math.sqrt(h+1);t[3]=.25/p,t[0]=(l-s)*p,t[1]=(n-c)*p,t[2]=(r-a)*p}else if(o>i&&o>u){var b=2*Math.sqrt(1+o-i-u);t[3]=(l-s)/b,t[0]=.25*b,t[1]=(a+r)/b,t[2]=(n+c)/b}else if(i>u){var m=2*Math.sqrt(1+i-o-u);t[3]=(n-c)/m,t[0]=(a+r)/m,t[1]=.25*m,t[2]=(s+l)/m}else{var d=2*Math.sqrt(1+u-o-i);t[3]=(r-a)/d,t[0]=(n+c)/d,t[1]=(s+l)/d,t[2]=.25*d}}(s,o),a[0]=n,a[1]=r,a[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new Ae(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new Ae(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,o,a,n,r,i){return(i=i||new Ae(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-o),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-r),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(o+a)/(o-a),i[14]=(n+r)/(n-r),i[15]=1,i},frustum:function(e,t,o,a,n,r,i){var s=t-e,c=a-o,l=r-n;return(i=i||new Ae(16))[0]=2*n/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(a+o)/c,i[10]=-(r+n)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*n*r/l,i[15]=0,i},perspective:function(e,t,o,a,n){n=n||new Ae(16);var r=Math.tan(.5*Math.PI-.5*e),i=1/(o-a);return n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(o+a)*i,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*a*i*2,n[15]=0,n},translation:function(e,t,o,a){return(a=a||new Ae(16))[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=e,a[13]=t,a[14]=o,a[15]=1,a},translate:function(e,t,o,a,n){n=n||new Ae(16);var r=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],p=e[7],b=e[8],m=e[9],d=e[10],f=e[11],O=e[12],j=e[13],v=e[14],y=e[15];return e!==n&&(n[0]=r,n[1]=i,n[2]=s,n[3]=c,n[4]=l,n[5]=u,n[6]=h,n[7]=p,n[8]=b,n[9]=m,n[10]=d,n[11]=f),n[12]=r*t+l*o+b*a+O,n[13]=i*t+u*o+m*a+j,n[14]=s*t+h*o+d*a+v,n[15]=c*t+p*o+f*a+y,n},xRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=o,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new Ae(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=o,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,o){o=o||new Ae(16);var a=e[4],n=e[5],r=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return o[4]=h*a+p*s,o[5]=h*n+p*c,o[6]=h*r+p*l,o[7]=h*i+p*u,o[8]=h*s-p*a,o[9]=h*c-p*n,o[10]=h*l-p*r,o[11]=h*u-p*i,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},yRotate:function(e,t,o){o=o||new Ae(16);var a=e[0],n=e[1],r=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return o[0]=h*a-p*s,o[1]=h*n-p*c,o[2]=h*r-p*l,o[3]=h*i-p*u,o[8]=h*s+p*a,o[9]=h*c+p*n,o[10]=h*l+p*r,o[11]=h*u+p*i,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},zRotate:function(e,t,o){o=o||new Ae(16);var a=e[0],n=e[1],r=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),p=Math.sin(t);return o[0]=h*a+p*s,o[1]=h*n+p*c,o[2]=h*r+p*l,o[3]=h*i+p*u,o[4]=h*s-p*a,o[5]=h*c-p*n,o[6]=h*l-p*r,o[7]=h*u-p*i,e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},axisRotation:function(e,t,o){o=o||new Ae(16);var a=e[0],n=e[1],r=e[2],i=Math.sqrt(a*a+n*n+r*r),s=(a/=i)*a,c=(n/=i)*n,l=(r/=i)*r,u=Math.cos(t),h=Math.sin(t),p=1-u;return o[0]=s+(1-s)*u,o[1]=a*n*p+r*h,o[2]=a*r*p-n*h,o[3]=0,o[4]=a*n*p-r*h,o[5]=c+(1-c)*u,o[6]=n*r*p+a*h,o[7]=0,o[8]=a*r*p+n*h,o[9]=n*r*p-a*h,o[10]=l+(1-l)*u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},axisRotate:function(e,t,o,a){a=a||new Ae(16);var n=t[0],r=t[1],i=t[2],s=Math.sqrt(n*n+r*r+i*i),c=(n/=s)*n,l=(r/=s)*r,u=(i/=s)*i,h=Math.cos(o),p=Math.sin(o),b=1-h,m=c+(1-c)*h,d=n*r*b+i*p,f=n*i*b-r*p,O=n*r*b-i*p,j=l+(1-l)*h,v=r*i*b+n*p,y=n*i*b+r*p,g=r*i*b-n*p,_=u+(1-u)*h,C=e[0],w=e[1],S=e[2],T=e[3],M=e[4],x=e[5],k=e[6],P=e[7],A=e[8],L=e[9],D=e[10],I=e[11];return a[0]=m*C+d*M+f*A,a[1]=m*w+d*x+f*L,a[2]=m*S+d*k+f*D,a[3]=m*T+d*P+f*I,a[4]=O*C+j*M+v*A,a[5]=O*w+j*x+v*L,a[6]=O*S+j*k+v*D,a[7]=O*T+j*P+v*I,a[8]=y*C+g*M+_*A,a[9]=y*w+g*x+_*L,a[10]=y*S+g*k+_*D,a[11]=y*T+g*P+_*I,e!==a&&(a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},scaling:function(e,t,o,a){return(a=a||new Ae(16))[0]=e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},scale:function(e,t,o,a,n){return(n=n||new Ae(16))[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n[3]=t*e[3],n[4]=o*e[4],n[5]=o*e[5],n[6]=o*e[6],n[7]=o*e[7],n[8]=a*e[8],n[9]=a*e[9],n[10]=a*e[10],n[11]=a*e[11],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},multiply:function(e,t,o){o=o||new Ae(16);var a=t[0],n=t[1],r=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],b=t[10],m=t[11],d=t[12],f=t[13],O=t[14],j=t[15],v=e[0],y=e[1],g=e[2],_=e[3],C=e[4],w=e[5],S=e[6],T=e[7],M=e[8],x=e[9],k=e[10],P=e[11],A=e[12],L=e[13],D=e[14],I=e[15];return o[0]=a*v+n*C+r*M+i*A,o[1]=a*y+n*w+r*x+i*L,o[2]=a*g+n*S+r*k+i*D,o[3]=a*_+n*T+r*P+i*I,o[4]=s*v+c*C+l*M+u*A,o[5]=s*y+c*w+l*x+u*L,o[6]=s*g+c*S+l*k+u*D,o[7]=s*_+c*T+l*P+u*I,o[8]=h*v+p*C+b*M+m*A,o[9]=h*y+p*w+b*x+m*L,o[10]=h*g+p*S+b*k+m*D,o[11]=h*_+p*T+b*P+m*I,o[12]=d*v+f*C+O*M+j*A,o[13]=d*y+f*w+O*x+j*L,o[14]=d*g+f*S+O*k+j*D,o[15]=d*_+f*T+O*P+j*I,o},inverse:Be,transformVector:function(e,t,o){o=o||new Ae(4);for(var a=0;a<4;++a){o[a]=0;for(var n=0;n<4;++n)o[a]+=t[n]*e[4*n+a]}return o},transformPoint:function(e,t,o){o=o||new Ae(3);var a=t[0],n=t[1],r=t[2],i=a*e[3]+n*e[7]+r*e[11]+e[15];return o[0]=(a*e[0]+n*e[4]+r*e[8]+e[12])/i,o[1]=(a*e[1]+n*e[5]+r*e[9]+e[13])/i,o[2]=(a*e[2]+n*e[6]+r*e[10]+e[14])/i,o},transformDirection:function(e,t,o){o=o||new Ae(3);var a=t[0],n=t[1],r=t[2];return o[0]=a*e[0]+n*e[4]+r*e[8],o[1]=a*e[1]+n*e[5]+r*e[9],o[2]=a*e[2]+n*e[6]+r*e[10],o},transformNormal:function(e,t,o){o=o||new Ae(3);var a=Be(e),n=t[0],r=t[1],i=t[2];return o[0]=n*a[0]+r*a[1]+i*a[2],o[1]=n*a[4]+r*a[5]+i*a[6],o[2]=n*a[8]+r*a[9]+i*a[10],o},setDefaultType:function(e){var t=Ae;return Ae=e,t}},Fe=(Math.floor,Math.random),Re=function(e,t){return e+Fe()*(t-e)},Ge=function(e,t,o,a){return[].concat(Object(Pe.a)(e),Object(Pe.a)(t),Object(Pe.a)(o),Object(Pe.a)(e),Object(Pe.a)(o),Object(Pe.a)(a))},ze=function(e,t,o,a){return[].concat(Object(Pe.a)(e),Object(Pe.a)(t),Object(Pe.a)(o),Object(Pe.a)(e),Object(Pe.a)(o),Object(Pe.a)(a))},We=function(e){return[].concat(Object(Pe.a)(e),Object(Pe.a)(e),Object(Pe.a)(e),Object(Pe.a)(e),Object(Pe.a)(e),Object(Pe.a)(e))},Ue=function(e,t,o,a,n,r){var i=t[0]-e[0],s=o[1]-e[1],c=Re(.3*i,.7*i),l=Re(.3*s,.7*s),u=e[0]+(i-c)/2,h=t[0]-(i-c)/2,p=e[1]+(s-l)/2,b=o[1]-(s-l)/2,m=[u,p,e[2]],d=[h,p,e[2]],f=[h,b,e[2]],O=[u,b,e[2]],j=[];return j.push.apply(j,Object(Pe.a)(Ge(m,d,f,O)).concat(Object(Pe.a)(Ge(e,t,d,m)),Object(Pe.a)(Ge(d,t,o,f)),Object(Pe.a)(Ge(O,f,o,a)),Object(Pe.a)(Ge(e,m,O,a)))),{vArr:j,cArr:Ke(n,r),uArr:[].concat(Object(Pe.a)(ze([.5,.5],[1,.5],[1,1],[.5,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(Pe.a)(ze([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(Pe.a)(ze([.1,.9],[.4,.9],[.5,1],[0,1])),Object(Pe.a)(ze([0,.5],[.1,.6],[.1,.9],[0,1])))}},Ke=function(e,t){return[].concat(Object(Pe.a)(We(e)),Object(Pe.a)(We(t)),Object(Pe.a)(We(t)),Object(Pe.a)(We(t)),Object(Pe.a)(We(t)))},Ve=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=Ne.yRotation(n);r=Ne.translate(r,t,o,a);for(var i=0;i<e.length;i+=3){var s=Ne.transformPoint(r,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},qe=function(e,t){for(var o=Ne.yRotation(t),a=0;a<e.length;a+=3){var n=Ne.transformPoint(o,[e[a+0],e[a+1],e[a+2],1]);e[a+0]=n[0],e[a+1]=n[1],e[a+2]=n[2]}},He=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=Ne.translation(t,o,a),r=0;r<e.length;r+=3){var i=Ne.transformPoint(n,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=i[0],e[r+1]=i[1],e[r+2]=i[2]}},Qe=function(e){var t=e.h0,o=e.h1,a=e.color1,n=void 0===a?[.2,.1,.1]:a,r=e.color2,i=void 0===r?[1,1,1]:r,s=e.rBase,c=void 0===s?5:s,l=e.hBase,u=void 0===l?5:l,h=e.hBaseToTrunk,p=void 0===h?1:h,d=e.hCapital,f=void 0===d?2:d,O=e.rCapital,j=void 0===O?6:O,v=e.hTrunkToCapital,y=void 0===v?1:v,g=e.rTrunk,_=void 0===g?3:g,C=t,w=t+u,S=Ge([-c,C,c],[c,C,c],[c,w,c],[-c,w,c]),T=We(n),M=ze([.5,0],[1,0],[1,.5],[.5,.5]),x=Ge([c+m,C-m,c+m],[-c-m,C-m,c+m],[-c-m,w,c+m],[c+m,w,c+m]),k=We(b),P=ze([0,1],[0,1],[0,1],[0,1]);w=(C=w)+p;var A=Object(Pe.a)(Ge([-c,C,c],[c,C,c],[_,w,_],[-_,w,_])),L=Object(Pe.a)(We(i)),D=ze([0,.5],[.5,.5],[.4,.7],[.1,.7]),I=function(e){for(var t=e.h,o=void 0===t?2:t,a=e.h2,n=void 0===a?30:a,r=e.r,i=void 0===r?10:r,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],p=n-o,b=o;p>0;){var m=Re(.5,10),d=Re(.5,4),f=Re(.5,4),O=Re(.5,.2),j=m+d+f+O;(p-=j)>5&&h.push({h0:b,h01:b+m,h02:b+m+d,h03:b+m+d+f,h04:b+m+d+f+O,r:Re(1,10)}),b+=j}var v=[],y=[],g=[];if(0===h.length)v.push.apply(v,Object(Pe.a)(Ge([-i,o,i],[i,o,i],[i,n,i],[-i,n,i]))),y.push.apply(y,Object(Pe.a)(We(c))),g.push.apply(g,Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var _=0;_<h.length;++_){var C=Ue([-i,h[_].h0,i],[i,h[_].h0,i],[i,h[_].h01,i],[-i,h[_].h01,i],u,u),w=C.vArr,S=C.cArr,T=C.uArr;v.push.apply(v,Object(Pe.a)(w)),y.push.apply(y,Object(Pe.a)(S)),g.push.apply(g,Object(Pe.a)(T)),v.push.apply(v,Object(Pe.a)(Ge([-i,h[_].h01,i],[i,h[_].h01,i],[h[_].r,h[_].h02,h[_].r],[-h[_].r,h[_].h02,h[_].r]))),y.push.apply(y,Object(Pe.a)(We(u))),g.push.apply(g,Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Pe.a)(Ge([-h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h03,h[_].r],[-h[_].r,h[_].h03,h[_].r]))),y.push.apply(y,Object(Pe.a)(We(c))),g.push.apply(g,Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Pe.a)(Ge([-h[_].r,h[_].h03,h[_].r],[h[_].r,h[_].h03,h[_].r],[i,h[_].h04,i],[-i,h[_].h04,i]))),y.push.apply(y,Object(Pe.a)(We(u))),g.push.apply(g,Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])))}var M=Ue([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,n,i],[-i,n,i],u,c),x=M.vArr,k=M.cArr,P=M.uArr;v.push.apply(v,Object(Pe.a)(x)),y.push.apply(y,Object(Pe.a)(k)),g.push.apply(g,Object(Pe.a)(P))}return{vert:v,col:y,uv:g}}({color1:n,color2:i,h:C=w,h2:w=o-f-y,r:_}),E=I.vert,B=I.col,N=I.uv;C=w,w=o-f;var F=Object(Pe.a)(Ge([-_,C,_],[_,C,_],[j,w,j],[-j,w,j]));C=w,w=o;var R=Object(Pe.a)(Ge([-j,C,j],[j,C,j],[j,w,j],[-j,w,j])),G=ze([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(Pe.a)(S),Object(Pe.a)(x),Object(Pe.a)(A),Object(Pe.a)(E),Object(Pe.a)(F),Object(Pe.a)(R)),frontColors:[].concat(Object(Pe.a)(T),Object(Pe.a)(k),Object(Pe.a)(L),Object(Pe.a)(B),Object(Pe.a)(L),Object(Pe.a)(T)),frontUV:[].concat(Object(Pe.a)(M),Object(Pe.a)(P),Object(Pe.a)(D),Object(Pe.a)(N),Object(Pe.a)(D),Object(Pe.a)(G))}},Ze=20,Xe=[0,0,0],Ye=[0,.7,0],Je=function(e){var t=e.h0,o=void 0===t?0:t,a=e.h1,n=void 0===a?30:a,r=e.rCapital,i=void 0===r?6:r,s=e.rBase,c=void 0===s?5:s,l=e.capTop,u=void 0!==l&&l,h=e.capBottom,p=void 0!==h&&h,d=Qe({h0:o,h1:n,color1:Xe,color2:Ye,rCapital:i,rBase:c}),f=d.frontVert,O=d.frontColors,j=d.frontUV,v=Object(Pe.a)(f);Ve(v,0,0,0,Math.PI/2);var y=Object(Pe.a)(f);Ve(y,0,0,0,-Math.PI/2);var g=Object(Pe.a)(f);Ve(g,0,0,0,Math.PI);var _=[].concat(Object(Pe.a)(f),Object(Pe.a)(v),Object(Pe.a)(y),Object(Pe.a)(g)),C=[].concat(Object(Pe.a)(O),Object(Pe.a)(O),Object(Pe.a)(O),Object(Pe.a)(O)),w=[].concat(Object(Pe.a)(j),Object(Pe.a)(j),Object(Pe.a)(j),Object(Pe.a)(j)),S=.6,T=[].concat(Object(Pe.a)(Ge([-c-S,o,c+S],[c+S,o,c+S],[c+S,n,c+S],[-c-S,n,c+S])),Object(Pe.a)(Ge([c+S,o,c+S],[c+S,o,-c-S],[c+S,n,-c-S],[c+S,n,c+S])),Object(Pe.a)(Ge([c+S,o,-c-S],[-c-S,o,-c-S],[-c-S,n,-c-S],[c+S,n,-c-S])),Object(Pe.a)(Ge([-c-S,o,-c-S],[-c-S,o,c+S],[-c-S,n,c+S],[-c-S,n,-c-S]))),M=[].concat(Object(Pe.a)(Ge([-20,o,Ze],[Ze,o,Ze],[Ze,n,Ze],[-20,n,Ze])),Object(Pe.a)(Ge([Ze,o,Ze],[Ze,o,-20],[Ze,n,-20],[Ze,n,Ze])),Object(Pe.a)(Ge([Ze,o,-20],[-20,o,-20],[-20,n,-20],[Ze,n,-20])),Object(Pe.a)(Ge([-20,o,-20],[-20,o,Ze],[-20,n,Ze],[-20,n,-20])));return p&&(_.push.apply(_,Object(Pe.a)(Ge([-c-m,o-m,c+m],[c+m,o-m,c+m],[c,o-m,-c-m],[-c,o-m,-c-m]))),C.push.apply(C,Object(Pe.a)(We(b))),w.push.apply(w,Object(Pe.a)(ze([0,1],[0,1],[0,1],[0,1])))),u&&(_.push.apply(_,Object(Pe.a)(Ge([-i,n,i],[i,n,i],[i,n,-i],[-i,n,-i]))),C.push.apply(C,Object(Pe.a)(We(Xe))),w.push.apply(w,Object(Pe.a)(ze([.5,0],[1,0],[1,.5],[.5,.5])))),{v:_,c:C,u:w,collision:T,collisionCar:M}},$e=Math.sin,et=Math.cos,tt=function(e){var t=e.isTopElem,o=e.color1,a=e.color2,n=e.h2;if(!t)return{vertTopElem:[],colorsTopElem:[],uvTopElem:[]};for(var r=[],i=[],s=[],c=2+12*Math.random(),l=1+4*Math.random(),u=.2+40*Math.random(),h=.1+10*Math.random(),p=.1+10*Math.random(),d=.1+40*Math.random(),f=0;f<6;++f){var O=f+1;O>6&&(O=0);var j=f/6*Math.PI*2,v=O/6*Math.PI*2,y=n,g=y+c,_=6,C=6,w=$e(j),S=et(j),T=$e(v),M=et(v);r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C]))),g=(y=g)+l,_=C,C=3,r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C]))),g=(y=g)+u,C=_=C,r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C]))),g=(y=g)+h,C=(_=C)+4,r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C]))),g=(y=g)+p,C=_=C,r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C])));var x=m+.5;r.push.apply(r,Object(Pe.a)(Ge([T*(_+x),y,M*(_+x)],[w*(_+x),y,S*(_+x)],[w*(C+x),g,S*(C+x)],[T*(C+x),g,M*(C+x)]))),r.push.apply(r,Object(Pe.a)(Ge([w*C,g,S*C],[T*C,g,M*C],[2*T,g,2*M],[2*$e(j),g,2*S]))),g=(y=g)+d,_=2,C=7,r.push.apply(r,Object(Pe.a)(Ge([w*_,y,S*_],[T*_,y,M*_],[T*C,g,M*C],[w*C,g,S*C])));var k=m;r.push.apply(r,Object(Pe.a)(Ge([T*(_+k),y,M*(_+k)],[w*(_+k),y,S*(_+k)],[w*(C+k),g,S*(C+k)],[T*(C+k),g,M*(C+k)]))),y=g,g+=d,r.push(w*C,y,S*C,T*C,y,M*C,0,g,0),r.push(T*(C+.5),y,M*(C+.5),w*(C+.5),y,S*(C+.5),0,g+3,0),i.push.apply(i,Object(Pe.a)(We(o)).concat(Object(Pe.a)(We(a)),Object(Pe.a)(We(a)),Object(Pe.a)(We(a)),Object(Pe.a)(We(o)),Object(Pe.a)(We(b)),Object(Pe.a)(We(o)),Object(Pe.a)(We(o)),Object(Pe.a)(We(b)),Object(Pe.a)(o),Object(Pe.a)(o),Object(Pe.a)(o),Object(Pe.a)(b),Object(Pe.a)(b),Object(Pe.a)(b))),s.push.apply(s,Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,1],[0,1],[0,1],[0,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,.5],[.5,.5],[.5,1],[0,1])),Object(Pe.a)(ze([0,1],[0,1],[0,1],[0,1])),[0,.5],[.5,.5],[.25,1],[0,1],[0,1],[0,1]))}return{vertTopElem:r,colorsTopElem:i,uvTopElem:s}},ot=function(e){var t=e.isColumn,o=e.h1,a=e.h2,n=e.color1,r=e.color2;if(!t)return{vertColumn:[],colorsColumn:[],uvColumn:[]};var i=[],s=[],c=[],l=a-5;i.push.apply(i,Object(Pe.a)(Ge([-4,o,4],[4,o,4],[4,a,4],[-4,a,4])).concat(Object(Pe.a)(Ge([4,o,4],[4,o,-4],[4,a,-4],[4,a,4])),Object(Pe.a)(Ge([4,o,-4],[-4,o,-4],[-4,a,-4],[4,a,-4])),Object(Pe.a)(Ge([-4,o,-4],[-4,o,4],[-4,a,4],[-4,a,-4])),Object(Pe.a)(Ge([-6,l,6],[6,l,6],[6,a,6],[-6,a,6])),Object(Pe.a)(Ge([6,l,6],[6,l,-6],[6,a,-6],[6,a,6])),Object(Pe.a)(Ge([6,l,-6],[-6,l,-6],[-6,a,-6],[6,a,-6])),Object(Pe.a)(Ge([-6,l,-6],[-6,l,6],[-6,a,6],[-6,a,-6])),Object(Pe.a)(Ge([-6,l,6],[-6,l,-6],[6,l,-6],[6,l,6])),Object(Pe.a)(Ge([-6,a,-6],[-6,a,6],[6,a,6],[6,a,-6])))),s.push.apply(s,Object(Pe.a)(We(r)).concat(Object(Pe.a)(We(r)),Object(Pe.a)(We(r)),Object(Pe.a)(We(r)),Object(Pe.a)(We(n)),Object(Pe.a)(We(n)),Object(Pe.a)(We(n)),Object(Pe.a)(We(n)),Object(Pe.a)(We(n)),Object(Pe.a)(We(n))));var u=ze([0,.5],[.5,.5],[.5,1],[0,1]);return c.push.apply(c,Object(Pe.a)(u).concat(Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u),Object(Pe.a)(u))),{vertColumn:i,colorsColumn:s,uvColumn:c}},at=[0,0,0],nt=[0,.7,0],rt=function(e){var t=e.h0,o=void 0===t?0:t,a=e.h1,n=void 0===a?30:a,r=e.h2,i=void 0===r?60:r,s=e.arc,c=void 0!==s&&s,l=e.isTopElem,u=void 0!==l&&l,h=e.isColumn,p=void 0!==h&&h,b=[],m=[],d=[],f=[],O=[];if(c){var j=function(e){for(var t=e.h1,o=e.h2,a=e.color1,n=void 0===a?[.2,.1,.1]:a,r=e.color2,i=void 0===r?[1,1,1]:r,s=e.r,c=void 0===s?5:s,l=e.rCap,u=void 0===l?7:l,h=e.wCol,p=void 0===h?3:h,b=e.w,m=(void 0===b?40:b)-2*c,d=-c-m,f=t,O=o-Math.min(.1*(o-t),2),j=Object(Pe.a)(Ge([-p,f,c],[p,f,c],[p,O,c],[-p,O,c])),v=Object(Pe.a)(We(i)),y=Object(Pe.a)(We(n)),g=ze([0,.5],[.5,.5],[.5,1],[0,1]),_=[].concat(Object(Pe.a)(Ge([-p,f,-c],[-p,f,c],[-p,O,c],[-p,O,-c])),Object(Pe.a)(Ge([p,f,c],[p,f,-c],[p,O,-c],[p,O,c]))),C=Object(Pe.a)(Ge([p,f,-c],[-p,f,-c],[-p,O,-c],[p,O,-c])),w=[],S=[],T=[],M=2-p,x=p-2,k=14,P=m/k,A=O-f,L=.15*A,D=0;D<k;++D){var I=(1-Math.sin((D+1)/k*Math.PI))*(A-L)+L,E=(1-Math.sin(D/k*Math.PI))*(A-L)+L,B=-c;D+1>7&&(B=-c-m),w.push(M,O-I,-c-(D+1)*P,M,O-E,-c-D*P,M,O,B),S.push.apply(S,Object(Pe.a)(i).concat(Object(Pe.a)(i),Object(Pe.a)(i))),T.push(0,0,.3,0,.3,.3),w.push(x,O-E,-c-D*P,x,O-I,-c-(D+1)*P,x,O,B),S.push.apply(S,Object(Pe.a)(i).concat(Object(Pe.a)(i),Object(Pe.a)(i))),T.push(0,0,.3,0,.3,.3),w.push.apply(w,Object(Pe.a)(Ge([x,O-E,-c-D*P],[M,O-E,-c-D*P],[M,O-I,-c-(D+1)*P],[x,O-I,-c-(D+1)*P]))),S.push.apply(S,Object(Pe.a)(y)),T.push.apply(T,Object(Pe.a)(ze([0,0],[0,0],[0,0],[0,0])))}w.push(M,O-L,-c-P*k/2,M,O,-c,M,O,-c-P*k),S.push.apply(S,Object(Pe.a)(i).concat(Object(Pe.a)(i),Object(Pe.a)(i))),T.push(.5,.25,.25,.3,.25,.2),w.push(x,O-L,-c-P*k/2,x,O,-c-P*k,x,O,-c),S.push.apply(S,Object(Pe.a)(i).concat(Object(Pe.a)(i),Object(Pe.a)(i))),T.push(.5,.25,.25,.3,.25,.2),f=O,O=o;var N=[].concat(Object(Pe.a)(Ge([-u,f,-u],[u,f,-u],[u,f,u],[-u,f,u])),Object(Pe.a)(Ge([-u,f,u],[u,f,u],[u,O,u],[-u,O,u])),Object(Pe.a)(Ge([-u,f,-u],[-u,f,u],[-u,O,u],[-u,O,-u])),Object(Pe.a)(Ge([u,f,u],[u,f,-u],[u,O,-u],[u,O,u])),Object(Pe.a)(Ge([u,f,-u],[-u,f,-u],[-u,O,-u],[u,O,-u])),Object(Pe.a)(Ge([-u,O,u],[u,O,u],[u,O,-u],[-u,O,-u])),Object(Pe.a)(Ge([2-u,f,d],[u-2,f,d],[u-2,f,-u],[2-u,f,-u])),Object(Pe.a)(Ge([2-u,f,d],[2-u,f,-u],[2-u,O,-u],[2-u,O,d])),Object(Pe.a)(Ge([u-2,f,-u],[u-2,f,d],[u-2,O,d],[u-2,O,-u])),Object(Pe.a)(Ge([2-u,O,-u],[u-2,O,-u],[u-2,O,d],[2-u,O,d])));return{v:[].concat(Object(Pe.a)(j),Object(Pe.a)(_),Object(Pe.a)(C),w,Object(Pe.a)(N)),c:[].concat(Object(Pe.a)(v),Object(Pe.a)(v),Object(Pe.a)(v),Object(Pe.a)(v),S,Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y),Object(Pe.a)(y)),u:[].concat(Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),T,Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g),Object(Pe.a)(g))}}(Object(D.a)({h1:n,h2:i,color1:at,color2:nt},c));b.push.apply(b,Object(Pe.a)(j.v)),m.push.apply(m,Object(Pe.a)(j.c)),d.push.apply(d,Object(Pe.a)(j.u))}var v=Je({h0:o,h1:n,color1:at,color2:nt,rCapital:6,rBase:5,capTop:!0,capBottom:!0});b.push.apply(b,Object(Pe.a)(v.v)),m.push.apply(m,Object(Pe.a)(v.c)),d.push.apply(d,Object(Pe.a)(v.u)),f.push.apply(f,Object(Pe.a)(v.collision)),v.collisionCar&&O.push.apply(O,Object(Pe.a)(v.collisionCar));var y=tt({h2:i,color1:at,color2:nt,isTopElem:u}),g=y.vertTopElem,_=y.colorsTopElem,C=y.uvTopElem;b.push.apply(b,Object(Pe.a)(g)),m.push.apply(m,Object(Pe.a)(_)),d.push.apply(d,Object(Pe.a)(C));var w=ot({isColumn:p,h1:n,h2:i,color1:at,color2:nt}),S=w.vertColumn,T=w.colorsColumn,M=w.uvColumn;return b.push.apply(b,Object(Pe.a)(S)),m.push.apply(m,Object(Pe.a)(T)),d.push.apply(d,Object(Pe.a)(M)),{v:b,c:m,u:d,collision:f,collisionCar:O}},it=function(e){for(var t=[],o=[],a=[],n=[],r=[],i=function(){var e=[],t=function t(o){var a=o.angle,n=o.offsetStart,r=o.h0,i=o.h1,s=o.h2,c=o.numFromCenter,l=120*Math.random()+30,u=Math.random()>.5;e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(a)*(n+l),z:Math.cos(a)*(n+l),angle:a,h0:r,h1:i,h2:s,arc:{w:l},isTopElem:!u,numFromCenter:c}),u&&t({angle:a,offsetStart:n+l,h0:r,h1:i,h2:s,numFromCenter:++c})},o=Math.floor(20*Math.random())+3,a=150*Math.random()+30,n=(.4*Math.random()+.5)*a;e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h0:0,h1:n,h2:a,numFromCenter:0,isTopElem:!1,isColumn:!0});for(var r=0;r<o;++r)Math.random()>.3&&t({angle:r/o*(2*Math.PI),offsetStart:0,h0:0,h1:n,h2:a,numFromCenter:1});for(var i=e.length,s=0;s<3;++s)for(var c=e[e.length-1].h2,l=c+150*Math.random()+30,u=c+(.4*Math.random()+.5)*(l-c),h=0;h<i;++h)e[h].isTopElem||e.push(Object(D.a)(Object(D.a)({},e[h]),{},{h0:c,h1:u,h2:l,isTopElem:2===s}));return e}(),s=0;s<i.length;++s){var c=i[s],l=(c.id,c.x),u=c.z,h=c.angle,p=c.h0,b=c.h1,m=c.h2,d=c.arc,f=c.isTopElem,O=c.isColumn,j=rt({h0:p,h1:b,h2:m,arc:d,isTopElem:f,isColumn:O}),v=j.v,y=j.c,_=j.u,C=j.collision,w=j.collisionCar;qe(v,h),He(v,l,0,u,h),C&&(qe(C,h),He(C,l,0,u),n.push.apply(n,Object(Pe.a)(C))),w&&(qe(w,h),He(w,l,0,u),r.push.apply(r,Object(Pe.a)(w))),t.push.apply(t,Object(Pe.a)(v)),o.push.apply(o,Object(Pe.a)(y)),a.push.apply(a,Object(Pe.a)(_))}var S=new Float32Array(t),T=new Float32Array(o),M=new Float32Array(a),x=new g.BufferGeometry;x.setAttribute("position",new g.BufferAttribute(S,3)),x.setAttribute("color",new g.BufferAttribute(T,3)),M&&x.setAttribute("uv",new g.BufferAttribute(M,2)),x.computeVertexNormals();var k=e.materials.wallVirtualColor,P=new g.Mesh(x,k),A=new Float32Array(n),L=new g.BufferGeometry;L.setAttribute("position",new g.BufferAttribute(A,3));var I=new g.Mesh(L,e.materials.testRed),E=new Float32Array(r),B=new g.BufferGeometry;return B.setAttribute("position",new g.BufferAttribute(E,3)),{mesh:P,meshCollision:I,meshCollisionCar:new g.Mesh(B,e.materials.testRed)}},st=Math.PI,ct=Math.cos,lt=st/2,ut=[0,0,0],ht=[0,0,0],pt=function(e,t,o){var a=e.h,n=e.r,r=e.x,i=e.z,s=e.bridgeL,c=e.bridgeMinusH,l=e.hColumn,u=e.rColumn,h=e.i,p=a-5,b=Math.min(l*(.35*Math.random()+.1),50),m=[],d=[],f=[],O=[],j=[],v=function(e){var t=e.r,o=e.h,a=e.hh,n=e.bridgeMinusH,r=e.bridgeL,i=e.color2,s=e.colorB,c=[],l=[],u=[],h=[],p=ze([0,.5],[.5,.5],[.5,1],[0,1]),b=ze([0,0],[0,0],[0,0],[0,0]);return c.push.apply(c,Object(Pe.a)(Ge([-t,o,t],[t,o,t],[t,o,-t],[-t,o,-t])).concat(Object(Pe.a)(Ge([-t,a,t],[t,a,t],[t,o,t],[-t,o,t])),Object(Pe.a)(Ge([-t,a,-t],[-t,a,t],[-t,o,t],[-t,o,-t])),Object(Pe.a)(Ge([t,a,t],[t,a,-t],[t,o,-t],[t,o,t])),Object(Pe.a)(Ge([t,a,-t],[-t,a,-t],[-t,o,-t],[t,o,-t])),Object(Pe.a)(Ge([t,a,-t],[t,a,t],[-t,a,t],[-t,a,-t])),Object(Pe.a)(Ge([-t,o,-t],[t,o,-t],[t,o-n,-t-r],[-t,o-n,-t-r])),Object(Pe.a)(Ge([-t,a-n,-t-r],[-t,a,-t],[-t,o,-t],[-t,o-n,-t-r])),Object(Pe.a)(Ge([t,a,-t],[t,a-n,-t-r],[t,o-n,-t-r],[t,o,-t])),Object(Pe.a)(Ge([-t,a-n,-t-r],[t,a-n,-t-r],[t,a,-t],[-t,a,-t])))),l.push.apply(l,Object(Pe.a)(We(i)).concat(Object(Pe.a)(We(s)),Object(Pe.a)(We(s)),Object(Pe.a)(We(s)),Object(Pe.a)(We(i)),Object(Pe.a)(We(i)),Object(Pe.a)(We(i)),Object(Pe.a)(We(s)),Object(Pe.a)(We(s)),Object(Pe.a)(We(i)))),u.push.apply(u,Object(Pe.a)(p).concat(Object(Pe.a)(b),Object(Pe.a)(b),Object(Pe.a)(b),Object(Pe.a)(b),Object(Pe.a)(p),Object(Pe.a)(p),Object(Pe.a)(b),Object(Pe.a)(b),Object(Pe.a)(p))),h.push.apply(h,Object(Pe.a)(Ge([-t,o,t],[t,o,t],[t,o,-t],[-t,o,-t])).concat(Object(Pe.a)(Ge([-t,o,-t],[t,o,-t],[t,o-n,-t-r],[-t,o-n,-t-r])))),{v:c,c:l,u:u,collision:h}}({h:a,hh:p,colorB:ht,color2:o,bridgeL:s,bridgeMinusH:c,r:n});m.push.apply(m,Object(Pe.a)(v.v)),d.push.apply(d,Object(Pe.a)(v.c)),f.push.apply(f,Object(Pe.a)(v.u)),O.push.apply(O,Object(Pe.a)(v.collision));var y=Je({h0:p-l-.1,h1:p-b,capTop:!0,capBottom:!0});He(y.v,n,0,n),m.push.apply(m,Object(Pe.a)(y.v)),d.push.apply(d,Object(Pe.a)(y.c)),f.push.apply(f,Object(Pe.a)(y.u)),He(y.collision,n,0,n),O.push.apply(O,Object(Pe.a)(y.collision)),y.collisionCar&&(He(y.collisionCar,n,0,n),j.push.apply(j,Object(Pe.a)(y.collisionCar)));var g=ot({isColumn:!0,h1:p-b,h2:p,color1:[0,0,0],color2:o});He(g.vertColumn,n,0,n),m.push.apply(m,Object(Pe.a)(g.vertColumn)),d.push.apply(d,Object(Pe.a)(g.colorsColumn)),f.push.apply(f,Object(Pe.a)(g.uvColumn));var _=function(e){for(var t=e.hArc,o=void 0===t?15:t,a=e.arcL,n=void 0===a?15:a,r=e.color2,i=[],s=[],c=[],l=n/5,u=0;u<5;++u){var h=ct(u/5*lt),p=ct((u+1)/5*lt);i.push(u*l,0+h*o,.1,(u+1)*l,0+p*o,.1,n,o,1),i.push(u*l,0+h*o,-2,n,o,-2,(u+1)*l,0+p*o,-2),s.push.apply(s,Object(Pe.a)(r).concat(Object(Pe.a)(r),Object(Pe.a)(r),Object(Pe.a)(r),Object(Pe.a)(r),Object(Pe.a)(r))),c.push(0,0,.3,0,.3,.3,0,0,.3,0,.3,.3),i.push.apply(i,Object(Pe.a)(Ge([u*l,0+h*o,.1],[u*l,0+h*o,-2],[(u+1)*l,0+p*o,-2],[(u+1)*l,0+p*o,.1]))),s.push.apply(s,Object(Pe.a)(We(ut))),c.push(0,0,0,0,0,0,0,0,0,0,0,0)}return{v:i,c:s,u:c}}({hArc:b,arcL:40,color2:o});if(He(_.v,n-u-40,p-b,n),m.push.apply(m,Object(Pe.a)(_.v)),d.push.apply(d,Object(Pe.a)(_.c)),f.push.apply(f,Object(Pe.a)(_.u)),e.isTop){var C=tt({isTopElem:!0,color1:[0,0,0],color2:o,h2:p});He(C.vertTopElem,n,0,n),m.push.apply(m,Object(Pe.a)(C.vertTopElem)),d.push.apply(d,Object(Pe.a)(C.colorsTopElem)),f.push.apply(f,Object(Pe.a)(C.uvTopElem))}return qe(m,Math.PI-Math.PI/2*h),He(m,r,0,i),qe(O,Math.PI-Math.PI/2*h),He(O,r,0,i),qe(j,Math.PI-Math.PI/2*h),He(j,r,0,i),{v:m,c:d,u:f,collision:O,collisionCar:j}},bt=[[30,-30],[70,-30],[70,-70],[30,-70]],mt=[[30,30],[70,30],[70,-30],[30,-30]],dt=[[-70,70],[-30,70],[-30,30],[-70,30]],ft=[[-30,70],[30,70],[30,30],[-30,30]],Ot=[[30,70],[70,70],[70,30],[30,30]],jt={N:[dt],W:[dt,ft,Ot],S:[dt,ft,Ot,mt,bt],E:[dt,ft,Ot,mt,bt,[[-30,-30],[30,-30],[30,-70],[-30,-70]],[[-70,-30],[-30,-30],[-30,-70],[-70,-70]]]},vt=function(e){var t=e.xCenter,o=e.zCenter,a=e.h,n=e.dir,r=e.color2,i=void 0===r?[0,.7,0]:r,s=e.colorB,c=void 0===s?[0,0,0]:s,l=a-3,u=[],h=[],p=[],b=[],m=ze([0,.5],[.5,.5],[.5,1],[0,1]),d=ze([0,0],[0,0],[0,0],[0,0]);if(jt[n])for(var f=0;f<jt[n].length;++f){var O=jt[n][f];u.push.apply(u,Object(Pe.a)(Ge([O[0][0],a,O[0][1]],[O[1][0],a,O[1][1]],[O[2][0],a,O[2][1]],[O[3][0],a,O[3][1]])).concat(Object(Pe.a)(Ge([O[3][0],l,O[3][1]],[O[2][0],l,O[2][1]],[O[1][0],l,O[1][1]],[O[0][0],l,O[0][1]])),Object(Pe.a)(Ge([O[0][0],l,O[0][1]],[O[1][0],l,O[1][1]],[O[1][0],a,O[1][1]],[O[0][0],a,O[0][1]])),Object(Pe.a)(Ge([O[1][0],l,O[1][1]],[O[2][0],l,O[2][1]],[O[2][0],a,O[2][1]],[O[1][0],a,O[1][1]])),Object(Pe.a)(Ge([O[2][0],l,O[2][1]],[O[3][0],l,O[3][1]],[O[3][0],a,O[3][1]],[O[2][0],a,O[2][1]])),Object(Pe.a)(Ge([O[3][0],l,O[3][1]],[O[0][0],l,O[0][1]],[O[0][0],a,O[0][1]],[O[3][0],a,O[3][1]])))),h.push.apply(h,Object(Pe.a)(We(i)).concat(Object(Pe.a)(We(i)),Object(Pe.a)(We(c)),Object(Pe.a)(We(c)),Object(Pe.a)(We(c)),Object(Pe.a)(We(c)))),p.push.apply(p,Object(Pe.a)(m).concat(Object(Pe.a)(m),Object(Pe.a)(d),Object(Pe.a)(d),Object(Pe.a)(d),Object(Pe.a)(d))),b.push.apply(b,Object(Pe.a)(Ge([O[0][0],a,O[0][1]],[O[1][0],a,O[1][1]],[O[2][0],a,O[2][1]],[O[3][0],a,O[3][1]])))}return He(u,t,0,o),He(b,t,0,o),{v:u,c:h,u:p,collision:b}},yt=[0,0,0],gt=[0,.7,0],_t={N:0,E:.5*-Math.PI,S:Math.PI,W:.5*Math.PI},Ct=function(e){for(var t=e.centerBridgeX,o=e.centerBridgeZ,a=e.h,n=e.dir,r=e.lenBridge,i=a-3,s=ze([0,.5],[.5,.5],[.5,1],[0,1]),c=ze([0,0],[0,0],[0,0],[0,0]),l=20,u=[],h=[],p=[],b=[],m=[],d=0,f=120*Math.random()+30,O=r/2,j=r/2;f<r-20;){O=r/2-d,j=r/2-f;var v=Je({h0:-20,h1:a-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});He(v.v,-20,0,j);for(var y=0;y<v.v.length;++y)u.push(v.v[y]);for(var g=0;g<v.c.length;++g)h.push(v.c[g]);for(var _=0;_<v.u.length;++_)p.push(v.u[_]);He(v.collision,-20,0,j);for(var C=0;C<v.collision.length;++C)b.push(v.collision[C]);He(v.collisionCar,-20,0,j);for(var w=0;w<v.collisionCar.length;++w)m.push(v.collisionCar[w]);var S=Je({h0:-20,h1:a-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});He(S.v,20,0,j);for(var T=0;T<S.v.length;++T)u.push(S.v[T]);for(var M=0;M<S.c.length;++M)h.push(S.c[M]);for(var x=0;x<S.u.length;++x)p.push(S.u[x]);He(S.collision,20,0,j);for(var k=0;k<S.collision.length;++k)b.push(S.collision[k]);He(S.collisionCar,20,0,j);for(var P=0;P<S.collisionCar.length;++P)m.push(S.collisionCar[P]);var A=tt({isTopElem:!0,color1:yt,color2:gt,h2:a-1});He(A.vertTopElem,-20,0,j),u.push.apply(u,Object(Pe.a)(A.vertTopElem)),h.push.apply(h,Object(Pe.a)(A.colorsTopElem)),p.push.apply(p,Object(Pe.a)(A.uvTopElem));var L=tt({isTopElem:!0,color1:yt,color2:gt,h2:a-1});He(L.vertTopElem,20,0,j),u.push.apply(u,Object(Pe.a)(L.vertTopElem)),h.push.apply(h,Object(Pe.a)(L.colorsTopElem)),p.push.apply(p,Object(Pe.a)(L.uvTopElem)),d=f,f+=120*Math.random()+30,u.push.apply(u,Object(Pe.a)(Ge([-l,a,O],[l,a,O],[l,a,j],[-l,a,j])).concat(Object(Pe.a)(Ge([-l,i,j],[-l,i,O],[-l,a,O],[-l,a,j])),Object(Pe.a)(Ge([l,i,O],[l,i,j],[l,a,j],[l,a,O])),Object(Pe.a)(Ge([l,i,j],[l,i,O],[-l,i,O],[-l,i,j])))),h.push.apply(h,Object(Pe.a)(We(gt)).concat(Object(Pe.a)(We(yt)),Object(Pe.a)(We(yt)),Object(Pe.a)(We(gt)))),p.push.apply(p,Object(Pe.a)(s).concat(Object(Pe.a)(c),Object(Pe.a)(c),Object(Pe.a)(s))),b.push.apply(b,Object(Pe.a)(Ge([-l,a,O],[l,a,O],[l,a,j],[-l,a,j])))}return u.push.apply(u,Object(Pe.a)(Ge([-l,a,j],[l,a,j],[l,a,-r/2],[-l,a,-r/2])).concat(Object(Pe.a)(Ge([-l,i,-r/2],[-l,i,j],[-l,a,j],[-l,a,-r/2])),Object(Pe.a)(Ge([l,i,j],[l,i,-r/2],[l,a,-r/2],[l,a,j])),Object(Pe.a)(Ge([l,i,-r/2],[l,i,j],[-l,i,j],[-l,i,-r/2])))),h.push.apply(h,Object(Pe.a)(We(gt)).concat(Object(Pe.a)(We(yt)),Object(Pe.a)(We(yt)),Object(Pe.a)(We(gt)))),p.push.apply(p,Object(Pe.a)(s).concat(Object(Pe.a)(c),Object(Pe.a)(c),Object(Pe.a)(s))),b.push.apply(b,Object(Pe.a)(Ge([-l,a,j],[l,a,j],[l,a,-r/2],[-l,a,-r/2]))),He(u,-50,0,0),qe(u,_t[n]),He(u,t,0,o),He(b,-50,0,0),qe(b,_t[n]),He(b,t,0,o),He(m,-50,0,0),qe(m,_t[n]),He(m,t,0,o),{v:u,c:h,u:p,collision:b,collisionCar:m}},wt=function(e){for(var t=e.xCenter,o=e.zCenter,a=e.hStart,n=e.hEnd,r=e.count,i=(n-a)/r,s=50,c=[],l=0;l<r;++l){var u=4*i;l<4&&(u=a+l*i+15);var h=i*l+a,p=h-7+a,b=t,m=o,d=l%4;d<1?(b=t-s,m=o-s):d<2?(b=t+s,m=o-s):d<3?(b=t+s,m=o+s):d<4&&(b=t-s,m=o+s),c.push({type:"stairs",offset:s,h:h,hh:p,r:20,x:b,z:m,bridgeMinusH:i,bridgeL:60,hColumn:u,rColumn:3,i:l,isTop:r-l<5})}return c},St=["N","E","S","W"],Tt={N:1,E:2,S:3,W:4},Mt={N:[0,-1],E:[1,0],S:[0,1],W:[-1,0]},xt=function(e){for(var t=function(){for(var e=[],t=0,o=0,a=0,n="N",r=0;r<5;++r){var i=St[Math.floor(Math.random()*St.length)],s=400*Math.random()+30,c=o+Mt[i][0]*(140+s),l=a+Mt[i][1]*(140+s),u=Tt[i]+4*Math.floor(2*Math.random()),h=t+30*u,p=wt({xCenter:o,zCenter:a,hStart:t,hEnd:h,count:u});if(e.push.apply(e,Object(Pe.a)(p)),0!==r&&e.push({xCenter:o,zCenter:a,h:t-30,type:"zone",nextDir:i,dir:n}),4!==r){var b=(c-o)/2+o,m=(l-a)/2+a;e.push({centerBridgeX:b,centerBridgeZ:m,h:h-30,dir:i,lenBridge:s,type:"bridge"})}o=c,a=l,t=h,n=i}return e}(),o=[],a=[],n=[],r=[],i=[],s=0;s<t.length;++s){if("stairs"===t[s].type){var c=pt(t[s],0,[0,.7,0]),l=c.v,u=c.c,h=c.u,p=c.collision,b=c.collisionCar;o.push.apply(o,Object(Pe.a)(l)),a.push.apply(a,Object(Pe.a)(u)),n.push.apply(n,Object(Pe.a)(h)),r.push.apply(r,Object(Pe.a)(p)),b&&i.push.apply(i,Object(Pe.a)(b))}if("zone"===t[s].type){var m=vt(t[s]),d=m.v,f=m.c,O=m.u,j=m.collision;o.push.apply(o,Object(Pe.a)(d)),a.push.apply(a,Object(Pe.a)(f)),n.push.apply(n,Object(Pe.a)(O)),r.push.apply(r,Object(Pe.a)(j))}if("bridge"===t[s].type){for(var v=Ct(t[s]),y=v.v,_=v.c,C=v.u,w=v.collision,S=v.collisionCar,T=0;T<y.length;++T)o.push(y[T]);for(var M=0;M<_.length;++M)a.push(_[M]);for(var x=0;x<C.length;++x)n.push(C[x]);for(var k=0;k<w.length;++k)r.push(w[k]);if(S)for(var P=0;P<S.length;++P)i.push(S[P])}}r.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var A=new Float32Array(o),L=new Float32Array(a),D=new Float32Array(n),I=new Float32Array(r),E=new g.BufferGeometry;E.setAttribute("position",new g.BufferAttribute(A,3)),E.setAttribute("color",new g.BufferAttribute(L,3)),D&&E.setAttribute("uv",new g.BufferAttribute(D,2)),E.computeVertexNormals();var B=e.materials.wallVirtualColor,N=new g.Mesh(E,B),F=new g.BufferGeometry;F.setAttribute("position",new g.BufferAttribute(I,3));var R=new g.MeshBasicMaterial({color:16711680}),G=new g.Mesh(F,R),z=new Float32Array(i),W=new g.BufferGeometry;W.setAttribute("position",new g.BufferAttribute(z,3));var U=new g.Mesh(W,R),K=new g.Mesh(new g.BoxGeometry(30,30,30),new g.MeshBasicMaterial({color:16711935}));return K.position.set(t[t.length-1].x,t[t.length-1].h,t[t.length-1].z),{mesh:N,meshCollision:G,meshCollisionCar:U,meshFinish:K}},kt=function(){function e(t){var o=this;Object(v.a)(this,e),this._root=t;var a=this._root,n=a.emitter,r=a.car,i=a.dispatcher,s=a.frameUpdater,c=a.studio,l=(a.player,a.system_PlayerMoveOnLevel);i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),i.dispatch({type:"ENABLE_CONTROL_SOUND"}),r.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),n.subscribe("checkNear")((function(e){console.log("checkNear",e),"nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),"nearPerson"===e.item&&console.log("checkNear nearPerson !!!!!!",e)}));var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Math.floor(t/e),n=Math.floor(o/e),r=a+"_"+n,i=xe(a,n);return{checkChanged:function(t,o){var a=Math.floor(t/e),n=Math.floor(o/e),s=a+"_"+n;if(s===r)return!1;var c=r;r=s;var l=i;i=xe(a,n);var u=ke(i,l),h=ke(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:r,currentEnv:i}}}}(u,r._model.position.x,r._model.position.z),b=p.getCurrent();this._changerLocations=Pt(this._root),this._changerLevelTresh=At(this._root),this._changerLevelTresh.createTresh(b.currentEnv),s.on((function(e){if(l.update(e),!r.isFreeze){r.update(e);var t=p.checkChanged(r._model.position.x,r._model.position.z);if(t&&(console.log("quadrants data",t),o._changerLevelTresh.updateTrash(t.removedQs,t.addedQs),h[t.oldKey]&&o._changerLocations.removeLocationFromScene(h[t.oldKey]),h[t.newKey])){var a=t.newKey.split("_"),n=+a[0]*u+u/2,i=+a[1]*u+u/2;o._changerLocations.addLocationToScene(h[t.newKey],n,i)}}c.drawFrame()})),this._startPlay()}return Object(y.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,o=e.system_PlayerMoveOnLevel,a=e.car;o.toggleFreeze(!0),a.toggleFreeze(!1),t.setCamera(a.getCamera())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,o=e.player,a=e.studio,n=e.car,r=n.getPosition(),i=n.getQuaternion();a.setCamera(o.getCamera()),n.toggleFreeze(!0),t.toggleFreeze(!1),o.setToPos(r.x,o.mesh.position.y,r.z),o.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key,o=null;for(var a in h)h[a]===t&&(o=a);if(o){var n=o.split("_"),r=+n[0]*u+u/2,i=+n[1]*u+u/2;this._root.car.setTargetPosition(new g.Vector3(r,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,o=e.ui,a=e.studio,n=e.car,r=e.system_Level,i=e.system_PlayerMoveOnLevel;e.system_PlayerNearLevelItems.setItemToCheck(n.getModel(),"nearStarterDrawCar",28),a.addToScene(n.getModel()),i.addItemToPlayerCollision(n.getCollision()),setTimeout((function(){var e=0,t=null;for(var o in h)0===e&&(t=o),++e;var a=t.split("_"),r=+a[0]*u+u/2,i=+a[1]*u+u/2;n.setTargetPosition(new g.Vector3(r,0,i))}),500),r._items.body.position.fromArray([-20,-60,-50]),r._items.body.rotation.fromArray([0,2,0]),a.addToScene(r._items.body),o.showStartButton((function(){t.toggleBlocked(!1)}))}}]),e}(),Pt=function(e){var t=e.studio,o=e.car,a=e.system_Level,n=e.system_PlayerMoveOnLevel,r=e.system_PlayerNearLevelItems;setTimeout((function(){for(var e in h){var o=e.split("_"),n=+o[0]*u+u/2,r=+o[1]*u+u/2;a.locations[h[e]].mesh.position.set(n,0,r),t.addToScene(a.locations[h[e]].mesh)}}),500);return{removeLocationFromScene:function(e){var i=a.locations[e],s=i.mesh,c=i.carCollision,l=i.personCollision;n.removeItemFromPlayerCollision(s),t.removeFromScene(c),o.removeCollisionForDraw(c),t.removeFromScene(l),r.removeItemFromCheck(l)},addLocationToScene:function(e,i,s){var c=a.locations[e],l=c.mesh,u=c.carCollision,h=c.personOffset,p=c.personCollision;l.position.set(i,0,s),n.addItemToPlayerCollision(l),u.position.set(i,0,s),t.addToScene(u),o.setCollisionForDraw(u),p.position.set(h[0]+i,h[1],h[2]+s),t.addToScene(p),r.setItemToCheck(p,"nearPerson_"+e,28)}}},At=function(e){var t=e.studio,o=e.car,a=e.system_PlayerMoveOnLevel,n=e.materials,r=[],i=function(e){for(var t=function(){for(var e=50,t=[],o=0;o<25;++o){var a=30*o,n=a-7,r=0,i=0,s=o%4;s<1?(r=-50,i=-50):s<2?(r=e,i=-50):s<3?(r=e,i=e):s<4&&(r=-50,i=e),t.push({offset:e,h:a,hh:n,r:20,x:r,z:i,bridgeMinusH:30,bridgeL:60,hColumn:120,rColumn:3,i:o,isTop:25-o<5})}return t}(),o=[],a=[],n=[],r=[],i=0;i<t.length;++i){var s=pt(t[i],0,[0,.7,0]),c=s.v,l=s.c,u=s.u,h=s.collision;o.push.apply(o,Object(Pe.a)(c)),a.push.apply(a,Object(Pe.a)(l)),n.push.apply(n,Object(Pe.a)(u)),r.push.apply(r,Object(Pe.a)(h))}r.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var p=new Float32Array(o),b=new Float32Array(a),m=new Float32Array(n),d=new Float32Array(r),f=new g.BufferGeometry;f.setAttribute("position",new g.BufferAttribute(p,3)),f.setAttribute("color",new g.BufferAttribute(b,3)),m&&f.setAttribute("uv",new g.BufferAttribute(m,2)),f.computeVertexNormals();var O=e.materials.wallVirtualColor,j=new g.Mesh(f,O),v=new g.BufferGeometry;v.setAttribute("position",new g.BufferAttribute(d,3));var y=new g.MeshBasicMaterial({color:16711680});return{mesh:j,meshCollision:new g.Mesh(v,y)}}(e);i.mesh.position.set(400,-42,-1e3),t.addToScene(i.mesh),i.meshCollision.visible=!1,i.meshCollision.position.copy(i.mesh.position),t.addToScene(i.meshCollision),a.addItemToPlayerCollision(i.meshCollision);var s=xt(e);s.mesh.position.set(0,-42,0),t.addToScene(s.mesh),s.meshCollision.visible=!1,s.meshCollision.position.copy(s.mesh.position),t.addToScene(s.meshCollision),a.addItemToPlayerCollision(s.meshCollision),s.meshCollisionCar.visible=!1,s.meshCollisionCar.position.copy(s.mesh.position),t.addToScene(s.meshCollisionCar),o.setCollisionForDraw(s.meshCollisionCar),s.meshFinish.position.copy(s.mesh.position),t.addToScene(s.meshFinish);var c=new g.PlaneGeometry(u,u),l=function(i){for(var s=0;s<i.length;++s){var l=i[s].split("_"),h=+l[0]*u,p=+l[1]*u,b=new g.Mesh(c,n.floorMat);b.rotation.x=-Math.PI/2,b.position.set(h,-62,p),t.addToScene(b),r.push({mesh:b,keyLocation:i[s],type:"floor"}),a.addItemToPlayerCollision(b);for(var m=Math.floor(3*Math.random()),d=0;d<m;++d){console.log("!!!!!!!!!!!!!!!!! new tresh");var f=it(e),O=f.mesh,j=f.meshCollision,v=f.meshCollisionCar;O.position.set(h+Math.random()*u,-60,p+Math.random()*u),t.addToScene(O),j.visible=!1,j.position.copy(O.position),t.addToScene(j),a.addItemToPlayerCollision(j),v.visible=!1,v.position.copy(O.position),t.addToScene(v),o.setCollisionForDraw(v),r.push({mesh:O,meshCollision:j,meshCollisionCar:v,keyLocation:i[s],type:"trash"})}}};return{updateTrash:function(e,n){!function(e){for(var n=[],i=0;i<e.length;++i)for(var s=0;s<r.length;++s)e[i]===r[s].keyLocation&&n.push(r[s]);r=r.filter((function(t){for(var o=0;o<e.length;++o)if(t.keyLocation===e[o])return!1;return!0}));for(var c=0;c<n.length;++c){var l=n[c],u=l.mesh,h=l.meshCollision,p=l.meshCollisionCar;t.removeFromScene(u),n[c].mesh.geometry.dispose(),delete n[c].mesh,h&&(a.removeItemFromPlayerCollision(h),t.removeFromScene(h),n[c].meshCollision.geometry.dispose(),delete n[c].meshCollision),p&&(o.removeCollisionForDraw(p),t.removeFromScene(p),n[c].meshCollisionCar.geometry.dispose(),delete n[c].meshCollisionCar)}}(e),l(n)},createTresh:function(e){l(e)}}},Lt=(o(43),{ru:{"What is this place?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","It's The Great Way to the surface.":"\u042d\u0442\u043e \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0435\u0440\u0445.","Who are you?":"\u041a\u0442\u043e \u0442\u044b?","I help The Creator.":"\u042f \u043f\u043e\u043c\u043e\u0433\u0430\u044e \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044e.","What are you doing?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Don't distract me, I have to dig the tunnel.":"\u041d\u0435 \u043e\u0442\u0432\u043b\u0435\u043a\u0430\u0439, \u043c\u043d\u0435 \u043d\u0430\u0434\u043e \u043a\u043e\u043f\u0430\u0442\u044c \u0442\u0443\u043d\u043d\u0435\u043b\u044c.","Such enormous dungeons...":"\u0422\u0430\u043a\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u043e\u0434\u0437\u0435\u043c\u0435\u043b\u044c\u044f...","The Creator gave the order to dig.":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0438\u043a\u0430\u0437\u0430\u043b \u043a\u043e\u043f\u0430\u0442\u044c. ","How long have you been digging?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0432\u044b \u043a\u043e\u043f\u0430\u043b\u0438? ","Time does not matter, the goal is what's important.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0430\u0436\u043d\u0430 \u0446\u0435\u043b\u044c. ","What do you do here?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Long ago, the Creator fell under the ground. He created us and gave us an assignment to dig.":"\u0414\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0422\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b\u0441\u044f \u043f\u043e\u0434 \u0437\u0435\u043c\u043b\u044e. \u041e\u043d \u0441\u043e\u0437\u0434\u0430\u043b \u043d\u0430\u0441 \u0438 \u0434\u0430\u043b \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043f\u0430\u0442\u044c. ","But you already dug the way out...":"\u041d\u043e \u0432\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u0432\u044b\u0445\u043e\u0434 ...","When we dug a tunnel, The Creator went through it.":"\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u043f\u0443\u0442\u044c, \u0442\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0448\u0435\u043b \u043f\u043e \u043d\u0435\u043c\u0443.","And...":"\u0418...","We are made to dig. And we keep on doing it. We believe that he will return to us.":"\u041c\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u043f\u0430\u0442\u044c. \u0418 \u043c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c. \u041c\u044b \u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043e\u043d \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043a \u043d\u0430\u043c. ","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),Dt=E(Lt),It=Object(A.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(B.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(B.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:Dt(t.q)},Math.floor(1e5*Math.random()))}))})})),Et=E(Lt),Bt=Object(A.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(B.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(B.jsxs)("div",{children:[Object(B.jsx)("div",{className:"q",children:Et(e.q)}),Object(B.jsx)("div",{className:"a",children:Et(e.a)})]},Math.floor(1e5*Math.random()))}))})})),Nt=E(Lt);var Ft=Object(A.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocation:e.ui.currentLocation,locationsList:e.ui.locationsList}}))((function(e){return Object(B.jsxs)(B.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(B.jsx)("div",{className:"dialog-wrapper",children:Object(B.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(B.jsxs)("div",{className:"messages-wrapper",children:[Object(B.jsx)(Bt,{}),Object(B.jsx)(It,{})]}),e.isButtonDialog&&Object(B.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?Nt("close dialog"):Nt("open dialog")})]})}),e.isShowButtonDrawCar&&Object(B.jsx)("div",{className:"dialog-wrapper",children:Object(B.jsx)("div",{className:"dialog-content",children:Object(B.jsx)("button",{className:"draw-car-button",onClick:function(){return e.dispatch({type:"CLICK_DRAW"})},children:Nt(e.valButtonDrawCar)})})}),e.isShowButtonToggleOpenLocationsList&&!e.isLocationListOpened&&Object(B.jsx)("button",{className:"open-locations-car-button",onClick:function(){return e.dispatch({type:"OPEN_LOCATIONS_LIST"})},children:e.currentLocation}),e.isLocationListOpened&&Object(B.jsx)("div",{className:"list-locations",children:Object(B.jsx)("div",{children:e.locationsList.map((function(t){return Object(B.jsxs)("button",{onClick:function(){return e.dispatch({type:"SELECT_LOCATION",location:t})},children:[t,e.currentLocation===t&&"___v"]},Math.floor(1e6*Math.random()))}))})}),e.isShowFinalMessage&&Object(B.jsx)("div",{className:"final-mess",children:Nt("To be continued")})]})})),Rt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"draw car",currentBot:null,phraseIndex:0,isDialogComplete:!1,isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocation:"location01",locationsList:["location01","location02","location03"]},Gt=[{key:"emitter",constr:T,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(v.a)(this,e);var o=t.emitter,a=t.appWrapper;!a&&(a=document.querySelector(".app-wrapper")),o.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&n()}));var n=function(){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},r=function(e){a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||o.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:S,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:X,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(v.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return Y.a()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:ne,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:re,initStateKey:"beforeStartPlay"},{key:"player",constr:ie,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:Me,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(v.a)(this,e);var o=t.assets,a=t.CONSTANTS;t.materials=se(o,a.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"car",constr:_e,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:Ce,key:"car"},{type:"obj",path:we,key:"carCollision"}]},{key:"system_Level",constr:function e(t){Object(v.a)(this,e),this._root=t;var o=t.assets,a=t.materials,n=ce(o,a).items;this._items=n,console.log("system_level_items",this._items),n.body.material=a.car,this._items.location_collision_01.visible=!1,this._items.location_collision_02.visible=!1,this._items.location_collision_03.visible=!1;var r=new g.Mesh(new g.BoxGeometry(15,15,15),new g.MeshBasicMaterial({color:16776960}));this._items.location01_person.geometry.computeBoundingSphere();var i=[this._items.location01_person.geometry.boundingSphere.center.x,this._items.location01_person.geometry.boundingSphere.center.y,this._items.location01_person.geometry.boundingSphere.center.z];this._items.location02_person.geometry.computeBoundingSphere();var s=[this._items.location02_person.geometry.boundingSphere.center.x,this._items.location02_person.geometry.boundingSphere.center.y,this._items.location02_person.geometry.boundingSphere.center.z];this._items.location03_person.geometry.computeBoundingSphere();var c=[this._items.location03_person.geometry.boundingSphere.center.x,this._items.location03_person.geometry.boundingSphere.center.y,this._items.location03_person.geometry.boundingSphere.center.z];this.locations={location01:{mesh:this._items.location01,carCollision:this._items.location_collision_01,personOffset:i,personCollision:r},location02:{mesh:this._items.location02,carCollision:this._items.location_collision_02,personOffset:s,personCollision:r},location03:{mesh:this._items.location03,carCollision:this._items.location_collision_03,personOffset:c,personCollision:r}}},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:le,key:"level-rooms"},{type:"obj",path:Se,key:"body"},{type:"cubeTextures",path:[me,me,me,me,me,me],key:"skyBox"},{type:"cubeTextures",path:[de,fe,Oe,je,ve,ye],key:"skyBox2"},{type:"img",path:ue,key:"mapFloorOuter",wrap:!0},{type:"img",path:pe,key:"mapTop",wrap:!0},{type:"img",path:he,key:"mapVirtual",wrap:!0},{type:"img",path:be,key:"mapParams"}]},{key:"system_PlayerMoveOnLevel",constr:Te,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(v.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=Ft,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rt,o=arguments.length>1?arguments[1]:void 0;if("OPEN_LOCATIONS_LIST"===o.type)return Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!0});if("SELECT_LOCATION"===o.type)return e.actions.changeTargetLocation({key:o.location}),Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!1,currentLocation:o.location});if("CLICK_PHRASE"===o.type)return Object(D.a)(Object(D.a)({},t),{},{botAnswers:[].concat(Object(Pe.a)(t.botAnswers),[o.phrase]),userReplicies:[]});if("PHRASE_EVENT"===o.type){var a=o.phrase,n=a.event;if(a.levelEvent,"nextReply"===n){var r=[t.phrasesData[t.currentBot][t.phraseIndex+1]];return Object(D.a)(Object(D.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:r})}if("close"===n)return 20===t.currentBot&&setTimeout((function(){e.dispatcher.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),e.dispatcher.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!1}),e.player.toggleBlocked(!0),setTimeout((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),Object(D.a)(Object(D.a)({},t),{},{userReplicies:[],isDialogComplete:!0,isButtonDialog:!0})}if("TOGGLE_DIALOG"===o.type){var i=[];return e.player.toggleBlocked(o.isShowPalleteDialog),o.isShowPalleteDialog&&(i=t.isDialogComplete?[]:[t.phrasesData[t.currentBot][t.phraseIndex]]),Object(D.a)(Object(D.a)({},t),{},{isShowPalleteDialog:o.isShowPalleteDialog,userReplicies:i})}if("TOGGLE_BUTTON"===o.type){var s=t.botAnswers,c=t.phraseIndex,l=t.isDialogComplete;return o.currentBot&&o.currentBot!==t.currentBot&&(s=[],c=0,l=!1),Object(D.a)(Object(D.a)({},t),{},{phraseIndex:c,currentBot:o.currentBot||t.currentBot,isButtonDialog:o.isButtonDialog,isDialogComplete:l,botAnswers:s})}return"SHOW_FINAL_MESSAGE"===o.type?Object(D.a)(Object(D.a)({},t),{},{isShowFinalMessage:!0}):"TOGGLE_BUTTON_DRAW_CAR"===o.type?Object(D.a)(Object(D.a)({},t),{},{isShowButtonDrawCar:o.is}):"CLICK_DRAW"===o.type?"draw car"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(D.a)(Object(D.a)({},t),{},{valButtonDrawCar:"exit car"})):(e.actions.clickMachineExit(),Object(D.a)(Object(D.a)({},t),{},{valButtonDrawCar:"draw car"})):t}}}(t);var o=new Q(t);t.ui=o},initStateKey:"pageLoaded"},{key:"actions",constr:kt,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(Gt,a)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.881597bc.chunk.js.map