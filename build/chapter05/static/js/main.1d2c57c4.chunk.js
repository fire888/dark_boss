(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{39:function(e,t,a){},41:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var o={};a.r(o),a.d(o,"SIZE_QUADRANT",(function(){return u})),a.d(o,"LOCATIONS_QUADRANTS",(function(){return h})),a.d(o,"CONFIG_FOR_INIT",(function(){return p})),a.d(o,"lCol",(function(){return b})),a.d(o,"lW",(function(){return m})),a.d(o,"MATERIALS_CONFIG",(function(){return d})),a.d(o,"START_ENV_CONFIG",(function(){return f})),a.d(o,"studioConfig",(function(){return O})),a.d(o,"playerConfig",(function(){return j}));var n=a(11),r=a.n(n),i=a(12);function s(){return(s=Object(i.a)(r.a.mark((function e(t,a){var o,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,o={CONSTANTS:a}),n=o.loaderAssets,i=l(t),e.next=6,n.loadAssets(i);case 6:o.assets=e.sent,c("beforeStartPlay",t,o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,a){for(var o=0;o<t.length;++o){var n=t[o],r=n.key,i=n.constr;n.initStateKey===e&&(a[r]=new i(a))}},l=function(e){for(var t=[],a=0;a<e.length;++a)if(e[a].assetsToLoad&&e[a].assetsToLoad.length)for(var o=0;o<e[a].assetsToLoad.length;++o)t.push(e[a].assetsToLoad[o]);return t},u=2e3,h={"0_0":"location01","0_-3":"location02","3_-1":"location03"},p={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},b=[.3,1,.3],m=.2,d={wallVirtual:{mat:"MeshStandardMaterial",props:{color:16711935,emissive:0}},wallVirtualColor:{mat:"MeshBasicMaterial",props:{color:16777215,emissive:4369,map:"mapParams",bumpMap:"mapParams",bumpScale:.1,specular:255,vertexColors:!0}},car:{mat:"MeshPhongMaterial",props:{color:255,emissive:0,reflectivity:.5,shininess:.5,specular:16777215}},floorMat:{mat:"MeshStandardMaterial",props:{color:17408}},testRed:{mat:"MeshBasicMaterial",props:{color:16711680}}},f={fogNear:500,fogFar:1500,color:43520},O={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},sceneEnvironment:f,composerAddPass:"Saturate"},j={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},v=a(2),y=a(3),g=a(1),_=a(21),C=a(22),w=function(){var e=null,t=null,a=null,o=null,n=null;return function(r,i){return new Promise((function(s){(function(r){return"obj"===r?e=e||new _.a:"glb"===r||"gltf"===r?a=a||new C.a:"img"===r?t=t||new g.TextureLoader:"cubeTextures"===r?o=o||new g.CubeTextureLoader:"soundMp3"===r?n=n||new g.AudioLoader:void 0})(i).load(r,s)}))}},S=function(){function e(){Object(v.a)(this,e),this.resources={},this._load=w()}return Object(y.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(a){var o=t._load,n=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(r.a.mark((function t(i){var c,l,u,h;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,o(u,h);case 4:n[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}a(n),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),M=function(){function e(){Object(v.a)(this,e),this._storage={}}return Object(y.a)(e,[{key:"emit",value:function(e){var t=this;return function(a){return T(t._storage)(e).forEach((function(e){return e(a)}))}}},{key:"subscribe",value:function(e){var t=this;return function(a){return T(t._storage)(e).push(a),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==a}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),T=function(e){return function(t){return e[t]=e[t]||[]}},x=a(5),k=a(17),P=a.n(k),A=a(8),L=a(10),D=a(6),I=(a(39),"en"),E=function(e){return function(t){return e[I]&&e[I][t]||t}},N=a(4),F=E({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),B=Object(A.b)((function(e){return Object(D.a)({},e.controls.infoPanelData)}))((function(e){return Object(N.jsxs)("div",{className:"info",children:[Object(N.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(N.jsxs)("div",{className:"info-inner",children:[Object(N.jsx)("p",{children:F(e.title)}),Object(N.jsx)("p",{children:F(e.topText)}),Object(N.jsx)("ul",{children:e.chapters.map((function(t,a){return Object(N.jsxs)("li",{children:[a+1,".\xa0",t.href?Object(N.jsx)("span",{children:Object(N.jsx)("a",{href:t.href,target:"blank",children:F(t.text)})}):Object(N.jsx)("span",{children:F(t.text)}),a===e.currentChapterIndex&&F(" (current)")]},a)}))}),Object(N.jsx)("p",{children:e.bottomText}),Object(N.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(N.jsxs)("li",{children:[F(e.text),Object(N.jsx)("a",{href:e.href,target:"blank",children:F(e.aText)})]},t)}))})]})]})})),R=(a(41),Object(A.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(x.useState)(!0),a=Object(L.a)(t,2),o=a[0],n=a[1];return Object(x.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&n(!0)}))})),Object(N.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(N.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(N.jsx)(N.Fragment,{children:"\u27fc"}):Object(N.jsx)(N.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&o&&Object(N.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),n(!1)},children:"\u2752"}),!e.isInfo&&Object(N.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(N.jsx)(B,{})]})})));var z={dispatch:null},G=Object(A.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!z.dispatch&&(z.dispatch=e.dispatch),Object(N.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(N.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(N.jsx)(R,{gameContext:e.gameContext})]})})),W=a(15),U=a(24),K={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var V=document.querySelector(".progress"),q=-100,H=!0;!function e(){H&&setTimeout((function(){0===++q&&(q-=100),V.style.marginLeft=q+"%",e()}),30)}();var Q=function(){function e(t){Object(v.a)(this,e),t.dispatcher=z,this._root=t;var a=function(e){e.customStore||(e.customStore={});var t=Object(W.b)(Object(D.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(D.a)(Object(D.a)({},e),{},{infoPanelData:Object(D.a)(Object(D.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(D.a)(Object(D.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(D.a)(Object(D.a)({},e),{},{isMute:t.is}):Object(D.a)({},e)}},e.customStore)),a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||W.c;return Object(W.d)(t,a(Object(W.a)(U.a)))}(t);a&&P.a.render(Object(N.jsx)(A.a,{store:a,children:Object(N.jsx)(G,{gameContext:t})}),document.getElementById("root"))}return Object(y.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),a=document.querySelector(".progress-wrapper"),o=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,I=t),document.querySelector(".start-screen").style.display="none"};H=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),o(t)})),a.style.display="none"}}]),e}(),Z=a(46),X=function(){function e(){var t=this;Object(v.a)(this,e),this._subscribers=[];var a={time:0,delta:0,count:0,oldTime:0},o=Z.a((function(){return a}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var a=0;a<t._subscribers.length;++a)t._subscribers[a](Object(D.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return a=e}));!function e(){requestAnimationFrame(e),o(a)}()}return Object(y.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),Y=a(19),J=a(27),$=a(26),ee=a(14),te={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},ae={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},oe=a(25),ne=function(){function e(t){var a=this;Object(v.a)(this,e),this._root=t;var o=t.assets,n=t.emitter,r=t.CONSTANTS.studioConfig,i=r.canId,s=r.rendererCon,c=(r.clearColor,r.amb);s.canvas=document.getElementById(i),this._renderer=new g.WebGLRenderer(s),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new g.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,u=l.color,h=l.fogNear,p=l.fogFar,b=l.backgroundImgKey;this._scene.background=o[b]||null,this._scene.fog=new g.Fog(u,h,p);c.color,c.strength;this._lightA=new g.AmbientLight(16777215,.2),this._scene.add(this._lightA);var m=new g.DirectionalLight(16777215,.6);m.position.set(1,1,.5),this._scene.add(m);var d=new g.DirectionalLight(16777215,.4);d.position.set(-1,-.1,-.4),this._scene.add(d),this._playerCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new g.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var f=new oe.a(this._controlsCamera,this._renderer.domElement);f.target.set(0,0,0),f.update(),this._composer=new J.a(this._renderer),this._renderPass=new $.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(te)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(ae)));var O=new g.Vector3,j=!0;n.subscribe("keyEvent")((function(e){e.o&&(j?(j=!1,a._renderPass.camera=a._controlsCamera,a._playerCamera.getWorldPosition(O),a._controlsCamera.position.x=O.x+100,a._controlsCamera.position.y=O.y+100,a._controlsCamera.position.z=O.z,f.target.set(O.x,O.y,O.z),f.update()):(j=!0,a._renderPass.camera=a._playerCamera))}));var y=function(){var e={width:window.innerWidth,height:window.innerHeight};a._renderer.setSize(e.width,e.height),a._composer.setSize(e.width,e.height),a._controlsCamera&&(a._controlsCamera.aspect=e.width/e.height,a._controlsCamera.updateProjectionMatrix()),a._playerCamera&&(a._playerCamera.aspect=e.width/e.height,a._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",y),y(),this.addToScene=function(e){return a._scene.add(e)},this.removeFromScene=function(e){return a._scene.remove(e)},this.drawFrame=function(){a._composer.render(a._scene,a._controlsCamera)},n.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(y.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),re=function(){function e(t){Object(v.a)(this,e);var a=t.emitter,o={up:!1,down:!1,left:!1,right:!1,p:!1},n={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=n,this.keys=o;var r=function(e,t){switch(e){case 38:case 87:n.up&&(o.up=t);break;case 40:case 83:n.down&&(o.down=t);break;case 37:case 65:o.left=t;break;case 39:case 68:o.right=t;break;case 79:o.o=t;break;case 80:o.p=t}a.emit("keyEvent")(o)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),a.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),a.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(y.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ie=function(){function e(t){Object(v.a)(this,e);var a=t.studio,o=t.CONSTANTS.playerConfig,n=(o.startPos,o.startRot,o.cameraData),r=(o.frontObjPos,o.backObjPos,o.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new g.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new g.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new g.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new g.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=n.fov,s=n.ratio,c=n.near,l=n.far;n.pos;if(this._camera=new g.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),r){var u=r.color,h=r.strenth,p=r.pos,b=new g.PointLight(u,h);b.position.fromArray(p),this.mesh.add(b)}a.setCamera(this._camera),a.addToScene(this.mesh)}return Object(y.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,a){this.mesh.position.set(e,t,a)}}]),e}(),se=function(e,t){for(var a in e)e[a].wrapS&&(e[a].wrapS=e[a].wrapT=g.RepeatWrapping);var o=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],n={},r=function(a){n[a]=new g[t[a].mat](Object(D.a)({},t[a].props)),o.map((function(o){return t[a].props[o]&&(n[a][o]=e[t[a].props[o]])}))};for(var i in t)r(i);return n},ce=function(e,t){var a={};return e["level-rooms"].traverse((function(e){e.geometry&&(a[e.name]=e,e.material=t.wallVirtual),e.name.includes("level")&&("level_000_000"===e.name&&(new g.Mesh(e.geometry,t.wallVirtual).name=e.name),"level_001_000"===e.name&&(new g.Mesh(e.geometry,t.wallVirtual).name=e.name))})),{items:a}},le=a.p+"static/media/level.21832d73.obj",ue=a.p+"static/media/floor_outer_map3.558e9646.jpg",he=(a.p,a.p+"static/media/map01.48219503.jpg"),pe=a.p+"static/media/floor_outer_map.35e50f6e.jpg",be=a.p+"static/media/txt1.b67888d5.jpg",me=a.p+"static/media/px.8a9030e7.jpg",de=a.p+"static/media/nx.dc0a1bc7.jpg",fe=a.p+"static/media/py.ed7a276e.jpg",Oe=a.p+"static/media/ny.75a01d7a.jpg",je=a.p+"static/media/pz.3cf6bf7f.jpg",ve=a.p+"static/media/nz.c24a9aad.jpg",ye=a.p+"static/media/px.96d0b65f.jpg",ge=a.p+"static/media/nx.8cbf039d.jpg",_e=a.p+"static/media/py.659ebc34.jpg",Ce=a.p+"static/media/ny.09051a4e.jpg",we=a.p+"static/media/pz.a1539724.jpg",Se=a.p+"static/media/nz.0bc769f7.jpg",Me=function(){function e(){Object(v.a)(this,e),this._arrMeshes=[],this._vecStart=new g.Vector3,this._vecDir=new g.Vector3,this._rayCaster=new g.Raycaster(this._vecStart,this._vecDir)}return Object(y.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,a){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var o=this._rayCaster.intersectObjects(this._arrMeshes);return o[0]&&o[0].distance<a?[!0,o[0]]:[!1,null]}}]),e}(),Te=function(){function e(t){var a=this;Object(v.a)(this,e);var o=t.assets,n=t.CONSTANTS,r=t.emitter,i=t.materials,s=(t.system_Level,n.CONFIG_FOR_INIT.currentSceneConfig.carProps),c=s.position,l=s.rotation;this._model=o.car.children[0],this._model.material=i.car,this._camera=new g.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=28,this._model.add(this._camera),this._model.position.fromArray(c),this._model.rotation.fromArray(l),this._collision=o.carCollision.children[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new g.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new g.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){a._compass=function(e){e.assets;var t=e.studio,a=e.system_Level._items.arrow;a.material=e.materials.car;var o=new g.Mesh(new g.BoxGeometry(10,10,10),new g.MeshBasicMaterial({color:16711680}));o.position.set(-500,-30,-500),t.addToScene(o);var n=new g.Mesh(new g.BoxGeometry(10,10,10),new g.MeshBasicMaterial({color:16711680}));return n.position.set(0,0,0),t.addToScene(o),new g.Vector3,{addToParent:function(e){e.add(a)},setArrowPosition:function(e,t,o){a.position.set(e,t,o)},setTargetPosition:function(e){o.position.copy(e)},update:function(){n.position.copy(a.parent.position),n.lookAt(o.position),a.parent.position.z<o.position.z?a.rotation.y=-a.parent.rotation.y+n.rotation.y:a.rotation.y=-a.parent.rotation.y-n.rotation.y+Math.PI}}}(t),a._compass.addToParent(a._model),a._compass.setArrowPosition(0,23,-11.5),a.setTargetPosition=function(e){a._compass.setTargetPosition(e),a._compass.update()}})),this._collisionsWalls=new Me;var u=function(e,t){var o=a._collisionsWalls.checkCollisions(a._model,e,t);return Object(L.a)(o,1)[0]};this.isFreeze=!0;var h={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!a.isFreeze){if(a._spd<0&&(u(a._frontObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),a._spd>0&&(u(a._backObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),h.up&&(a._spd-=a._acc),h.down&&(a._spd+=a._acc),Math.abs(a._spd)>.001){a._spd>0&&(a._spd-=a._deceleration,a._spd<0&&(a._spd=0)),a._spd<0&&(a._spd+=a._deceleration,a._spd>0&&(a._spd=0)),a._spd=Math.min(a._maxSpdBack,Math.max(a._maxSpdFront,a._spd));var t=Math.min(1,Math.max(0,Math.abs(a._spd)));h.left&&(a._spd<0&&(a._model.rotation.y+=a._spdRot*t),a._spd>0&&(a._model.rotation.y-=a._spdRot*t)),h.right&&(a._spd<0&&(a._model.rotation.y-=a._spdRot*t),a._spd>0&&(a._model.rotation.y+=a._spdRot*t))}else a._spd=0;a._isCarStay&&0!==a._spd&&(a._isCarStay=!1,a._onChangeStateIsStay("carStart")),a._isCarStay||0!==a._spd||(a._isCarStay=!0,a._onChangeStateIsStay("carStop"))}},r.subscribe("keyEvent")((function(e){return h=e}))}return Object(y.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}}]),e}(),xe=a.p+"static/media/car.8c016cb9.obj",ke=a.p+"static/media/car_collision.66478aff.obj",Pe=a.p+"static/media/body.bb8da675.obj",Ae=function(){function e(t){var a=this;Object(v.a)(this,e);var o=t.emitter,n=t.CONSTANTS,r=t.player;t.assets,t.studio;r.mesh.position.fromArray([0,0,0]);var i=new Me,s=n.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;r.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},r.toggleCanMove=function(e,t){return a.isCanMove[e]=t},this.isFreeze=!1;var p={};this.update=function(e){a.isFreeze||(p.left&&r.mesh.rotateY(u*e.count),p.right&&r.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(r.mesh,r.bottomObj,17.2),a=Object(L.a)(t,2),o=a[0],n=a[1];o&&17>n.distance?r.mesh.translateY(17-n.distance):o||(r.mesh.position.y+=l*e.count)}(e),p.up&&a.isCanMove.forward&&function(e){var t=i.checkCollisions(r.mesh,r.frontObj,17),a=Object(L.a)(t,2),n=a[0],s=a[1];n?s.object.userData.type&&"alert"===s.object.userData.type&&o.emit("collision")(s.object.userData.event):(r.mesh.translateZ(-c*e.count),o.emit("playerMove")("forward"))}(e),p.down&&a.isCanMove.back&&function(e){var t=i.checkCollisions(r.mesh,r.backObj,17);Object(L.a)(t,1)[0]||(r.mesh.translateZ(c*e.count),o.emit("playerMove")("back"))}(e),p.p&&console.log("player.mesh.position.fromArray([".concat(r.mesh.position.x,", ").concat(r.mesh.position.y,", ").concat(r.mesh.position.z,"])"))))},o.subscribe("keyEvent")((function(e){return p=e})),this._collisionsWalls=i}return Object(y.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),Le=function(){function e(t){var a=this;Object(v.a)(this,e),this._root=t;var o=t.emitter,n=t.player;this._itemsToCheck=[],o.subscribe("playerMove")((function(){for(var e=0;e<a._itemsToCheck.length;++e){var t=n.mesh.position.distanceTo(a._itemsToCheck[e].position);if(!a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<a._itemsToCheck[e].userData.nearPlayerItemNear)return a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>a._itemsToCheck[e].userData.nearPlayerItemNear&&(a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(y.a)(e,[{key:"setItemToCheck",value:function(e,t,a,o){for(var n=0;n<this._itemsToCheck.length;++n)if(e===this._itemsToCheck[n])return;t&&(e.userData.nearPlayerItemKey=t),a&&(e.userData.nearPlayerItemNear=a),o&&(e.userData.nearPlayerItemFar=o),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),De=function(e,t){for(var a=[],o=e-1;o<e+2;++o)for(var n=t-1;n<t+2;++n)a.push(o+"_"+n);return a},Ie=function(e,t){for(var a=[],o=0;o<e.length;++o){for(var n=!1,r=0;r<t.length;++r)e[o]===t[r]&&(n=!0);n||a.push(e[o])}return a},Ee=a(0),Ne=Float32Array;function Fe(e,t,a){return(a=a||new Ne(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a}function Be(e,t){t=t||new Ne(3);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return a>1e-5&&(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a),t}function Re(e,t,a){return(a=a||new Ne(3))[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a}function ze(e,t){var a=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2];return a*a+o*o+n*n}function Ge(e,t){t=t||new Ne(16);var a=e[0],o=e[1],n=e[2],r=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],p=e[10],b=e[11],m=e[12],d=e[13],f=e[14],O=e[15],j=p*O,v=f*b,y=c*O,g=f*l,_=c*b,C=p*l,w=n*O,S=f*r,M=n*b,T=p*r,x=n*l,k=c*r,P=u*d,A=m*h,L=i*d,D=m*s,I=i*h,E=u*s,N=a*d,F=m*o,B=a*h,R=u*o,z=a*s,G=i*o,W=j*s+g*h+_*d-(v*s+y*h+C*d),U=v*o+w*h+T*d-(j*o+S*h+M*d),K=y*o+S*s+x*d-(g*o+w*s+k*d),V=C*o+M*s+k*h-(_*o+T*s+x*h),q=1/(a*W+i*U+u*K+m*V);return t[0]=q*W,t[1]=q*U,t[2]=q*K,t[3]=q*V,t[4]=q*(v*i+y*u+C*m-(j*i+g*u+_*m)),t[5]=q*(j*a+S*u+M*m-(v*a+w*u+T*m)),t[6]=q*(g*a+w*i+k*m-(y*a+S*i+x*m)),t[7]=q*(_*a+T*i+x*u-(C*a+M*i+k*u)),t[8]=q*(P*l+D*b+I*O-(A*l+L*b+E*O)),t[9]=q*(A*r+N*b+R*O-(P*r+F*b+B*O)),t[10]=q*(L*r+F*l+z*O-(D*r+N*l+G*O)),t[11]=q*(E*r+B*l+G*b-(I*r+R*l+z*b)),t[12]=q*(L*p+E*f+A*c-(I*f+P*c+D*p)),t[13]=q*(B*f+P*n+F*p-(N*p+R*f+A*n)),t[14]=q*(N*c+G*f+D*n-(z*f+L*n+F*c)),t[15]=q*(z*p+I*n+R*c-(B*c+G*p+E*n)),t}var We={copy:function(e,t){return(t=t||new Ne(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,a,o){o=o||new Ne(16);var n=Be(Fe(e,t)),r=Be(Re(a,n)),i=Be(Re(n,r));return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=0,o[4]=i[0],o[5]=i[1],o[6]=i[2],o[7]=0,o[8]=n[0],o[9]=n[1],o[10]=n[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},addVectors:function(e,t,a){return(a=a||new Ne(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},subtractVectors:Fe,scaleVector:function(e,t,a){return(a=a||new Ne(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},distance:function(e,t){return Math.sqrt(ze(e,t))},distanceSq:ze,normalize:Be,compose:function(e,t,a,o){o=o||new Ne(16);var n=t[0],r=t[1],i=t[2],s=t[3],c=n+n,l=r+r,u=i+i,h=n*c,p=n*l,b=n*u,m=r*l,d=r*u,f=i*u,O=s*c,j=s*l,v=s*u,y=a[0],g=a[1],_=a[2];return o[0]=(1-(m+f))*y,o[1]=(p+v)*y,o[2]=(b-j)*y,o[3]=0,o[4]=(p-v)*g,o[5]=(1-(h+f))*g,o[6]=(d+O)*g,o[7]=0,o[8]=(b+j)*_,o[9]=(d-O)*_,o[10]=(1-(h+m))*_,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},cross:Re,decompose:function(e,t,a,o){var n=We.length(e.slice(0,3)),r=We.length(e.slice(4,7)),i=We.length(e.slice(8,11));(function(e){var t=e[0],a=e[1],o=e[2],n=e[3],r=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],b=e[12],m=e[13],d=e[14],f=e[15],O=h*f,j=d*p,v=s*f,y=d*c,g=s*p,_=h*c,C=o*f,w=d*n,S=o*p,M=h*n,T=o*c,x=s*n;return 1/(t*(O*i+y*u+g*m-(j*i+v*u+_*m))+r*(j*a+C*u+M*m-(O*a+w*u+S*m))+l*(v*a+w*i+T*m-(y*a+C*i+x*m))+b*(_*a+S*i+x*u-(g*a+M*i+T*u)))})(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=We.copy(e),c=1/n,l=1/r,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var a=e[0],o=e[4],n=e[8],r=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=a+i+u;if(h>0){var p=.5/Math.sqrt(h+1);t[3]=.25/p,t[0]=(l-s)*p,t[1]=(n-c)*p,t[2]=(r-o)*p}else if(a>i&&a>u){var b=2*Math.sqrt(1+a-i-u);t[3]=(l-s)/b,t[0]=.25*b,t[1]=(o+r)/b,t[2]=(n+c)/b}else if(i>u){var m=2*Math.sqrt(1+i-a-u);t[3]=(n-c)/m,t[0]=(o+r)/m,t[1]=.25*m,t[2]=(s+l)/m}else{var d=2*Math.sqrt(1+u-a-i);t[3]=(r-o)/d,t[0]=(n+c)/d,t[1]=(s+l)/d,t[2]=.25*d}}(s,a),o[0]=n,o[1]=r,o[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new Ne(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new Ne(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,a,o,n,r,i){return(i=i||new Ne(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(o-a),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-r),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(a+o)/(a-o),i[14]=(n+r)/(n-r),i[15]=1,i},frustum:function(e,t,a,o,n,r,i){var s=t-e,c=o-a,l=r-n;return(i=i||new Ne(16))[0]=2*n/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(o+a)/c,i[10]=-(r+n)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*n*r/l,i[15]=0,i},perspective:function(e,t,a,o,n){n=n||new Ne(16);var r=Math.tan(.5*Math.PI-.5*e),i=1/(a-o);return n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(a+o)*i,n[11]=-1,n[12]=0,n[13]=0,n[14]=a*o*i*2,n[15]=0,n},translation:function(e,t,a,o){return(o=o||new Ne(16))[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=e,o[13]=t,o[14]=a,o[15]=1,o},translate:function(e,t,a,o,n){n=n||new Ne(16);var r=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],p=e[7],b=e[8],m=e[9],d=e[10],f=e[11],O=e[12],j=e[13],v=e[14],y=e[15];return e!==n&&(n[0]=r,n[1]=i,n[2]=s,n[3]=c,n[4]=l,n[5]=u,n[6]=h,n[7]=p,n[8]=b,n[9]=m,n[10]=d,n[11]=f),n[12]=r*t+l*a+b*o+O,n[13]=i*t+u*a+m*o+j,n[14]=s*t+h*a+d*o+v,n[15]=c*t+p*a+f*o+y,n},xRotation:function(e,t){t=t||new Ne(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=o,t[7]=0,t[8]=0,t[9]=-o,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new Ne(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=0,t[2]=-o,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=o,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new Ne(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=o,t[2]=0,t[3]=0,t[4]=-o,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,a){a=a||new Ne(16);var o=e[4],n=e[5],r=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[4]=h*o+p*s,a[5]=h*n+p*c,a[6]=h*r+p*l,a[7]=h*i+p*u,a[8]=h*s-p*o,a[9]=h*c-p*n,a[10]=h*l-p*r,a[11]=h*u-p*i,e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},yRotate:function(e,t,a){a=a||new Ne(16);var o=e[0],n=e[1],r=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o-p*s,a[1]=h*n-p*c,a[2]=h*r-p*l,a[3]=h*i-p*u,a[8]=h*s+p*o,a[9]=h*c+p*n,a[10]=h*l+p*r,a[11]=h*u+p*i,e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},zRotate:function(e,t,a){a=a||new Ne(16);var o=e[0],n=e[1],r=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o+p*s,a[1]=h*n+p*c,a[2]=h*r+p*l,a[3]=h*i+p*u,a[4]=h*s-p*o,a[5]=h*c-p*n,a[6]=h*l-p*r,a[7]=h*u-p*i,e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},axisRotation:function(e,t,a){a=a||new Ne(16);var o=e[0],n=e[1],r=e[2],i=Math.sqrt(o*o+n*n+r*r),s=(o/=i)*o,c=(n/=i)*n,l=(r/=i)*r,u=Math.cos(t),h=Math.sin(t),p=1-u;return a[0]=s+(1-s)*u,a[1]=o*n*p+r*h,a[2]=o*r*p-n*h,a[3]=0,a[4]=o*n*p-r*h,a[5]=c+(1-c)*u,a[6]=n*r*p+o*h,a[7]=0,a[8]=o*r*p+n*h,a[9]=n*r*p-o*h,a[10]=l+(1-l)*u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},axisRotate:function(e,t,a,o){o=o||new Ne(16);var n=t[0],r=t[1],i=t[2],s=Math.sqrt(n*n+r*r+i*i),c=(n/=s)*n,l=(r/=s)*r,u=(i/=s)*i,h=Math.cos(a),p=Math.sin(a),b=1-h,m=c+(1-c)*h,d=n*r*b+i*p,f=n*i*b-r*p,O=n*r*b-i*p,j=l+(1-l)*h,v=r*i*b+n*p,y=n*i*b+r*p,g=r*i*b-n*p,_=u+(1-u)*h,C=e[0],w=e[1],S=e[2],M=e[3],T=e[4],x=e[5],k=e[6],P=e[7],A=e[8],L=e[9],D=e[10],I=e[11];return o[0]=m*C+d*T+f*A,o[1]=m*w+d*x+f*L,o[2]=m*S+d*k+f*D,o[3]=m*M+d*P+f*I,o[4]=O*C+j*T+v*A,o[5]=O*w+j*x+v*L,o[6]=O*S+j*k+v*D,o[7]=O*M+j*P+v*I,o[8]=y*C+g*T+_*A,o[9]=y*w+g*x+_*L,o[10]=y*S+g*k+_*D,o[11]=y*M+g*P+_*I,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},scaling:function(e,t,a,o){return(o=o||new Ne(16))[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},scale:function(e,t,a,o,n){return(n=n||new Ne(16))[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n[3]=t*e[3],n[4]=a*e[4],n[5]=a*e[5],n[6]=a*e[6],n[7]=a*e[7],n[8]=o*e[8],n[9]=o*e[9],n[10]=o*e[10],n[11]=o*e[11],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},multiply:function(e,t,a){a=a||new Ne(16);var o=t[0],n=t[1],r=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],b=t[10],m=t[11],d=t[12],f=t[13],O=t[14],j=t[15],v=e[0],y=e[1],g=e[2],_=e[3],C=e[4],w=e[5],S=e[6],M=e[7],T=e[8],x=e[9],k=e[10],P=e[11],A=e[12],L=e[13],D=e[14],I=e[15];return a[0]=o*v+n*C+r*T+i*A,a[1]=o*y+n*w+r*x+i*L,a[2]=o*g+n*S+r*k+i*D,a[3]=o*_+n*M+r*P+i*I,a[4]=s*v+c*C+l*T+u*A,a[5]=s*y+c*w+l*x+u*L,a[6]=s*g+c*S+l*k+u*D,a[7]=s*_+c*M+l*P+u*I,a[8]=h*v+p*C+b*T+m*A,a[9]=h*y+p*w+b*x+m*L,a[10]=h*g+p*S+b*k+m*D,a[11]=h*_+p*M+b*P+m*I,a[12]=d*v+f*C+O*T+j*A,a[13]=d*y+f*w+O*x+j*L,a[14]=d*g+f*S+O*k+j*D,a[15]=d*_+f*M+O*P+j*I,a},inverse:Ge,transformVector:function(e,t,a){a=a||new Ne(4);for(var o=0;o<4;++o){a[o]=0;for(var n=0;n<4;++n)a[o]+=t[n]*e[4*n+o]}return a},transformPoint:function(e,t,a){a=a||new Ne(3);var o=t[0],n=t[1],r=t[2],i=o*e[3]+n*e[7]+r*e[11]+e[15];return a[0]=(o*e[0]+n*e[4]+r*e[8]+e[12])/i,a[1]=(o*e[1]+n*e[5]+r*e[9]+e[13])/i,a[2]=(o*e[2]+n*e[6]+r*e[10]+e[14])/i,a},transformDirection:function(e,t,a){a=a||new Ne(3);var o=t[0],n=t[1],r=t[2];return a[0]=o*e[0]+n*e[4]+r*e[8],a[1]=o*e[1]+n*e[5]+r*e[9],a[2]=o*e[2]+n*e[6]+r*e[10],a},transformNormal:function(e,t,a){a=a||new Ne(3);var o=Ge(e),n=t[0],r=t[1],i=t[2];return a[0]=n*o[0]+r*o[1]+i*o[2],a[1]=n*o[4]+r*o[5]+i*o[6],a[2]=n*o[8]+r*o[9]+i*o[10],a},setDefaultType:function(e){var t=Ne;return Ne=e,t}},Ue=(Math.floor,Math.random),Ke=function(e,t){return e+Ue()*(t-e)},Ve=function(e,t,a,o){return[].concat(Object(Ee.a)(e),Object(Ee.a)(t),Object(Ee.a)(a),Object(Ee.a)(e),Object(Ee.a)(a),Object(Ee.a)(o))},qe=function(e,t,a,o){return[].concat(Object(Ee.a)(e),Object(Ee.a)(t),Object(Ee.a)(a),Object(Ee.a)(e),Object(Ee.a)(a),Object(Ee.a)(o))},He=function(e){return[].concat(Object(Ee.a)(e),Object(Ee.a)(e),Object(Ee.a)(e),Object(Ee.a)(e),Object(Ee.a)(e),Object(Ee.a)(e))},Qe=function(e,t,a,o,n,r){var i=t[0]-e[0],s=a[1]-e[1],c=Ke(.3*i,.7*i),l=Ke(.3*s,.7*s),u=e[0]+(i-c)/2,h=t[0]-(i-c)/2,p=e[1]+(s-l)/2,b=a[1]-(s-l)/2,m=[u,p,e[2]],d=[h,p,e[2]],f=[h,b,e[2]],O=[u,b,e[2]],j=[];return j.push.apply(j,Object(Ee.a)(Ve(m,d,f,O)).concat(Object(Ee.a)(Ve(e,t,d,m)),Object(Ee.a)(Ve(d,t,a,f)),Object(Ee.a)(Ve(O,f,a,o)),Object(Ee.a)(Ve(e,m,O,o)))),{vArr:j,cArr:Ze(n,r),uArr:[].concat(Object(Ee.a)(qe([.5,.5],[1,.5],[1,1],[.5,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(Ee.a)(qe([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(Ee.a)(qe([.1,.9],[.4,.9],[.5,1],[0,1])),Object(Ee.a)(qe([0,.5],[.1,.6],[.1,.9],[0,1])))}},Ze=function(e,t){return[].concat(Object(Ee.a)(He(e)),Object(Ee.a)(He(t)),Object(Ee.a)(He(t)),Object(Ee.a)(He(t)),Object(Ee.a)(He(t)))},Xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=We.yRotation(n);r=We.translate(r,t,a,o);for(var i=0;i<e.length;i+=3){var s=We.transformPoint(r,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},Ye=function(e,t){for(var a=We.yRotation(t),o=0;o<e.length;o+=3){var n=We.transformPoint(a,[e[o+0],e[o+1],e[o+2],1]);e[o+0]=n[0],e[o+1]=n[1],e[o+2]=n[2]}},Je=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=We.translation(t,a,o),r=0;r<e.length;r+=3){var i=We.transformPoint(n,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=i[0],e[r+1]=i[1],e[r+2]=i[2]}},$e=function(e){var t=e.h0,a=e.h1,o=e.color1,n=void 0===o?[.2,.1,.1]:o,r=e.color2,i=void 0===r?[1,1,1]:r,s=e.rBase,c=void 0===s?5:s,l=e.hBase,u=void 0===l?5:l,h=e.hBaseToTrunk,p=void 0===h?1:h,d=e.hCapital,f=void 0===d?2:d,O=e.rCapital,j=void 0===O?6:O,v=e.hTrunkToCapital,y=void 0===v?1:v,g=e.rTrunk,_=void 0===g?3:g,C=t,w=t+u,S=Ve([-c,C,c],[c,C,c],[c,w,c],[-c,w,c]),M=He(n),T=qe([.5,0],[1,0],[1,.5],[.5,.5]),x=Ve([c+m,C-m,c+m],[-c-m,C-m,c+m],[-c-m,w,c+m],[c+m,w,c+m]),k=He(b),P=qe([0,1],[0,1],[0,1],[0,1]);w=(C=w)+p;var A=Object(Ee.a)(Ve([-c,C,c],[c,C,c],[_,w,_],[-_,w,_])),L=Object(Ee.a)(He(i)),D=qe([0,.5],[.5,.5],[.4,.7],[.1,.7]),I=function(e){for(var t=e.h,a=void 0===t?2:t,o=e.h2,n=void 0===o?30:o,r=e.r,i=void 0===r?10:r,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],p=n-a,b=a;p>0;){var m=Ke(.5,10),d=Ke(.5,4),f=Ke(.5,4),O=Ke(.5,.2),j=m+d+f+O;(p-=j)>5&&h.push({h0:b,h01:b+m,h02:b+m+d,h03:b+m+d+f,h04:b+m+d+f+O,r:Ke(1,10)}),b+=j}var v=[],y=[],g=[];if(0===h.length)v.push.apply(v,Object(Ee.a)(Ve([-i,a,i],[i,a,i],[i,n,i],[-i,n,i]))),y.push.apply(y,Object(Ee.a)(He(c))),g.push.apply(g,Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var _=0;_<h.length;++_){var C=Qe([-i,h[_].h0,i],[i,h[_].h0,i],[i,h[_].h01,i],[-i,h[_].h01,i],u,u),w=C.vArr,S=C.cArr,M=C.uArr;v.push.apply(v,Object(Ee.a)(w)),y.push.apply(y,Object(Ee.a)(S)),g.push.apply(g,Object(Ee.a)(M)),v.push.apply(v,Object(Ee.a)(Ve([-i,h[_].h01,i],[i,h[_].h01,i],[h[_].r,h[_].h02,h[_].r],[-h[_].r,h[_].h02,h[_].r]))),y.push.apply(y,Object(Ee.a)(He(u))),g.push.apply(g,Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Ee.a)(Ve([-h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h03,h[_].r],[-h[_].r,h[_].h03,h[_].r]))),y.push.apply(y,Object(Ee.a)(He(c))),g.push.apply(g,Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Ee.a)(Ve([-h[_].r,h[_].h03,h[_].r],[h[_].r,h[_].h03,h[_].r],[i,h[_].h04,i],[-i,h[_].h04,i]))),y.push.apply(y,Object(Ee.a)(He(u))),g.push.apply(g,Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])))}var T=Qe([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,n,i],[-i,n,i],u,c),x=T.vArr,k=T.cArr,P=T.uArr;v.push.apply(v,Object(Ee.a)(x)),y.push.apply(y,Object(Ee.a)(k)),g.push.apply(g,Object(Ee.a)(P))}return{vert:v,col:y,uv:g}}({color1:n,color2:i,h:C=w,h2:w=a-f-y,r:_}),E=I.vert,N=I.col,F=I.uv;C=w,w=a-f;var B=Object(Ee.a)(Ve([-_,C,_],[_,C,_],[j,w,j],[-j,w,j]));C=w,w=a;var R=Object(Ee.a)(Ve([-j,C,j],[j,C,j],[j,w,j],[-j,w,j])),z=qe([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(Ee.a)(S),Object(Ee.a)(x),Object(Ee.a)(A),Object(Ee.a)(E),Object(Ee.a)(B),Object(Ee.a)(R)),frontColors:[].concat(Object(Ee.a)(M),Object(Ee.a)(k),Object(Ee.a)(L),Object(Ee.a)(N),Object(Ee.a)(L),Object(Ee.a)(M)),frontUV:[].concat(Object(Ee.a)(T),Object(Ee.a)(P),Object(Ee.a)(D),Object(Ee.a)(F),Object(Ee.a)(D),Object(Ee.a)(z))}},et=[0,0,0],tt=[0,.7,0],at=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,n=void 0===o?30:o,r=e.rCapital,i=void 0===r?6:r,s=e.rBase,c=void 0===s?5:s,l=e.capTop,u=void 0!==l&&l,h=e.capBottom,p=void 0!==h&&h,d=$e({h0:a,h1:n,color1:et,color2:tt,rCapital:i,rBase:c}),f=d.frontVert,O=d.frontColors,j=d.frontUV,v=Object(Ee.a)(f);Xe(v,0,0,0,Math.PI/2);var y=Object(Ee.a)(f);Xe(y,0,0,0,-Math.PI/2);var g=Object(Ee.a)(f);Xe(g,0,0,0,Math.PI);var _=[].concat(Object(Ee.a)(f),Object(Ee.a)(v),Object(Ee.a)(y),Object(Ee.a)(g)),C=[].concat(Object(Ee.a)(O),Object(Ee.a)(O),Object(Ee.a)(O),Object(Ee.a)(O)),w=[].concat(Object(Ee.a)(j),Object(Ee.a)(j),Object(Ee.a)(j),Object(Ee.a)(j)),S=.6,M=[].concat(Object(Ee.a)(Ve([-c-S,a,c+S],[c+S,a,c+S],[c+S,n,c+S],[-c-S,n,c+S])),Object(Ee.a)(Ve([c+S,a,c+S],[c+S,a,-c-S],[c+S,n,-c-S],[c+S,n,c+S])),Object(Ee.a)(Ve([c+S,a,-c-S],[-c-S,a,-c-S],[-c-S,n,-c-S],[c+S,n,-c-S])),Object(Ee.a)(Ve([-c-S,a,-c-S],[-c-S,a,c+S],[-c-S,n,c+S],[-c-S,n,-c-S])));return p&&(_.push.apply(_,Object(Ee.a)(Ve([-c-m,a-m,c+m],[c+m,a-m,c+m],[c,a-m,-c-m],[-c,a-m,-c-m]))),C.push.apply(C,Object(Ee.a)(He(b))),w.push.apply(w,Object(Ee.a)(qe([0,1],[0,1],[0,1],[0,1])))),u&&(_.push.apply(_,Object(Ee.a)(Ve([-i,n,i],[i,n,i],[i,n,-i],[-i,n,-i]))),C.push.apply(C,Object(Ee.a)(He(et))),w.push.apply(w,Object(Ee.a)(qe([.5,0],[1,0],[1,.5],[.5,.5])))),{v:_,c:C,u:w,collision:M}},ot=Math.sin,nt=Math.cos,rt=function(e){var t=e.isTopElem,a=e.color1,o=e.color2,n=e.h2;if(!t)return{vertTopElem:[],colorsTopElem:[],uvTopElem:[]};for(var r=[],i=[],s=[],c=2+12*Math.random(),l=1+4*Math.random(),u=.2+40*Math.random(),h=.1+10*Math.random(),p=.1+10*Math.random(),d=.1+40*Math.random(),f=0;f<6;++f){var O=f+1;O>6&&(O=0);var j=f/6*Math.PI*2,v=O/6*Math.PI*2,y=n,g=y+c,_=6,C=6,w=ot(j),S=nt(j),M=ot(v),T=nt(v);r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C]))),g=(y=g)+l,_=C,C=3,r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C]))),g=(y=g)+u,C=_=C,r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C]))),g=(y=g)+h,C=(_=C)+4,r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C]))),g=(y=g)+p,C=_=C,r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C])));var x=m+.5;r.push.apply(r,Object(Ee.a)(Ve([M*(_+x),y,T*(_+x)],[w*(_+x),y,S*(_+x)],[w*(C+x),g,S*(C+x)],[M*(C+x),g,T*(C+x)]))),r.push.apply(r,Object(Ee.a)(Ve([w*C,g,S*C],[M*C,g,T*C],[2*M,g,2*T],[2*ot(j),g,2*S]))),g=(y=g)+d,_=2,C=7,r.push.apply(r,Object(Ee.a)(Ve([w*_,y,S*_],[M*_,y,T*_],[M*C,g,T*C],[w*C,g,S*C])));var k=m;r.push.apply(r,Object(Ee.a)(Ve([M*(_+k),y,T*(_+k)],[w*(_+k),y,S*(_+k)],[w*(C+k),g,S*(C+k)],[M*(C+k),g,T*(C+k)]))),y=g,g+=d,r.push(w*C,y,S*C,M*C,y,T*C,0,g,0),r.push(M*(C+.5),y,T*(C+.5),w*(C+.5),y,S*(C+.5),0,g+3,0),i.push.apply(i,Object(Ee.a)(He(a)).concat(Object(Ee.a)(He(o)),Object(Ee.a)(He(o)),Object(Ee.a)(He(o)),Object(Ee.a)(He(a)),Object(Ee.a)(He(b)),Object(Ee.a)(He(a)),Object(Ee.a)(He(a)),Object(Ee.a)(He(b)),Object(Ee.a)(a),Object(Ee.a)(a),Object(Ee.a)(a),Object(Ee.a)(b),Object(Ee.a)(b),Object(Ee.a)(b))),s.push.apply(s,Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,1],[0,1],[0,1],[0,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Ee.a)(qe([0,1],[0,1],[0,1],[0,1])),[0,.5],[.5,.5],[.25,1],[0,1],[0,1],[0,1]))}return{vertTopElem:r,colorsTopElem:i,uvTopElem:s}},it=function(e){var t=e.isColumn,a=e.h1,o=e.h2,n=e.color1,r=e.color2;if(!t)return{vertColumn:[],colorsColumn:[],uvColumn:[]};var i=[],s=[],c=[],l=o-5;i.push.apply(i,Object(Ee.a)(Ve([-4,a,4],[4,a,4],[4,o,4],[-4,o,4])).concat(Object(Ee.a)(Ve([4,a,4],[4,a,-4],[4,o,-4],[4,o,4])),Object(Ee.a)(Ve([4,a,-4],[-4,a,-4],[-4,o,-4],[4,o,-4])),Object(Ee.a)(Ve([-4,a,-4],[-4,a,4],[-4,o,4],[-4,o,-4])),Object(Ee.a)(Ve([-6,l,6],[6,l,6],[6,o,6],[-6,o,6])),Object(Ee.a)(Ve([6,l,6],[6,l,-6],[6,o,-6],[6,o,6])),Object(Ee.a)(Ve([6,l,-6],[-6,l,-6],[-6,o,-6],[6,o,-6])),Object(Ee.a)(Ve([-6,l,-6],[-6,l,6],[-6,o,6],[-6,o,-6])),Object(Ee.a)(Ve([-6,l,6],[-6,l,-6],[6,l,-6],[6,l,6])),Object(Ee.a)(Ve([-6,o,-6],[-6,o,6],[6,o,6],[6,o,-6])))),s.push.apply(s,Object(Ee.a)(He(r)).concat(Object(Ee.a)(He(r)),Object(Ee.a)(He(r)),Object(Ee.a)(He(r)),Object(Ee.a)(He(n)),Object(Ee.a)(He(n)),Object(Ee.a)(He(n)),Object(Ee.a)(He(n)),Object(Ee.a)(He(n)),Object(Ee.a)(He(n))));var u=qe([0,.5],[.5,.5],[.5,1],[0,1]);return c.push.apply(c,Object(Ee.a)(u).concat(Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u),Object(Ee.a)(u))),{vertColumn:i,colorsColumn:s,uvColumn:c}},st=[0,0,0],ct=[0,.7,0],lt=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,n=void 0===o?30:o,r=e.h2,i=void 0===r?60:r,s=e.arc,c=void 0!==s&&s,l=e.isTopElem,u=void 0!==l&&l,h=e.isColumn,p=void 0!==h&&h,b=[],m=[],d=[];if(c){var f=function(e){for(var t=e.h1,a=e.h2,o=e.color1,n=void 0===o?[.2,.1,.1]:o,r=e.color2,i=void 0===r?[1,1,1]:r,s=e.r,c=void 0===s?5:s,l=e.rCap,u=void 0===l?7:l,h=e.wCol,p=void 0===h?3:h,b=e.w,m=(void 0===b?40:b)-2*c,d=-c-m,f=t,O=a-Math.min(.1*(a-t),2),j=Object(Ee.a)(Ve([-p,f,c],[p,f,c],[p,O,c],[-p,O,c])),v=Object(Ee.a)(He(i)),y=Object(Ee.a)(He(n)),g=qe([0,.5],[.5,.5],[.5,1],[0,1]),_=[].concat(Object(Ee.a)(Ve([-p,f,-c],[-p,f,c],[-p,O,c],[-p,O,-c])),Object(Ee.a)(Ve([p,f,c],[p,f,-c],[p,O,-c],[p,O,c]))),C=Object(Ee.a)(Ve([p,f,-c],[-p,f,-c],[-p,O,-c],[p,O,-c])),w=[],S=[],M=[],T=2-p,x=p-2,k=14,P=m/k,A=O-f,L=.15*A,D=0;D<k;++D){var I=(1-Math.sin((D+1)/k*Math.PI))*(A-L)+L,E=(1-Math.sin(D/k*Math.PI))*(A-L)+L,N=-c;D+1>7&&(N=-c-m),w.push(T,O-I,-c-(D+1)*P,T,O-E,-c-D*P,T,O,N),S.push.apply(S,Object(Ee.a)(i).concat(Object(Ee.a)(i),Object(Ee.a)(i))),M.push(0,0,.3,0,.3,.3),w.push(x,O-E,-c-D*P,x,O-I,-c-(D+1)*P,x,O,N),S.push.apply(S,Object(Ee.a)(i).concat(Object(Ee.a)(i),Object(Ee.a)(i))),M.push(0,0,.3,0,.3,.3),w.push.apply(w,Object(Ee.a)(Ve([x,O-E,-c-D*P],[T,O-E,-c-D*P],[T,O-I,-c-(D+1)*P],[x,O-I,-c-(D+1)*P]))),S.push.apply(S,Object(Ee.a)(y)),M.push.apply(M,Object(Ee.a)(qe([0,0],[0,0],[0,0],[0,0])))}w.push(T,O-L,-c-P*k/2,T,O,-c,T,O,-c-P*k),S.push.apply(S,Object(Ee.a)(i).concat(Object(Ee.a)(i),Object(Ee.a)(i))),M.push(.5,.25,.25,.3,.25,.2),w.push(x,O-L,-c-P*k/2,x,O,-c-P*k,x,O,-c),S.push.apply(S,Object(Ee.a)(i).concat(Object(Ee.a)(i),Object(Ee.a)(i))),M.push(.5,.25,.25,.3,.25,.2),f=O,O=a;var F=[].concat(Object(Ee.a)(Ve([-u,f,-u],[u,f,-u],[u,f,u],[-u,f,u])),Object(Ee.a)(Ve([-u,f,u],[u,f,u],[u,O,u],[-u,O,u])),Object(Ee.a)(Ve([-u,f,-u],[-u,f,u],[-u,O,u],[-u,O,-u])),Object(Ee.a)(Ve([u,f,u],[u,f,-u],[u,O,-u],[u,O,u])),Object(Ee.a)(Ve([u,f,-u],[-u,f,-u],[-u,O,-u],[u,O,-u])),Object(Ee.a)(Ve([-u,O,u],[u,O,u],[u,O,-u],[-u,O,-u])),Object(Ee.a)(Ve([2-u,f,d],[u-2,f,d],[u-2,f,-u],[2-u,f,-u])),Object(Ee.a)(Ve([2-u,f,d],[2-u,f,-u],[2-u,O,-u],[2-u,O,d])),Object(Ee.a)(Ve([u-2,f,-u],[u-2,f,d],[u-2,O,d],[u-2,O,-u])),Object(Ee.a)(Ve([2-u,O,-u],[u-2,O,-u],[u-2,O,d],[2-u,O,d])));return{v:[].concat(Object(Ee.a)(j),Object(Ee.a)(_),Object(Ee.a)(C),w,Object(Ee.a)(F)),c:[].concat(Object(Ee.a)(v),Object(Ee.a)(v),Object(Ee.a)(v),Object(Ee.a)(v),S,Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y),Object(Ee.a)(y)),u:[].concat(Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),M,Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g),Object(Ee.a)(g))}}(Object(D.a)({h1:n,h2:i,color1:st,color2:ct},c));b.push.apply(b,Object(Ee.a)(f.v)),m.push.apply(m,Object(Ee.a)(f.c)),d.push.apply(d,Object(Ee.a)(f.u))}var O=at({h0:a,h1:n,color1:st,color2:ct,rCapital:6,rBase:5,capTop:!0,capBottom:!0});b.push.apply(b,Object(Ee.a)(O.v)),m.push.apply(m,Object(Ee.a)(O.c)),d.push.apply(d,Object(Ee.a)(O.u));var j=rt({h2:i,color1:st,color2:ct,isTopElem:u}),v=j.vertTopElem,y=j.colorsTopElem,g=j.uvTopElem;b.push.apply(b,Object(Ee.a)(v)),m.push.apply(m,Object(Ee.a)(y)),d.push.apply(d,Object(Ee.a)(g));var _=it({isColumn:p,h1:n,h2:i,color1:st,color2:ct}),C=_.vertColumn,w=_.colorsColumn,S=_.uvColumn;return b.push.apply(b,Object(Ee.a)(C)),m.push.apply(m,Object(Ee.a)(w)),d.push.apply(d,Object(Ee.a)(S)),{v:b,c:m,u:d}},ut=function(e){for(var t=new g.BufferGeometry,a=[],o=[],n=[],r=function(){var e=[],t=function t(a){var o=a.angle,n=a.offsetStart,r=a.h0,i=a.h1,s=a.h2,c=a.numFromCenter,l=120*Math.random()+30,u=Math.random()>.5;e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(o)*(n+l),z:Math.cos(o)*(n+l),angle:o,h0:r,h1:i,h2:s,arc:{w:l},isTopElem:!u,numFromCenter:c}),u&&t({angle:o,offsetStart:n+l,h0:r,h1:i,h2:s,numFromCenter:++c})},a=Math.floor(20*Math.random())+3,o=150*Math.random()+30,n=(.4*Math.random()+.5)*o;e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h0:0,h1:n,h2:o,numFromCenter:0,isTopElem:!1,isColumn:!0});for(var r=0;r<a;++r)Math.random()>.3&&t({angle:r/a*(2*Math.PI),offsetStart:0,h0:0,h1:n,h2:o,numFromCenter:1});for(var i=e.length,s=0;s<3;++s)for(var c=e[e.length-1].h2,l=c+150*Math.random()+30,u=c+(.4*Math.random()+.5)*(l-c),h=0;h<i;++h)e[h].isTopElem||e.push(Object(D.a)(Object(D.a)({},e[h]),{},{h0:c,h1:u,h2:l,isTopElem:2===s}));return e}(),i=0;i<r.length;++i){var s=r[i],c=(s.id,s.x),l=s.z,u=s.angle,h=s.h0,p=s.h1,b=s.h2,m=s.arc,d=s.isTopElem,f=s.isColumn,O=lt({h0:h,h1:p,h2:b,arc:m,isTopElem:d,isColumn:f}),j=O.v,v=O.c,y=O.u;Ye(j,u),Je(j,c,0,l,u),a.push.apply(a,Object(Ee.a)(j)),o.push.apply(o,Object(Ee.a)(v)),n.push.apply(n,Object(Ee.a)(y))}var _=new Float32Array(a),C=new Float32Array(o),w=new Float32Array(n);t.setAttribute("position",new g.BufferAttribute(_,3)),t.setAttribute("color",new g.BufferAttribute(C,3)),w&&t.setAttribute("uv",new g.BufferAttribute(w,2)),t.computeVertexNormals();var S=e.materials.wallVirtualColor;return new g.Mesh(t,S)},ht=Math.PI,pt=Math.cos,bt=ht/2,mt=[0,0,0],dt=[0,0,0],ft=function(e,t,a){var o=e.h,n=e.r,r=e.x,i=e.z,s=e.bridgeL,c=e.bridgeMinusH,l=e.hColumn,u=e.rColumn,h=e.i,p=o-5,b=l*(.35*Math.random()+.1),m=[],d=[],f=[],O=[],j=function(e){var t=e.r,a=e.h,o=e.hh,n=e.bridgeMinusH,r=e.bridgeL,i=e.color2,s=e.colorB,c=[],l=[],u=[],h=[],p=qe([0,.5],[.5,.5],[.5,1],[0,1]),b=qe([0,0],[0,0],[0,0],[0,0]);return c.push.apply(c,Object(Ee.a)(Ve([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(Ee.a)(Ve([-t,o,t],[t,o,t],[t,a,t],[-t,a,t])),Object(Ee.a)(Ve([-t,o,-t],[-t,o,t],[-t,a,t],[-t,a,-t])),Object(Ee.a)(Ve([t,o,t],[t,o,-t],[t,a,-t],[t,a,t])),Object(Ee.a)(Ve([t,o,-t],[-t,o,-t],[-t,a,-t],[t,a,-t])),Object(Ee.a)(Ve([t,o,-t],[t,o,t],[-t,o,t],[-t,o,-t])),Object(Ee.a)(Ve([-t,a,-t],[t,a,-t],[t,a-n,-t-r],[-t,a-n,-t-r])),Object(Ee.a)(Ve([-t,o-n,-t-r],[-t,o,-t],[-t,a,-t],[-t,a-n,-t-r])),Object(Ee.a)(Ve([t,o,-t],[t,o-n,-t-r],[t,a-n,-t-r],[t,a,-t])),Object(Ee.a)(Ve([-t,o-n,-t-r],[t,o-n,-t-r],[t,o,-t],[-t,o,-t])))),l.push.apply(l,Object(Ee.a)(He(i)).concat(Object(Ee.a)(He(s)),Object(Ee.a)(He(s)),Object(Ee.a)(He(s)),Object(Ee.a)(He(i)),Object(Ee.a)(He(i)),Object(Ee.a)(He(i)),Object(Ee.a)(He(s)),Object(Ee.a)(He(s)),Object(Ee.a)(He(i)))),u.push.apply(u,Object(Ee.a)(p).concat(Object(Ee.a)(b),Object(Ee.a)(b),Object(Ee.a)(b),Object(Ee.a)(b),Object(Ee.a)(p),Object(Ee.a)(p),Object(Ee.a)(b),Object(Ee.a)(b),Object(Ee.a)(p))),h.push.apply(h,Object(Ee.a)(Ve([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(Ee.a)(Ve([-t,a,-t],[t,a,-t],[t,a-n,-t-r],[-t,a-n,-t-r])))),{v:c,c:l,u:u,collision:h}}({h:o,hh:p,colorB:dt,color2:a,bridgeL:s,bridgeMinusH:c,r:n});m.push.apply(m,Object(Ee.a)(j.v)),d.push.apply(d,Object(Ee.a)(j.c)),f.push.apply(f,Object(Ee.a)(j.u)),O.push.apply(O,Object(Ee.a)(j.collision));var v=at({h0:p-l-.1,h1:p-b,capTop:!0,capBottom:!0});Je(v.v,n,0,n),m.push.apply(m,Object(Ee.a)(v.v)),d.push.apply(d,Object(Ee.a)(v.c)),f.push.apply(f,Object(Ee.a)(v.u)),Je(v.collision,n,0,n),O.push.apply(O,Object(Ee.a)(v.collision));var y=it({isColumn:!0,h1:p-b,h2:p,color1:[0,0,0],color2:a});Je(y.vertColumn,n,0,n),m.push.apply(m,Object(Ee.a)(y.vertColumn)),d.push.apply(d,Object(Ee.a)(y.colorsColumn)),f.push.apply(f,Object(Ee.a)(y.uvColumn));var g=function(e){for(var t=e.hArc,a=void 0===t?15:t,o=e.arcL,n=void 0===o?15:o,r=e.color2,i=[],s=[],c=[],l=n/5,u=0;u<5;++u){var h=pt(u/5*bt),p=pt((u+1)/5*bt);i.push(u*l,0+h*a,0,(u+1)*l,0+p*a,0,n,a,0),i.push(u*l,0+h*a,-2,n,a,-2,(u+1)*l,0+p*a,-2),s.push.apply(s,Object(Ee.a)(r).concat(Object(Ee.a)(r),Object(Ee.a)(r),Object(Ee.a)(r),Object(Ee.a)(r),Object(Ee.a)(r))),c.push(0,0,.3,0,.3,.3,0,0,.3,0,.3,.3),i.push.apply(i,Object(Ee.a)(Ve([u*l,0+h*a,0],[u*l,0+h*a,-2],[(u+1)*l,0+p*a,-2],[(u+1)*l,0+p*a,0]))),s.push.apply(s,Object(Ee.a)(He(mt))),c.push(0,0,0,0,0,0,0,0,0,0,0,0)}return{v:i,c:s,u:c}}({hArc:b,arcL:40,color2:a});if(Je(g.v,n-u-40,p-b,n),m.push.apply(m,Object(Ee.a)(g.v)),d.push.apply(d,Object(Ee.a)(g.c)),f.push.apply(f,Object(Ee.a)(g.u)),e.isTop){var _=rt({isTopElem:!0,color1:[0,0,0],color2:a,h2:p});Je(_.vertTopElem,n,0,n),m.push.apply(m,Object(Ee.a)(_.vertTopElem)),d.push.apply(d,Object(Ee.a)(_.colorsTopElem)),f.push.apply(f,Object(Ee.a)(_.uvTopElem))}return Ye(m,Math.PI-Math.PI/2*h),Je(m,r,0,i),Ye(O,Math.PI-Math.PI/2*h),Je(O,r,0,i),{v:m,c:d,u:f,collision:O}},Ot=function(e){var t=e.xCenter,a=e.zCenter,o=e.r,n=void 0===o?70:o,r=e.h,i=(e.offset,e.color2),s=void 0===i?[0,1,0]:i,c=e.colorB,l=void 0===c?[1,0,1]:c,u=r-3,h=[],p=[],b=[],m=[],d=qe([0,.5],[.5,.5],[.5,1],[0,1]),f=qe([0,0],[0,0],[0,0],[0,0]);return h.push.apply(h,Object(Ee.a)(Ve([-n,r,n],[n,r,n],[n,r,-n],[-n,r,-n])).concat(Object(Ee.a)(Ve([-n,u,n],[n,u,n],[n,r,n],[-n,r,n])),Object(Ee.a)(Ve([-n,u,-n],[-n,u,n],[-n,r,n],[-n,r,-n])),Object(Ee.a)(Ve([n,u,n],[n,u,-n],[n,r,-n],[n,r,n])),Object(Ee.a)(Ve([n,u,-n],[-n,u,-n],[-n,r,-n],[n,r,-n])),Object(Ee.a)(Ve([n,u,-n],[n,u,n],[-n,u,n],[-n,u,-n])))),p.push.apply(p,Object(Ee.a)(He(s)).concat(Object(Ee.a)(He(l)),Object(Ee.a)(He(l)),Object(Ee.a)(He(l)),Object(Ee.a)(He(s)),Object(Ee.a)(He(s)))),b.push.apply(b,Object(Ee.a)(d).concat(Object(Ee.a)(f),Object(Ee.a)(f),Object(Ee.a)(f),Object(Ee.a)(f),Object(Ee.a)(d))),m.push.apply(m,Object(Ee.a)(Ve([-n,r,n],[n,r,n],[n,r,-n],[-n,r,-n]))),Je(h,t,0,a),Je(m,t,0,a),{v:h,c:p,u:b,collision:m}},jt=[1,1,0],vt=[1,1,1],yt={N:0,E:.5*-Math.PI,S:Math.PI,W:.5*Math.PI},gt=function(e){var t=e.centerBridgeX,a=e.centerBridgeZ,o=e.h,n=e.dir,r=o-3,i=[],s=[],c=[],l=[],u=e.lenBridge/2,h=qe([0,.5],[.5,.5],[.5,1],[0,1]),p=qe([0,0],[0,0],[0,0],[0,0]),b=20;return i.push.apply(i,Object(Ee.a)(Ve([-b,o,u],[b,o,u],[b,o,-u],[-b,o,-u])).concat(Object(Ee.a)(Ve([-b,r,u],[b,r,u],[b,o,u],[-b,o,u])),Object(Ee.a)(Ve([-b,r,-u],[-b,r,u],[-b,o,u],[-b,o,-u])),Object(Ee.a)(Ve([b,r,u],[b,r,-u],[b,o,-u],[b,o,u])),Object(Ee.a)(Ve([b,r,-u],[-b,r,-u],[-b,o,-u],[b,o,-u])),Object(Ee.a)(Ve([b,r,-u],[b,r,u],[-b,r,u],[-b,r,-u])))),s.push.apply(s,Object(Ee.a)(He(jt)).concat(Object(Ee.a)(He(vt)),Object(Ee.a)(He(vt)),Object(Ee.a)(He(vt)),Object(Ee.a)(He(jt)),Object(Ee.a)(He(jt)))),c.push.apply(c,Object(Ee.a)(h).concat(Object(Ee.a)(p),Object(Ee.a)(p),Object(Ee.a)(p),Object(Ee.a)(p),Object(Ee.a)(h))),l.push.apply(l,Object(Ee.a)(Ve([-b,o,u],[b,o,u],[b,o,-u],[-b,o,-u]))),Je(i,-50,0,0),Ye(i,yt[n]),Je(i,t,0,a),Je(l,-50,0,0),Ye(l,yt[n]),Je(l,t,0,a),{v:i,c:s,u:c,collision:l}},_t=function(e){for(var t=e.xCenter,a=e.zCenter,o=e.hStart,n=e.hEnd,r=e.count,i=(n-o)/r,s=4*i,c=50,l=[],u=0;u<r;++u){var h=i*u+o,p=h-7+o,b=t,m=a,d=u%4;d<1?(b=t-c,m=a-c):d<2?(b=t+c,m=a-c):d<3?(b=t+c,m=a+c):d<4&&(b=t-c,m=a+c),l.push({type:"stairs",offset:c,h:h,hh:p,r:20,x:b,z:m,bridgeMinusH:i,bridgeL:60,hColumn:s,rColumn:3,i:u,isTop:r-u<5})}return l},Ct=["N","E","S","W"],wt={N:1,E:2,S:3,W:4},St={N:[0,-1],E:[1,0],S:[0,1],W:[-1,0]},Mt=function(e){var t=function(){for(var e=[],t=0,a=0,o=0,n=0;n<5;++n){var r=Ct[Math.floor(Math.random()*Ct.length)],i=400*Math.random()+30,s=a+St[r][0]*(140+i),c=o+St[r][1]*(140+i),l=wt[r]+4*Math.floor(2*Math.random()),u=t+30*l,h={xCenter:a,zCenter:o,hStart:t,hEnd:u,count:l};if(e.push.apply(e,Object(Ee.a)(_t(h))),0!==n&&e.push({xCenter:a,zCenter:o,h:t-30,type:"zone"}),4!==n){var p=(s-a)/2+a,b=(c-o)/2+o;e.push({centerBridgeX:p,centerBridgeZ:b,h:u-30,dir:r,lenBridge:i,type:"bridge"})}a=s,o=c,t=u}return e}();console.log(t[t.length-1]);for(var a=[],o=[],n=[],r=[],i=0;i<t.length;++i){if("stairs"===t[i].type){var s=ft(t[i],0,[0,.7,0]),c=s.v,l=s.c,u=s.u,h=s.collision;a.push.apply(a,Object(Ee.a)(c)),o.push.apply(o,Object(Ee.a)(l)),n.push.apply(n,Object(Ee.a)(u)),r.push.apply(r,Object(Ee.a)(h))}if("zone"===t[i].type){var p=Ot(t[i]),b=p.v,m=p.c,d=p.u,f=p.collision;a.push.apply(a,Object(Ee.a)(b)),o.push.apply(o,Object(Ee.a)(m)),n.push.apply(n,Object(Ee.a)(d)),r.push.apply(r,Object(Ee.a)(f))}if("bridge"===t[i].type){var O=gt(t[i]),j=O.v,v=O.c,y=O.u,_=O.collision;a.push.apply(a,Object(Ee.a)(j)),o.push.apply(o,Object(Ee.a)(v)),n.push.apply(n,Object(Ee.a)(y)),r.push.apply(r,Object(Ee.a)(_))}}r.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var C=new Float32Array(a),w=new Float32Array(o),S=new Float32Array(n),M=new Float32Array(r),T=new g.BufferGeometry;T.setAttribute("position",new g.BufferAttribute(C,3)),T.setAttribute("color",new g.BufferAttribute(w,3)),S&&T.setAttribute("uv",new g.BufferAttribute(S,2)),T.computeVertexNormals();var x=e.materials.wallVirtualColor,k=new g.Mesh(T,x),P=new g.BufferGeometry;P.setAttribute("position",new g.BufferAttribute(M,3));var A=new g.MeshBasicMaterial({color:16711680}),L=new g.Mesh(P,A),D=new g.Mesh(new g.BoxGeometry(30,30,30),new g.MeshBasicMaterial({color:16711935}));return D.position.set(t[t.length-1].x,t[t.length-1].h,t[t.length-1].z),{mesh:k,meshCollision:L,meshFinish:D}},Tt=function(){function e(t){var a=this;Object(v.a)(this,e),this._root=t;var o=this._root,n=o.emitter,r=o.car,i=o.dispatcher,s=o.frameUpdater,c=o.studio,l=(o.player,o.system_PlayerMoveOnLevel);i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),i.dispatch({type:"ENABLE_CONTROL_SOUND"}),r.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),n.subscribe("checkNear")((function(e){console.log("checkNear",e),"nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),"nearPerson"===e.item&&console.log("checkNear nearPerson !!!!!!",e)}));var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Math.floor(t/e),n=Math.floor(a/e),r=o+"_"+n,i=De(o,n);return{checkChanged:function(t,a){var o=Math.floor(t/e),n=Math.floor(a/e),s=o+"_"+n;if(s===r)return!1;var c=r;r=s;var l=i;i=De(o,n);var u=Ie(i,l),h=Ie(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:r,currentEnv:i}}}}(u,r._model.position.x,r._model.position.z),b=p.getCurrent();this._changerLocations=xt(this._root),this._changerLevelTresh=kt(this._root),this._changerLevelTresh.createTresh(b.currentEnv),s.on((function(e){if(l.update(e),!r.isFreeze){r.update(e);var t=p.checkChanged(r._model.position.x,r._model.position.z);if(t&&(console.log("quadrants data",t),a._changerLevelTresh.updateTrash(t.removedQs,t.addedQs),h[t.oldKey]&&a._changerLocations.removeLocationFromScene(h[t.oldKey]),h[t.newKey])){var o=t.newKey.split("_"),n=+o[0]*u+u/2,i=+o[1]*u+u/2;a._changerLocations.addLocationToScene(h[t.newKey],n,i)}}c.drawFrame()})),this._startPlay()}return Object(y.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,a=e.system_PlayerMoveOnLevel,o=e.car;a.toggleFreeze(!0),o.toggleFreeze(!1),t.setCamera(o.getCamera())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,a=e.player,o=e.studio,n=e.car,r=n.getPosition(),i=n.getQuaternion();o.setCamera(a.getCamera()),n.toggleFreeze(!0),t.toggleFreeze(!1),a.setToPos(r.x,a.mesh.position.y,r.z),a.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key,a=null;for(var o in h)h[o]===t&&(a=o);if(a){var n=a.split("_"),r=+n[0]*u+u/2,i=+n[1]*u+u/2;this._root.car.setTargetPosition(new g.Vector3(r,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,a=e.ui,o=e.studio,n=e.car,r=e.system_Level,i=e.system_PlayerMoveOnLevel;e.system_PlayerNearLevelItems.setItemToCheck(n.getModel(),"nearStarterDrawCar",28),o.addToScene(n.getModel()),i.addItemToPlayerCollision(n.getCollision()),setTimeout((function(){var e=0,t=null;for(var a in h)0===e&&(t=a),++e;var o=t.split("_"),r=+o[0]*u+u/2,i=+o[1]*u+u/2;n.setTargetPosition(new g.Vector3(r,0,i))}),500),r._items.body.position.fromArray([-20,-60,-50]),r._items.body.rotation.fromArray([0,2,0]),o.addToScene(r._items.body),a.showStartButton((function(){t.toggleBlocked(!1)}))}}]),e}(),xt=function(e){var t=e.studio,a=e.car,o=e.system_Level,n=e.system_PlayerMoveOnLevel,r=e.system_PlayerNearLevelItems;setTimeout((function(){for(var e in h){var a=e.split("_"),n=+a[0]*u+u/2,r=+a[1]*u+u/2;o.locations[h[e]].mesh.position.set(n,0,r),t.addToScene(o.locations[h[e]].mesh)}}),500);return{removeLocationFromScene:function(e){var i=o.locations[e],s=i.mesh,c=i.carCollision,l=i.personCollision;n.removeItemFromPlayerCollision(s),t.removeFromScene(c),a.removeCollisionForDraw(c),t.removeFromScene(l),r.removeItemFromCheck(l)},addLocationToScene:function(e,i,s){var c=o.locations[e],l=c.mesh,u=c.carCollision,h=c.personOffset,p=c.personCollision;l.position.set(i,0,s),n.addItemToPlayerCollision(l),u.position.set(i,0,s),t.addToScene(u),a.setCollisionForDraw(u),p.position.set(h[0]+i,h[1],h[2]+s),t.addToScene(p),r.setItemToCheck(p,"nearPerson_"+e,28)}}},kt=function(e){var t=e.studio,a=e.car,o=e.system_PlayerMoveOnLevel,n=e.materials,r=[],i=function(e){for(var t=function(){for(var e=50,t=[],a=0;a<25;++a){var o=30*a,n=o-7,r=0,i=0,s=a%4;s<1?(r=-50,i=-50):s<2?(r=e,i=-50):s<3?(r=e,i=e):s<4&&(r=-50,i=e),t.push({offset:e,h:o,hh:n,r:20,x:r,z:i,bridgeMinusH:30,bridgeL:60,hColumn:120,rColumn:3,i:a,isTop:25-a<5})}return t}(),a=[],o=[],n=[],r=[],i=0;i<t.length;++i){var s=ft(t[i],0,[0,.7,0]),c=s.v,l=s.c,u=s.u,h=s.collision;a.push.apply(a,Object(Ee.a)(c)),o.push.apply(o,Object(Ee.a)(l)),n.push.apply(n,Object(Ee.a)(u)),r.push.apply(r,Object(Ee.a)(h))}r.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var p=new Float32Array(a),b=new Float32Array(o),m=new Float32Array(n),d=new Float32Array(r),f=new g.BufferGeometry;f.setAttribute("position",new g.BufferAttribute(p,3)),f.setAttribute("color",new g.BufferAttribute(b,3)),m&&f.setAttribute("uv",new g.BufferAttribute(m,2)),f.computeVertexNormals();var O=e.materials.wallVirtualColor,j=new g.Mesh(f,O),v=new g.BufferGeometry;v.setAttribute("position",new g.BufferAttribute(d,3));var y=new g.MeshBasicMaterial({color:16711680});return{mesh:j,meshCollision:new g.Mesh(v,y)}}(e);i.mesh.position.set(400,-42,-1e3),t.addToScene(i.mesh),i.meshCollision.visible=!1,i.meshCollision.position.copy(i.mesh.position),t.addToScene(i.meshCollision),o.addItemToPlayerCollision(i.meshCollision);var s=Mt(e);s.mesh.position.set(0,-42,0),t.addToScene(s.mesh),s.meshCollision.visible=!1,s.meshCollision.position.copy(s.mesh.position),t.addToScene(s.meshCollision),o.addItemToPlayerCollision(s.meshCollision),t.addToScene(s.meshFinish);var c=new g.BoxGeometry(45,50,45),l=n.testRed,h=new g.PlaneGeometry(u,u),p=function(i){for(var s=0;s<i.length;++s){var p=i[s].split("_"),b=+p[0]*u,m=+p[1]*u,d=new g.Mesh(h,n.floorMat);d.rotation.x=-Math.PI/2,d.position.set(b,-62,m),t.addToScene(d),r.push({mesh:d,keyLocation:i[s],type:"floor"}),o.addItemToPlayerCollision(d);for(var f=Math.floor(3*Math.random()),O=0;O<f;++O){console.log("!!!!!!!!!!!!!!!!! new tresh");var j=ut(e);j.position.set(b+Math.random()*u,-60,m+Math.random()*u),t.addToScene(j);var v=new g.Mesh(c,l);v.position.copy(j.position),t.addToScene(v),a.setCollisionForDraw(v),r.push({mesh:j,meshCollision:v,keyLocation:i[s],type:"trash"})}}};return{updateTrash:function(e,n){!function(e){for(var n=[],i=0;i<e.length;++i)for(var s=0;s<r.length;++s)e[i]===r[s].keyLocation&&n.push(r[s]);r=r.filter((function(t){for(var a=0;a<e.length;++a)if(t.keyLocation===e[a])return!1;return!0}));for(var c=0;c<n.length;++c){var l=n[c],u=l.mesh,h=l.meshCollision;t.removeFromScene(u),o.removeItemFromPlayerCollision(u),h&&(t.removeFromScene(h),a.removeCollisionForDraw(h)),n[c].mesh.geometry.dispose(),delete n[c].mesh,delete n[c].meshCollision}}(e),p(n)},createTresh:function(e){p(e)}}},Pt=(a(43),{ru:{"What is this place?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","It's The Great Way to the surface.":"\u042d\u0442\u043e \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0435\u0440\u0445.","Who are you?":"\u041a\u0442\u043e \u0442\u044b?","I help The Creator.":"\u042f \u043f\u043e\u043c\u043e\u0433\u0430\u044e \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044e.","What are you doing?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Don't distract me, I have to dig the tunnel.":"\u041d\u0435 \u043e\u0442\u0432\u043b\u0435\u043a\u0430\u0439, \u043c\u043d\u0435 \u043d\u0430\u0434\u043e \u043a\u043e\u043f\u0430\u0442\u044c \u0442\u0443\u043d\u043d\u0435\u043b\u044c.","Such enormous dungeons...":"\u0422\u0430\u043a\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u043e\u0434\u0437\u0435\u043c\u0435\u043b\u044c\u044f...","The Creator gave the order to dig.":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0438\u043a\u0430\u0437\u0430\u043b \u043a\u043e\u043f\u0430\u0442\u044c. ","How long have you been digging?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0432\u044b \u043a\u043e\u043f\u0430\u043b\u0438? ","Time does not matter, the goal is what's important.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0430\u0436\u043d\u0430 \u0446\u0435\u043b\u044c. ","What do you do here?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Long ago, the Creator fell under the ground. He created us and gave us an assignment to dig.":"\u0414\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0422\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b\u0441\u044f \u043f\u043e\u0434 \u0437\u0435\u043c\u043b\u044e. \u041e\u043d \u0441\u043e\u0437\u0434\u0430\u043b \u043d\u0430\u0441 \u0438 \u0434\u0430\u043b \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043f\u0430\u0442\u044c. ","But you already dug the way out...":"\u041d\u043e \u0432\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u0432\u044b\u0445\u043e\u0434 ...","When we dug a tunnel, The Creator went through it.":"\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u043f\u0443\u0442\u044c, \u0442\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0448\u0435\u043b \u043f\u043e \u043d\u0435\u043c\u0443.","And...":"\u0418...","We are made to dig. And we keep on doing it. We believe that he will return to us.":"\u041c\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u043f\u0430\u0442\u044c. \u0418 \u043c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c. \u041c\u044b \u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043e\u043d \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043a \u043d\u0430\u043c. ","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),At=E(Pt),Lt=Object(A.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(N.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(N.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:At(t.q)},Math.floor(1e5*Math.random()))}))})})),Dt=E(Pt),It=Object(A.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(N.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(N.jsxs)("div",{children:[Object(N.jsx)("div",{className:"q",children:Dt(e.q)}),Object(N.jsx)("div",{className:"a",children:Dt(e.a)})]},Math.floor(1e5*Math.random()))}))})})),Et=E(Pt);var Nt=Object(A.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocation:e.ui.currentLocation,locationsList:e.ui.locationsList}}))((function(e){return Object(N.jsxs)(N.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(N.jsx)("div",{className:"dialog-wrapper",children:Object(N.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(N.jsxs)("div",{className:"messages-wrapper",children:[Object(N.jsx)(It,{}),Object(N.jsx)(Lt,{})]}),e.isButtonDialog&&Object(N.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?Et("close dialog"):Et("open dialog")})]})}),e.isShowButtonDrawCar&&Object(N.jsx)("div",{className:"dialog-wrapper",children:Object(N.jsx)("div",{className:"dialog-content",children:Object(N.jsx)("button",{className:"draw-car-button",onClick:function(){return e.dispatch({type:"CLICK_DRAW"})},children:Et(e.valButtonDrawCar)})})}),e.isShowButtonToggleOpenLocationsList&&!e.isLocationListOpened&&Object(N.jsx)("button",{className:"open-locations-car-button",onClick:function(){return e.dispatch({type:"OPEN_LOCATIONS_LIST"})},children:e.currentLocation}),e.isLocationListOpened&&Object(N.jsx)("div",{className:"list-locations",children:Object(N.jsx)("div",{children:e.locationsList.map((function(t){return Object(N.jsxs)("button",{onClick:function(){return e.dispatch({type:"SELECT_LOCATION",location:t})},children:[t,e.currentLocation===t&&"___v"]},Math.floor(1e6*Math.random()))}))})}),e.isShowFinalMessage&&Object(N.jsx)("div",{className:"final-mess",children:Et("To be continued")})]})})),Ft={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"draw car",currentBot:null,phraseIndex:0,isDialogComplete:!1,isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocation:"location01",locationsList:["location01","location02","location03"]},Bt=[{key:"emitter",constr:M,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(v.a)(this,e);var a=t.emitter,o=t.appWrapper;!o&&(o=document.querySelector(".app-wrapper")),a.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&n()}));var n=function(){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()},r=function(e){o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||a.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:S,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:X,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(v.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return Y.a()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:ne,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:re,initStateKey:"beforeStartPlay"},{key:"player",constr:ie,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:Le,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(v.a)(this,e);var a=t.assets,o=t.CONSTANTS;t.materials=se(a,o.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"car",constr:Te,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:xe,key:"car"},{type:"obj",path:ke,key:"carCollision"}]},{key:"system_Level",constr:function e(t){Object(v.a)(this,e),this._root=t;var a=t.assets,o=t.materials,n=ce(a,o).items;this._items=n,console.log("system_level_items",this._items),n.body.material=o.car,this._items.location_collision_01.visible=!1,this._items.location_collision_02.visible=!1,this._items.location_collision_03.visible=!1;var r=new g.Mesh(new g.BoxGeometry(15,15,15),new g.MeshBasicMaterial({color:16776960}));this._items.location01_person.geometry.computeBoundingSphere();var i=[this._items.location01_person.geometry.boundingSphere.center.x,this._items.location01_person.geometry.boundingSphere.center.y,this._items.location01_person.geometry.boundingSphere.center.z];this._items.location02_person.geometry.computeBoundingSphere();var s=[this._items.location02_person.geometry.boundingSphere.center.x,this._items.location02_person.geometry.boundingSphere.center.y,this._items.location02_person.geometry.boundingSphere.center.z];this._items.location03_person.geometry.computeBoundingSphere();var c=[this._items.location03_person.geometry.boundingSphere.center.x,this._items.location03_person.geometry.boundingSphere.center.y,this._items.location03_person.geometry.boundingSphere.center.z];this.locations={location01:{mesh:this._items.location01,carCollision:this._items.location_collision_01,personOffset:i,personCollision:r},location02:{mesh:this._items.location02,carCollision:this._items.location_collision_02,personOffset:s,personCollision:r},location03:{mesh:this._items.location03,carCollision:this._items.location_collision_03,personOffset:c,personCollision:r}}},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:le,key:"level-rooms"},{type:"obj",path:Pe,key:"body"},{type:"cubeTextures",path:[me,de,fe,Oe,je,ve],key:"skyBox"},{type:"cubeTextures",path:[ye,ge,_e,Ce,we,Se],key:"skyBox2"},{type:"img",path:ue,key:"mapFloorOuter",wrap:!0},{type:"img",path:pe,key:"mapTop",wrap:!0},{type:"img",path:he,key:"mapVirtual",wrap:!0},{type:"img",path:be,key:"mapParams"}]},{key:"system_PlayerMoveOnLevel",constr:Ae,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(v.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=Nt,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ft,a=arguments.length>1?arguments[1]:void 0;if("OPEN_LOCATIONS_LIST"===a.type)return Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!0});if("SELECT_LOCATION"===a.type)return e.actions.changeTargetLocation({key:a.location}),Object(D.a)(Object(D.a)({},t),{},{isLocationListOpened:!1,currentLocation:a.location});if("CLICK_PHRASE"===a.type)return Object(D.a)(Object(D.a)({},t),{},{botAnswers:[].concat(Object(Ee.a)(t.botAnswers),[a.phrase]),userReplicies:[]});if("PHRASE_EVENT"===a.type){var o=a.phrase,n=o.event;if(o.levelEvent,"nextReply"===n){var r=[t.phrasesData[t.currentBot][t.phraseIndex+1]];return Object(D.a)(Object(D.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:r})}if("close"===n)return 20===t.currentBot&&setTimeout((function(){e.dispatcher.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),e.dispatcher.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!1}),e.player.toggleBlocked(!0),setTimeout((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),Object(D.a)(Object(D.a)({},t),{},{userReplicies:[],isDialogComplete:!0,isButtonDialog:!0})}if("TOGGLE_DIALOG"===a.type){var i=[];return e.player.toggleBlocked(a.isShowPalleteDialog),a.isShowPalleteDialog&&(i=t.isDialogComplete?[]:[t.phrasesData[t.currentBot][t.phraseIndex]]),Object(D.a)(Object(D.a)({},t),{},{isShowPalleteDialog:a.isShowPalleteDialog,userReplicies:i})}if("TOGGLE_BUTTON"===a.type){var s=t.botAnswers,c=t.phraseIndex,l=t.isDialogComplete;return a.currentBot&&a.currentBot!==t.currentBot&&(s=[],c=0,l=!1),Object(D.a)(Object(D.a)({},t),{},{phraseIndex:c,currentBot:a.currentBot||t.currentBot,isButtonDialog:a.isButtonDialog,isDialogComplete:l,botAnswers:s})}return"SHOW_FINAL_MESSAGE"===a.type?Object(D.a)(Object(D.a)({},t),{},{isShowFinalMessage:!0}):"TOGGLE_BUTTON_DRAW_CAR"===a.type?Object(D.a)(Object(D.a)({},t),{},{isShowButtonDrawCar:a.is}):"CLICK_DRAW"===a.type?"draw car"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(D.a)(Object(D.a)({},t),{},{valButtonDrawCar:"exit car"})):(e.actions.clickMachineExit(),Object(D.a)(Object(D.a)({},t),{},{valButtonDrawCar:"draw car"})):t}}}(t);var a=new Q(t);t.ui=a},initStateKey:"pageLoaded"},{key:"actions",constr:Tt,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(Bt,o)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.1d2c57c4.chunk.js.map