(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{39:function(e,t,a){},41:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var o={};a.r(o),a.d(o,"SIZE_QUADRANT",(function(){return h})),a.d(o,"LOCATIONS_QUADRANTS",(function(){return p})),a.d(o,"CONFIG_FOR_INIT",(function(){return b})),a.d(o,"lCol",(function(){return m})),a.d(o,"lW",(function(){return d})),a.d(o,"MATERIALS_CONFIG",(function(){return f})),a.d(o,"START_ENV_CONFIG",(function(){return O})),a.d(o,"studioConfig",(function(){return j})),a.d(o,"playerConfig",(function(){return v}));var r=a(11),n=a.n(r),i=a(12);function s(){return(s=Object(i.a)(n.a.mark((function e(t,a){var o,r,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,o={CONSTANTS:a}),r=o.loaderAssets,i=l(t),e.next=6,r.loadAssets(i);case 6:o.assets=e.sent,c("beforeStartPlay",t,o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,a){for(var o=0;o<t.length;++o){var r=t[o],n=r.key,i=r.constr;r.initStateKey===e&&(a[n]=new i(a))}},l=function(e){for(var t=[],a=0;a<e.length;++a)if(e[a].assetsToLoad&&e[a].assetsToLoad.length)for(var o=0;o<e[a].assetsToLoad.length;++o)t.push(e[a].assetsToLoad[o]);return t},u=a(1),h=5e3,p={"0_0":"location01","0_-3":"location02","3_-1":"location03"},b={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},m=[.3,1,.3],d=.2,f={wallVirtual:{mat:"MeshStandardMaterial",props:{color:16711935,emissive:0}},wallVirtualColor:{mat:"MeshBasicMaterial",props:{color:16777215,emissive:4369,map:"mapParams",bumpMap:"mapParams",bumpScale:.1,specular:255,vertexColors:!0}},car:{mat:"MeshPhongMaterial",props:{color:255,emissive:0,reflectivity:.5,shininess:.5,specular:16777215}},floorMat:{mat:"MeshPhongMaterial",props:{color:65280,map:"mapVirtual2",bumpMap:"mapVirtual2",bumpScale:3}},testRed:{mat:"MeshBasicMaterial",props:{color:16711680}},testGreen:{mat:"MeshBasicMaterial",props:{color:43520}},testGreen1:{mat:"MeshBasicMaterial",props:{color:43520}},testBlack:{mat:"MeshBasicMaterial",props:{color:0,side:u.DoubleSide}}},O={fogNear:1e3,fogFar:3e3,color:0,backgroundImgKey:"skyBox"},j={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},sceneEnvironment:O,composerAddPass:"Saturate"},v={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},y=a(2),g=a(3),C=a(21),_=a(22),w=function(){var e=null,t=null,a=null,o=null,r=null;return function(n,i){return new Promise((function(s){(function(n){return"obj"===n?e=e||new C.a:"glb"===n||"gltf"===n?a=a||new _.a:"img"===n?t=t||new u.TextureLoader:"cubeTextures"===n?o=o||new u.CubeTextureLoader:"soundMp3"===n?r=r||new u.AudioLoader:void 0})(i).load(n,s)}))}},M=function(){function e(){Object(y.a)(this,e),this.resources={},this._load=w()}return Object(g.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(a){var o=t._load,r=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(n.a.mark((function t(i){var c,l,u,h;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,o(u,h);case 4:r[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}a(r),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),S=function(){function e(){Object(y.a)(this,e),this._storage={}}return Object(g.a)(e,[{key:"emit",value:function(e){var t=this;return function(a){return T(t._storage)(e).forEach((function(e){return e(a)}))}}},{key:"subscribe",value:function(e){var t=this;return function(a){return T(t._storage)(e).push(a),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==a}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),T=function(e){return function(t){return e[t]=e[t]||[]}},k=a(5),x=a(17),P=a.n(x),A=a(8),D=a(10),L=a(6),E=(a(39),"en"),I=function(e){return function(t){return e[E]&&e[E][t]||t}},N=a(4),F=I({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),B=Object(A.b)((function(e){return Object(L.a)({},e.controls.infoPanelData)}))((function(e){return Object(N.jsxs)("div",{className:"info",children:[Object(N.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(N.jsxs)("div",{className:"info-inner",children:[Object(N.jsx)("p",{children:F(e.title)}),Object(N.jsx)("p",{children:F(e.topText)}),Object(N.jsx)("ul",{children:e.chapters.map((function(t,a){return Object(N.jsxs)("li",{children:[a+1,".\xa0",t.href?Object(N.jsx)("span",{children:Object(N.jsx)("a",{href:t.href,target:"blank",children:F(t.text)})}):Object(N.jsx)("span",{children:F(t.text)}),a===e.currentChapterIndex&&F(" (current)")]},a)}))}),Object(N.jsx)("p",{children:e.bottomText}),Object(N.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(N.jsxs)("li",{children:[F(e.text),Object(N.jsx)("a",{href:e.href,target:"blank",children:F(e.aText)})]},t)}))})]})]})})),R=(a(41),Object(A.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(k.useState)(!0),a=Object(D.a)(t,2),o=a[0],r=a[1];return Object(k.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&r(!0)}))})),Object(N.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(N.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(N.jsx)(N.Fragment,{children:"\u27fc"}):Object(N.jsx)(N.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(N.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&o&&Object(N.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),r(!1)},children:"\u2752"}),!e.isInfo&&Object(N.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(N.jsx)(B,{})]})})));var G={dispatch:null},z=Object(A.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!G.dispatch&&(G.dispatch=e.dispatch),Object(N.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(N.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(N.jsx)(R,{gameContext:e.gameContext})]})})),W=a(15),U=a(24),K={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var V=document.querySelector(".progress"),q=-100,H=!0;!function e(){H&&setTimeout((function(){0===++q&&(q-=100),V.style.marginLeft=q+"%",e()}),30)}();var Q=function(){function e(t){Object(y.a)(this,e),t.dispatcher=G,this._root=t;var a=function(e){e.customStore||(e.customStore={});var t=Object(W.b)(Object(L.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(L.a)(Object(L.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(L.a)(Object(L.a)({},e),{},{infoPanelData:Object(L.a)(Object(L.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(L.a)(Object(L.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(L.a)(Object(L.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(L.a)(Object(L.a)({},e),{},{isMute:t.is}):Object(L.a)({},e)}},e.customStore)),a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||W.c;return Object(W.d)(t,a(Object(W.a)(U.a)))}(t);a&&P.a.render(Object(N.jsx)(A.a,{store:a,children:Object(N.jsx)(z,{gameContext:t})}),document.getElementById("root"))}return Object(g.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),a=document.querySelector(".progress-wrapper"),o=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,E=t),document.querySelector(".start-screen").style.display="none"};H=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),o(t)})),a.style.display="none"}}]),e}(),Z=a(46),X=function(){function e(){var t=this;Object(y.a)(this,e),this._subscribers=[];var a={time:0,delta:0,count:0,oldTime:0},o=Z.a((function(){return a}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var a=0;a<t._subscribers.length;++a)t._subscribers[a](Object(L.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return a=e}));!function e(){requestAnimationFrame(e),o(a)}()}return Object(g.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),Y=a(19),J=a(27),$=a(26),ee=a(14),te={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},ae={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},oe=a(25),re=function(){function e(t){var a=this;Object(y.a)(this,e),this._root=t;var o=t.assets,r=t.emitter,n=t.CONSTANTS.studioConfig,i=n.canId,s=n.rendererCon,c=(n.clearColor,n.amb);s.canvas=document.getElementById(i),this._renderer=new u.WebGLRenderer(s),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new u.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,h=l.color,p=l.fogNear,b=l.fogFar,m=l.backgroundImgKey;this._scene.background=o[m]||null,this._scene.fog=new u.Fog(h,p,b);c.color,c.strength;this._lightA=new u.AmbientLight(16777215,.2),this._scene.add(this._lightA);var d=new u.DirectionalLight(16777215,.6);d.position.set(1,1,.5),this._scene.add(d);var f=new u.DirectionalLight(16777215,.4);f.position.set(-1,-.1,-.4),this._scene.add(f),this._playerCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var O=new oe.a(this._controlsCamera,this._renderer.domElement);O.target.set(0,0,0),O.update(),this._composer=new J.a(this._renderer),this._renderPass=new $.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(te)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new ee.a(ae)));var j=new u.Vector3,v=!0;r.subscribe("keyEvent")((function(e){e.o&&(v?(v=!1,a._renderPass.camera=a._controlsCamera,a._playerCamera.getWorldPosition(j),a._controlsCamera.position.x=j.x+100,a._controlsCamera.position.y=j.y+100,a._controlsCamera.position.z=j.z,O.target.set(j.x,j.y,j.z),O.update()):(v=!0,a._renderPass.camera=a._playerCamera))}));var g=function(){var e={width:window.innerWidth,height:window.innerHeight};a._renderer.setSize(e.width,e.height),a._composer.setSize(e.width,e.height),a._controlsCamera&&(a._controlsCamera.aspect=e.width/e.height,a._controlsCamera.updateProjectionMatrix()),a._playerCamera&&(a._playerCamera.aspect=e.width/e.height,a._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",g),g(),this.addToScene=function(e){return a._scene.add(e)},this.removeFromScene=function(e){return a._scene.remove(e)},this.drawFrame=function(){a._composer.render(a._scene,a._controlsCamera)},r.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(g.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),ne=function(){function e(t){Object(y.a)(this,e);var a=t.emitter,o={up:!1,down:!1,left:!1,right:!1,p:!1},r={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=r,this.keys=o;var n=function(e,t){switch(e){case 38:case 87:r.up&&(o.up=t);break;case 40:case 83:r.down&&(o.down=t);break;case 37:case 65:o.left=t;break;case 39:case 68:o.right=t;break;case 79:o.o=t;break;case 80:o.p=t}a.emit("keyEvent")(o)};document.addEventListener("keydown",(function(e){return n(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return n(e.keyCode,!1)})),a.subscribe("mouseDown")((function(e){"butt-left"===e&&n(37,!0),"butt-right"===e&&n(39,!0),"butt-front"===e&&n(38,!0),"butt-back"===e&&n(40,!0)})),a.subscribe("mouseUp")((function(e){"butt-left"===e&&n(37,!1),"butt-right"===e&&n(39,!1),"butt-front"===e&&n(38,!1),"butt-back"===e&&n(40,!1)}))}return Object(g.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),ie=function(){function e(t){Object(y.a)(this,e);var a=t.studio,o=t.CONSTANTS.playerConfig,r=(o.startPos,o.startRot,o.cameraData),n=(o.frontObjPos,o.backObjPos,o.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new u.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new u.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new u.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new u.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=r.fov,s=r.ratio,c=r.near,l=r.far;r.pos;if(this._camera=new u.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),n){var h=n.color,p=n.strenth,b=n.pos,m=new u.PointLight(h,p);m.position.fromArray(b),this.mesh.add(m)}a.setCamera(this._camera),a.addToScene(this.mesh)}return Object(g.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,a){this.mesh.position.set(e,t,a)}}]),e}(),se=function(e,t){for(var a in e)e[a].wrapS&&(e[a].wrapS=e[a].wrapT=u.RepeatWrapping);var o=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],r={},n=function(a){r[a]=new u[t[a].mat](Object(L.a)({},t[a].props)),o.map((function(o){return t[a].props[o]&&(r[a][o]=e[t[a].props[o]])}))};for(var i in t)n(i);return r},ce=function(e,t){var a={};return e["level-rooms"].traverse((function(e){e.geometry&&(a[e.name]=e,e.material=t.wallVirtual)})),{items:a}},le=a.p+"static/media/level.5a24fd33.obj",ue=a.p+"static/media/floor_outer_map3.558e9646.jpg",he=(a.p,a.p+"static/media/map02.10921dbe.jpg"),pe=a.p+"static/media/floor_outer_map.35e50f6e.jpg",be=a.p+"static/media/txt1.b67888d5.jpg",me=(a.p,a.p+"static/media/nx.a038c501.jpg"),de=(a.p,a.p,a.p,a.p,a.p+"static/media/px.96d0b65f.jpg"),fe=a.p+"static/media/nx.8cbf039d.jpg",Oe=a.p+"static/media/py.659ebc34.jpg",je=a.p+"static/media/ny.09051a4e.jpg",ve=a.p+"static/media/pz.a1539724.jpg",ye=a.p+"static/media/nz.0bc769f7.jpg",ge=function(){function e(){Object(y.a)(this,e),this._arrMeshes=[],this._vecStart=new u.Vector3,this._vecDir=new u.Vector3,this._rayCaster=new u.Raycaster(this._vecStart,this._vecDir)}return Object(g.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,a){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var o=this._rayCaster.intersectObjects(this._arrMeshes);return o[0]&&o[0].distance<a?[!0,o[0]]:[!1,null]}}]),e}(),Ce=function(){function e(t){var a=this;Object(y.a)(this,e);var o=t.assets,r=t.CONSTANTS,n=t.emitter,i=t.materials,s=(t.system_Level,r.CONFIG_FOR_INIT.currentSceneConfig.carProps),c=s.position,l=s.rotation;console.log(o["level-rooms"].children),this._model=o["level-rooms"].children.filter((function(e){return"CAR_102G"===e.name}))[0],this._model.material=i.testGreen1;var h=o["level-rooms"].children.filter((function(e){return"CAR_102"===e.name}))[0];h.material=i.testBlack,this._model.add(h),this._camera=new u.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=15,this._model.add(this._camera),this._model.position.fromArray(c),this._model.rotation.fromArray(l),this._collision=o["level-rooms"].children.filter((function(e){return"CAR_104"===e.name}))[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new u.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new u.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){a._compass=function(e){e.assets;var t=e.studio,a=e.system_Level._items.arrow;a.material=e.materials.testGreen1;var o=new u.Mesh(new u.BoxGeometry(10,10,10),new u.MeshBasicMaterial({color:16711680}));o.position.set(-500,-30,-500),t.addToScene(o);var r=new u.Mesh(new u.BoxGeometry(10,10,10),new u.MeshBasicMaterial({color:16711680}));return r.position.set(0,0,0),t.addToScene(o),new u.Vector3,{addToParent:function(e){e.add(a)},setArrowPosition:function(e,t,o){a.position.set(e,t,o)},setTargetPosition:function(e){o.position.copy(e)},update:function(){r.position.copy(a.parent.position),r.lookAt(o.position),a.parent.position.z<o.position.z?a.rotation.y=-a.parent.rotation.y+r.rotation.y:a.rotation.y=-a.parent.rotation.y-r.rotation.y+Math.PI}}}(t),a._compass.addToParent(a._model),a._compass.setArrowPosition(0,4.3,-26),a.setTargetPosition=function(e){a._compass.setTargetPosition(e),a._compass.update()}})),this._collisionsWalls=new ge;var p=function(e,t){var o=a._collisionsWalls.checkCollisions(a._model,e,t);return Object(D.a)(o,1)[0]};this.isFreeze=!0;var b={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!a.isFreeze){if(a._spd<0&&(p(a._frontObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),a._spd>0&&(p(a._backObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),b.up&&(a._spd-=a._acc),b.down&&(a._spd+=a._acc),Math.abs(a._spd)>.001){a._spd>0&&(a._spd-=a._deceleration,a._spd<0&&(a._spd=0)),a._spd<0&&(a._spd+=a._deceleration,a._spd>0&&(a._spd=0)),a._spd=Math.min(a._maxSpdBack,Math.max(a._maxSpdFront,a._spd));var t=Math.min(1,Math.max(0,Math.abs(a._spd)));b.left&&(a._spd<0&&(a._model.rotation.y+=a._spdRot*t),a._spd>0&&(a._model.rotation.y-=a._spdRot*t)),b.right&&(a._spd<0&&(a._model.rotation.y-=a._spdRot*t),a._spd>0&&(a._model.rotation.y+=a._spdRot*t))}else a._spd=0;a._isCarStay&&0!==a._spd&&(a._isCarStay=!1,a._onChangeStateIsStay("carStart")),a._isCarStay||0!==a._spd||(a._isCarStay=!0,a._onChangeStateIsStay("carStop"))}},n.subscribe("keyEvent")((function(e){return b=e}))}return Object(g.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}}]),e}(),_e=function(){function e(t){var a=this;Object(y.a)(this,e);var o=t.emitter,r=t.CONSTANTS,n=t.player;t.assets,t.studio;n.mesh.position.fromArray([0,0,0]);var i=new ge,s=r.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;n.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},n.toggleCanMove=function(e,t){return a.isCanMove[e]=t},this.isFreeze=!1;var p={};this.update=function(e){a.isFreeze||(p.left&&n.mesh.rotateY(u*e.count),p.right&&n.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(n.mesh,n.bottomObj,17.2),a=Object(D.a)(t,2),o=a[0],r=a[1];o&&17>r.distance?n.mesh.translateY(17-r.distance):o||(n.mesh.position.y+=l*e.count)}(e),p.up&&a.isCanMove.forward&&function(e){var t=i.checkCollisions(n.mesh,n.frontObj,17),a=Object(D.a)(t,2),r=a[0],s=a[1];r?s.object.userData.type&&"alert"===s.object.userData.type&&o.emit("collision")(s.object.userData.event):(n.mesh.translateZ(-c*e.count),o.emit("playerMove")("forward"))}(e),p.down&&a.isCanMove.back&&function(e){var t=i.checkCollisions(n.mesh,n.backObj,17);Object(D.a)(t,1)[0]||(n.mesh.translateZ(c*e.count),o.emit("playerMove")("back"))}(e),p.p&&console.log("player.mesh.position.fromArray([".concat(n.mesh.position.x,", ").concat(n.mesh.position.y,", ").concat(n.mesh.position.z,"])"))))},o.subscribe("keyEvent")((function(e){return p=e})),this._collisionsWalls=i}return Object(g.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),we=function(){function e(t){var a=this;Object(y.a)(this,e),this._root=t;var o=t.emitter,r=t.player;this._itemsToCheck=[],o.subscribe("playerMove")((function(){for(var e=0;e<a._itemsToCheck.length;++e){var t=r.mesh.position.distanceTo(a._itemsToCheck[e].position);if(!a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<a._itemsToCheck[e].userData.nearPlayerItemNear)return a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>a._itemsToCheck[e].userData.nearPlayerItemNear&&(a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(g.a)(e,[{key:"setItemToCheck",value:function(e,t,a,o){for(var r=0;r<this._itemsToCheck.length;++r)if(e===this._itemsToCheck[r])return;t&&(e.userData.nearPlayerItemKey=t),a&&(e.userData.nearPlayerItemNear=a),o&&(e.userData.nearPlayerItemFar=o),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),Me=function(e,t){for(var a=[],o=e-1;o<e+2;++o)for(var r=t-1;r<t+2;++r)a.push(o+"_"+r);return a},Se=function(e,t){for(var a=[],o=0;o<e.length;++o){for(var r=!1,n=0;n<t.length;++n)e[o]===t[n]&&(r=!0);r||a.push(e[o])}return a},Te=a(0),ke=Float32Array;function xe(e,t,a){return(a=a||new ke(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a}function Pe(e,t){t=t||new ke(3);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return a>1e-5&&(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a),t}function Ae(e,t,a){return(a=a||new ke(3))[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a}function De(e,t){var a=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return a*a+o*o+r*r}function Le(e,t){t=t||new ke(16);var a=e[0],o=e[1],r=e[2],n=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],p=e[10],b=e[11],m=e[12],d=e[13],f=e[14],O=e[15],j=p*O,v=f*b,y=c*O,g=f*l,C=c*b,_=p*l,w=r*O,M=f*n,S=r*b,T=p*n,k=r*l,x=c*n,P=u*d,A=m*h,D=i*d,L=m*s,E=i*h,I=u*s,N=a*d,F=m*o,B=a*h,R=u*o,G=a*s,z=i*o,W=j*s+g*h+C*d-(v*s+y*h+_*d),U=v*o+w*h+T*d-(j*o+M*h+S*d),K=y*o+M*s+k*d-(g*o+w*s+x*d),V=_*o+S*s+x*h-(C*o+T*s+k*h),q=1/(a*W+i*U+u*K+m*V);return t[0]=q*W,t[1]=q*U,t[2]=q*K,t[3]=q*V,t[4]=q*(v*i+y*u+_*m-(j*i+g*u+C*m)),t[5]=q*(j*a+M*u+S*m-(v*a+w*u+T*m)),t[6]=q*(g*a+w*i+x*m-(y*a+M*i+k*m)),t[7]=q*(C*a+T*i+k*u-(_*a+S*i+x*u)),t[8]=q*(P*l+L*b+E*O-(A*l+D*b+I*O)),t[9]=q*(A*n+N*b+R*O-(P*n+F*b+B*O)),t[10]=q*(D*n+F*l+G*O-(L*n+N*l+z*O)),t[11]=q*(I*n+B*l+z*b-(E*n+R*l+G*b)),t[12]=q*(D*p+I*f+A*c-(E*f+P*c+L*p)),t[13]=q*(B*f+P*r+F*p-(N*p+R*f+A*r)),t[14]=q*(N*c+z*f+L*r-(G*f+D*r+F*c)),t[15]=q*(G*p+E*r+R*c-(B*c+z*p+I*r)),t}var Ee={copy:function(e,t){return(t=t||new ke(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,a,o){o=o||new ke(16);var r=Pe(xe(e,t)),n=Pe(Ae(a,r)),i=Pe(Ae(r,n));return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=0,o[4]=i[0],o[5]=i[1],o[6]=i[2],o[7]=0,o[8]=r[0],o[9]=r[1],o[10]=r[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},addVectors:function(e,t,a){return(a=a||new ke(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},subtractVectors:xe,scaleVector:function(e,t,a){return(a=a||new ke(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},distance:function(e,t){return Math.sqrt(De(e,t))},distanceSq:De,normalize:Pe,compose:function(e,t,a,o){o=o||new ke(16);var r=t[0],n=t[1],i=t[2],s=t[3],c=r+r,l=n+n,u=i+i,h=r*c,p=r*l,b=r*u,m=n*l,d=n*u,f=i*u,O=s*c,j=s*l,v=s*u,y=a[0],g=a[1],C=a[2];return o[0]=(1-(m+f))*y,o[1]=(p+v)*y,o[2]=(b-j)*y,o[3]=0,o[4]=(p-v)*g,o[5]=(1-(h+f))*g,o[6]=(d+O)*g,o[7]=0,o[8]=(b+j)*C,o[9]=(d-O)*C,o[10]=(1-(h+m))*C,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},cross:Ae,decompose:function(e,t,a,o){var r=Ee.length(e.slice(0,3)),n=Ee.length(e.slice(4,7)),i=Ee.length(e.slice(8,11));(function(e){var t=e[0],a=e[1],o=e[2],r=e[3],n=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],b=e[12],m=e[13],d=e[14],f=e[15],O=h*f,j=d*p,v=s*f,y=d*c,g=s*p,C=h*c,_=o*f,w=d*r,M=o*p,S=h*r,T=o*c,k=s*r;return 1/(t*(O*i+y*u+g*m-(j*i+v*u+C*m))+n*(j*a+_*u+S*m-(O*a+w*u+M*m))+l*(v*a+w*i+T*m-(y*a+_*i+k*m))+b*(C*a+M*i+k*u-(g*a+S*i+T*u)))})(e)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=Ee.copy(e),c=1/r,l=1/n,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var a=e[0],o=e[4],r=e[8],n=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=a+i+u;if(h>0){var p=.5/Math.sqrt(h+1);t[3]=.25/p,t[0]=(l-s)*p,t[1]=(r-c)*p,t[2]=(n-o)*p}else if(a>i&&a>u){var b=2*Math.sqrt(1+a-i-u);t[3]=(l-s)/b,t[0]=.25*b,t[1]=(o+n)/b,t[2]=(r+c)/b}else if(i>u){var m=2*Math.sqrt(1+i-a-u);t[3]=(r-c)/m,t[0]=(o+n)/m,t[1]=.25*m,t[2]=(s+l)/m}else{var d=2*Math.sqrt(1+u-a-i);t[3]=(n-o)/d,t[0]=(r+c)/d,t[1]=(s+l)/d,t[2]=.25*d}}(s,a),o[0]=r,o[1]=n,o[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new ke(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new ke(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,a,o,r,n,i){return(i=i||new ke(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(o-a),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(r-n),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(a+o)/(a-o),i[14]=(r+n)/(r-n),i[15]=1,i},frustum:function(e,t,a,o,r,n,i){var s=t-e,c=o-a,l=n-r;return(i=i||new ke(16))[0]=2*r/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*r/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(o+a)/c,i[10]=-(n+r)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*r*n/l,i[15]=0,i},perspective:function(e,t,a,o,r){r=r||new ke(16);var n=Math.tan(.5*Math.PI-.5*e),i=1/(a-o);return r[0]=n/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(a+o)*i,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*o*i*2,r[15]=0,r},translation:function(e,t,a,o){return(o=o||new ke(16))[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=e,o[13]=t,o[14]=a,o[15]=1,o},translate:function(e,t,a,o,r){r=r||new ke(16);var n=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],p=e[7],b=e[8],m=e[9],d=e[10],f=e[11],O=e[12],j=e[13],v=e[14],y=e[15];return e!==r&&(r[0]=n,r[1]=i,r[2]=s,r[3]=c,r[4]=l,r[5]=u,r[6]=h,r[7]=p,r[8]=b,r[9]=m,r[10]=d,r[11]=f),r[12]=n*t+l*a+b*o+O,r[13]=i*t+u*a+m*o+j,r[14]=s*t+h*a+d*o+v,r[15]=c*t+p*a+f*o+y,r},xRotation:function(e,t){t=t||new ke(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=o,t[7]=0,t[8]=0,t[9]=-o,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new ke(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=0,t[2]=-o,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=o,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new ke(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=o,t[2]=0,t[3]=0,t[4]=-o,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,a){a=a||new ke(16);var o=e[4],r=e[5],n=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[4]=h*o+p*s,a[5]=h*r+p*c,a[6]=h*n+p*l,a[7]=h*i+p*u,a[8]=h*s-p*o,a[9]=h*c-p*r,a[10]=h*l-p*n,a[11]=h*u-p*i,e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},yRotate:function(e,t,a){a=a||new ke(16);var o=e[0],r=e[1],n=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o-p*s,a[1]=h*r-p*c,a[2]=h*n-p*l,a[3]=h*i-p*u,a[8]=h*s+p*o,a[9]=h*c+p*r,a[10]=h*l+p*n,a[11]=h*u+p*i,e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},zRotate:function(e,t,a){a=a||new ke(16);var o=e[0],r=e[1],n=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o+p*s,a[1]=h*r+p*c,a[2]=h*n+p*l,a[3]=h*i+p*u,a[4]=h*s-p*o,a[5]=h*c-p*r,a[6]=h*l-p*n,a[7]=h*u-p*i,e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},axisRotation:function(e,t,a){a=a||new ke(16);var o=e[0],r=e[1],n=e[2],i=Math.sqrt(o*o+r*r+n*n),s=(o/=i)*o,c=(r/=i)*r,l=(n/=i)*n,u=Math.cos(t),h=Math.sin(t),p=1-u;return a[0]=s+(1-s)*u,a[1]=o*r*p+n*h,a[2]=o*n*p-r*h,a[3]=0,a[4]=o*r*p-n*h,a[5]=c+(1-c)*u,a[6]=r*n*p+o*h,a[7]=0,a[8]=o*n*p+r*h,a[9]=r*n*p-o*h,a[10]=l+(1-l)*u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},axisRotate:function(e,t,a,o){o=o||new ke(16);var r=t[0],n=t[1],i=t[2],s=Math.sqrt(r*r+n*n+i*i),c=(r/=s)*r,l=(n/=s)*n,u=(i/=s)*i,h=Math.cos(a),p=Math.sin(a),b=1-h,m=c+(1-c)*h,d=r*n*b+i*p,f=r*i*b-n*p,O=r*n*b-i*p,j=l+(1-l)*h,v=n*i*b+r*p,y=r*i*b+n*p,g=n*i*b-r*p,C=u+(1-u)*h,_=e[0],w=e[1],M=e[2],S=e[3],T=e[4],k=e[5],x=e[6],P=e[7],A=e[8],D=e[9],L=e[10],E=e[11];return o[0]=m*_+d*T+f*A,o[1]=m*w+d*k+f*D,o[2]=m*M+d*x+f*L,o[3]=m*S+d*P+f*E,o[4]=O*_+j*T+v*A,o[5]=O*w+j*k+v*D,o[6]=O*M+j*x+v*L,o[7]=O*S+j*P+v*E,o[8]=y*_+g*T+C*A,o[9]=y*w+g*k+C*D,o[10]=y*M+g*x+C*L,o[11]=y*S+g*P+C*E,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},scaling:function(e,t,a,o){return(o=o||new ke(16))[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},scale:function(e,t,a,o,r){return(r=r||new ke(16))[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=t*e[3],r[4]=a*e[4],r[5]=a*e[5],r[6]=a*e[6],r[7]=a*e[7],r[8]=o*e[8],r[9]=o*e[9],r[10]=o*e[10],r[11]=o*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},multiply:function(e,t,a){a=a||new ke(16);var o=t[0],r=t[1],n=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],b=t[10],m=t[11],d=t[12],f=t[13],O=t[14],j=t[15],v=e[0],y=e[1],g=e[2],C=e[3],_=e[4],w=e[5],M=e[6],S=e[7],T=e[8],k=e[9],x=e[10],P=e[11],A=e[12],D=e[13],L=e[14],E=e[15];return a[0]=o*v+r*_+n*T+i*A,a[1]=o*y+r*w+n*k+i*D,a[2]=o*g+r*M+n*x+i*L,a[3]=o*C+r*S+n*P+i*E,a[4]=s*v+c*_+l*T+u*A,a[5]=s*y+c*w+l*k+u*D,a[6]=s*g+c*M+l*x+u*L,a[7]=s*C+c*S+l*P+u*E,a[8]=h*v+p*_+b*T+m*A,a[9]=h*y+p*w+b*k+m*D,a[10]=h*g+p*M+b*x+m*L,a[11]=h*C+p*S+b*P+m*E,a[12]=d*v+f*_+O*T+j*A,a[13]=d*y+f*w+O*k+j*D,a[14]=d*g+f*M+O*x+j*L,a[15]=d*C+f*S+O*P+j*E,a},inverse:Le,transformVector:function(e,t,a){a=a||new ke(4);for(var o=0;o<4;++o){a[o]=0;for(var r=0;r<4;++r)a[o]+=t[r]*e[4*r+o]}return a},transformPoint:function(e,t,a){a=a||new ke(3);var o=t[0],r=t[1],n=t[2],i=o*e[3]+r*e[7]+n*e[11]+e[15];return a[0]=(o*e[0]+r*e[4]+n*e[8]+e[12])/i,a[1]=(o*e[1]+r*e[5]+n*e[9]+e[13])/i,a[2]=(o*e[2]+r*e[6]+n*e[10]+e[14])/i,a},transformDirection:function(e,t,a){a=a||new ke(3);var o=t[0],r=t[1],n=t[2];return a[0]=o*e[0]+r*e[4]+n*e[8],a[1]=o*e[1]+r*e[5]+n*e[9],a[2]=o*e[2]+r*e[6]+n*e[10],a},transformNormal:function(e,t,a){a=a||new ke(3);var o=Le(e),r=t[0],n=t[1],i=t[2];return a[0]=r*o[0]+n*o[1]+i*o[2],a[1]=r*o[4]+n*o[5]+i*o[6],a[2]=r*o[8]+n*o[9]+i*o[10],a},setDefaultType:function(e){var t=ke;return ke=e,t}},Ie=(Math.floor,Math.random),Ne=function(e,t){return e+Ie()*(t-e)},Fe=function(e,t,a,o){return[].concat(Object(Te.a)(e),Object(Te.a)(t),Object(Te.a)(a),Object(Te.a)(e),Object(Te.a)(a),Object(Te.a)(o))},Be=function(e,t,a,o){return[].concat(Object(Te.a)(e),Object(Te.a)(t),Object(Te.a)(a),Object(Te.a)(e),Object(Te.a)(a),Object(Te.a)(o))},Re=function(e){return[].concat(Object(Te.a)(e),Object(Te.a)(e),Object(Te.a)(e),Object(Te.a)(e),Object(Te.a)(e),Object(Te.a)(e))},Ge=function(e,t,a,o,r,n){var i=t[0]-e[0],s=a[1]-e[1],c=Ne(.3*i,.7*i),l=Ne(.3*s,.7*s),u=e[0]+(i-c)/2,h=t[0]-(i-c)/2,p=e[1]+(s-l)/2,b=a[1]-(s-l)/2,m=[u,p,e[2]],d=[h,p,e[2]],f=[h,b,e[2]],O=[u,b,e[2]],j=[];return j.push.apply(j,Object(Te.a)(Fe(m,d,f,O)).concat(Object(Te.a)(Fe(e,t,d,m)),Object(Te.a)(Fe(d,t,a,f)),Object(Te.a)(Fe(O,f,a,o)),Object(Te.a)(Fe(e,m,O,o)))),{vArr:j,cArr:ze(r,n),uArr:[].concat(Object(Te.a)(Be([.5,.5],[1,.5],[1,1],[.5,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(Te.a)(Be([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(Te.a)(Be([.1,.9],[.4,.9],[.5,1],[0,1])),Object(Te.a)(Be([0,.5],[.1,.6],[.1,.9],[0,1])))}},ze=function(e,t){return[].concat(Object(Te.a)(Re(e)),Object(Te.a)(Re(t)),Object(Te.a)(Re(t)),Object(Te.a)(Re(t)),Object(Te.a)(Re(t)))},We=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=Ee.yRotation(r);n=Ee.translate(n,t,a,o);for(var i=0;i<e.length;i+=3){var s=Ee.transformPoint(n,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},Ue=function(e,t){for(var a=Ee.yRotation(t),o=0;o<e.length;o+=3){var r=Ee.transformPoint(a,[e[o+0],e[o+1],e[o+2],1]);e[o+0]=r[0],e[o+1]=r[1],e[o+2]=r[2]}},Ke=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=Ee.translation(t,a,o),n=0;n<e.length;n+=3){var i=Ee.transformPoint(r,[e[n+0],e[n+1],e[n+2],1]);e[n+0]=i[0],e[n+1]=i[1],e[n+2]=i[2]}},Ve=function(e){var t=e.h0,a=e.h1,o=e.color1,r=void 0===o?[.2,.1,.1]:o,n=e.color2,i=void 0===n?[1,1,1]:n,s=e.rBase,c=void 0===s?5:s,l=e.hBase,u=void 0===l?5:l,h=e.hBaseToTrunk,p=void 0===h?1:h,b=e.hCapital,f=void 0===b?2:b,O=e.rCapital,j=void 0===O?6:O,v=e.hTrunkToCapital,y=void 0===v?1:v,g=e.rTrunk,C=void 0===g?3:g,_=t,w=t+u,M=Fe([-c,_,c],[c,_,c],[c,w,c],[-c,w,c]),S=Re(r),T=Be([.5,0],[1,0],[1,.5],[.5,.5]),k=Fe([c+d,_-d,c+d],[-c-d,_-d,c+d],[-c-d,w,c+d],[c+d,w,c+d]),x=Re(m),P=Be([0,1],[0,1],[0,1],[0,1]);w=(_=w)+p;var A=Object(Te.a)(Fe([-c,_,c],[c,_,c],[C,w,C],[-C,w,C])),D=Object(Te.a)(Re(i)),L=Be([0,.5],[.5,.5],[.4,.7],[.1,.7]),E=function(e){for(var t=e.h,a=void 0===t?2:t,o=e.h2,r=void 0===o?30:o,n=e.r,i=void 0===n?10:n,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],p=r-a,b=a;p>0;){var m=Ne(.5,10),d=Ne(.5,4),f=Ne(.5,4),O=Ne(.5,.2),j=m+d+f+O;(p-=j)>5&&h.push({h0:b,h01:b+m,h02:b+m+d,h03:b+m+d+f,h04:b+m+d+f+O,r:Ne(1,10)}),b+=j}var v=[],y=[],g=[];if(0===h.length)v.push.apply(v,Object(Te.a)(Fe([-i,a,i],[i,a,i],[i,r,i],[-i,r,i]))),y.push.apply(y,Object(Te.a)(Re(c))),g.push.apply(g,Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var C=0;C<h.length;++C){var _=Ge([-i,h[C].h0,i],[i,h[C].h0,i],[i,h[C].h01,i],[-i,h[C].h01,i],u,u),w=_.vArr,M=_.cArr,S=_.uArr;v.push.apply(v,Object(Te.a)(w)),y.push.apply(y,Object(Te.a)(M)),g.push.apply(g,Object(Te.a)(S)),v.push.apply(v,Object(Te.a)(Fe([-i,h[C].h01,i],[i,h[C].h01,i],[h[C].r,h[C].h02,h[C].r],[-h[C].r,h[C].h02,h[C].r]))),y.push.apply(y,Object(Te.a)(Re(u))),g.push.apply(g,Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Te.a)(Fe([-h[C].r,h[C].h02,h[C].r],[h[C].r,h[C].h02,h[C].r],[h[C].r,h[C].h03,h[C].r],[-h[C].r,h[C].h03,h[C].r]))),y.push.apply(y,Object(Te.a)(Re(c))),g.push.apply(g,Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1]))),v.push.apply(v,Object(Te.a)(Fe([-h[C].r,h[C].h03,h[C].r],[h[C].r,h[C].h03,h[C].r],[i,h[C].h04,i],[-i,h[C].h04,i]))),y.push.apply(y,Object(Te.a)(Re(u))),g.push.apply(g,Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])))}var T=Ge([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,r,i],[-i,r,i],u,c),k=T.vArr,x=T.cArr,P=T.uArr;v.push.apply(v,Object(Te.a)(k)),y.push.apply(y,Object(Te.a)(x)),g.push.apply(g,Object(Te.a)(P))}return{vert:v,col:y,uv:g}}({color1:r,color2:i,h:_=w,h2:w=a-f-y,r:C}),I=E.vert,N=E.col,F=E.uv;_=w,w=a-f;var B=Object(Te.a)(Fe([-C,_,C],[C,_,C],[j,w,j],[-j,w,j]));_=w,w=a;var R=Object(Te.a)(Fe([-j,_,j],[j,_,j],[j,w,j],[-j,w,j])),G=Be([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(Te.a)(M),Object(Te.a)(k),Object(Te.a)(A),Object(Te.a)(I),Object(Te.a)(B),Object(Te.a)(R)),frontColors:[].concat(Object(Te.a)(S),Object(Te.a)(x),Object(Te.a)(D),Object(Te.a)(N),Object(Te.a)(D),Object(Te.a)(S)),frontUV:[].concat(Object(Te.a)(T),Object(Te.a)(P),Object(Te.a)(L),Object(Te.a)(F),Object(Te.a)(L),Object(Te.a)(G))}},qe=20,He=[0,0,0],Qe=[0,.7,0],Ze=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,r=void 0===o?30:o,n=e.rCapital,i=void 0===n?6:n,s=e.rBase,c=void 0===s?5:s,l=e.capTop,u=void 0!==l&&l,h=e.capBottom,p=void 0!==h&&h,b=Ve({h0:a,h1:r,color1:He,color2:Qe,rCapital:i,rBase:c}),f=b.frontVert,O=b.frontColors,j=b.frontUV,v=Object(Te.a)(f);We(v,0,0,0,Math.PI/2);var y=Object(Te.a)(f);We(y,0,0,0,-Math.PI/2);var g=Object(Te.a)(f);We(g,0,0,0,Math.PI);var C=[].concat(Object(Te.a)(f),Object(Te.a)(v),Object(Te.a)(y),Object(Te.a)(g)),_=[].concat(Object(Te.a)(O),Object(Te.a)(O),Object(Te.a)(O),Object(Te.a)(O)),w=[].concat(Object(Te.a)(j),Object(Te.a)(j),Object(Te.a)(j),Object(Te.a)(j)),M=.6,S=[].concat(Object(Te.a)(Fe([-c-M,a,c+M],[c+M,a,c+M],[c+M,r,c+M],[-c-M,r,c+M])),Object(Te.a)(Fe([c+M,a,c+M],[c+M,a,-c-M],[c+M,r,-c-M],[c+M,r,c+M])),Object(Te.a)(Fe([c+M,a,-c-M],[-c-M,a,-c-M],[-c-M,r,-c-M],[c+M,r,-c-M])),Object(Te.a)(Fe([-c-M,a,-c-M],[-c-M,a,c+M],[-c-M,r,c+M],[-c-M,r,-c-M]))),T=[].concat(Object(Te.a)(Fe([-20,a,qe],[qe,a,qe],[qe,r,qe],[-20,r,qe])),Object(Te.a)(Fe([qe,a,qe],[qe,a,-20],[qe,r,-20],[qe,r,qe])),Object(Te.a)(Fe([qe,a,-20],[-20,a,-20],[-20,r,-20],[qe,r,-20])),Object(Te.a)(Fe([-20,a,-20],[-20,a,qe],[-20,r,qe],[-20,r,-20])));return p&&(C.push.apply(C,Object(Te.a)(Fe([-c-d,a-d,c+d],[c+d,a-d,c+d],[c,a-d,-c-d],[-c,a-d,-c-d]))),_.push.apply(_,Object(Te.a)(Re(m))),w.push.apply(w,Object(Te.a)(Be([0,1],[0,1],[0,1],[0,1])))),u&&(C.push.apply(C,Object(Te.a)(Fe([-i,r,i],[i,r,i],[i,r,-i],[-i,r,-i]))),_.push.apply(_,Object(Te.a)(Re(He))),w.push.apply(w,Object(Te.a)(Be([.5,0],[1,0],[1,.5],[.5,.5])))),{v:C,c:_,u:w,collision:S,collisionCar:T}},Xe=function(e){var t=e.isColumn,a=e.h1,o=e.h2,r=e.color1,n=e.color2;if(!t)return{vertColumn:[],colorsColumn:[],uvColumn:[]};var i=[],s=[],c=[],l=o-5;i.push.apply(i,Object(Te.a)(Fe([-4,a,4],[4,a,4],[4,o,4],[-4,o,4])).concat(Object(Te.a)(Fe([4,a,4],[4,a,-4],[4,o,-4],[4,o,4])),Object(Te.a)(Fe([4,a,-4],[-4,a,-4],[-4,o,-4],[4,o,-4])),Object(Te.a)(Fe([-4,a,-4],[-4,a,4],[-4,o,4],[-4,o,-4])),Object(Te.a)(Fe([-6,l,6],[6,l,6],[6,o,6],[-6,o,6])),Object(Te.a)(Fe([6,l,6],[6,l,-6],[6,o,-6],[6,o,6])),Object(Te.a)(Fe([6,l,-6],[-6,l,-6],[-6,o,-6],[6,o,-6])),Object(Te.a)(Fe([-6,l,-6],[-6,l,6],[-6,o,6],[-6,o,-6])),Object(Te.a)(Fe([-6,l,6],[-6,l,-6],[6,l,-6],[6,l,6])),Object(Te.a)(Fe([-6,o,-6],[-6,o,6],[6,o,6],[6,o,-6])))),s.push.apply(s,Object(Te.a)(Re(n)).concat(Object(Te.a)(Re(n)),Object(Te.a)(Re(n)),Object(Te.a)(Re(n)),Object(Te.a)(Re(r)),Object(Te.a)(Re(r)),Object(Te.a)(Re(r)),Object(Te.a)(Re(r)),Object(Te.a)(Re(r)),Object(Te.a)(Re(r))));var u=Be([0,.5],[.5,.5],[.5,1],[0,1]);return c.push.apply(c,Object(Te.a)(u).concat(Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u),Object(Te.a)(u))),{vertColumn:i,colorsColumn:s,uvColumn:c}},Ye=Math.PI,Je=Math.cos,$e=Ye/2,et=[0,0,0],tt=Math.sin,at=Math.cos,ot=function(e){var t=e.isTopElem,a=e.color1,o=e.color2,r=e.h2;if(!t)return{vertTopElem:[],colorsTopElem:[],uvTopElem:[]};for(var n=[],i=[],s=[],c=2+12*Math.random(),l=1+4*Math.random(),u=.2+40*Math.random(),h=.1+10*Math.random(),p=.1+10*Math.random(),b=.1+40*Math.random(),f=0;f<6;++f){var O=f+1;O>6&&(O=0);var j=f/6*Math.PI*2,v=O/6*Math.PI*2,y=r,g=y+c,C=6,_=6,w=tt(j),M=at(j),S=tt(v),T=at(v);n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+l,C=_,_=3,n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+u,_=C=_,n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+h,_=(C=_)+4,n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+p,_=C=_,n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_])));var k=d+.5;n.push.apply(n,Object(Te.a)(Fe([S*(C+k),y,T*(C+k)],[w*(C+k),y,M*(C+k)],[w*(_+k),g,M*(_+k)],[S*(_+k),g,T*(_+k)]))),n.push.apply(n,Object(Te.a)(Fe([w*_,g,M*_],[S*_,g,T*_],[2*S,g,2*T],[2*tt(j),g,2*M]))),g=(y=g)+b,C=2,_=7,n.push.apply(n,Object(Te.a)(Fe([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_])));var x=d;n.push.apply(n,Object(Te.a)(Fe([S*(C+x),y,T*(C+x)],[w*(C+x),y,M*(C+x)],[w*(_+x),g,M*(_+x)],[S*(_+x),g,T*(_+x)]))),y=g,g+=b,n.push(w*_,y,M*_,S*_,y,T*_,0,g,0),n.push(S*(_+.5),y,T*(_+.5),w*(_+.5),y,M*(_+.5),0,g+3,0),i.push.apply(i,Object(Te.a)(Re(a)).concat(Object(Te.a)(Re(o)),Object(Te.a)(Re(o)),Object(Te.a)(Re(o)),Object(Te.a)(Re(a)),Object(Te.a)(Re(m)),Object(Te.a)(Re(a)),Object(Te.a)(Re(a)),Object(Te.a)(Re(m)),Object(Te.a)(a),Object(Te.a)(a),Object(Te.a)(a),Object(Te.a)(m),Object(Te.a)(m),Object(Te.a)(m))),s.push.apply(s,Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,1],[0,1],[0,1],[0,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,.5],[.5,.5],[.5,1],[0,1])),Object(Te.a)(Be([0,1],[0,1],[0,1],[0,1])),[0,.5],[.5,.5],[.25,1],[0,1],[0,1],[0,1]))}return{vertTopElem:n,colorsTopElem:i,uvTopElem:s}},rt=[0,0,0],nt=function(e,t,a){var o=e.h,r=e.r,n=e.x,i=e.z,s=e.bridgeL,c=e.bridgeMinusH,l=e.hColumn,u=e.rColumn,h=e.i,p=o-5,b=Math.min(l*(.35*Math.random()+.1),50),m=[],d=[],f=[],O=[],j=[],v=function(e){var t=e.r,a=e.h,o=e.hh,r=e.bridgeMinusH,n=e.bridgeL,i=e.color2,s=e.colorB,c=[],l=[],u=[],h=[],p=Be([0,.5],[.5,.5],[.5,1],[0,1]),b=Be([0,0],[0,0],[0,0],[0,0]);return c.push.apply(c,Object(Te.a)(Fe([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(Te.a)(Fe([-t,o,t],[t,o,t],[t,a,t],[-t,a,t])),Object(Te.a)(Fe([-t,o,-t],[-t,o,t],[-t,a,t],[-t,a,-t])),Object(Te.a)(Fe([t,o,t],[t,o,-t],[t,a,-t],[t,a,t])),Object(Te.a)(Fe([t,o,-t],[-t,o,-t],[-t,a,-t],[t,a,-t])),Object(Te.a)(Fe([t,o,-t],[t,o,t],[-t,o,t],[-t,o,-t])),Object(Te.a)(Fe([-t,a,-t],[t,a,-t],[t,a-r,-t-n],[-t,a-r,-t-n])),Object(Te.a)(Fe([-t,o-r,-t-n],[-t,o,-t],[-t,a,-t],[-t,a-r,-t-n])),Object(Te.a)(Fe([t,o,-t],[t,o-r,-t-n],[t,a-r,-t-n],[t,a,-t])),Object(Te.a)(Fe([-t,o-r,-t-n],[t,o-r,-t-n],[t,o,-t],[-t,o,-t])))),l.push.apply(l,Object(Te.a)(Re(i)).concat(Object(Te.a)(Re(s)),Object(Te.a)(Re(s)),Object(Te.a)(Re(s)),Object(Te.a)(Re(i)),Object(Te.a)(Re(i)),Object(Te.a)(Re(i)),Object(Te.a)(Re(s)),Object(Te.a)(Re(s)),Object(Te.a)(Re(i)))),u.push.apply(u,Object(Te.a)(p).concat(Object(Te.a)(b),Object(Te.a)(b),Object(Te.a)(b),Object(Te.a)(b),Object(Te.a)(p),Object(Te.a)(p),Object(Te.a)(b),Object(Te.a)(b),Object(Te.a)(p))),h.push.apply(h,Object(Te.a)(Fe([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(Te.a)(Fe([-t,a,-t],[t,a,-t],[t,a-r,-t-n],[-t,a-r,-t-n])))),{v:c,c:l,u:u,collision:h}}({h:o,hh:p,colorB:rt,color2:a,bridgeL:s,bridgeMinusH:c,r:r});m.push.apply(m,Object(Te.a)(v.v)),d.push.apply(d,Object(Te.a)(v.c)),f.push.apply(f,Object(Te.a)(v.u)),O.push.apply(O,Object(Te.a)(v.collision));var y=Ze({h0:p-l-.1,h1:p-b,capTop:!0,capBottom:!0});Ke(y.v,r,0,r),m.push.apply(m,Object(Te.a)(y.v)),d.push.apply(d,Object(Te.a)(y.c)),f.push.apply(f,Object(Te.a)(y.u)),Ke(y.collision,r,0,r),O.push.apply(O,Object(Te.a)(y.collision)),y.collisionCar&&(Ke(y.collisionCar,r,0,r),j.push.apply(j,Object(Te.a)(y.collisionCar)));var g=Xe({isColumn:!0,h1:p-b,h2:p,color1:[0,0,0],color2:a});Ke(g.vertColumn,r,0,r),m.push.apply(m,Object(Te.a)(g.vertColumn)),d.push.apply(d,Object(Te.a)(g.colorsColumn)),f.push.apply(f,Object(Te.a)(g.uvColumn));var C=function(e){for(var t=e.hArc,a=void 0===t?15:t,o=e.arcL,r=void 0===o?15:o,n=e.color2,i=[],s=[],c=[],l=r/5,u=0;u<5;++u){var h=Je(u/5*$e),p=Je((u+1)/5*$e);i.push(u*l,0+h*a,.1,(u+1)*l,0+p*a,.1,r,a,1),i.push(u*l,0+h*a,-2,r,a,-2,(u+1)*l,0+p*a,-2),s.push.apply(s,Object(Te.a)(n).concat(Object(Te.a)(n),Object(Te.a)(n),Object(Te.a)(n),Object(Te.a)(n),Object(Te.a)(n))),c.push(0,0,.3,0,.3,.3,0,0,.3,0,.3,.3),i.push.apply(i,Object(Te.a)(Fe([u*l,0+h*a,.1],[u*l,0+h*a,-2],[(u+1)*l,0+p*a,-2],[(u+1)*l,0+p*a,.1]))),s.push.apply(s,Object(Te.a)(Re(et))),c.push(0,0,0,0,0,0,0,0,0,0,0,0)}return{v:i,c:s,u:c}}({hArc:b,arcL:40,color2:a});if(Ke(C.v,r-u-40,p-b,r),m.push.apply(m,Object(Te.a)(C.v)),d.push.apply(d,Object(Te.a)(C.c)),f.push.apply(f,Object(Te.a)(C.u)),e.isTop){var _=ot({isTopElem:!0,color1:[0,0,0],color2:a,h2:p});Ke(_.vertTopElem,r,0,r),m.push.apply(m,Object(Te.a)(_.vertTopElem)),d.push.apply(d,Object(Te.a)(_.colorsTopElem)),f.push.apply(f,Object(Te.a)(_.uvTopElem))}return Ue(m,Math.PI-Math.PI/2*h),Ke(m,n,0,i),Ue(O,Math.PI-Math.PI/2*h),Ke(O,n,0,i),Ue(j,Math.PI-Math.PI/2*h),Ke(j,n,0,i),{v:m,c:d,u:f,collision:O,collisionCar:j}},it=[[30,-30],[70,-30],[70,-70],[30,-70]],st=[[30,30],[70,30],[70,-30],[30,-30]],ct=[[-70,70],[-30,70],[-30,30],[-70,30]],lt=[[-30,70],[30,70],[30,30],[-30,30]],ut=[[30,70],[70,70],[70,30],[30,30]],ht={N:[ct],W:[ct,lt,ut],S:[ct,lt,ut,st,it],E:[ct,lt,ut,st,it,[[-30,-30],[30,-30],[30,-70],[-30,-70]],[[-70,-30],[-30,-30],[-30,-70],[-70,-70]]]},pt=function(e){var t=e.xCenter,a=e.zCenter,o=e.h,r=e.dir,n=e.color2,i=void 0===n?[0,.7,0]:n,s=e.colorB,c=void 0===s?[0,0,0]:s,l=o-3,u=[],h=[],p=[],b=[],m=Be([0,.5],[.5,.5],[.5,1],[0,1]),d=Be([0,0],[0,0],[0,0],[0,0]);if(ht[r])for(var f=0;f<ht[r].length;++f){var O=ht[r][f];u.push.apply(u,Object(Te.a)(Fe([O[0][0],o,O[0][1]],[O[1][0],o,O[1][1]],[O[2][0],o,O[2][1]],[O[3][0],o,O[3][1]])).concat(Object(Te.a)(Fe([O[3][0],l,O[3][1]],[O[2][0],l,O[2][1]],[O[1][0],l,O[1][1]],[O[0][0],l,O[0][1]])),Object(Te.a)(Fe([O[0][0],l,O[0][1]],[O[1][0],l,O[1][1]],[O[1][0],o,O[1][1]],[O[0][0],o,O[0][1]])),Object(Te.a)(Fe([O[1][0],l,O[1][1]],[O[2][0],l,O[2][1]],[O[2][0],o,O[2][1]],[O[1][0],o,O[1][1]])),Object(Te.a)(Fe([O[2][0],l,O[2][1]],[O[3][0],l,O[3][1]],[O[3][0],o,O[3][1]],[O[2][0],o,O[2][1]])),Object(Te.a)(Fe([O[3][0],l,O[3][1]],[O[0][0],l,O[0][1]],[O[0][0],o,O[0][1]],[O[3][0],o,O[3][1]])))),h.push.apply(h,Object(Te.a)(Re(i)).concat(Object(Te.a)(Re(i)),Object(Te.a)(Re(c)),Object(Te.a)(Re(c)),Object(Te.a)(Re(c)),Object(Te.a)(Re(c)))),p.push.apply(p,Object(Te.a)(m).concat(Object(Te.a)(m),Object(Te.a)(d),Object(Te.a)(d),Object(Te.a)(d),Object(Te.a)(d))),b.push.apply(b,Object(Te.a)(Fe([O[0][0],o,O[0][1]],[O[1][0],o,O[1][1]],[O[2][0],o,O[2][1]],[O[3][0],o,O[3][1]])))}return Ke(u,t,0,a),Ke(b,t,0,a),{v:u,c:h,u:p,collision:b}},bt=[0,0,0],mt=[0,.7,0],dt={N:0,E:.5*-Math.PI,S:Math.PI,W:.5*Math.PI},ft=function(e){for(var t=e.centerBridgeX,a=e.centerBridgeZ,o=e.h,r=e.dir,n=e.lenBridge,i=o-3,s=Be([0,.5],[.5,.5],[.5,1],[0,1]),c=Be([0,0],[0,0],[0,0],[0,0]),l=20,u=[],h=[],p=[],b=[],m=[],d=0,f=120*Math.random()+30,O=n/2,j=n/2;f<n-20;){O=n/2-d,j=n/2-f;var v=Ze({h0:-20,h1:o-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});Ke(v.v,-20,0,j);for(var y=0;y<v.v.length;++y)u.push(v.v[y]);for(var g=0;g<v.c.length;++g)h.push(v.c[g]);for(var C=0;C<v.u.length;++C)p.push(v.u[C]);Ke(v.collision,-20,0,j);for(var _=0;_<v.collision.length;++_)b.push(v.collision[_]);Ke(v.collisionCar,-20,0,j);for(var w=0;w<v.collisionCar.length;++w)m.push(v.collisionCar[w]);var M=Ze({h0:-20,h1:o-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});Ke(M.v,20,0,j);for(var S=0;S<M.v.length;++S)u.push(M.v[S]);for(var T=0;T<M.c.length;++T)h.push(M.c[T]);for(var k=0;k<M.u.length;++k)p.push(M.u[k]);Ke(M.collision,20,0,j);for(var x=0;x<M.collision.length;++x)b.push(M.collision[x]);Ke(M.collisionCar,20,0,j);for(var P=0;P<M.collisionCar.length;++P)m.push(M.collisionCar[P]);var A=ot({isTopElem:!0,color1:bt,color2:mt,h2:o-1});Ke(A.vertTopElem,-20,0,j),u.push.apply(u,Object(Te.a)(A.vertTopElem)),h.push.apply(h,Object(Te.a)(A.colorsTopElem)),p.push.apply(p,Object(Te.a)(A.uvTopElem));var D=ot({isTopElem:!0,color1:bt,color2:mt,h2:o-1});Ke(D.vertTopElem,20,0,j),u.push.apply(u,Object(Te.a)(D.vertTopElem)),h.push.apply(h,Object(Te.a)(D.colorsTopElem)),p.push.apply(p,Object(Te.a)(D.uvTopElem)),d=f,f+=120*Math.random()+30,u.push.apply(u,Object(Te.a)(Fe([-l,o,O],[l,o,O],[l,o,j],[-l,o,j])).concat(Object(Te.a)(Fe([-l,i,j],[-l,i,O],[-l,o,O],[-l,o,j])),Object(Te.a)(Fe([l,i,O],[l,i,j],[l,o,j],[l,o,O])),Object(Te.a)(Fe([l,i,j],[l,i,O],[-l,i,O],[-l,i,j])))),h.push.apply(h,Object(Te.a)(Re(mt)).concat(Object(Te.a)(Re(bt)),Object(Te.a)(Re(bt)),Object(Te.a)(Re(mt)))),p.push.apply(p,Object(Te.a)(s).concat(Object(Te.a)(c),Object(Te.a)(c),Object(Te.a)(s))),b.push.apply(b,Object(Te.a)(Fe([-l,o,O],[l,o,O],[l,o,j],[-l,o,j])))}return u.push.apply(u,Object(Te.a)(Fe([-l,o,j],[l,o,j],[l,o,-n/2],[-l,o,-n/2])).concat(Object(Te.a)(Fe([-l,i,-n/2],[-l,i,j],[-l,o,j],[-l,o,-n/2])),Object(Te.a)(Fe([l,i,j],[l,i,-n/2],[l,o,-n/2],[l,o,j])),Object(Te.a)(Fe([l,i,-n/2],[l,i,j],[-l,i,j],[-l,i,-n/2])))),h.push.apply(h,Object(Te.a)(Re(mt)).concat(Object(Te.a)(Re(bt)),Object(Te.a)(Re(bt)),Object(Te.a)(Re(mt)))),p.push.apply(p,Object(Te.a)(s).concat(Object(Te.a)(c),Object(Te.a)(c),Object(Te.a)(s))),b.push.apply(b,Object(Te.a)(Fe([-l,o,j],[l,o,j],[l,o,-n/2],[-l,o,-n/2]))),Ke(u,-50,0,0),Ue(u,dt[r]),Ke(u,t,0,a),Ke(b,-50,0,0),Ue(b,dt[r]),Ke(b,t,0,a),Ke(m,-50,0,0),Ue(m,dt[r]),Ke(m,t,0,a),{v:u,c:h,u:p,collision:b,collisionCar:m}},Ot=function(e){for(var t=e.xCenter,a=e.zCenter,o=e.hStart,r=e.hEnd,n=e.count,i=(r-o)/n,s=50,c=[],l=0;l<n;++l){var u=4*i;l<4&&(u=o+l*i+15);var h=i*l+o,p=h-7+o,b=t,m=a,d=l%4;d<1?(b=t-s,m=a-s):d<2?(b=t+s,m=a-s):d<3?(b=t+s,m=a+s):d<4&&(b=t-s,m=a+s),c.push({type:"stairs",offset:s,h:h,hh:p,r:20,x:b,z:m,bridgeMinusH:i,bridgeL:60,hColumn:u,rColumn:3,i:l,isTop:n-l<5})}return c},jt=["N","E","S","W"],vt={N:1,E:2,S:3,W:4},yt={N:[0,-1],E:[1,0],S:[0,1],W:[-1,0]},gt=function(e){for(var t=function(){for(var e=[],t=0,a=0,o=0,r="N",n=0;n<5;++n){var i=jt[Math.floor(Math.random()*jt.length)],s=400*Math.random()+30,c=a+yt[i][0]*(140+s),l=o+yt[i][1]*(140+s),u=vt[i]+4*Math.floor(2*Math.random()),h=t+30*u,p=Ot({xCenter:a,zCenter:o,hStart:t,hEnd:h,count:u});if(e.push.apply(e,Object(Te.a)(p)),0!==n&&e.push({xCenter:a,zCenter:o,h:t-30,type:"zone",nextDir:i,dir:r}),4!==n){var b=(c-a)/2+a,m=(l-o)/2+o;e.push({centerBridgeX:b,centerBridgeZ:m,h:h-30,dir:i,lenBridge:s,type:"bridge"})}a=c,o=l,t=h,r=i}return e}(),a=[],o=[],r=[],n=[],i=[],s=0;s<t.length;++s){if("stairs"===t[s].type){var c=nt(t[s],0,[0,.7,0]),l=c.v,h=c.c,p=c.u,b=c.collision,m=c.collisionCar;a.push.apply(a,Object(Te.a)(l)),o.push.apply(o,Object(Te.a)(h)),r.push.apply(r,Object(Te.a)(p)),n.push.apply(n,Object(Te.a)(b)),m&&i.push.apply(i,Object(Te.a)(m))}if("zone"===t[s].type){var d=pt(t[s]),f=d.v,O=d.c,j=d.u,v=d.collision;a.push.apply(a,Object(Te.a)(f)),o.push.apply(o,Object(Te.a)(O)),r.push.apply(r,Object(Te.a)(j)),n.push.apply(n,Object(Te.a)(v))}if("bridge"===t[s].type){for(var y=ft(t[s]),g=y.v,C=y.c,_=y.u,w=y.collision,M=y.collisionCar,S=0;S<g.length;++S)a.push(g[S]);for(var T=0;T<C.length;++T)o.push(C[T]);for(var k=0;k<_.length;++k)r.push(_[k]);for(var x=0;x<w.length;++x)n.push(w[x]);if(M)for(var P=0;P<M.length;++P)i.push(M[P])}}n.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var A=new Float32Array(a),D=new Float32Array(o),L=new Float32Array(r),E=new Float32Array(n),I=new u.BufferGeometry;I.setAttribute("position",new u.BufferAttribute(A,3)),I.setAttribute("color",new u.BufferAttribute(D,3)),L&&I.setAttribute("uv",new u.BufferAttribute(L,2)),I.computeVertexNormals();var N=e.materials.wallVirtualColor,F=new u.Mesh(I,N),B=new u.BufferGeometry;B.setAttribute("position",new u.BufferAttribute(E,3));var R=new u.MeshBasicMaterial({color:16711680}),G=new u.Mesh(B,R),z=new Float32Array(i),W=new u.BufferGeometry;W.setAttribute("position",new u.BufferAttribute(z,3));for(var U,K=new u.Mesh(W,R),V=t.length-1;V>-1;--V)if(t[V].type&&"stairs"===t[V].type){U=[t[V].x,t[V].h,t[V].z];break}var q=new u.Mesh(new u.BoxGeometry(15,15,15),new u.MeshBasicMaterial({color:16711935}));return q.position.set(U[0],U[1],U[2]),{mesh:F,meshCollision:G,meshCollisionCar:K,meshFinish:q,lastXYZ:U}},Ct=[0,0,0],_t=[0,.7,0],wt=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,r=void 0===o?30:o,n=e.h2,i=void 0===n?60:n,s=e.arc,c=void 0!==s&&s,l=e.isTopElem,u=void 0!==l&&l,h=e.isColumn,p=void 0!==h&&h,b=[],m=[],d=[],f=[],O=[];if(c){var j=function(e){for(var t=e.h1,a=e.h2,o=e.color1,r=void 0===o?[.2,.1,.1]:o,n=e.color2,i=void 0===n?[1,1,1]:n,s=e.r,c=void 0===s?5:s,l=e.rCap,u=void 0===l?7:l,h=e.wCol,p=void 0===h?3:h,b=e.w,m=(void 0===b?40:b)-2*c,d=-c-m,f=t,O=a-Math.min(.1*(a-t),2),j=Object(Te.a)(Fe([-p,f,c],[p,f,c],[p,O,c],[-p,O,c])),v=Object(Te.a)(Re(i)),y=Object(Te.a)(Re(r)),g=Be([0,.5],[.5,.5],[.5,1],[0,1]),C=[].concat(Object(Te.a)(Fe([-p,f,-c],[-p,f,c],[-p,O,c],[-p,O,-c])),Object(Te.a)(Fe([p,f,c],[p,f,-c],[p,O,-c],[p,O,c]))),_=Object(Te.a)(Fe([p,f,-c],[-p,f,-c],[-p,O,-c],[p,O,-c])),w=[],M=[],S=[],T=2-p,k=p-2,x=14,P=m/x,A=O-f,D=.15*A,L=0;L<x;++L){var E=(1-Math.sin((L+1)/x*Math.PI))*(A-D)+D,I=(1-Math.sin(L/x*Math.PI))*(A-D)+D,N=-c;L+1>7&&(N=-c-m),w.push(T,O-E,-c-(L+1)*P,T,O-I,-c-L*P,T,O,N),M.push.apply(M,Object(Te.a)(i).concat(Object(Te.a)(i),Object(Te.a)(i))),S.push(0,0,.3,0,.3,.3),w.push(k,O-I,-c-L*P,k,O-E,-c-(L+1)*P,k,O,N),M.push.apply(M,Object(Te.a)(i).concat(Object(Te.a)(i),Object(Te.a)(i))),S.push(0,0,.3,0,.3,.3),w.push.apply(w,Object(Te.a)(Fe([k,O-I,-c-L*P],[T,O-I,-c-L*P],[T,O-E,-c-(L+1)*P],[k,O-E,-c-(L+1)*P]))),M.push.apply(M,Object(Te.a)(y)),S.push.apply(S,Object(Te.a)(Be([0,0],[0,0],[0,0],[0,0])))}w.push(T,O-D,-c-P*x/2,T,O,-c,T,O,-c-P*x),M.push.apply(M,Object(Te.a)(i).concat(Object(Te.a)(i),Object(Te.a)(i))),S.push(.5,.25,.25,.3,.25,.2),w.push(k,O-D,-c-P*x/2,k,O,-c-P*x,k,O,-c),M.push.apply(M,Object(Te.a)(i).concat(Object(Te.a)(i),Object(Te.a)(i))),S.push(.5,.25,.25,.3,.25,.2),f=O,O=a;var F=[].concat(Object(Te.a)(Fe([-u,f,-u],[u,f,-u],[u,f,u],[-u,f,u])),Object(Te.a)(Fe([-u,f,u],[u,f,u],[u,O,u],[-u,O,u])),Object(Te.a)(Fe([-u,f,-u],[-u,f,u],[-u,O,u],[-u,O,-u])),Object(Te.a)(Fe([u,f,u],[u,f,-u],[u,O,-u],[u,O,u])),Object(Te.a)(Fe([u,f,-u],[-u,f,-u],[-u,O,-u],[u,O,-u])),Object(Te.a)(Fe([-u,O,u],[u,O,u],[u,O,-u],[-u,O,-u])),Object(Te.a)(Fe([2-u,f,d],[u-2,f,d],[u-2,f,-u],[2-u,f,-u])),Object(Te.a)(Fe([2-u,f,d],[2-u,f,-u],[2-u,O,-u],[2-u,O,d])),Object(Te.a)(Fe([u-2,f,-u],[u-2,f,d],[u-2,O,d],[u-2,O,-u])),Object(Te.a)(Fe([2-u,O,-u],[u-2,O,-u],[u-2,O,d],[2-u,O,d])));return{v:[].concat(Object(Te.a)(j),Object(Te.a)(C),Object(Te.a)(_),w,Object(Te.a)(F)),c:[].concat(Object(Te.a)(v),Object(Te.a)(v),Object(Te.a)(v),Object(Te.a)(v),M,Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y),Object(Te.a)(y)),u:[].concat(Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),S,Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g),Object(Te.a)(g))}}(Object(L.a)({h1:r,h2:i,color1:Ct,color2:_t},c));b.push.apply(b,Object(Te.a)(j.v)),m.push.apply(m,Object(Te.a)(j.c)),d.push.apply(d,Object(Te.a)(j.u))}var v=Ze({h0:a,h1:r,color1:Ct,color2:_t,rCapital:6,rBase:5,capTop:!0,capBottom:!0});b.push.apply(b,Object(Te.a)(v.v)),m.push.apply(m,Object(Te.a)(v.c)),d.push.apply(d,Object(Te.a)(v.u)),f.push.apply(f,Object(Te.a)(v.collision)),v.collisionCar&&O.push.apply(O,Object(Te.a)(v.collisionCar));var y=ot({h2:i,color1:Ct,color2:_t,isTopElem:u}),g=y.vertTopElem,C=y.colorsTopElem,_=y.uvTopElem;b.push.apply(b,Object(Te.a)(g)),m.push.apply(m,Object(Te.a)(C)),d.push.apply(d,Object(Te.a)(_));var w=Xe({isColumn:p,h1:r,h2:i,color1:Ct,color2:_t}),M=w.vertColumn,S=w.colorsColumn,T=w.uvColumn;return b.push.apply(b,Object(Te.a)(M)),m.push.apply(m,Object(Te.a)(S)),d.push.apply(d,Object(Te.a)(T)),{v:b,c:m,u:d,collision:f,collisionCar:O}},Mt=function(e){for(var t=[],a=[],o=[],r=[],n=[],i=function(){var e=[],t=function t(a){var o=a.angle,r=a.offsetStart,n=a.h0,i=a.h1,s=a.h2,c=a.numFromCenter,l=120*Math.random()+30,u=Math.random()>.5;e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(o)*(r+l),z:Math.cos(o)*(r+l),angle:o,h0:n,h1:i,h2:s,arc:{w:l},isTopElem:!u,numFromCenter:c}),u&&t({angle:o,offsetStart:r+l,h0:n,h1:i,h2:s,numFromCenter:++c})},a=Math.floor(20*Math.random())+3,o=150*Math.random()+30,r=(.4*Math.random()+.5)*o;e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h0:0,h1:r,h2:o,numFromCenter:0,isTopElem:!1,isColumn:!0});for(var n=0;n<a;++n)Math.random()>.3&&t({angle:n/a*(2*Math.PI),offsetStart:0,h0:0,h1:r,h2:o,numFromCenter:1});for(var i=e.length,s=0;s<3;++s)for(var c=e[e.length-1].h2,l=c+150*Math.random()+30,u=c+(.4*Math.random()+.5)*(l-c),h=0;h<i;++h)e[h].isTopElem||e.push(Object(L.a)(Object(L.a)({},e[h]),{},{h0:c,h1:u,h2:l,isTopElem:2===s}));return e}(),s=0;s<i.length;++s){var c=i[s],l=(c.id,c.x),h=c.z,p=c.angle,b=c.h0,m=c.h1,d=c.h2,f=c.arc,O=c.isTopElem,j=c.isColumn,v=wt({h0:b,h1:m,h2:d,arc:f,isTopElem:O,isColumn:j}),y=v.v,g=v.c,C=v.u,_=v.collision,w=v.collisionCar;Ue(y,p),Ke(y,l,0,h,p),_&&(Ue(_,p),Ke(_,l,0,h),r.push.apply(r,Object(Te.a)(_))),w&&(Ue(w,p),Ke(w,l,0,h),n.push.apply(n,Object(Te.a)(w))),t.push.apply(t,Object(Te.a)(y)),a.push.apply(a,Object(Te.a)(g)),o.push.apply(o,Object(Te.a)(C))}var M=new Float32Array(t),S=new Float32Array(a),T=new Float32Array(o),k=new u.BufferGeometry;k.setAttribute("position",new u.BufferAttribute(M,3)),k.setAttribute("color",new u.BufferAttribute(S,3)),T&&k.setAttribute("uv",new u.BufferAttribute(T,2)),k.computeVertexNormals();var x=e.materials.wallVirtualColor,P=new u.Mesh(k,x),A=new Float32Array(r),D=new u.BufferGeometry;D.setAttribute("position",new u.BufferAttribute(A,3));var E=new u.Mesh(D,e.materials.testRed),I=new Float32Array(n),N=new u.BufferGeometry;return N.setAttribute("position",new u.BufferAttribute(I,3)),{mesh:P,meshCollision:E,meshCollisionCar:new u.Mesh(N,e.materials.testRed)}},St=function(e){var t=e.studio,a=e.car,o=e.system_PlayerMoveOnLevel,r=e.materials,n=[],i=new u.PlaneGeometry(h,h);r.floorMat.map.wrapS=r.floorMat.map.wrapT=80,r.floorMat.map.repeat.set(50,50);var s=function(s){for(var c=0;c<s.length;++c){var l=s[c].split("_"),p=+l[0]*h,b=+l[1]*h,m=new u.Mesh(i,r.floorMat);m.rotation.x=-Math.PI/2,m.position.set(p,-62,b),t.addToScene(m),n.push({mesh:m,keyLocation:s[c],type:"floor"}),o.addItemToPlayerCollision(m);for(var d=Math.floor(3*Math.random()),f=0;f<d;++f){console.log("!!!!!!!!!!!!!!!!! new tresh");var O=Mt(e),j=O.mesh,v=O.meshCollision,y=O.meshCollisionCar;j.position.set(p+Math.random()*h,-60,b+Math.random()*h),t.addToScene(j),v.visible=!1,v.position.copy(j.position),t.addToScene(v),o.addItemToPlayerCollision(v),y.visible=!1,y.position.copy(j.position),t.addToScene(y),a.setCollisionForDraw(y),n.push({mesh:j,meshCollision:v,meshCollisionCar:y,keyLocation:s[c],type:"trash"})}}};return{updateTrash:function(e,r){!function(e){for(var r=[],i=0;i<e.length;++i)for(var s=0;s<n.length;++s)e[i]===n[s].keyLocation&&r.push(n[s]);n=n.filter((function(t){for(var a=0;a<e.length;++a)if(t.keyLocation===e[a])return!1;return!0}));for(var c=0;c<r.length;++c){var l=r[c],u=l.mesh,h=l.meshCollision,p=l.meshCollisionCar;t.removeFromScene(u),r[c].mesh.geometry.dispose(),delete r[c].mesh,h&&(o.removeItemFromPlayerCollision(h),t.removeFromScene(h),r[c].meshCollision.geometry.dispose(),delete r[c].meshCollision),p&&(a.removeCollisionForDraw(p),t.removeFromScene(p),r[c].meshCollisionCar.geometry.dispose(),delete r[c].meshCollisionCar)}}(e),s(r)},createTresh:function(e){s(e)}}},Tt=function(e){for(var t=[],a=0;a<20;++a)for(var o=3e3*Math.random()-1500,r=400*Math.random()-50,n=3e3*Math.random()-1500,i=0;i<3;++i)t.push(o+3*Math.random(),r+3*Math.random(),n+3*Math.random());var s=new Float32Array(t),c=new u.BufferGeometry;return c.setAttribute("position",new u.BufferAttribute(s,3)),new u.Mesh(c,e.materials.testGreen)},kt=function(){function e(t){var a=this;Object(y.a)(this,e),this._root=t;var o=this._root,r=o.emitter,n=o.car,i=o.dispatcher,s=o.frameUpdater,c=o.studio,l=(o.player,o.system_PlayerMoveOnLevel);i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),i.dispatch({type:"ENABLE_CONTROL_SOUND"}),n.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),r.subscribe("checkNear")((function(e){console.log("checkNear",e),"nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),"nearPerson"===e.item&&console.log("checkNear nearPerson !!!!!!",e)}));var b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Math.floor(t/e),r=Math.floor(a/e),n=o+"_"+r,i=Me(o,r);return{checkChanged:function(t,a){var o=Math.floor(t/e),r=Math.floor(a/e),s=o+"_"+r;if(s===n)return!1;var c=n;n=s;var l=i;i=Me(o,r);var u=Se(i,l),h=Se(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:n,currentEnv:i}}}}(h,n._model.position.x,n._model.position.z),m=b.getCurrent();this._changerLocations=function(e){var t=e.studio,a=e.car,o=(e.system_Level,e.system_PlayerMoveOnLevel),r=e.system_PlayerNearLevelItems,n=function(){var t=gt(e);return t.meshCollision.visible=!1,t.meshCollisionCar.visible=!1,t.meshFinish.position.copy(t.mesh.position),t},i={location01:n(),location02:n(),location03:n()};return{removeLocationFromScene:function(e){var n=i[e],s=n.mesh,c=n.meshCollision,l=n.meshCollisionCar,u=n.meshFinish;t.removeFromScene(s),o.removeItemFromPlayerCollision(c),t.removeFromScene(c),t.removeFromScene(l),a.removeCollisionForDraw(l),t.removeFromScene(u),r.removeItemFromCheck(u)},addLocationToScene:function(e,n,s){var c=i[e],l=c.mesh,u=c.meshCollision,h=c.meshCollisionCar,p=c.meshFinish,b=c.lastXYZ,m=-42;l.position.set(n,m,s),t.addToScene(l),o.addItemToPlayerCollision(u),u.visible=!1,u.position.set(n,m,s),t.addToScene(u),a.setCollisionForDraw(h),h.visible=!1,h.position.set(n,m,s),t.addToScene(h),p.position.set(n,m,s),p.position.x+=b[0],p.position.y+=b[1],p.position.z+=b[2],t.addToScene(p),r.setItemToCheck(p,"nearPerson_"+e,28)}}}(this._root),this._changerLevelTresh=St(this._root),this._systemSprites=function(e){var t=e.car.getModel(),a=new u.Object3D;a.position.set(0,0,-3e3),t.add(a);for(var o=new u.Vector3,r=[],n=0;n<50;++n){var i=Tt(e);i.position.set(3e3*Math.random()-1500,0,3e3*Math.random()-1500),r.push(i),e.studio.addToScene(i)}return{update:function(){a.getWorldPosition(o);for(var e=0;e<r.length;++e)r[e].position.distanceTo(o)>4e3&&r[e].position.copy(o)}}}(this._root),this._changerLevelTresh.createTresh(m.currentEnv),s.on((function(e){if(l.update(e),!n.isFreeze){n.update(e),a._systemSprites.update();var t=b.checkChanged(n._model.position.x,n._model.position.z);if(t&&(console.log("quadrants data",t),a._changerLevelTresh.updateTrash(t.removedQs,t.addedQs),p[t.oldKey]&&a._changerLocations.removeLocationFromScene(p[t.oldKey]),p[t.newKey])){var o=t.newKey.split("_"),r=+o[0]*h+h/2,i=+o[1]*h+h/2;a._changerLocations.addLocationToScene(p[t.newKey],r,i)}}c.drawFrame()})),this._startPlay()}return Object(g.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,a=e.system_PlayerMoveOnLevel,o=e.car;a.toggleFreeze(!0),o.toggleFreeze(!1),t.setCamera(o.getCamera())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,a=e.player,o=e.studio,r=e.car,n=r.getPosition(),i=r.getQuaternion();o.setCamera(a.getCamera()),r.toggleFreeze(!0),t.toggleFreeze(!1),a.setToPos(n.x,a.mesh.position.y,n.z),a.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key,a=null;for(var o in p)p[o]===t&&(a=o);if(a){var r=a.split("_"),n=+r[0]*h+h/2,i=+r[1]*h+h/2;this._root.car.setTargetPosition(new u.Vector3(n,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,a=e.ui,o=e.studio,r=e.car,n=e.system_Level,i=e.system_PlayerMoveOnLevel;e.system_PlayerNearLevelItems.setItemToCheck(r.getModel(),"nearStarterDrawCar",28),o.addToScene(r.getModel()),i.addItemToPlayerCollision(r.getCollision()),setTimeout((function(){var e=0,t=null;for(var a in p)0===e&&(t=a),++e;var o=t.split("_"),n=+o[0]*h+h/2,i=+o[1]*h+h/2;r.setTargetPosition(new u.Vector3(n,0,i))}),500),n._items.body.position.fromArray([-20,-60,-50]),n._items.body.rotation.fromArray([0,2,0]),o.addToScene(n._items.body),a.showStartButton((function(){t.toggleBlocked(!1)}))}}]),e}(),xt=(a(43),{ru:{"What is this place?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","It's The Great Way to the surface.":"\u042d\u0442\u043e \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0435\u0440\u0445.","Who are you?":"\u041a\u0442\u043e \u0442\u044b?","I help The Creator.":"\u042f \u043f\u043e\u043c\u043e\u0433\u0430\u044e \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044e.","What are you doing?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Don't distract me, I have to dig the tunnel.":"\u041d\u0435 \u043e\u0442\u0432\u043b\u0435\u043a\u0430\u0439, \u043c\u043d\u0435 \u043d\u0430\u0434\u043e \u043a\u043e\u043f\u0430\u0442\u044c \u0442\u0443\u043d\u043d\u0435\u043b\u044c.","Such enormous dungeons...":"\u0422\u0430\u043a\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u043e\u0434\u0437\u0435\u043c\u0435\u043b\u044c\u044f...","The Creator gave the order to dig.":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0438\u043a\u0430\u0437\u0430\u043b \u043a\u043e\u043f\u0430\u0442\u044c. ","How long have you been digging?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0432\u044b \u043a\u043e\u043f\u0430\u043b\u0438? ","Time does not matter, the goal is what's important.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0430\u0436\u043d\u0430 \u0446\u0435\u043b\u044c. ","What do you do here?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Long ago, the Creator fell under the ground. He created us and gave us an assignment to dig.":"\u0414\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0422\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b\u0441\u044f \u043f\u043e\u0434 \u0437\u0435\u043c\u043b\u044e. \u041e\u043d \u0441\u043e\u0437\u0434\u0430\u043b \u043d\u0430\u0441 \u0438 \u0434\u0430\u043b \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043f\u0430\u0442\u044c. ","But you already dug the way out...":"\u041d\u043e \u0432\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u0432\u044b\u0445\u043e\u0434 ...","When we dug a tunnel, The Creator went through it.":"\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u043f\u0443\u0442\u044c, \u0442\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0448\u0435\u043b \u043f\u043e \u043d\u0435\u043c\u0443.","And...":"\u0418...","We are made to dig. And we keep on doing it. We believe that he will return to us.":"\u041c\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u043f\u0430\u0442\u044c. \u0418 \u043c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c. \u041c\u044b \u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043e\u043d \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043a \u043d\u0430\u043c. ","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),Pt=I(xt),At=Object(A.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(N.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(N.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:Pt(t.q)},Math.floor(1e5*Math.random()))}))})})),Dt=I(xt),Lt=Object(A.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(N.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(N.jsxs)("div",{children:[Object(N.jsx)("div",{className:"q",children:Dt(e.q)}),Object(N.jsx)("div",{className:"a",children:Dt(e.a)})]},Math.floor(1e5*Math.random()))}))})})),Et=I(xt);var It=Object(A.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocation:e.ui.currentLocation,locationsList:e.ui.locationsList}}))((function(e){return Object(N.jsxs)(N.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(N.jsx)("div",{className:"dialog-wrapper",children:Object(N.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(N.jsxs)("div",{className:"messages-wrapper",children:[Object(N.jsx)(Lt,{}),Object(N.jsx)(At,{})]}),e.isButtonDialog&&Object(N.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?Et("close dialog"):Et("open dialog")})]})}),e.isShowButtonDrawCar&&Object(N.jsx)("div",{className:"dialog-wrapper",children:Object(N.jsx)("div",{className:"dialog-content",children:Object(N.jsx)("button",{className:"draw-car-button",onClick:function(){return e.dispatch({type:"CLICK_DRAW"})},children:Et(e.valButtonDrawCar)})})}),e.isShowButtonToggleOpenLocationsList&&!e.isLocationListOpened&&Object(N.jsx)("button",{className:"open-locations-car-button",onClick:function(){return e.dispatch({type:"OPEN_LOCATIONS_LIST"})},children:e.currentLocation}),e.isLocationListOpened&&Object(N.jsx)("div",{className:"list-locations",children:Object(N.jsx)("div",{children:e.locationsList.map((function(t){return Object(N.jsxs)("button",{onClick:function(){return e.dispatch({type:"SELECT_LOCATION",location:t})},children:[t,e.currentLocation===t&&"___v"]},Math.floor(1e6*Math.random()))}))})}),e.isShowFinalMessage&&Object(N.jsx)("div",{className:"final-mess",children:Et("To be continued")})]})})),Nt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"draw car",currentBot:null,phraseIndex:0,isDialogComplete:!1,isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocation:"location01",locationsList:["location01","location02","location03"]},Ft=[{key:"emitter",constr:S,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(y.a)(this,e);var a=t.emitter,o=t.appWrapper;!o&&(o=document.querySelector(".app-wrapper")),a.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&r()}));var r=function(){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()},n=function(e){o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||a.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",n),n()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:M,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:X,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(y.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return Y.a()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:re,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:ne,initStateKey:"beforeStartPlay"},{key:"player",constr:ie,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:we,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(y.a)(this,e);var a=t.assets,o=t.CONSTANTS;t.materials=se(a,o.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"system_Level",constr:function e(t){Object(y.a)(this,e),this._root=t;var a=t.assets,o=t.materials,r=ce(a,o).items;this._items=r,console.log("system_level_items",this._items),r.body.material=o.car},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:le,key:"level-rooms"},{type:"cubeTextures",path:[me,me,me,me,me,me],key:"skyBox"},{type:"cubeTextures",path:[de,fe,Oe,je,ve,ye],key:"skyBox2"},{type:"img",path:ue,key:"mapFloorOuter",wrap:!0},{type:"img",path:pe,key:"mapTop",wrap:!0},{type:"img",path:he,key:"mapVirtual2",wrap:!0},{type:"img",path:be,key:"mapParams"}]},{key:"car",constr:Ce,initStateKey:"beforeStartPlay"},{key:"system_PlayerMoveOnLevel",constr:_e,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(y.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=It,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nt,a=arguments.length>1?arguments[1]:void 0;if("OPEN_LOCATIONS_LIST"===a.type)return Object(L.a)(Object(L.a)({},t),{},{isLocationListOpened:!0});if("SELECT_LOCATION"===a.type)return e.actions.changeTargetLocation({key:a.location}),Object(L.a)(Object(L.a)({},t),{},{isLocationListOpened:!1,currentLocation:a.location});if("CLICK_PHRASE"===a.type)return Object(L.a)(Object(L.a)({},t),{},{botAnswers:[].concat(Object(Te.a)(t.botAnswers),[a.phrase]),userReplicies:[]});if("PHRASE_EVENT"===a.type){var o=a.phrase,r=o.event;if(o.levelEvent,"nextReply"===r){var n=[t.phrasesData[t.currentBot][t.phraseIndex+1]];return Object(L.a)(Object(L.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:n})}if("close"===r)return 20===t.currentBot&&setTimeout((function(){e.dispatcher.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),e.dispatcher.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!1}),e.player.toggleBlocked(!0),setTimeout((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),Object(L.a)(Object(L.a)({},t),{},{userReplicies:[],isDialogComplete:!0,isButtonDialog:!0})}if("TOGGLE_DIALOG"===a.type){var i=[];return e.player.toggleBlocked(a.isShowPalleteDialog),a.isShowPalleteDialog&&(i=t.isDialogComplete?[]:[t.phrasesData[t.currentBot][t.phraseIndex]]),Object(L.a)(Object(L.a)({},t),{},{isShowPalleteDialog:a.isShowPalleteDialog,userReplicies:i})}if("TOGGLE_BUTTON"===a.type){var s=t.botAnswers,c=t.phraseIndex,l=t.isDialogComplete;return a.currentBot&&a.currentBot!==t.currentBot&&(s=[],c=0,l=!1),Object(L.a)(Object(L.a)({},t),{},{phraseIndex:c,currentBot:a.currentBot||t.currentBot,isButtonDialog:a.isButtonDialog,isDialogComplete:l,botAnswers:s})}return"SHOW_FINAL_MESSAGE"===a.type?Object(L.a)(Object(L.a)({},t),{},{isShowFinalMessage:!0}):"TOGGLE_BUTTON_DRAW_CAR"===a.type?Object(L.a)(Object(L.a)({},t),{},{isShowButtonDrawCar:a.is}):"CLICK_DRAW"===a.type?"draw car"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(L.a)(Object(L.a)({},t),{},{valButtonDrawCar:"exit car"})):(e.actions.clickMachineExit(),Object(L.a)(Object(L.a)({},t),{},{valButtonDrawCar:"draw car"})):t}}}(t);var a=new Q(t);t.ui=a},initStateKey:"pageLoaded"},{key:"actions",constr:kt,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(Ft,o)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.9b270b17.chunk.js.map