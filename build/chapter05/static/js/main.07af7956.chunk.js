(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{40:function(e,t,o){},42:function(e,t,o){},44:function(e,t,o){},45:function(e,t,o){"use strict";o.r(t);var a={};o.r(a),o.d(a,"SIZE_QUADRANT",(function(){return h})),o.d(a,"LOCATIONS_QUADRANTS",(function(){return p})),o.d(a,"CONFIG_FOR_INIT",(function(){return m})),o.d(a,"lCol",(function(){return d})),o.d(a,"lW",(function(){return b})),o.d(a,"MATERIALS_CONFIG",(function(){return f})),o.d(a,"START_ENV_CONFIG",(function(){return v})),o.d(a,"studioConfig",(function(){return O})),o.d(a,"playerConfig",(function(){return j}));var n=o(11),r=o.n(n),i=o(12);function s(){return(s=Object(i.a)(r.a.mark((function e(t,o){var a,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,a={CONSTANTS:o}),n=a.loaderAssets,i=l(t),e.next=6,n.loadAssets(i);case 6:a.assets=e.sent,c("beforeStartPlay",t,a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,o){for(var a=0;a<t.length;++a){var n=t[a],r=n.key,i=n.constr;n.initStateKey===e&&(o[r]=new i(o))}},l=function(e){for(var t=[],o=0;o<e.length;++o)if(e[o].assetsToLoad&&e[o].assetsToLoad.length)for(var a=0;a<e[o].assetsToLoad.length;++a)t.push(e[o].assetsToLoad[a]);return t},u=o(7),h=2e3,p={"0_0":"location01","0_-3":"location02","3_-1":"location03"},m={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},d=[.3,1,.3],b=.2,f={wallVirtual:{mat:"MeshStandardMaterial",props:{color:1118481,emissive:0}},wallVirtualColor:{mat:"MeshBasicMaterial",props:{color:16777215,emissive:4369,map:"mapParams",bumpMap:"mapParams",bumpScale:.1,specular:255,vertexColors:!0}},car:{mat:"MeshPhongMaterial",props:{color:4473924,emissive:0,reflectivity:.5,shininess:.5,specular:16777215}}},v={fogNear:500,fogFar:1500,color:21760},O=Object(u.a)({canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},sceneEnvironment:v,composerAddPass:"Saturate"},"composerAddPass","Saturate2"),j={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startRot:[0,0,0],startPos:[0,5,0],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},y=o(2),g=o(3),_=o(0),w=o(22),C=o(23),S=function(){var e=null,t=null,o=null,a=null,n=null;return function(r,i){return new Promise((function(s){(function(r){return"obj"===r?e=e||new w.a:"glb"===r||"gltf"===r?o=o||new C.a:"img"===r?t=t||new _.TextureLoader:"cubeTextures"===r?a=a||new _.CubeTextureLoader:"soundMp3"===r?n=n||new _.AudioLoader:void 0})(i).load(r,s)}))}},M=function(){function e(){Object(y.a)(this,e),this.resources={},this._load=S()}return Object(g.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(o){var a=t._load,n=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(r.a.mark((function t(i){var c,l,u,h;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,a(u,h);case 4:n[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}o(n),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),T=function(){function e(){Object(y.a)(this,e),this._storage={}}return Object(g.a)(e,[{key:"emit",value:function(e){var t=this;return function(o){return k(t._storage)(e).forEach((function(e){return e(o)}))}}},{key:"subscribe",value:function(e){var t=this;return function(o){return k(t._storage)(e).push(o),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==o}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),k=function(e){return function(t){return e[t]=e[t]||[]}},x=o(5),P=o(17),D=o.n(P),L=o(8),A=o(10),I=o(6),N=(o(40),"en"),E=function(e){return function(t){return e[N]&&e[N][t]||t}},F=o(4),B=E({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),R=Object(L.b)((function(e){return Object(I.a)({},e.controls.infoPanelData)}))((function(e){return Object(F.jsxs)("div",{className:"info",children:[Object(F.jsx)("button",{className:"control butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"x"}),Object(F.jsxs)("div",{className:"info-inner",children:[Object(F.jsx)("p",{children:B(e.title)}),Object(F.jsx)("p",{children:B(e.topText)}),Object(F.jsx)("ul",{children:e.chapters.map((function(t,o){return Object(F.jsxs)("li",{children:[o+1,".\xa0",t.href?Object(F.jsx)("span",{children:Object(F.jsx)("a",{href:t.href,target:"blank",children:B(t.text)})}):Object(F.jsx)("span",{children:B(t.text)}),o===e.currentChapterIndex&&B(" (current)")]},o)}))}),Object(F.jsx)("p",{children:e.bottomText}),Object(F.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(F.jsxs)("li",{children:[B(e.text),Object(F.jsx)("a",{href:e.href,target:"blank",children:B(e.aText)})]},t)}))})]})]})})),G=(o(42),Object(L.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(x.useState)(!0),o=Object(A.a)(t,2),a=o[0],n=o[1];return Object(x.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&n(!0)}))})),Object(F.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(F.jsx)("button",{className:"butt-sound control",onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},children:e.isMute?Object(F.jsx)(F.Fragment,{children:"\u27fc"}):Object(F.jsx)(F.Fragment,{children:"\u27ff"})}),e.isShowControls&&Object(F.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},children:"\u25c4"}),e.isShowControls&&Object(F.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},children:"\u25ba"}),e.isShowControls&&Object(F.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},children:"\u25b2"}),e.isShowControls&&Object(F.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},children:"\u25bc"}),e.isShowControls&&a&&Object(F.jsx)("button",{className:"butt-fullscreen control",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),n(!1)},children:"\u2752"}),!e.isInfo&&Object(F.jsx)("button",{className:"butt-info control",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})},children:"i"}),e.isInfo&&Object(F.jsx)(R,{})]})})));var z={dispatch:null},U=Object(L.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!z.dispatch&&(z.dispatch=e.dispatch),Object(F.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(F.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(F.jsx)(G,{gameContext:e.gameContext})]})})),W=o(15),K=o(25),V={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var q=document.querySelector(".progress"),H=-100,Q=!0;!function e(){Q&&setTimeout((function(){0===++H&&(H-=100),q.style.marginLeft=H+"%",e()}),30)}();var Z=function(){function e(t){Object(y.a)(this,e),t.dispatcher=z,this._root=t;var o=function(e){e.customStore||(e.customStore={});var t=Object(W.b)(Object(I.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(I.a)(Object(I.a)({},e),{},{infoPanelData:Object(I.a)(Object(I.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(I.a)(Object(I.a)({},e),{},{isMute:t.is}):Object(I.a)({},e)}},e.customStore)),o=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||W.c;return Object(W.d)(t,o(Object(W.a)(K.a)))}(t);o&&D.a.render(Object(F.jsx)(L.a,{store:o,children:Object(F.jsx)(U,{gameContext:t})}),document.getElementById("root"))}return Object(g.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),o=document.querySelector(".progress-wrapper"),a=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,N=t),document.querySelector(".start-screen").style.display="none"};Q=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),a(t)})),o.style.display="none"}}]),e}(),Y=o(47),J=function(){function e(){var t=this;Object(y.a)(this,e),this._subscribers=[];var o={time:0,delta:0,count:0,oldTime:0},a=Y.a((function(){return o}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var o=0;o<t._subscribers.length;++o)t._subscribers[o](Object(I.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return o=e}));!function e(){requestAnimationFrame(e),a(o)}()}return Object(g.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),X=o(20),$=o(28),ee=o(27),te=o(14),oe={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},ae={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},ne=o(26),re=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var a=t.assets,n=t.emitter,r=t.CONSTANTS.studioConfig,i=r.canId,s=r.rendererCon,c=(r.clearColor,r.amb);s.canvas=document.getElementById(i),this._renderer=new _.WebGLRenderer(s),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new _.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,u=l.color,h=l.fogNear,p=l.fogFar,m=l.backgroundImgKey;this._scene.background=a[m]||null,this._scene.fog=new _.Fog(u,h,p);c.color,c.strength;this._lightA=new _.AmbientLight(16777215,.2),this._scene.add(this._lightA);var d=new _.DirectionalLight(16777215,.6);d.position.set(1,1,.5),this._scene.add(d);var b=new _.DirectionalLight(16777215,.4);b.position.set(-1,-.1,-.4),this._scene.add(b),this._playerCamera=new _.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new _.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var f=new ne.a(this._controlsCamera,this._renderer.domElement);f.target.set(0,0,0),f.update(),this._composer=new $.a(this._renderer),this._renderPass=new ee.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new te.a(oe)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new te.a(ae)));var v=new _.Vector3,O=!0;n.subscribe("keyEvent")((function(e){e.o&&(O?(O=!1,o._renderPass.camera=o._controlsCamera,o._playerCamera.getWorldPosition(v),o._controlsCamera.position.x=v.x+100,o._controlsCamera.position.y=v.y+100,o._controlsCamera.position.z=v.z,f.target.set(v.x,v.y,v.z),f.update()):(O=!0,o._renderPass.camera=o._playerCamera))}));var j=function(){var e={width:window.innerWidth,height:window.innerHeight};o._renderer.setSize(e.width,e.height),o._composer.setSize(e.width,e.height),o._controlsCamera&&(o._controlsCamera.aspect=e.width/e.height,o._controlsCamera.updateProjectionMatrix()),o._playerCamera&&(o._playerCamera.aspect=e.width/e.height,o._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",j),j(),this.addToScene=function(e){return o._scene.add(e)},this.removeFromScene=function(e){return o._scene.remove(e)},this.drawFrame=function(){o._composer.render(o._scene,o._controlsCamera)},n.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(g.a)(e,[{key:"setCamera",value:function(e){this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),ie=function(){function e(t){Object(y.a)(this,e);var o=t.emitter,a={up:!1,down:!1,left:!1,right:!1,p:!1},n={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=n,this.keys=a;var r=function(e,t){switch(e){case 38:case 87:n.up&&(a.up=t);break;case 40:case 83:n.down&&(a.down=t);break;case 37:case 65:a.left=t;break;case 39:case 68:a.right=t;break;case 79:a.o=t;break;case 80:a.p=t}o.emit("keyEvent")(a)};document.addEventListener("keydown",(function(e){return r(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return r(e.keyCode,!1)})),o.subscribe("mouseDown")((function(e){"butt-left"===e&&r(37,!0),"butt-right"===e&&r(39,!0),"butt-front"===e&&r(38,!0),"butt-back"===e&&r(40,!0)})),o.subscribe("mouseUp")((function(e){"butt-left"===e&&r(37,!1),"butt-right"===e&&r(39,!1),"butt-front"===e&&r(38,!1),"butt-back"===e&&r(40,!1)}))}return Object(g.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),se=function(){function e(t){Object(y.a)(this,e);var o=t.studio,a=t.CONSTANTS.playerConfig,n=(a.startPos,a.startRot,a.cameraData),r=(a.frontObjPos,a.backObjPos,a.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new _.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new _.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new _.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new _.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=n.fov,s=n.ratio,c=n.near,l=n.far;n.pos;if(this._camera=new _.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),r){var u=r.color,h=r.strenth,p=r.pos,m=new _.PointLight(u,h);m.position.fromArray(p),this.mesh.add(m)}o.setCamera(this._camera),o.addToScene(this.mesh)}return Object(g.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,o){this.mesh.position.set(e,t,o)}}]),e}(),ce=function(e,t){for(var o in e)e[o].wrapS&&(e[o].wrapS=e[o].wrapT=_.RepeatWrapping);var a=["bumpMap","envMap","map","normalMap","lightMap","aoMap"],n={},r=function(o){n[o]=new _[t[o].mat](Object(I.a)({},t[o].props)),a.map((function(a){return t[o].props[a]&&(n[o][a]=e[t[o].props[a]])}))};for(var i in t)r(i);return n},le=function(e,t){var o={};return e["level-rooms"].traverse((function(e){e.geometry&&(o[e.name]=e,e.material=t.wallVirtual),e.name.includes("level")&&("level_000_000"===e.name&&(new _.Mesh(e.geometry,t.wallVirtual).name=e.name),"level_001_000"===e.name&&(new _.Mesh(e.geometry,t.wallVirtual).name=e.name))})),{items:o}},ue=o.p+"static/media/level.21832d73.obj",he=o.p+"static/media/floor_outer_map3.558e9646.jpg",pe=(o.p,o.p+"static/media/map01.48219503.jpg"),me=o.p+"static/media/floor_outer_map.35e50f6e.jpg",de=o.p+"static/media/txt1.b67888d5.jpg",be=o.p+"static/media/px.8a9030e7.jpg",fe=o.p+"static/media/nx.dc0a1bc7.jpg",ve=o.p+"static/media/py.ed7a276e.jpg",Oe=o.p+"static/media/ny.75a01d7a.jpg",je=o.p+"static/media/pz.3cf6bf7f.jpg",ye=o.p+"static/media/nz.c24a9aad.jpg",ge=o.p+"static/media/px.96d0b65f.jpg",_e=o.p+"static/media/nx.8cbf039d.jpg",we=o.p+"static/media/py.659ebc34.jpg",Ce=o.p+"static/media/ny.09051a4e.jpg",Se=o.p+"static/media/pz.a1539724.jpg",Me=o.p+"static/media/nz.0bc769f7.jpg",Te=function(){function e(){Object(y.a)(this,e),this._arrMeshes=[],this._vecStart=new _.Vector3,this._vecDir=new _.Vector3,this._rayCaster=new _.Raycaster(this._vecStart,this._vecDir)}return Object(g.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,o){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var a=this._rayCaster.intersectObjects(this._arrMeshes);return a[0]&&a[0].distance<o?[!0,a[0]]:[!1,null]}}]),e}(),ke=function(){function e(t){var o=this;Object(y.a)(this,e);var a=t.assets,n=t.CONSTANTS,r=t.emitter,i=t.materials,s=(t.system_Level,n.CONFIG_FOR_INIT.currentSceneConfig.carProps),c=s.position,l=s.rotation;this._model=a.car.children[0],this._model.material=i.car,this._camera=new _.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=28,this._model.add(this._camera),this._model.position.fromArray(c),this._model.rotation.fromArray(l),this._collision=a.carCollision.children[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new _.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new _.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){o._compass=function(e){e.assets;var t=e.studio,o=e.system_Level._items.arrow;o.material=e.materials.car;var a=new _.Mesh(new _.BoxGeometry(10,10,10),new _.MeshBasicMaterial({color:16711680}));a.position.set(-500,-30,-500),t.addToScene(a);var n=new _.Mesh(new _.BoxGeometry(10,10,10),new _.MeshBasicMaterial({color:16711680}));return n.position.set(0,0,0),t.addToScene(a),new _.Vector3,{addToParent:function(e){e.add(o)},setArrowPosition:function(e,t,a){o.position.set(e,t,a)},setTargetPosition:function(e){a.position.copy(e)},update:function(){n.position.copy(o.parent.position),n.lookAt(a.position),o.parent.position.z<a.position.z?o.rotation.y=-o.parent.rotation.y+n.rotation.y:o.rotation.y=-o.parent.rotation.y-n.rotation.y+Math.PI}}}(t),o._compass.addToParent(o._model),o._compass.setArrowPosition(0,23,-11.5),o.setTargetPosition=function(e){o._compass.setTargetPosition(e),o._compass.update()}})),this._collisionsWalls=new Te;var u=function(e,t){var a=o._collisionsWalls.checkCollisions(o._model,e,t);return Object(A.a)(a,1)[0]};this.isFreeze=!0;var h={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!o.isFreeze){if(o._spd<0&&(u(o._frontObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),o._spd>0&&(u(o._backObj,30)?o._spd=0:(o._model.translateZ(o._spd*e.count),o._compass.update())),h.up&&(o._spd-=o._acc),h.down&&(o._spd+=o._acc),Math.abs(o._spd)>.001){o._spd>0&&(o._spd-=o._deceleration,o._spd<0&&(o._spd=0)),o._spd<0&&(o._spd+=o._deceleration,o._spd>0&&(o._spd=0)),o._spd=Math.min(o._maxSpdBack,Math.max(o._maxSpdFront,o._spd));var t=Math.min(1,Math.max(0,Math.abs(o._spd)));h.left&&(o._spd<0&&(o._model.rotation.y+=o._spdRot*t),o._spd>0&&(o._model.rotation.y-=o._spdRot*t)),h.right&&(o._spd<0&&(o._model.rotation.y-=o._spdRot*t),o._spd>0&&(o._model.rotation.y+=o._spdRot*t))}else o._spd=0;o._isCarStay&&0!==o._spd&&(o._isCarStay=!1,o._onChangeStateIsStay("carStart")),o._isCarStay||0!==o._spd||(o._isCarStay=!0,o._onChangeStateIsStay("carStop"))}},r.subscribe("keyEvent")((function(e){return h=e}))}return Object(g.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}}]),e}(),xe=o.p+"static/media/car.8c016cb9.obj",Pe=o.p+"static/media/car_collision.66478aff.obj",De=o.p+"static/media/body.bb8da675.obj",Le=function(){function e(t){var o=this;Object(y.a)(this,e);var a=t.emitter,n=t.CONSTANTS,r=t.player;t.assets,t.studio;r.mesh.position.fromArray([0,0,0]);var i=new Te,s=n.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;r.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},r.toggleCanMove=function(e,t){return o.isCanMove[e]=t},this.isFreeze=!1;var p={};this.update=function(e){o.isFreeze||(p.left&&r.mesh.rotateY(u*e.count),p.right&&r.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(r.mesh,r.bottomObj,17.2),o=Object(A.a)(t,2),a=o[0],n=o[1];a&&17>n.distance?r.mesh.translateY(17-n.distance):a||(r.mesh.position.y+=l*e.count)}(e),p.up&&o.isCanMove.forward&&function(e){var t=i.checkCollisions(r.mesh,r.frontObj,17),o=Object(A.a)(t,2),n=o[0],s=o[1];n?s.object.userData.type&&"alert"===s.object.userData.type&&a.emit("collision")(s.object.userData.event):(r.mesh.translateZ(-c*e.count),a.emit("playerMove")("forward"))}(e),p.down&&o.isCanMove.back&&function(e){var t=i.checkCollisions(r.mesh,r.backObj,17);Object(A.a)(t,1)[0]||(r.mesh.translateZ(c*e.count),a.emit("playerMove")("back"))}(e),p.p&&console.log("player.mesh.position.fromArray([".concat(r.mesh.position.x,", ").concat(r.mesh.position.y,", ").concat(r.mesh.position.z,"])"))))},a.subscribe("keyEvent")((function(e){return p=e})),this._collisionsWalls=i}return Object(g.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),Ae=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var a=t.emitter,n=t.player;this._itemsToCheck=[],a.subscribe("playerMove")((function(){for(var e=0;e<o._itemsToCheck.length;++e){var t=n.mesh.position.distanceTo(o._itemsToCheck[e].position);if(!o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<o._itemsToCheck[e].userData.nearPlayerItemNear)return o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void a.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});o._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>o._itemsToCheck[e].userData.nearPlayerItemNear&&(o._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,a.emit("checkNear")({item:o._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(g.a)(e,[{key:"setItemToCheck",value:function(e,t,o,a){for(var n=0;n<this._itemsToCheck.length;++n)if(e===this._itemsToCheck[n])return;t&&(e.userData.nearPlayerItemKey=t),o&&(e.userData.nearPlayerItemNear=o),a&&(e.userData.nearPlayerItemFar=a),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),Ie=function(e,t){for(var o=[],a=e-1;a<e+2;++a)for(var n=t-1;n<t+2;++n)o.push(a+"_"+n);return o},Ne=function(e,t){for(var o=[],a=0;a<e.length;++a){for(var n=!1,r=0;r<t.length;++r)e[a]===t[r]&&(n=!0);n||o.push(e[a])}return o},Ee=o(18),Fe=o(1),Be=Float32Array;function Re(e,t,o){return(o=o||new Be(3))[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],o}function Ge(e,t){t=t||new Be(3);var o=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return o>1e-5&&(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t}function ze(e,t,o){return(o=o||new Be(3))[0]=e[1]*t[2]-e[2]*t[1],o[1]=e[2]*t[0]-e[0]*t[2],o[2]=e[0]*t[1]-e[1]*t[0],o}function Ue(e,t){var o=e[0]-t[0],a=e[1]-t[1],n=e[2]-t[2];return o*o+a*a+n*n}function We(e,t){t=t||new Be(16);var o=e[0],a=e[1],n=e[2],r=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],p=e[10],m=e[11],d=e[12],b=e[13],f=e[14],v=e[15],O=p*v,j=f*m,y=c*v,g=f*l,_=c*m,w=p*l,C=n*v,S=f*r,M=n*m,T=p*r,k=n*l,x=c*r,P=u*b,D=d*h,L=i*b,A=d*s,I=i*h,N=u*s,E=o*b,F=d*a,B=o*h,R=u*a,G=o*s,z=i*a,U=O*s+g*h+_*b-(j*s+y*h+w*b),W=j*a+C*h+T*b-(O*a+S*h+M*b),K=y*a+S*s+k*b-(g*a+C*s+x*b),V=w*a+M*s+x*h-(_*a+T*s+k*h),q=1/(o*U+i*W+u*K+d*V);return t[0]=q*U,t[1]=q*W,t[2]=q*K,t[3]=q*V,t[4]=q*(j*i+y*u+w*d-(O*i+g*u+_*d)),t[5]=q*(O*o+S*u+M*d-(j*o+C*u+T*d)),t[6]=q*(g*o+C*i+x*d-(y*o+S*i+k*d)),t[7]=q*(_*o+T*i+k*u-(w*o+M*i+x*u)),t[8]=q*(P*l+A*m+I*v-(D*l+L*m+N*v)),t[9]=q*(D*r+E*m+R*v-(P*r+F*m+B*v)),t[10]=q*(L*r+F*l+G*v-(A*r+E*l+z*v)),t[11]=q*(N*r+B*l+z*m-(I*r+R*l+G*m)),t[12]=q*(L*p+N*f+D*c-(I*f+P*c+A*p)),t[13]=q*(B*f+P*n+F*p-(E*p+R*f+D*n)),t[14]=q*(E*c+z*f+A*n-(G*f+L*n+F*c)),t[15]=q*(G*p+I*n+R*c-(B*c+z*p+N*n)),t}var Ke={copy:function(e,t){return(t=t||new Be(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,o,a){a=a||new Be(16);var n=Ge(Re(e,t)),r=Ge(ze(o,n)),i=Ge(ze(n,r));return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=0,a[4]=i[0],a[5]=i[1],a[6]=i[2],a[7]=0,a[8]=n[0],a[9]=n[1],a[10]=n[2],a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},addVectors:function(e,t,o){return(o=o||new Be(3))[0]=e[0]+t[0],o[1]=e[1]+t[1],o[2]=e[2]+t[2],o},subtractVectors:Re,scaleVector:function(e,t,o){return(o=o||new Be(3))[0]=e[0]*t,o[1]=e[1]*t,o[2]=e[2]*t,o},distance:function(e,t){return Math.sqrt(Ue(e,t))},distanceSq:Ue,normalize:Ge,compose:function(e,t,o,a){a=a||new Be(16);var n=t[0],r=t[1],i=t[2],s=t[3],c=n+n,l=r+r,u=i+i,h=n*c,p=n*l,m=n*u,d=r*l,b=r*u,f=i*u,v=s*c,O=s*l,j=s*u,y=o[0],g=o[1],_=o[2];return a[0]=(1-(d+f))*y,a[1]=(p+j)*y,a[2]=(m-O)*y,a[3]=0,a[4]=(p-j)*g,a[5]=(1-(h+f))*g,a[6]=(b+v)*g,a[7]=0,a[8]=(m+O)*_,a[9]=(b-v)*_,a[10]=(1-(h+d))*_,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a},cross:ze,decompose:function(e,t,o,a){var n=Ke.length(e.slice(0,3)),r=Ke.length(e.slice(4,7)),i=Ke.length(e.slice(8,11));(function(e){var t=e[0],o=e[1],a=e[2],n=e[3],r=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],m=e[12],d=e[13],b=e[14],f=e[15],v=h*f,O=b*p,j=s*f,y=b*c,g=s*p,_=h*c,w=a*f,C=b*n,S=a*p,M=h*n,T=a*c,k=s*n;return 1/(t*(v*i+y*u+g*d-(O*i+j*u+_*d))+r*(O*o+w*u+M*d-(v*o+C*u+S*d))+l*(j*o+C*i+T*d-(y*o+w*i+k*d))+m*(_*o+S*i+k*u-(g*o+M*i+T*u)))})(e)<0&&(n=-n),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=Ke.copy(e),c=1/n,l=1/r,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var o=e[0],a=e[4],n=e[8],r=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=o+i+u;if(h>0){var p=.5/Math.sqrt(h+1);t[3]=.25/p,t[0]=(l-s)*p,t[1]=(n-c)*p,t[2]=(r-a)*p}else if(o>i&&o>u){var m=2*Math.sqrt(1+o-i-u);t[3]=(l-s)/m,t[0]=.25*m,t[1]=(a+r)/m,t[2]=(n+c)/m}else if(i>u){var d=2*Math.sqrt(1+i-o-u);t[3]=(n-c)/d,t[0]=(a+r)/d,t[1]=.25*d,t[2]=(s+l)/d}else{var b=2*Math.sqrt(1+u-o-i);t[3]=(r-a)/b,t[0]=(n+c)/b,t[1]=(s+l)/b,t[2]=.25*b}}(s,o),a[0]=n,a[1]=r,a[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new Be(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new Be(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,o,a,n,r,i){return(i=i||new Be(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(a-o),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(n-r),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(o+a)/(o-a),i[14]=(n+r)/(n-r),i[15]=1,i},frustum:function(e,t,o,a,n,r,i){var s=t-e,c=a-o,l=r-n;return(i=i||new Be(16))[0]=2*n/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*n/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(a+o)/c,i[10]=-(r+n)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*n*r/l,i[15]=0,i},perspective:function(e,t,o,a,n){n=n||new Be(16);var r=Math.tan(.5*Math.PI-.5*e),i=1/(o-a);return n[0]=r/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=r,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(o+a)*i,n[11]=-1,n[12]=0,n[13]=0,n[14]=o*a*i*2,n[15]=0,n},translation:function(e,t,o,a){return(a=a||new Be(16))[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=e,a[13]=t,a[14]=o,a[15]=1,a},translate:function(e,t,o,a,n){n=n||new Be(16);var r=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8],d=e[9],b=e[10],f=e[11],v=e[12],O=e[13],j=e[14],y=e[15];return e!==n&&(n[0]=r,n[1]=i,n[2]=s,n[3]=c,n[4]=l,n[5]=u,n[6]=h,n[7]=p,n[8]=m,n[9]=d,n[10]=b,n[11]=f),n[12]=r*t+l*o+m*a+v,n[13]=i*t+u*o+d*a+O,n[14]=s*t+h*o+b*a+j,n[15]=c*t+p*o+f*a+y,n},xRotation:function(e,t){t=t||new Be(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=a,t[7]=0,t[8]=0,t[9]=-a,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new Be(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=o,t[1]=0,t[2]=-a,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=a,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new Be(16);var o=Math.cos(e),a=Math.sin(e);return t[0]=o,t[1]=a,t[2]=0,t[3]=0,t[4]=-a,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,o){o=o||new Be(16);var a=e[4],n=e[5],r=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return o[4]=h*a+p*s,o[5]=h*n+p*c,o[6]=h*r+p*l,o[7]=h*i+p*u,o[8]=h*s-p*a,o[9]=h*c-p*n,o[10]=h*l-p*r,o[11]=h*u-p*i,e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},yRotate:function(e,t,o){o=o||new Be(16);var a=e[0],n=e[1],r=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return o[0]=h*a-p*s,o[1]=h*n-p*c,o[2]=h*r-p*l,o[3]=h*i-p*u,o[8]=h*s+p*a,o[9]=h*c+p*n,o[10]=h*l+p*r,o[11]=h*u+p*i,e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},zRotate:function(e,t,o){o=o||new Be(16);var a=e[0],n=e[1],r=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),p=Math.sin(t);return o[0]=h*a+p*s,o[1]=h*n+p*c,o[2]=h*r+p*l,o[3]=h*i+p*u,o[4]=h*s-p*a,o[5]=h*c-p*n,o[6]=h*l-p*r,o[7]=h*u-p*i,e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},axisRotation:function(e,t,o){o=o||new Be(16);var a=e[0],n=e[1],r=e[2],i=Math.sqrt(a*a+n*n+r*r),s=(a/=i)*a,c=(n/=i)*n,l=(r/=i)*r,u=Math.cos(t),h=Math.sin(t),p=1-u;return o[0]=s+(1-s)*u,o[1]=a*n*p+r*h,o[2]=a*r*p-n*h,o[3]=0,o[4]=a*n*p-r*h,o[5]=c+(1-c)*u,o[6]=n*r*p+a*h,o[7]=0,o[8]=a*r*p+n*h,o[9]=n*r*p-a*h,o[10]=l+(1-l)*u,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},axisRotate:function(e,t,o,a){a=a||new Be(16);var n=t[0],r=t[1],i=t[2],s=Math.sqrt(n*n+r*r+i*i),c=(n/=s)*n,l=(r/=s)*r,u=(i/=s)*i,h=Math.cos(o),p=Math.sin(o),m=1-h,d=c+(1-c)*h,b=n*r*m+i*p,f=n*i*m-r*p,v=n*r*m-i*p,O=l+(1-l)*h,j=r*i*m+n*p,y=n*i*m+r*p,g=r*i*m-n*p,_=u+(1-u)*h,w=e[0],C=e[1],S=e[2],M=e[3],T=e[4],k=e[5],x=e[6],P=e[7],D=e[8],L=e[9],A=e[10],I=e[11];return a[0]=d*w+b*T+f*D,a[1]=d*C+b*k+f*L,a[2]=d*S+b*x+f*A,a[3]=d*M+b*P+f*I,a[4]=v*w+O*T+j*D,a[5]=v*C+O*k+j*L,a[6]=v*S+O*x+j*A,a[7]=v*M+O*P+j*I,a[8]=y*w+g*T+_*D,a[9]=y*C+g*k+_*L,a[10]=y*S+g*x+_*A,a[11]=y*M+g*P+_*I,e!==a&&(a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},scaling:function(e,t,o,a){return(a=a||new Be(16))[0]=e,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=o,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},scale:function(e,t,o,a,n){return(n=n||new Be(16))[0]=t*e[0],n[1]=t*e[1],n[2]=t*e[2],n[3]=t*e[3],n[4]=o*e[4],n[5]=o*e[5],n[6]=o*e[6],n[7]=o*e[7],n[8]=a*e[8],n[9]=a*e[9],n[10]=a*e[10],n[11]=a*e[11],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},multiply:function(e,t,o){o=o||new Be(16);var a=t[0],n=t[1],r=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],m=t[10],d=t[11],b=t[12],f=t[13],v=t[14],O=t[15],j=e[0],y=e[1],g=e[2],_=e[3],w=e[4],C=e[5],S=e[6],M=e[7],T=e[8],k=e[9],x=e[10],P=e[11],D=e[12],L=e[13],A=e[14],I=e[15];return o[0]=a*j+n*w+r*T+i*D,o[1]=a*y+n*C+r*k+i*L,o[2]=a*g+n*S+r*x+i*A,o[3]=a*_+n*M+r*P+i*I,o[4]=s*j+c*w+l*T+u*D,o[5]=s*y+c*C+l*k+u*L,o[6]=s*g+c*S+l*x+u*A,o[7]=s*_+c*M+l*P+u*I,o[8]=h*j+p*w+m*T+d*D,o[9]=h*y+p*C+m*k+d*L,o[10]=h*g+p*S+m*x+d*A,o[11]=h*_+p*M+m*P+d*I,o[12]=b*j+f*w+v*T+O*D,o[13]=b*y+f*C+v*k+O*L,o[14]=b*g+f*S+v*x+O*A,o[15]=b*_+f*M+v*P+O*I,o},inverse:We,transformVector:function(e,t,o){o=o||new Be(4);for(var a=0;a<4;++a){o[a]=0;for(var n=0;n<4;++n)o[a]+=t[n]*e[4*n+a]}return o},transformPoint:function(e,t,o){o=o||new Be(3);var a=t[0],n=t[1],r=t[2],i=a*e[3]+n*e[7]+r*e[11]+e[15];return o[0]=(a*e[0]+n*e[4]+r*e[8]+e[12])/i,o[1]=(a*e[1]+n*e[5]+r*e[9]+e[13])/i,o[2]=(a*e[2]+n*e[6]+r*e[10]+e[14])/i,o},transformDirection:function(e,t,o){o=o||new Be(3);var a=t[0],n=t[1],r=t[2];return o[0]=a*e[0]+n*e[4]+r*e[8],o[1]=a*e[1]+n*e[5]+r*e[9],o[2]=a*e[2]+n*e[6]+r*e[10],o},transformNormal:function(e,t,o){o=o||new Be(3);var a=We(e),n=t[0],r=t[1],i=t[2];return o[0]=n*a[0]+r*a[1]+i*a[2],o[1]=n*a[4]+r*a[5]+i*a[6],o[2]=n*a[8]+r*a[9]+i*a[10],o},setDefaultType:function(e){var t=Be;return Be=e,t}},Ve=(Math.floor,Math.random),qe=(Math.PI,Math.sin,Math.cos,function(e,t){return e+Ve()*(t-e)}),He=function(e,t,o,a){return[].concat(Object(Fe.a)(e),Object(Fe.a)(t),Object(Fe.a)(o),Object(Fe.a)(e),Object(Fe.a)(o),Object(Fe.a)(a))},Qe=function(e,t,o,a){return[].concat(Object(Fe.a)(e),Object(Fe.a)(t),Object(Fe.a)(o),Object(Fe.a)(e),Object(Fe.a)(o),Object(Fe.a)(a))},Ze=function(e){return[].concat(Object(Fe.a)(e),Object(Fe.a)(e),Object(Fe.a)(e),Object(Fe.a)(e),Object(Fe.a)(e),Object(Fe.a)(e))},Ye=function(e,t,o,a,n,r){var i=t[0]-e[0],s=o[1]-e[1],c=qe(.3*i,.7*i),l=qe(.3*s,.7*s),u=e[0]+(i-c)/2,h=t[0]-(i-c)/2,p=e[1]+(s-l)/2,m=o[1]-(s-l)/2,d=[u,p,e[2]],b=[h,p,e[2]],f=[h,m,e[2]],v=[u,m,e[2]],O=[];return O.push.apply(O,Object(Fe.a)(He(d,b,f,v)).concat(Object(Fe.a)(He(e,t,b,d)),Object(Fe.a)(He(b,t,o,f)),Object(Fe.a)(He(v,f,o,a)),Object(Fe.a)(He(e,d,v,a)))),{vArr:O,cArr:Je(n,r),uArr:[].concat(Object(Fe.a)(Qe([.5,.5],[1,.5],[1,1],[.5,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(Fe.a)(Qe([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(Fe.a)(Qe([.1,.9],[.4,.9],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.1,.6],[.1,.9],[0,1])))}},Je=function(e,t){return[].concat(Object(Fe.a)(Ze(e)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)))},Xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=Ke.yRotation(n);r=Ke.translate(r,t,o,a);for(var i=0;i<e.length;i+=3){var s=Ke.transformPoint(r,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},$e=function(e,t){for(var o=Ke.yRotation(t),a=0;a<e.length;a+=3){var n=Ke.transformPoint(o,[e[a+0],e[a+1],e[a+2],1]);e[a+0]=n[0],e[a+1]=n[1],e[a+2]=n[2]}},et=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=Ke.translation(t,o,a),r=0;r<e.length;r+=3){var i=Ke.transformPoint(n,[e[r+0],e[r+1],e[r+2],1]);e[r+0]=i[0],e[r+1]=i[1],e[r+2]=i[2]}},tt=(Math.floor,Math.random,Math.PI,Math.sin,Math.cos,function(e){var t=e.h0,o=e.h1,a=e.color1,n=void 0===a?[.2,.1,.1]:a,r=e.color2,i=void 0===r?[1,1,1]:r,s=e.rBase,c=void 0===s?5:s,l=e.hBase,u=void 0===l?5:l,h=e.hBaseToTrunk,p=void 0===h?1:h,m=e.hCapital,f=void 0===m?2:m,v=e.rCapital,O=void 0===v?6:v,j=e.hTrunkToCapital,y=void 0===j?1:j,g=e.rTrunk,_=void 0===g?3:g,w=t,C=t+u,S=He([-c,w,c],[c,w,c],[c,C,c],[-c,C,c]),M=Ze(n),T=Qe([.5,0],[1,0],[1,.5],[.5,.5]),k=He([c+b,w-b,c+b],[-c-b,w-b,c+b],[-c-b,C,c+b],[c+b,C,c+b]),x=Ze(d),P=Qe([0,1],[0,1],[0,1],[0,1]);C=(w=C)+p;var D=Object(Fe.a)(He([-c,w,c],[c,w,c],[_,C,_],[-_,C,_])),L=Object(Fe.a)(Ze(i)),A=Qe([0,.5],[.5,.5],[.4,.7],[.1,.7]),I=function(e){for(var t=e.h,o=void 0===t?2:t,a=e.h2,n=void 0===a?30:a,r=e.r,i=void 0===r?10:r,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],p=n-o,m=o;p>0;){var d=qe(.5,10),b=qe(.5,4),f=qe(.5,4),v=qe(.5,.2),O=d+b+f+v;(p-=O)>5&&h.push({h0:m,h01:m+d,h02:m+d+b,h03:m+d+b+f,h04:m+d+b+f+v,r:qe(1,10)}),m+=O}var j=[],y=[],g=[];if(0===h.length)j.push.apply(j,Object(Fe.a)(He([-i,o,i],[i,o,i],[i,n,i],[-i,n,i]))),y.push.apply(y,Object(Fe.a)(Ze(c))),g.push.apply(g,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var _=0;_<h.length;++_){var w=Ye([-i,h[_].h0,i],[i,h[_].h0,i],[i,h[_].h01,i],[-i,h[_].h01,i],u,u),C=w.vArr,S=w.cArr,M=w.uArr;j.push.apply(j,Object(Fe.a)(C)),y.push.apply(y,Object(Fe.a)(S)),g.push.apply(g,Object(Fe.a)(M)),j.push.apply(j,Object(Fe.a)(He([-i,h[_].h01,i],[i,h[_].h01,i],[h[_].r,h[_].h02,h[_].r],[-h[_].r,h[_].h02,h[_].r]))),y.push.apply(y,Object(Fe.a)(Ze(u))),g.push.apply(g,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1]))),j.push.apply(j,Object(Fe.a)(He([-h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h02,h[_].r],[h[_].r,h[_].h03,h[_].r],[-h[_].r,h[_].h03,h[_].r]))),y.push.apply(y,Object(Fe.a)(Ze(c))),g.push.apply(g,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1]))),j.push.apply(j,Object(Fe.a)(He([-h[_].r,h[_].h03,h[_].r],[h[_].r,h[_].h03,h[_].r],[i,h[_].h04,i],[-i,h[_].h04,i]))),y.push.apply(y,Object(Fe.a)(Ze(u))),g.push.apply(g,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])))}var T=Ye([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,n,i],[-i,n,i],u,c),k=T.vArr,x=T.cArr,P=T.uArr;j.push.apply(j,Object(Fe.a)(k)),y.push.apply(y,Object(Fe.a)(x)),g.push.apply(g,Object(Fe.a)(P))}return{vert:j,col:y,uv:g}}({color1:n,color2:i,h:w=C,h2:C=o-f-y,r:_}),N=I.vert,E=I.col,F=I.uv;w=C,C=o-f;var B=Object(Fe.a)(He([-_,w,_],[_,w,_],[O,C,O],[-O,C,O]));w=C,C=o;var R=Object(Fe.a)(He([-O,w,O],[O,w,O],[O,C,O],[-O,C,O])),G=Qe([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(Fe.a)(S),Object(Fe.a)(k),Object(Fe.a)(D),Object(Fe.a)(N),Object(Fe.a)(B),Object(Fe.a)(R)),frontColors:[].concat(Object(Fe.a)(M),Object(Fe.a)(x),Object(Fe.a)(L),Object(Fe.a)(E),Object(Fe.a)(L),Object(Fe.a)(M)),frontUV:[].concat(Object(Fe.a)(T),Object(Fe.a)(P),Object(Fe.a)(A),Object(Fe.a)(F),Object(Fe.a)(A),Object(Fe.a)(G))}}),ot=(Math.floor,Math.random,Math.PI,Math.sin,Math.cos,Math.floor,Math.random,Math.PI,Math.sin),at=Math.cos,nt=(Math.PI,Math.sin,Math.cos,[0,0,0]),rt=[0,.7,0],it=function(e){var t=e.h0,o=void 0===t?0:t,a=e.h1,n=void 0===a?30:a,r=e.h2,i=void 0===r?60:r,s=e.arc,c=void 0!==s&&s,l=e.isTopElem,u=void 0!==l&&l,h=e.isColumn,p=void 0!==h&&h,m=[],f=[],v=[];if(c){var O=function(e){for(var t=e.h1,o=e.h2,a=e.color1,n=void 0===a?[.2,.1,.1]:a,r=e.color2,i=void 0===r?[1,1,1]:r,s=(e.hStart,e.fullH,e.r),c=void 0===s?5:s,l=e.rCap,u=void 0===l?7:l,h=e.wCol,p=void 0===h?3:h,m=(e.zBridge,e.w),d=(void 0===m?40:m)-2*c,b=-c-d,f=t,v=o-Math.min(.1*(o-t),2),O=Object(Fe.a)(He([-p,f,c],[p,f,c],[p,v,c],[-p,v,c])),j=Object(Fe.a)(Ze(i)),y=Object(Fe.a)(Ze(n)),g=Qe([0,.5],[.5,.5],[.5,1],[0,1]),_=[].concat(Object(Fe.a)(He([-p,f,-c],[-p,f,c],[-p,v,c],[-p,v,-c])),Object(Fe.a)(He([p,f,c],[p,f,-c],[p,v,-c],[p,v,c]))),w=Object(Fe.a)(He([p,f,-c],[-p,f,-c],[-p,v,-c],[p,v,-c])),C=[],S=[],M=[],T=2-p,k=p-2,x=14,P=d/x,D=v-f,L=.15*D,A=0;A<x;++A){var I=(1-Math.sin((A+1)/x*Math.PI))*(D-L)+L,N=(1-Math.sin(A/x*Math.PI))*(D-L)+L,E=-c;A+1>7&&(E=-c-d),C.push(T,v-I,-c-(A+1)*P,T,v-N,-c-A*P,T,v,E),S.push.apply(S,Object(Fe.a)(i).concat(Object(Fe.a)(i),Object(Fe.a)(i))),M.push(0,0,.3,0,.3,.3),C.push(k,v-N,-c-A*P,k,v-I,-c-(A+1)*P,k,v,E),S.push.apply(S,Object(Fe.a)(i).concat(Object(Fe.a)(i),Object(Fe.a)(i))),M.push(0,0,.3,0,.3,.3),C.push.apply(C,Object(Fe.a)(He([k,v-N,-c-A*P],[T,v-N,-c-A*P],[T,v-I,-c-(A+1)*P],[k,v-I,-c-(A+1)*P]))),S.push.apply(S,Object(Fe.a)(y)),M.push.apply(M,Object(Fe.a)(Qe([0,0],[0,0],[0,0],[0,0])))}C.push(T,v-L,-c-P*x/2,T,v,-c,T,v,-c-P*x),S.push.apply(S,Object(Fe.a)(i).concat(Object(Fe.a)(i),Object(Fe.a)(i))),M.push(.5,.25,.25,.3,.25,.2),C.push(k,v-L,-c-P*x/2,k,v,-c-P*x,k,v,-c),S.push.apply(S,Object(Fe.a)(i).concat(Object(Fe.a)(i),Object(Fe.a)(i))),M.push(.5,.25,.25,.3,.25,.2),f=v,v=o;var F=[].concat(Object(Fe.a)(He([-u,f,-u],[u,f,-u],[u,f,u],[-u,f,u])),Object(Fe.a)(He([-u,f,u],[u,f,u],[u,v,u],[-u,v,u])),Object(Fe.a)(He([-u,f,-u],[-u,f,u],[-u,v,u],[-u,v,-u])),Object(Fe.a)(He([u,f,u],[u,f,-u],[u,v,-u],[u,v,u])),Object(Fe.a)(He([u,f,-u],[-u,f,-u],[-u,v,-u],[u,v,-u])),Object(Fe.a)(He([-u,v,u],[u,v,u],[u,v,-u],[-u,v,-u])),Object(Fe.a)(He([2-u,f,b],[u-2,f,b],[u-2,f,-u],[2-u,f,-u])),Object(Fe.a)(He([2-u,f,b],[2-u,f,-u],[2-u,v,-u],[2-u,v,b])),Object(Fe.a)(He([u-2,f,-u],[u-2,f,b],[u-2,v,b],[u-2,v,-u])),Object(Fe.a)(He([2-u,v,-u],[u-2,v,-u],[u-2,v,b],[2-u,v,b])));return{vArc:[].concat(Object(Fe.a)(O),Object(Fe.a)(_),Object(Fe.a)(w),C,Object(Fe.a)(F)),cArc:[].concat(Object(Fe.a)(j),Object(Fe.a)(j),Object(Fe.a)(j),Object(Fe.a)(j),S,Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y),Object(Fe.a)(y)),uvArc:[].concat(Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),M,Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g))}}(Object(I.a)({h1:n,h2:i,color1:nt,color2:rt},c));m=O.vArc,f=O.cArc,v=O.uvArc}var j=tt({h0:o,h1:n,color1:nt,color2:rt,rCapital:6,rBase:5}),y=j.frontVert,g=j.frontColors,_=j.frontUV,w=Object(Fe.a)(y);Xe(w,0,0,0,Math.PI/2);var C=Object(Fe.a)(y);Xe(C,0,0,0,-Math.PI/2);var S=Object(Fe.a)(y);Xe(S,0,0,0,Math.PI);var M=He([-6,n,6],[6,n,6],[6,n,-6],[-6,n,-6]),T=Ze(nt),k=Qe([.5,0],[1,0],[1,.5],[.5,.5]),x=He([-5-b,o-b,5+b],[5+b,o-b,5+b],[5,o-b,-5-b],[-5,o-b,-5-b]),P=Ze(d),D=Qe([0,1],[0,1],[0,1],[0,1]),L=function(e){var t=e.isTopElem,o=e.color1,a=e.color2,n=e.h2;if(!t)return{vertTopElem:[],colorsTopElem:[],uvTopElem:[]};for(var r=[],i=[],s=[],c=2+12*Math.random(),l=1+4*Math.random(),u=.2+40*Math.random(),h=.1+10*Math.random(),p=.1+10*Math.random(),m=.1+40*Math.random(),f=0;f<6;++f){var v=f+1;v>6&&(v=0);var O=f/6*Math.PI*2,j=v/6*Math.PI*2,y=n,g=y+c,_=6,w=6,C=ot(O),S=at(O),M=ot(j),T=at(j);r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w]))),g=(y=g)+l,_=w,w=3,r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w]))),g=(y=g)+u,w=_=w,r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w]))),g=(y=g)+h,w=(_=w)+4,r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w]))),g=(y=g)+p,w=_=w,r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w])));var k=b+.5;r.push.apply(r,Object(Fe.a)(He([M*(_+k),y,T*(_+k)],[C*(_+k),y,S*(_+k)],[C*(w+k),g,S*(w+k)],[M*(w+k),g,T*(w+k)]))),r.push.apply(r,Object(Fe.a)(He([C*w,g,S*w],[M*w,g,T*w],[2*M,g,2*T],[2*ot(O),g,2*S]))),g=(y=g)+m,_=2,w=7,r.push.apply(r,Object(Fe.a)(He([C*_,y,S*_],[M*_,y,T*_],[M*w,g,T*w],[C*w,g,S*w])));var x=b;r.push.apply(r,Object(Fe.a)(He([M*(_+x),y,T*(_+x)],[C*(_+x),y,S*(_+x)],[C*(w+x),g,S*(w+x)],[M*(w+x),g,T*(w+x)]))),y=g,g+=m,r.push(C*w,y,S*w,M*w,y,T*w,0,g,0),r.push(M*(w+.5),y,T*(w+.5),C*(w+.5),y,S*(w+.5),0,g+3,0),i.push.apply(i,Object(Fe.a)(Ze(o)).concat(Object(Fe.a)(Ze(a)),Object(Fe.a)(Ze(a)),Object(Fe.a)(Ze(a)),Object(Fe.a)(Ze(o)),Object(Fe.a)(Ze(d)),Object(Fe.a)(Ze(o)),Object(Fe.a)(Ze(o)),Object(Fe.a)(Ze(d)),Object(Fe.a)(o),Object(Fe.a)(o),Object(Fe.a)(o),Object(Fe.a)(d),Object(Fe.a)(d),Object(Fe.a)(d))),s.push.apply(s,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,1],[0,1],[0,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,1],[0,1],[0,1],[0,1])),[0,.5],[.5,.5],[.25,1],[0,1],[0,1],[0,1]))}return{vertTopElem:r,colorsTopElem:i,uvTopElem:s}}({h2:i,color1:nt,color2:rt,isTopElem:u}),A=L.vertTopElem,N=L.colorsTopElem,E=L.uvTopElem,F=function(e){var t=e.isColumn,o=e.h1,a=e.h2,n=e.color1,r=e.color2;if(!t)return{vertColumn:[],colorsColumn:[],uvColumn:[]};var i=[],s=[],c=[],l=a-5;i.push.apply(i,Object(Fe.a)(He([-4,o,4],[4,o,4],[4,a,4],[-4,a,4])).concat(Object(Fe.a)(He([4,o,4],[4,o,-4],[4,a,-4],[4,a,4])),Object(Fe.a)(He([4,o,-4],[-4,o,-4],[-4,a,-4],[4,a,-4])),Object(Fe.a)(He([-4,o,-4],[-4,o,4],[-4,a,4],[-4,a,-4])),Object(Fe.a)(He([-6,l,6],[6,l,6],[6,a,6],[-6,a,6])),Object(Fe.a)(He([6,l,6],[6,l,-6],[6,a,-6],[6,a,6])),Object(Fe.a)(He([6,l,-6],[-6,l,-6],[-6,a,-6],[6,a,-6])),Object(Fe.a)(He([-6,l,-6],[-6,l,6],[-6,a,6],[-6,a,-6])),Object(Fe.a)(He([-6,l,6],[-6,l,-6],[6,l,-6],[6,l,6])),Object(Fe.a)(He([-6,a,-6],[-6,a,6],[6,a,6],[6,a,-6])))),s.push.apply(s,Object(Fe.a)(Ze(r)).concat(Object(Fe.a)(Ze(r)),Object(Fe.a)(Ze(r)),Object(Fe.a)(Ze(r)),Object(Fe.a)(Ze(n)),Object(Fe.a)(Ze(n)),Object(Fe.a)(Ze(n)),Object(Fe.a)(Ze(n)),Object(Fe.a)(Ze(n)),Object(Fe.a)(Ze(n))));var u=Qe([0,.5],[.5,.5],[.5,1],[0,1]);return c.push.apply(c,Object(Fe.a)(u).concat(Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u),Object(Fe.a)(u))),{vertColumn:i,colorsColumn:s,uvColumn:c}}({isColumn:p,h1:n,h2:i,color1:nt,color2:rt}),B=F.vertColumn,R=F.colorsColumn,G=F.uvColumn;return{vResult:[].concat(Object(Fe.a)(y),Object(Fe.a)(w),Object(Fe.a)(C),Object(Fe.a)(S),Object(Fe.a)(x),Object(Fe.a)(M),Object(Fe.a)(m),Object(Fe.a)(A),Object(Fe.a)(B)),cResult:[].concat(Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(g),Object(Fe.a)(P),Object(Fe.a)(T),Object(Fe.a)(f),Object(Fe.a)(N),Object(Fe.a)(R)),uvResult:[].concat(Object(Fe.a)(_),Object(Fe.a)(_),Object(Fe.a)(_),Object(Fe.a)(_),Object(Fe.a)(D),Object(Fe.a)(k),Object(Fe.a)(v),Object(Fe.a)(E),Object(Fe.a)(G))}},st=function(e){Object(Ee.a)(e);for(var t=[],o=[],a=[],n=function(){var e=[],t=function t(o){var a=o.angle,n=o.offsetStart,r=o.h0,i=o.h1,s=o.h2,c=o.numFromCenter,l=120*Math.random()+30,u=Math.random()>.5;e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(a)*(n+l),z:Math.cos(a)*(n+l),angle:a,h0:r,h1:i,h2:s,arc:{w:l},isTopElem:!u,numFromCenter:c}),u&&t({angle:a,offsetStart:n+l,h0:r,h1:i,h2:s,numFromCenter:++c})},o=Math.floor(20*Math.random())+3,a=150*Math.random()+30,n=(.4*Math.random()+.5)*a;e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h0:0,h1:n,h2:a,numFromCenter:0,isTopElem:!1,isColumn:!0});for(var r=0;r<o;++r)Math.random()>.3&&t({angle:r/o*(2*Math.PI),offsetStart:0,h0:0,h1:n,h2:a,numFromCenter:1});for(var i=e.length,s=0;s<3;++s)for(var c=e[e.length-1].h2,l=c+150*Math.random()+30,u=c+(.4*Math.random()+.5)*(l-c),h=0;h<i;++h)e[h].isTopElem||e.push(Object(I.a)(Object(I.a)({},e[h]),{},{h0:c,h1:u,h2:l,isTopElem:2===s}));return e}(),r=(Math.random(),0);r<n.length;++r){var i=n[r],s=(i.id,i.x),c=i.z,l=i.angle,u=i.h0,h=i.h1,p=i.h2,m=i.arc,d=i.isTopElem,b=i.isColumn,f=it({h0:u,h1:h,h2:p,arc:m,isTopElem:d,isColumn:b}),v=f.vResult,O=f.cResult,j=f.uvResult;$e(v,l),et(v,s,0,c,l),t.push.apply(t,Object(Fe.a)(v)),o.push.apply(o,Object(Fe.a)(O)),a.push.apply(a,Object(Fe.a)(j))}return{vertices:new Float32Array(t),colors:new Float32Array(o),uv:new Float32Array(a)}},ct=function(e){var t=e.materials.wallVirtualColor,o=function(){var e=new _.BufferGeometry,t=st({}),o=t.vertices,a=t.colors,n=t.uv;return e.setAttribute("position",new _.BufferAttribute(o,3)),e.setAttribute("color",new _.BufferAttribute(a,3)),n&&e.setAttribute("uv",new _.BufferAttribute(n,2)),e.computeVertexNormals(),e}();return new _.Mesh(o,t)},lt=(Math.floor,Math.random,Math.PI,Math.sin,Math.cos,function(e){Object(Ee.a)(e);var t=function(e){for(var t=e.color1,o=(e.color2,e.h2,[]),a=[],n=[],r=[],i=0;i<8;++i){var s=-30;i%.5&&(s=30);var c=-30;(i+1)%.5&&(c=30),r.push({h:20*i,r:10,x:s,z:c})}for(var l=0;l<r.length;++l){var u=r[l],h=u.h,p=u.r,m=u.x,d=u.z,b=h-3,f=[];f.push.apply(f,Object(Fe.a)(He([-p,h,p],[p,h,p],[p,h,-p],[-p,h,-p])).concat(Object(Fe.a)(He([-p,b,p],[p,b,p],[p,h,p],[-p,h,p])),Object(Fe.a)(He([-p,b,-p],[-p,b,p],[-p,h,p],[-p,h,-p])),Object(Fe.a)(He([p,b,p],[p,b,-p],[p,h,-p],[p,h,p])),Object(Fe.a)(He([p,b,-p],[-p,b,-p],[-p,h,-p],[p,h,-p])),Object(Fe.a)(He([-p,h,-p],[p,h,-p],[p,h-30,-p-50],[-p,h-30,-p-50])))),$e(f,Math.PI-Math.PI/2*l),et(f,m,0,d),o.push.apply(o,f),a.push.apply(a,Object(Fe.a)(Ze(t)).concat(Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)),Object(Fe.a)(Ze(t)))),n.push.apply(n,Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1])),Object(Fe.a)(Qe([0,.5],[.5,.5],[.5,1],[0,1]))))}return{vertP:o,colorsP:a,uvTopP:n}}({h2:0,color1:[1,1,1],color2:[0,0,0]}),o=t.vertP,a=t.colorsP,n=t.uvTopP;return{vertices:new Float32Array(o),colors:new Float32Array(a),uv:new Float32Array(n)}}),ut=function(e){var t=e.materials.wallVirtualColor,o=function(){var e=new _.BufferGeometry,t=lt({}),o=t.vertices,a=t.colors,n=t.uv;return e.setAttribute("position",new _.BufferAttribute(o,3)),e.setAttribute("color",new _.BufferAttribute(a,3)),n&&e.setAttribute("uv",new _.BufferAttribute(n,2)),e.computeVertexNormals(),e}();return new _.Mesh(o,t)},ht=function(){function e(t){var o=this;Object(y.a)(this,e),this._root=t;var a=this._root,n=a.emitter,r=a.car,i=a.dispatcher,s=a.frameUpdater,c=a.studio,l=(a.player,a.system_PlayerMoveOnLevel);i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),i.dispatch({type:"ENABLE_CONTROL_SOUND"}),r.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),n.subscribe("checkNear")((function(e){console.log("checkNear",e),"nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),"nearPerson"===e.item&&console.log("checkNear nearPerson !!!!!!",e)}));var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Math.floor(t/e),n=Math.floor(o/e),r=a+"_"+n,i=Ie(a,n);return{checkChanged:function(t,o){var a=Math.floor(t/e),n=Math.floor(o/e),s=a+"_"+n;if(s===r)return!1;var c=r;r=s;var l=i;i=Ie(a,n);var u=Ne(i,l),h=Ne(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:r,currentEnv:i}}}}(h,r._model.position.x,r._model.position.z),m=u.getCurrent();this._changerLocations=pt(this._root),this._changerLevelTresh=mt(this._root),this._changerLevelTresh.createTresh(m.currentEnv),s.on((function(e){if(l.update(e),!r.isFreeze){r.update(e);var t=u.checkChanged(r._model.position.x,r._model.position.z);if(t&&(console.log("quadrants data",t),o._changerLevelTresh.updateTrash(t.removedQs,t.addedQs),p[t.oldKey]&&o._changerLocations.removeLocationFromScene(p[t.oldKey]),p[t.newKey])){var a=t.newKey.split("_"),n=+a[0]*h+h/2,i=+a[1]*h+h/2;o._changerLocations.addLocationToScene(p[t.newKey],n,i)}}c.drawFrame()})),this._startPlay()}return Object(g.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,o=e.system_PlayerMoveOnLevel,a=e.car;o.toggleFreeze(!0),a.toggleFreeze(!1),t.setCamera(a.getCamera())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,o=e.player,a=e.studio,n=e.car,r=n.getPosition(),i=n.getQuaternion();a.setCamera(o.getCamera()),n.toggleFreeze(!0),t.toggleFreeze(!1),o.setToPos(r.x,o.mesh.position.y,r.z),o.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key,o=null;for(var a in p)p[a]===t&&(o=a);if(o){var n=o.split("_"),r=+n[0]*h+h/2,i=+n[1]*h+h/2;this._root.car.setTargetPosition(new _.Vector3(r,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,o=e.ui,a=e.studio,n=e.car,r=e.system_Level,i=e.system_PlayerMoveOnLevel;e.system_PlayerNearLevelItems.setItemToCheck(n.getModel(),"nearStarterDrawCar",28),a.addToScene(n.getModel()),i.addItemToPlayerCollision(n.getCollision()),setTimeout((function(){var e=0,t=null;for(var o in p)0===e&&(t=o),++e;var a=t.split("_"),r=+a[0]*h+h/2,i=+a[1]*h+h/2;n.setTargetPosition(new _.Vector3(r,0,i))}),500),r._items.body.position.fromArray([-20,-60,-50]),r._items.body.rotation.fromArray([0,2,0]),a.addToScene(r._items.body),o.showStartButton((function(){t.toggleBlocked(!1)}))}}]),e}(),pt=function(e){var t=e.studio,o=e.car,a=e.system_Level,n=e.system_PlayerMoveOnLevel,r=e.system_PlayerNearLevelItems;setTimeout((function(){for(var e in p){var o=e.split("_"),n=+o[0]*h+h/2,r=+o[1]*h+h/2;a.locations[p[e]].mesh.position.set(n,0,r),t.addToScene(a.locations[p[e]].mesh)}}),500);return{removeLocationFromScene:function(e){var i=a.locations[e],s=i.mesh,c=i.carCollision,l=i.personCollision;n.removeItemFromPlayerCollision(s),t.removeFromScene(c),o.removeCollisionForDraw(c),t.removeFromScene(l),r.removeItemFromCheck(l)},addLocationToScene:function(e,i,s){var c=a.locations[e],l=c.mesh,u=c.carCollision,h=c.personOffset,p=c.personCollision;l.position.set(i,0,s),n.addItemToPlayerCollision(l),u.position.set(i,0,s),t.addToScene(u),o.setCollisionForDraw(u),p.position.set(h[0]+i,h[1],h[2]+s),t.addToScene(p),r.setItemToCheck(p,"nearPerson_"+e,28)}}},mt=function(e){var t=e.studio,o=e.car,a=e.system_PlayerMoveOnLevel,n=e.materials,r=[],i=ut(e);i.position.set(0,0,-40),t.addToScene(i);var s=new _.BoxGeometry(45,50,45),c=n.wallVirtual,l=new _.PlaneGeometry(h,h),u=function(n){for(var i=0;i<n.length;++i){var u=n[i].split("_"),p=+u[0]*h,m=+u[1]*h,d=new _.Mesh(l,c);d.rotation.x=-Math.PI/2,d.position.set(p,-62,m),t.addToScene(d),r.push({mesh:d,keyLocation:n[i],type:"floor"}),a.addItemToPlayerCollision(d);for(var b=Math.floor(3*Math.random()),f=0;f<b;++f){console.log("!!!!!!!!!!!!!!!!! new tresh");var v=ct(e);v.position.set(p+Math.random()*h,-60,m+Math.random()*h),t.addToScene(v),a.addItemToPlayerCollision(v);var O=new _.Mesh(s,c);O.visible=!1,O.position.copy(v.position),t.addToScene(O),o.setCollisionForDraw(O),r.push({mesh:v,meshCollision:O,keyLocation:n[i],type:"trash"})}}};return{updateTrash:function(e,n){!function(e){for(var n=[],i=0;i<e.length;++i)for(var s=0;s<r.length;++s)e[i]===r[s].keyLocation&&n.push(r[s]);r=r.filter((function(t){for(var o=0;o<e.length;++o)if(t.keyLocation===e[o])return!1;return!0}));for(var c=0;c<n.length;++c){var l=n[c],u=l.mesh,h=l.meshCollision;t.removeFromScene(u),a.removeItemFromPlayerCollision(u),h&&(t.removeFromScene(h),o.removeCollisionForDraw(h)),n[c].mesh.geometry.dispose(),delete n[c].mesh,delete n[c].meshCollision}}(e),u(n)},createTresh:function(e){u(e)}}},dt=(o(44),{ru:{"What is this place?":"\u0427\u0442\u043e \u044d\u0442\u043e \u0437\u0430 \u043c\u0435\u0441\u0442\u043e?","It's The Great Way to the surface.":"\u042d\u0442\u043e \u0432\u0435\u043b\u0438\u043a\u0438\u0439 \u043f\u0443\u0442\u044c \u043d\u0430\u0432\u0435\u0440\u0445.","Who are you?":"\u041a\u0442\u043e \u0442\u044b?","I help The Creator.":"\u042f \u043f\u043e\u043c\u043e\u0433\u0430\u044e \u0441\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044e.","What are you doing?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Don't distract me, I have to dig the tunnel.":"\u041d\u0435 \u043e\u0442\u0432\u043b\u0435\u043a\u0430\u0439, \u043c\u043d\u0435 \u043d\u0430\u0434\u043e \u043a\u043e\u043f\u0430\u0442\u044c \u0442\u0443\u043d\u043d\u0435\u043b\u044c.","Such enormous dungeons...":"\u0422\u0430\u043a\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0438\u0435 \u043f\u043e\u0434\u0437\u0435\u043c\u0435\u043b\u044c\u044f...","The Creator gave the order to dig.":"\u0421\u043e\u0437\u0434\u0430\u0442\u0435\u043b\u044c \u043f\u0440\u0438\u043a\u0430\u0437\u0430\u043b \u043a\u043e\u043f\u0430\u0442\u044c. ","How long have you been digging?":"\u041a\u0430\u043a \u0434\u043e\u043b\u0433\u043e \u0432\u044b \u043a\u043e\u043f\u0430\u043b\u0438? ","Time does not matter, the goal is what's important.":"\u0412\u0440\u0435\u043c\u044f \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u044f, \u0432\u0430\u0436\u043d\u0430 \u0446\u0435\u043b\u044c. ","What do you do here?":"\u0427\u0442\u043e \u0442\u044b \u0434\u0435\u043b\u0430\u0435\u0448\u044c?","Long ago, the Creator fell under the ground. He created us and gave us an assignment to dig.":"\u0414\u0430\u0432\u043d\u044b\u043c-\u0434\u0430\u0432\u043d\u043e \u0422\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0432\u0430\u043b\u0438\u043b\u0441\u044f \u043f\u043e\u0434 \u0437\u0435\u043c\u043b\u044e. \u041e\u043d \u0441\u043e\u0437\u0434\u0430\u043b \u043d\u0430\u0441 \u0438 \u0434\u0430\u043b \u0437\u0430\u0434\u0430\u043d\u0438\u0435 \u043a\u043e\u043f\u0430\u0442\u044c. ","But you already dug the way out...":"\u041d\u043e \u0432\u044b \u0443\u0436\u0435 \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u0432\u044b\u0445\u043e\u0434 ...","When we dug a tunnel, The Creator went through it.":"\u041a\u043e\u0433\u0434\u0430 \u043c\u044b \u043f\u0440\u043e\u0440\u044b\u043b\u0438 \u043f\u0443\u0442\u044c, \u0442\u0432\u043e\u0440\u0435\u0446 \u043f\u0440\u043e\u0448\u0435\u043b \u043f\u043e \u043d\u0435\u043c\u0443.","And...":"\u0418...","We are made to dig. And we keep on doing it. We believe that he will return to us.":"\u041c\u044b \u0441\u043e\u0437\u0434\u0430\u043d\u044b \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u043f\u0430\u0442\u044c. \u0418 \u043c\u044b \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u0435\u043c \u044d\u0442\u043e \u0434\u0435\u043b\u0430\u0442\u044c. \u041c\u044b \u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u043e\u043d \u0432\u0435\u0440\u043d\u0435\u0442\u0441\u044f \u043a \u043d\u0430\u043c. ","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),bt=E(dt),ft=Object(L.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(F.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(F.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:bt(t.q)},Math.floor(1e5*Math.random()))}))})})),vt=E(dt),Ot=Object(L.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(F.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(F.jsxs)("div",{children:[Object(F.jsx)("div",{className:"q",children:vt(e.q)}),Object(F.jsx)("div",{className:"a",children:vt(e.a)})]},Math.floor(1e5*Math.random()))}))})})),jt=E(dt);var yt=Object(L.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocation:e.ui.currentLocation,locationsList:e.ui.locationsList}}))((function(e){return Object(F.jsxs)(F.Fragment,{children:[(!e.isShowFinalMessage&&e.isButtonDialog||e.isShowPalleteDialog)&&Object(F.jsx)("div",{className:"dialog-wrapper",children:Object(F.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(F.jsxs)("div",{className:"messages-wrapper",children:[Object(F.jsx)(Ot,{}),Object(F.jsx)(ft,{})]}),e.isButtonDialog&&Object(F.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?jt("close dialog"):jt("open dialog")})]})}),e.isShowButtonDrawCar&&Object(F.jsx)("div",{className:"dialog-wrapper",children:Object(F.jsx)("div",{className:"dialog-content",children:Object(F.jsx)("button",{className:"draw-car-button",onClick:function(){return e.dispatch({type:"CLICK_DRAW"})},children:jt(e.valButtonDrawCar)})})}),e.isShowButtonToggleOpenLocationsList&&!e.isLocationListOpened&&Object(F.jsx)("button",{className:"open-locations-car-button",onClick:function(){return e.dispatch({type:"OPEN_LOCATIONS_LIST"})},children:e.currentLocation}),e.isLocationListOpened&&Object(F.jsx)("div",{className:"list-locations",children:Object(F.jsx)("div",{children:e.locationsList.map((function(t){return Object(F.jsxs)("button",{onClick:function(){return e.dispatch({type:"SELECT_LOCATION",location:t})},children:[t,e.currentLocation===t&&"___v"]},Math.floor(1e6*Math.random()))}))})}),e.isShowFinalMessage&&Object(F.jsx)("div",{className:"final-mess",children:jt("To be continued")})]})})),gt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"draw car",currentBot:null,phraseIndex:0,isDialogComplete:!1,isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocation:"location01",locationsList:["location01","location02","location03"]},_t=[{key:"emitter",constr:T,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(y.a)(this,e);var o=t.emitter,a=t.appWrapper;!a&&(a=document.querySelector(".app-wrapper")),o.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&n()}));var n=function(){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()},r=function(e){a.style.width=window.innerWidth+"px",a.style.height=window.innerHeight+"px",a.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||o.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",r),r()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:M,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:J,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(y.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return X.a()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:re,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:ie,initStateKey:"beforeStartPlay"},{key:"player",constr:se,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:Ae,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(y.a)(this,e);var o=t.assets,a=t.CONSTANTS;t.materials=ce(o,a.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"car",constr:ke,initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:xe,key:"car"},{type:"obj",path:Pe,key:"carCollision"}]},{key:"system_Level",constr:function e(t){Object(y.a)(this,e),this._root=t;var o=t.assets,a=t.materials,n=le(o,a).items;this._items=n,console.log("system_level_items",this._items),n.body.material=a.car,this._items.location_collision_01.visible=!1,this._items.location_collision_02.visible=!1,this._items.location_collision_03.visible=!1;var r=new _.Mesh(new _.BoxGeometry(15,15,15),new _.MeshBasicMaterial({color:16776960}));this._items.location01_person.geometry.computeBoundingSphere();var i=[this._items.location01_person.geometry.boundingSphere.center.x,this._items.location01_person.geometry.boundingSphere.center.y,this._items.location01_person.geometry.boundingSphere.center.z];this._items.location02_person.geometry.computeBoundingSphere();var s=[this._items.location02_person.geometry.boundingSphere.center.x,this._items.location02_person.geometry.boundingSphere.center.y,this._items.location02_person.geometry.boundingSphere.center.z];this._items.location03_person.geometry.computeBoundingSphere();var c=[this._items.location03_person.geometry.boundingSphere.center.x,this._items.location03_person.geometry.boundingSphere.center.y,this._items.location03_person.geometry.boundingSphere.center.z];this.locations={location01:{mesh:this._items.location01,carCollision:this._items.location_collision_01,personOffset:i,personCollision:r},location02:{mesh:this._items.location02,carCollision:this._items.location_collision_02,personOffset:s,personCollision:r},location03:{mesh:this._items.location03,carCollision:this._items.location_collision_03,personOffset:c,personCollision:r}}},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:ue,key:"level-rooms"},{type:"obj",path:De,key:"body"},{type:"cubeTextures",path:[be,fe,ve,Oe,je,ye],key:"skyBox"},{type:"cubeTextures",path:[ge,_e,we,Ce,Se,Me],key:"skyBox2"},{type:"img",path:he,key:"mapFloorOuter",wrap:!0},{type:"img",path:me,key:"mapTop",wrap:!0},{type:"img",path:pe,key:"mapVirtual",wrap:!0},{type:"img",path:de,key:"mapParams"}]},{key:"system_PlayerMoveOnLevel",constr:Le,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(y.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=yt,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gt,o=arguments.length>1?arguments[1]:void 0;if("OPEN_LOCATIONS_LIST"===o.type)return Object(I.a)(Object(I.a)({},t),{},{isLocationListOpened:!0});if("SELECT_LOCATION"===o.type)return e.actions.changeTargetLocation({key:o.location}),Object(I.a)(Object(I.a)({},t),{},{isLocationListOpened:!1,currentLocation:o.location});if("CLICK_PHRASE"===o.type)return Object(I.a)(Object(I.a)({},t),{},{botAnswers:[].concat(Object(Fe.a)(t.botAnswers),[o.phrase]),userReplicies:[]});if("PHRASE_EVENT"===o.type){var a=o.phrase,n=a.event;if(a.levelEvent,"nextReply"===n){var r=[t.phrasesData[t.currentBot][t.phraseIndex+1]];return Object(I.a)(Object(I.a)({},t),{},{phraseIndex:t.phraseIndex+1,userReplicies:r})}if("close"===n)return 20===t.currentBot&&setTimeout((function(){e.dispatcher.dispatch({type:"TOGGLE_BUTTON",isButtonDialog:!1}),e.dispatcher.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!1}),e.player.toggleBlocked(!0),setTimeout((function(){e.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),3e3)}),2e4),Object(I.a)(Object(I.a)({},t),{},{userReplicies:[],isDialogComplete:!0,isButtonDialog:!0})}if("TOGGLE_DIALOG"===o.type){var i=[];return e.player.toggleBlocked(o.isShowPalleteDialog),o.isShowPalleteDialog&&(i=t.isDialogComplete?[]:[t.phrasesData[t.currentBot][t.phraseIndex]]),Object(I.a)(Object(I.a)({},t),{},{isShowPalleteDialog:o.isShowPalleteDialog,userReplicies:i})}if("TOGGLE_BUTTON"===o.type){var s=t.botAnswers,c=t.phraseIndex,l=t.isDialogComplete;return o.currentBot&&o.currentBot!==t.currentBot&&(s=[],c=0,l=!1),Object(I.a)(Object(I.a)({},t),{},{phraseIndex:c,currentBot:o.currentBot||t.currentBot,isButtonDialog:o.isButtonDialog,isDialogComplete:l,botAnswers:s})}return"SHOW_FINAL_MESSAGE"===o.type?Object(I.a)(Object(I.a)({},t),{},{isShowFinalMessage:!0}):"TOGGLE_BUTTON_DRAW_CAR"===o.type?Object(I.a)(Object(I.a)({},t),{},{isShowButtonDrawCar:o.is}):"CLICK_DRAW"===o.type?"draw car"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(I.a)(Object(I.a)({},t),{},{valButtonDrawCar:"exit car"})):(e.actions.clickMachineExit(),Object(I.a)(Object(I.a)({},t),{},{valButtonDrawCar:"draw car"})):t}}}(t);var o=new Z(t);t.ui=o},initStateKey:"pageLoaded"},{key:"actions",constr:ht,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(_t,a)}))}},[[45,1,2]]]);
//# sourceMappingURL=main.07af7956.chunk.js.map