(this.webpackJsonplevels=this.webpackJsonplevels||[]).push([[0],{40:function(e,t,a){},42:function(e,t,a){},43:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var o={};a.r(o),a.d(o,"SIZE_QUADRANT",(function(){return p})),a.d(o,"LOCATIONS_QUADRANTS",(function(){return b})),a.d(o,"MATERIALS_CONFIG",(function(){return m})),a.d(o,"CONFIG_FOR_INIT",(function(){return d})),a.d(o,"lCol",(function(){return f})),a.d(o,"lW",(function(){return v})),a.d(o,"START_ENV_CONFIG",(function(){return O})),a.d(o,"ENV_CONFIG_WORD_1",(function(){return j})),a.d(o,"ENV_CONFIG_WORD_2",(function(){return y})),a.d(o,"studioConfig",(function(){return g})),a.d(o,"playerConfig",(function(){return C}));var r=a(11),n=a.n(r),i=a(12);function s(){return(s=Object(i.a)(n.a.mark((function e(t,a){var o,r,i;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("pageLoaded",t,o={CONSTANTS:a}),r=o.loaderAssets,i=l(t),e.next=6,r.loadAssets(i);case 6:o.assets=e.sent,c("beforeStartPlay",t,o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var c=function(e,t,a){for(var o=0;o<t.length;++o){var r=t[o],n=r.key,i=r.constr;r.initStateKey===e&&(a[n]=new i(a))}},l=function(e){for(var t=[],a=0;a<e.length;++a)if(e[a].assetsToLoad&&e[a].assetsToLoad.length)for(var o=0;o<e[a].assetsToLoad.length;++o)t.push(e[a].assetsToLoad[o]);return t},u=a(1),h={unit:{mat:"MeshPhongMaterial",props:{color:16777215,emissive:0,reflectivity:5,shininess:5,vertexColors:!0,flatShading:!1}},wallVirtual:{mat:"MeshStandardMaterial",props:{color:16711935,emissive:0}},wallVirtualColor:{mat:"MeshBasicMaterial",props:{color:16777215,emissive:4369,map:"mapParams",bumpMap:"mapParams",bumpScale:.1,specular:255,vertexColors:!0}},body:{mat:"MeshPhongMaterial",props:{color:11184895,emissive:0,map:"mapBody",bumpMap:"mapBody",bumpScale:.1,reflectivity:.005,shininess:.005,specular:16777215}},body_sh:{mat:"MeshPhongMaterial",props:{color:0,emissive:0,transparent:!0,alphaMap:"mapBodySh"}},floorMat1:{mat:"MeshPhongMaterial",props:{color:16742399,map:"mapTop",bumpMap:"mapTop",bumpScale:3,envMap:"skyBox2",reflectivity:.01,shininess:.01,specular:16777215}},floorMat:{mat:"MeshPhongMaterial",props:{color:65280,map:"mapVirtual2",bumpMap:"mapVirtual2",bumpScale:3}},testWhite:{mat:"MeshBasicMaterial",props:{color:16777045}},testRed:{mat:"MeshBasicMaterial",props:{color:16711680}},carNorm:{mat:"MeshStandardMaterial",props:{color:11141290}},carBattery:{mat:"MeshBasicMaterial",props:{color:11141120,transparent:!0}},testGreen:{mat:"MeshBasicMaterial",props:{color:43520}},testGreen1:{mat:"MeshBasicMaterial",props:{color:39168}},testBlack:{mat:"MeshBasicMaterial",props:{color:0,side:u.DoubleSide}}},p=5e3,b={"3_-3":"location01","-3_-3":"location02","3_3":"location03","100_1000":"locationToFinish"},m=h,d={isInCar:!1,currentSceneConfig:{isInVirtual:!1,isPlayerInCar:!1,carProps:{keyMesh:"car",keyCollide:"carCollision",position:[0,-50,-100],rotation:[0,2,0]},bodyProps:{keyMesh:"body",position:[-20,-60,-50],rotation:[0,2,0]}}},f=[.3,1,.3],v=.2,O={fogNear:0,fogFar:0,color:4852294,backgroundImgKey:null},j={fogNear:100,fogFar:1500,color:4852294,backgroundImgKey:"skyBox2"},y={fogNear:1500,fogFar:3e3,color:0,backgroundImgKey:"skyBox"},g={canId:"webgl-canvas",rendererCon:{antialias:!0},amb:{color:16777215,strength:1},sceneEnvironment:O,composerAddPass:"Saturate"},C={speed:.8,speedRot:.02,speedDown:-.45,offsetFromFloor:10,offsetFromFloorFactor:.5,offsetWallCollision:3.5,level:-13,startPos:[0,-45,400],cameraData:{fov:90,ratio:window.innerWidth/window.innerHeight,near:.1,far:1e4,pos:[0,2,-.5]},frontObjPos:[0,0,-1],backObjPos:[0,0,1]},_=a(2),w=a(3),M=a(21),S=a(22),T=function(){var e=null,t=null,a=null,o=null,r=null;return function(n,i){return new Promise((function(s){(function(n){return"obj"===n?e=e||new M.a:"glb"===n||"gltf"===n?a=a||new S.a:"img"===n?t=t||new u.TextureLoader:"cubeTextures"===n?o=o||new u.CubeTextureLoader:"soundMp3"===n?r=r||new u.AudioLoader:void 0})(i).load(n,s)}))}},x=function(){function e(){Object(_.a)(this,e),this.resources={},this._load=T()}return Object(w.a)(e,[{key:"loadAssets",value:function(e){var t=this;return new Promise((function(a){var o=t._load,r=t.resources;function s(e){return c.apply(this,arguments)}function c(){return(c=Object(i.a)(n.a.mark((function t(i){var c,l,u,h;return n.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e[i]){t.next=5;break}return c=e[i],l=c.key,u=c.path,h=c.type,t.next=4,o(u,h);case 4:r[l]=t.sent;case 5:if(++i,e[i]){t.next=10;break}a(r),t.next=12;break;case 10:return t.next=12,s(i);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}s(0)}))}}]),e}(),k=function(){function e(){Object(_.a)(this,e),this._storage={}}return Object(w.a)(e,[{key:"emit",value:function(e){var t=this;return function(a){return P(t._storage)(e).forEach((function(e){return e(a)}))}}},{key:"subscribe",value:function(e){var t=this;return function(a){return P(t._storage)(e).push(a),function(){return t._storage[e]=t._storage[e].filter((function(e){return e!==a}))}}}},{key:"showAll",value:function(){var e={};for(var t in this._storage)e[t]=this._storage[t].length;console.log(e)}}]),e}(),P=function(e){return function(t){return e[t]=e[t]||[]}},I=a(4),A=a(46),D=function(){function e(){var t=this;Object(_.a)(this,e),this._subscribers=[];var a={time:0,delta:0,count:0,oldTime:0},o=A.a((function(){return a}),(function(e){return e.time=Date.now(),e}),(function(e){return e.delta=.001*(e.time-e.oldTime),(isNaN(e.delta)||e.delta>1e3||0===e.delta)&&(e.delta=1e3/60*.001),e}),(function(e){return e.count=e.delta/(1/60),e}),(function(e){for(var a=0;a<t._subscribers.length;++a)t._subscribers[a](Object(I.a)({},e));return e}),(function(e){return e.oldTime=e.time,e}),(function(e){return a=e}));!function e(){requestAnimationFrame(e),o(a)}()}return Object(w.a)(e,[{key:"on",value:function(e){var t=this;return this._subscribers.push(e),function(){t._subscribers=t._subscribers.filter((function(t){return t!==e}))}}}]),e}(),F=a(14),L=a(27),E=a(24),N=a(15),B={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel * texel * texel) * vec4(3.);\n}"},R={uniforms:{tDiffuse:{value:null}},vertexShader:"\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix*modelViewMatrix*vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\n  vec4 texel = texture2D( tDiffuse, vUv );\n  gl_FragColor = (texel + texel * 1.5) * vec4(0.5);\n}"},G=a(23),W=function(){function e(t){var a=this;Object(_.a)(this,e),this._root=t;var o=t.assets,r=t.emitter,n=t.CONSTANTS.studioConfig,i=n.canId,s=n.rendererCon,c=(n.clearColor,n.amb);s.canvas=document.getElementById(i),this._renderer=new u.WebGLRenderer(s),this._renderer.setClearColor(0),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(window.innerWidth,window.innerHeight),this._scene=new u.Scene;var l=t.CONSTANTS.studioConfig.sceneEnvironment,h=l.color,p=l.fogNear,b=l.fogFar,m=l.backgroundImgKey;this._scene.background=o[m]||null,this._scene.fog=new u.Fog(h,p,b);c.color,c.strength;this._lightA=new u.AmbientLight(16777215,.2),this._scene.add(this._lightA);var d=new u.DirectionalLight(16777215,.6);d.position.set(1,1,.5),this._scene.add(d);var f=new u.DirectionalLight(16777215,.4);f.position.set(-1,-.1,-.4),this._scene.add(f),this._playerCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera=new u.PerspectiveCamera(90,window.innerWidth/window.innerHeight,.1,5e3),this._controlsCamera.position.set(0,0,20);var v=new G.a(this._controlsCamera,this._renderer.domElement);v.target.set(0,0,0),v.update(),this._composer=new L.a(this._renderer),this._renderPass=new E.a(this._scene,this._controlsCamera),this._composer.addPass(this._renderPass),this._root.CONSTANTS.studioConfig.composerAddPass&&("Saturate"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new N.a(B)),"Saturate2"===this._root.CONSTANTS.studioConfig.composerAddPass&&this._composer.addPass(new N.a(R)));var O=new u.Vector3,j=!0;r.subscribe("keyEvent")((function(e){e.o&&(j?(j=!1,a._renderPass.camera=a._controlsCamera,a._playerCamera.getWorldPosition(O),a._controlsCamera.position.x=O.x+100,a._controlsCamera.position.y=O.y+100,a._controlsCamera.position.z=O.z,v.target.set(O.x,O.y,O.z),v.update()):(j=!0,a._renderPass.camera=a._playerCamera))}));var y=function(){var e={width:window.innerWidth,height:window.innerHeight};a._renderer.setSize(e.width,e.height),a._composer.setSize(e.width,e.height),a._controlsCamera&&(a._controlsCamera.aspect=e.width/e.height,a._controlsCamera.updateProjectionMatrix()),a._playerCamera&&(a._playerCamera.aspect=e.width/e.height,a._playerCamera.updateProjectionMatrix())};window.addEventListener("resize",y),y(),this.addToScene=function(e){return a._scene.add(e)},this.removeFromScene=function(e){return a._scene.remove(e)},this.drawFrame=function(){a._composer.render(a._scene,a._controlsCamera)},r.subscribe("changeSceneEnvironment")((function(e){console.log("deprecated!!","studio","changeSceneEnvironment",e)}))}return Object(w.a)(e,[{key:"setCamera",value:function(e){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),this._playerCamera=e,this._renderPass.camera=this._playerCamera}},{key:"changeEnvironment",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._changeFog(e,t),this._changeBackground(e,t)}},{key:"_changeFog",value:function(e,t){var a=this,o=e.fogNear,r=e.fogFar,n=e.color;if(this._scene.fog.near!==o||this._scene.fog.far!==r||this._scene.fog.color!==r){var i={color:this._scene.fog.color,near:this._scene.fog.near,far:this._scene.fog.far},s={color:new u.Color(n),near:o,far:r};new F.a(i).to(s,t&&t.time||3e3).onUpdate((function(){a._scene.fog.color=i.color,a._scene.fog.near=i.near,a._scene.fog.far=i.far,a._renderer.setClearColor(i.color)})).start()}}},{key:"_changeBackground",value:function(e){var t=e.backgroundImgKey;t!==this._backgroundImgKey&&(this._backgroundImgKey=t,this._scene.background=this._root.assets[t]||null)}}]),e}(),z=function(){function e(t){Object(_.a)(this,e);var a=t.emitter,o={up:!1,down:!1,left:!1,right:!1,p:!1},r={up:!0,down:!0,left:!0,right:!0};this.keysEnabled=r,this.keys=o;var n=function(e,t){switch(e){case 38:case 87:r.up&&(o.up=t);break;case 40:case 83:r.down&&(o.down=t);break;case 37:case 65:o.left=t;break;case 39:case 68:o.right=t;break;case 79:o.o=t;break;case 80:o.p=t}a.emit("keyEvent")(o)};document.addEventListener("keydown",(function(e){return n(e.keyCode,!0)})),document.addEventListener("keyup",(function(e){return n(e.keyCode,!1)})),a.subscribe("mouseDown")((function(e){"butt-left"===e&&n(37,!0),"butt-right"===e&&n(39,!0),"butt-front"===e&&n(38,!0),"butt-back"===e&&n(40,!0)})),a.subscribe("mouseUp")((function(e){"butt-left"===e&&n(37,!1),"butt-right"===e&&n(39,!1),"butt-front"===e&&n(38,!1),"butt-back"===e&&n(40,!1)}))}return Object(w.a)(e,[{key:"toggleEnableKeys",value:function(e,t){this.keysEnabled[e]=t,!t&&(this.keys[e]=!1)}}]),e}(),U=function(){function e(t){Object(_.a)(this,e);var a=t.studio,o=t.CONSTANTS.playerConfig,r=(o.startPos,o.startRot,o.cameraData),n=(o.frontObjPos,o.backObjPos,o.lightDataOne);this._camera=null,this.isBlocked=!0,this.isFreeze=!0,this.mesh=new u.Object3D,this.mesh.rotation.fromArray([0,0,0]),this.mesh.userData.type="player",this.bottomObj=new u.Object3D,this.bottomObj.position.fromArray([0,-.02,0]),this.mesh.add(this.bottomObj),this.frontObj=new u.Object3D,this.frontObj.position.fromArray([0,0,-.02]),this.mesh.add(this.frontObj),this.backObj=new u.Object3D,this.backObj.position.fromArray([0,0,.02]),this.mesh.add(this.backObj);var i=r.fov,s=r.ratio,c=r.near,l=r.far;r.pos;if(this._camera=new u.PerspectiveCamera(i,s,c,l),this._camera.position.fromArray([0,0,-2]),this.mesh.add(this._camera),n){var h=n.color,p=n.strenth,b=n.pos,m=new u.PointLight(h,p);m.position.fromArray(b),this.mesh.add(m)}a.setCamera(this._camera),a.addToScene(this.mesh)}return Object(w.a)(e,[{key:"toggleFeeze",value:function(e){this.isFeeze=e}},{key:"toggleCanMove",value:function(e,t){}},{key:"getObj",value:function(){return this.mesh}},{key:"getCamera",value:function(){return this._camera}},{key:"setToPos",value:function(e,t,a){this.mesh.position.set(e,t,a)}}]),e}(),K=function(e,t){for(var a in e)e[a].wrapS&&(e[a].wrapS=e[a].wrapT=u.RepeatWrapping);var o=["bumpMap","envMap","map","normalMap","lightMap","aoMap","alphaMap"],r={},n=function(a){r[a]=new u[t[a].mat](Object(I.a)({},t[a].props)),o.map((function(o){return t[a].props[o]&&(r[a][o]=e[t[a].props[o]])}))};for(var i in t)n(i);return r},V=function(e,t){var a={};return e["level-rooms"].traverse((function(e){e.geometry&&(a[e.name]=e,e.material=t.wallVirtual)})),a},q=a.p+"static/media/level.0d2a124d.obj",H=a.p+"static/media/floor_outer_map3.558e9646.jpg",Q=a.p+"static/media/map02.10921dbe.jpg",Y=a.p+"static/media/floor_outer_map.bb8fd979.jpg",Z=a.p+"static/media/txt1.b67888d5.jpg",X=a.p+"static/media/botMap.55359807.png",J=a.p+"static/media/body_sh_map.379841cc.jpg",$=(a.p,a.p+"static/media/nx.a038c501.jpg"),ee=(a.p,a.p,a.p,a.p,a.p+"static/media/px.96d0b65f.jpg"),te=a.p+"static/media/nx.8cbf039d.jpg",ae=a.p+"static/media/py.659ebc34.jpg",oe=a.p+"static/media/ny.09051a4e.jpg",re=a.p+"static/media/pz.a1539724.jpg",ne=a.p+"static/media/nz.0bc769f7.jpg",ie=a(10),se=function(){function e(){Object(_.a)(this,e),this._arrMeshes=[],this._vecStart=new u.Vector3,this._vecDir=new u.Vector3,this._rayCaster=new u.Raycaster(this._vecStart,this._vecDir)}return Object(w.a)(e,[{key:"setItemToCollision",value:function(e){for(var t=0;t<this._arrMeshes.length;++t)if(this._arrMeshes[t]===e)return;this._arrMeshes.push(e)}},{key:"removeItemFromCollision",value:function(e){this._arrMeshes=this._arrMeshes.filter((function(t){return t!==e}))}},{key:"checkCollisions",value:function(e,t,a){e.getWorldPosition(this._vecStart),t.getWorldPosition(this._vecDir),this._vecDir.sub(this._vecStart);var o=this._rayCaster.intersectObjects(this._arrMeshes);return o[0]&&o[0].distance<a?[!0,o[0]]:[!1,null]}}]),e}(),ce=function(){function e(t){var a=this;Object(_.a)(this,e);var o=t.assets,r=t.emitter,n=t.materials;this._root=t,this._model=o["level-rooms"].children.filter((function(e){return"CAR_102G"===e.name}))[0],this._model.material=n.carNorm;var i=o["level-rooms"].children.filter((function(e){return"CAR_102"===e.name}))[0];i.material=n.testBlack,this._model.add(i),this._phase=0,this._battery=o["level-rooms"].children.filter((function(e){return"battary"===e.name}))[0],this._battery.material=n.carBattery,this._battery.material.opacity=0,this._model.add(this._battery),this._camera=new u.PerspectiveCamera(80,window.innerWidth/window.innerHeight,.5,1e5),this._camera.position.y=15,this._model.add(this._camera),this._collision=o["level-rooms"].children.filter((function(e){return"CAR_104"===e.name}))[0],this._collision.visible=!1,this._model.add(this._collision),this._frontObj=new u.Object3D,this._frontObj.position.set(0,0,-.5),this._model.add(this._frontObj),this._backObj=new u.Object3D,this._backObj.position.set(0,0,.5),this._model.add(this._backObj),this._compass=null,setTimeout((function(){a._compass=function(e){e.assets;var t=e.studio,a=e.system_Assets.items.arrow;a.material=e.materials.carNorm;var o=new u.Object3D;o.position.set(-500,-30,-500),t.addToScene(o);var r=new u.Mesh(new u.BoxGeometry(10,10,10),new u.MeshBasicMaterial({color:16711680}));return r.position.set(0,0,0),t.addToScene(o),new u.Vector3,{addToParent:function(e){e.add(a)},setArrowPosition:function(e,t,o){a.position.set(e,t,o)},setTargetPosition:function(e){o.position.copy(e)},update:function(){r.position.copy(a.parent.position),r.lookAt(o.position),a.parent.position.z<o.position.z?a.rotation.y=-a.parent.rotation.y+r.rotation.y:a.rotation.y=-a.parent.rotation.y-r.rotation.y+Math.PI},changeColor:function(t){"normal"===t&&(a.material=e.materials.carNorm),"green"===t&&(a.material=e.materials.testGreen1)}}}(t),a._compass.addToParent(a._model),a._compass.setArrowPosition(0,4.3,-26),a.setTargetPosition=function(e){a._compass.setTargetPosition(e),a._compass.update()}})),this._collisionsWalls=new se;var s=function(e,t){var o=a._collisionsWalls.checkCollisions(a._model,e,t);return Object(ie.a)(o,1)[0]};this.isFreeze=!0;var c={};this._onChangeStateIsStay=function(){},this._spd=0,this._acc=.1,this._deceleration=.02,this._maxSpdFront=-10,this._maxSpdBack=10,this._spdRot=.03,this._isCarStay=!1,this.update=function(e){if(!a.isFreeze){if(a._spd<0&&(s(a._frontObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),a._spd>0&&(s(a._backObj,30)?a._spd=0:(a._model.translateZ(a._spd*e.count),a._compass.update())),c.up&&(a._spd-=a._acc),c.down&&(a._spd+=a._acc),Math.abs(a._spd)>.001){a._spd>0&&(a._spd-=a._deceleration,a._spd<0&&(a._spd=0)),a._spd<0&&(a._spd+=a._deceleration,a._spd>0&&(a._spd=0)),a._spd=Math.min(a._maxSpdBack,Math.max(a._maxSpdFront,a._spd));var t=Math.min(1,Math.max(0,Math.abs(a._spd)));c.left&&(a._spd<0&&(a._model.rotation.y+=a._spdRot*t),a._spd>0&&(a._model.rotation.y-=a._spdRot*t)),c.right&&(a._spd<0&&(a._model.rotation.y-=a._spdRot*t),a._spd>0&&(a._model.rotation.y+=a._spdRot*t))}else a._spd=0;a._isCarStay&&0!==a._spd&&(a._isCarStay=!1,a._onChangeStateIsStay("carStart")),a._isCarStay||0!==a._spd||(a._isCarStay=!0,a._onChangeStateIsStay("carStop"))}},r.subscribe("keyEvent")((function(e){return c=e}))}return Object(w.a)(e,[{key:"setCollisionForDraw",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeCollisionForDraw",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"getModel",value:function(){return this._model}},{key:"getCollision",value:function(){return this._collision}},{key:"getCamera",value:function(){return this._camera}},{key:"toggleFreeze",value:function(e){console.log("freeze"),this.isFreeze=e}},{key:"onChangeCarStateMove",value:function(e){this._onChangeStateIsStay=e}},{key:"getPosition",value:function(){return this._model.position}},{key:"getQuaternion",value:function(){return this._model.quaternion}},{key:"subscribeOnMove",value:function(){}},{key:"toggleMat",value:function(e){var t=this._root.materials;"green"===e&&(this._compass.changeColor("green"),this._model.material=t.testGreen1),"red"===e&&(this._compass.changeColor("normal"),this._model.material=t.carNorm)}},{key:"updateBattary",value:function(){this._phase+=.05,this._battery.material.opacity=Math.sin(this._phase)+1}},{key:"batteryLight",value:function(){this._battery.material.opacity=0}}]),e}(),le=function(){function e(t){var a=this;Object(_.a)(this,e);var o=t.emitter,r=t.CONSTANTS,n=t.player;t.assets,t.studio;n.mesh.position.fromArray([0,0,0]);var i=new se,s=r.playerConfig,c=s.speed,l=s.speedDown,u=s.speedRot,h=!0;n.toggleBlocked=function(e){return h=e},this.isCanMove={forward:!0,back:!0},n.toggleCanMove=function(e,t){return a.isCanMove[e]=t},this.isFreeze=!1;var p={};this.update=function(e){a.isFreeze||(p.left&&n.mesh.rotateY(u*e.count),p.right&&n.mesh.rotateY(-u*e.count),h||(!function(e){var t=i.checkCollisions(n.mesh,n.bottomObj,17.2),a=Object(ie.a)(t,2),o=a[0],r=a[1];o&&17>r.distance?n.mesh.translateY(17-r.distance):o||(n.mesh.position.y+=l*e.count)}(e),p.up&&a.isCanMove.forward&&function(e){var t=i.checkCollisions(n.mesh,n.frontObj,17),a=Object(ie.a)(t,2),r=a[0],s=a[1];r?s.object.userData.type&&"alert"===s.object.userData.type&&o.emit("collision")(s.object.userData.event):(n.mesh.translateZ(-c*e.count),o.emit("playerMove")("forward"))}(e),p.down&&a.isCanMove.back&&function(e){var t=i.checkCollisions(n.mesh,n.backObj,17);Object(ie.a)(t,1)[0]||(n.mesh.translateZ(c*e.count),o.emit("playerMove")("back"))}(e),p.p&&console.log("player.mesh.position.fromArray([".concat(n.mesh.position.x,", ").concat(n.mesh.position.y,", ").concat(n.mesh.position.z,"])"))))},o.subscribe("keyEvent")((function(e){return p=e})),this._collisionsWalls=i}return Object(w.a)(e,[{key:"addItemToPlayerCollision",value:function(e){this._collisionsWalls.setItemToCollision(e)}},{key:"removeItemFromPlayerCollision",value:function(e){this._collisionsWalls.removeItemFromCollision(e)}},{key:"toggleFreeze",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.isFreeze;this.isFreeze=e}}]),e}(),ue=function(){function e(t){var a=this;Object(_.a)(this,e),this._root=t;var o=t.emitter,r=t.player;this._itemsToCheck=[],o.subscribe("playerMove")((function(){for(var e=0;e<a._itemsToCheck.length;++e){var t=r.mesh.position.distanceTo(a._itemsToCheck[e].position);if(!a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t<a._itemsToCheck[e].userData.nearPlayerItemNear)return a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!0,void o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!0});a._itemsToCheck[e].userData.nearPlayerIsNearPlayer&&t>a._itemsToCheck[e].userData.nearPlayerItemNear&&(a._itemsToCheck[e].userData.nearPlayerIsNearPlayer=!1,o.emit("checkNear")({item:a._itemsToCheck[e].userData.nearPlayerItemKey,is:!1}))}}))}return Object(w.a)(e,[{key:"setItemToCheck",value:function(e,t,a,o){for(var r=0;r<this._itemsToCheck.length;++r)if(e===this._itemsToCheck[r])return;t&&(e.userData.nearPlayerItemKey=t),a&&(e.userData.nearPlayerItemNear=a),o&&(e.userData.nearPlayerItemFar=o),e.userData.nearPlayerIsNearPlayer=!1,this._itemsToCheck.push(e)}},{key:"removeItemFromCheck",value:function(e){this._itemsToCheck=this._itemsToCheck.filter((function(t){return t!==e}))}}]),e}(),he=a(0),pe=function(e,t){for(var a=[],o=e-1;o<e+2;++o)for(var r=t-1;r<t+2;++r)a.push(o+"_"+r);return a},be=function(e,t){for(var a=[],o=0;o<e.length;++o){for(var r=!1,n=0;n<t.length;++n)e[o]===t[n]&&(r=!0);r||a.push(e[o])}return a},me=Float32Array;function de(e,t,a){return(a=a||new me(3))[0]=e[0]-t[0],a[1]=e[1]-t[1],a[2]=e[2]-t[2],a}function fe(e,t){t=t||new me(3);var a=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return a>1e-5&&(t[0]=e[0]/a,t[1]=e[1]/a,t[2]=e[2]/a),t}function ve(e,t,a){return(a=a||new me(3))[0]=e[1]*t[2]-e[2]*t[1],a[1]=e[2]*t[0]-e[0]*t[2],a[2]=e[0]*t[1]-e[1]*t[0],a}function Oe(e,t){var a=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return a*a+o*o+r*r}function je(e,t){t=t||new me(16);var a=e[0],o=e[1],r=e[2],n=e[3],i=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],p=e[10],b=e[11],m=e[12],d=e[13],f=e[14],v=e[15],O=p*v,j=f*b,y=c*v,g=f*l,C=c*b,_=p*l,w=r*v,M=f*n,S=r*b,T=p*n,x=r*l,k=c*n,P=u*d,I=m*h,A=i*d,D=m*s,F=i*h,L=u*s,E=a*d,N=m*o,B=a*h,R=u*o,G=a*s,W=i*o,z=O*s+g*h+C*d-(j*s+y*h+_*d),U=j*o+w*h+T*d-(O*o+M*h+S*d),K=y*o+M*s+x*d-(g*o+w*s+k*d),V=_*o+S*s+k*h-(C*o+T*s+x*h),q=1/(a*z+i*U+u*K+m*V);return t[0]=q*z,t[1]=q*U,t[2]=q*K,t[3]=q*V,t[4]=q*(j*i+y*u+_*m-(O*i+g*u+C*m)),t[5]=q*(O*a+M*u+S*m-(j*a+w*u+T*m)),t[6]=q*(g*a+w*i+k*m-(y*a+M*i+x*m)),t[7]=q*(C*a+T*i+x*u-(_*a+S*i+k*u)),t[8]=q*(P*l+D*b+F*v-(I*l+A*b+L*v)),t[9]=q*(I*n+E*b+R*v-(P*n+N*b+B*v)),t[10]=q*(A*n+N*l+G*v-(D*n+E*l+W*v)),t[11]=q*(L*n+B*l+W*b-(F*n+R*l+G*b)),t[12]=q*(A*p+L*f+I*c-(F*f+P*c+D*p)),t[13]=q*(B*f+P*r+N*p-(E*p+R*f+I*r)),t[14]=q*(E*c+W*f+D*r-(G*f+A*r+N*c)),t[15]=q*(G*p+F*r+R*c-(B*c+W*p+L*r)),t}var ye={copy:function(e,t){return(t=t||new me(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},lookAt:function(e,t,a,o){o=o||new me(16);var r=fe(de(e,t)),n=fe(ve(a,r)),i=fe(ve(r,n));return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=0,o[4]=i[0],o[5]=i[1],o[6]=i[2],o[7]=0,o[8]=r[0],o[9]=r[1],o[10]=r[2],o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},addVectors:function(e,t,a){return(a=a||new me(3))[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a},subtractVectors:de,scaleVector:function(e,t,a){return(a=a||new me(3))[0]=e[0]*t,a[1]=e[1]*t,a[2]=e[2]*t,a},distance:function(e,t){return Math.sqrt(Oe(e,t))},distanceSq:Oe,normalize:fe,compose:function(e,t,a,o){o=o||new me(16);var r=t[0],n=t[1],i=t[2],s=t[3],c=r+r,l=n+n,u=i+i,h=r*c,p=r*l,b=r*u,m=n*l,d=n*u,f=i*u,v=s*c,O=s*l,j=s*u,y=a[0],g=a[1],C=a[2];return o[0]=(1-(m+f))*y,o[1]=(p+j)*y,o[2]=(b-O)*y,o[3]=0,o[4]=(p-j)*g,o[5]=(1-(h+f))*g,o[6]=(d+v)*g,o[7]=0,o[8]=(b+O)*C,o[9]=(d-v)*C,o[10]=(1-(h+m))*C,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o},cross:ve,decompose:function(e,t,a,o){var r=ye.length(e.slice(0,3)),n=ye.length(e.slice(4,7)),i=ye.length(e.slice(8,11));(function(e){var t=e[0],a=e[1],o=e[2],r=e[3],n=e[4],i=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],p=e[11],b=e[12],m=e[13],d=e[14],f=e[15],v=h*f,O=d*p,j=s*f,y=d*c,g=s*p,C=h*c,_=o*f,w=d*r,M=o*p,S=h*r,T=o*c,x=s*r;return 1/(t*(v*i+y*u+g*m-(O*i+j*u+C*m))+n*(O*a+_*u+S*m-(v*a+w*u+M*m))+l*(j*a+w*i+T*m-(y*a+_*i+x*m))+b*(C*a+M*i+x*u-(g*a+S*i+T*u)))})(e)<0&&(r=-r),t[0]=e[12],t[1]=e[13],t[2]=e[14];var s=ye.copy(e),c=1/r,l=1/n,u=1/i;s[0]*=c,s[1]*=c,s[2]*=c,s[4]*=l,s[5]*=l,s[6]*=l,s[8]*=u,s[9]*=u,s[10]*=u,function(e,t){var a=e[0],o=e[4],r=e[8],n=e[1],i=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=a+i+u;if(h>0){var p=.5/Math.sqrt(h+1);t[3]=.25/p,t[0]=(l-s)*p,t[1]=(r-c)*p,t[2]=(n-o)*p}else if(a>i&&a>u){var b=2*Math.sqrt(1+a-i-u);t[3]=(l-s)/b,t[0]=.25*b,t[1]=(o+n)/b,t[2]=(r+c)/b}else if(i>u){var m=2*Math.sqrt(1+i-a-u);t[3]=(r-c)/m,t[0]=(o+n)/m,t[1]=.25*m,t[2]=(s+l)/m}else{var d=2*Math.sqrt(1+u-a-i);t[3]=(n-o)/d,t[0]=(r+c)/d,t[1]=(s+l)/d,t[2]=.25*d}}(s,a),o[0]=r,o[1]=n,o[2]=i},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},identity:function(e){return(e=e||new me(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){return(t=t||new me(16))[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},length:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},lengthSq:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},orthographic:function(e,t,a,o,r,n,i){return(i=i||new me(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(o-a),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(r-n),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(a+o)/(a-o),i[14]=(r+n)/(r-n),i[15]=1,i},frustum:function(e,t,a,o,r,n,i){var s=t-e,c=o-a,l=n-r;return(i=i||new me(16))[0]=2*r/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*r/c,i[6]=0,i[7]=0,i[8]=(e+t)/s,i[9]=(o+a)/c,i[10]=-(n+r)/l,i[11]=-1,i[12]=0,i[13]=0,i[14]=-2*r*n/l,i[15]=0,i},perspective:function(e,t,a,o,r){r=r||new me(16);var n=Math.tan(.5*Math.PI-.5*e),i=1/(a-o);return r[0]=n/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=(a+o)*i,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*o*i*2,r[15]=0,r},translation:function(e,t,a,o){return(o=o||new me(16))[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=e,o[13]=t,o[14]=a,o[15]=1,o},translate:function(e,t,a,o,r){r=r||new me(16);var n=e[0],i=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],p=e[7],b=e[8],m=e[9],d=e[10],f=e[11],v=e[12],O=e[13],j=e[14],y=e[15];return e!==r&&(r[0]=n,r[1]=i,r[2]=s,r[3]=c,r[4]=l,r[5]=u,r[6]=h,r[7]=p,r[8]=b,r[9]=m,r[10]=d,r[11]=f),r[12]=n*t+l*a+b*o+v,r[13]=i*t+u*a+m*o+O,r[14]=s*t+h*a+d*o+j,r[15]=c*t+p*a+f*o+y,r},xRotation:function(e,t){t=t||new me(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=o,t[7]=0,t[8]=0,t[9]=-o,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},yRotation:function(e,t){t=t||new me(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=0,t[2]=-o,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=o,t[9]=0,t[10]=a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},zRotation:function(e,t){t=t||new me(16);var a=Math.cos(e),o=Math.sin(e);return t[0]=a,t[1]=o,t[2]=0,t[3]=0,t[4]=-o,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xRotate:function(e,t,a){a=a||new me(16);var o=e[4],r=e[5],n=e[6],i=e[7],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[4]=h*o+p*s,a[5]=h*r+p*c,a[6]=h*n+p*l,a[7]=h*i+p*u,a[8]=h*s-p*o,a[9]=h*c-p*r,a[10]=h*l-p*n,a[11]=h*u-p*i,e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},yRotate:function(e,t,a){a=a||new me(16);var o=e[0],r=e[1],n=e[2],i=e[3],s=e[8],c=e[9],l=e[10],u=e[11],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o-p*s,a[1]=h*r-p*c,a[2]=h*n-p*l,a[3]=h*i-p*u,a[8]=h*s+p*o,a[9]=h*c+p*r,a[10]=h*l+p*n,a[11]=h*u+p*i,e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},zRotate:function(e,t,a){a=a||new me(16);var o=e[0],r=e[1],n=e[2],i=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=Math.cos(t),p=Math.sin(t);return a[0]=h*o+p*s,a[1]=h*r+p*c,a[2]=h*n+p*l,a[3]=h*i+p*u,a[4]=h*s-p*o,a[5]=h*c-p*r,a[6]=h*l-p*n,a[7]=h*u-p*i,e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a},axisRotation:function(e,t,a){a=a||new me(16);var o=e[0],r=e[1],n=e[2],i=Math.sqrt(o*o+r*r+n*n),s=(o/=i)*o,c=(r/=i)*r,l=(n/=i)*n,u=Math.cos(t),h=Math.sin(t),p=1-u;return a[0]=s+(1-s)*u,a[1]=o*r*p+n*h,a[2]=o*n*p-r*h,a[3]=0,a[4]=o*r*p-n*h,a[5]=c+(1-c)*u,a[6]=r*n*p+o*h,a[7]=0,a[8]=o*n*p+r*h,a[9]=r*n*p-o*h,a[10]=l+(1-l)*u,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},axisRotate:function(e,t,a,o){o=o||new me(16);var r=t[0],n=t[1],i=t[2],s=Math.sqrt(r*r+n*n+i*i),c=(r/=s)*r,l=(n/=s)*n,u=(i/=s)*i,h=Math.cos(a),p=Math.sin(a),b=1-h,m=c+(1-c)*h,d=r*n*b+i*p,f=r*i*b-n*p,v=r*n*b-i*p,O=l+(1-l)*h,j=n*i*b+r*p,y=r*i*b+n*p,g=n*i*b-r*p,C=u+(1-u)*h,_=e[0],w=e[1],M=e[2],S=e[3],T=e[4],x=e[5],k=e[6],P=e[7],I=e[8],A=e[9],D=e[10],F=e[11];return o[0]=m*_+d*T+f*I,o[1]=m*w+d*x+f*A,o[2]=m*M+d*k+f*D,o[3]=m*S+d*P+f*F,o[4]=v*_+O*T+j*I,o[5]=v*w+O*x+j*A,o[6]=v*M+O*k+j*D,o[7]=v*S+O*P+j*F,o[8]=y*_+g*T+C*I,o[9]=y*w+g*x+C*A,o[10]=y*M+g*k+C*D,o[11]=y*S+g*P+C*F,e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o},scaling:function(e,t,a,o){return(o=o||new me(16))[0]=e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=t,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=a,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},scale:function(e,t,a,o,r){return(r=r||new me(16))[0]=t*e[0],r[1]=t*e[1],r[2]=t*e[2],r[3]=t*e[3],r[4]=a*e[4],r[5]=a*e[5],r[6]=a*e[6],r[7]=a*e[7],r[8]=o*e[8],r[9]=o*e[9],r[10]=o*e[10],r[11]=o*e[11],e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},multiply:function(e,t,a){a=a||new me(16);var o=t[0],r=t[1],n=t[2],i=t[3],s=t[4],c=t[5],l=t[6],u=t[7],h=t[8],p=t[9],b=t[10],m=t[11],d=t[12],f=t[13],v=t[14],O=t[15],j=e[0],y=e[1],g=e[2],C=e[3],_=e[4],w=e[5],M=e[6],S=e[7],T=e[8],x=e[9],k=e[10],P=e[11],I=e[12],A=e[13],D=e[14],F=e[15];return a[0]=o*j+r*_+n*T+i*I,a[1]=o*y+r*w+n*x+i*A,a[2]=o*g+r*M+n*k+i*D,a[3]=o*C+r*S+n*P+i*F,a[4]=s*j+c*_+l*T+u*I,a[5]=s*y+c*w+l*x+u*A,a[6]=s*g+c*M+l*k+u*D,a[7]=s*C+c*S+l*P+u*F,a[8]=h*j+p*_+b*T+m*I,a[9]=h*y+p*w+b*x+m*A,a[10]=h*g+p*M+b*k+m*D,a[11]=h*C+p*S+b*P+m*F,a[12]=d*j+f*_+v*T+O*I,a[13]=d*y+f*w+v*x+O*A,a[14]=d*g+f*M+v*k+O*D,a[15]=d*C+f*S+v*P+O*F,a},inverse:je,transformVector:function(e,t,a){a=a||new me(4);for(var o=0;o<4;++o){a[o]=0;for(var r=0;r<4;++r)a[o]+=t[r]*e[4*r+o]}return a},transformPoint:function(e,t,a){a=a||new me(3);var o=t[0],r=t[1],n=t[2],i=o*e[3]+r*e[7]+n*e[11]+e[15];return a[0]=(o*e[0]+r*e[4]+n*e[8]+e[12])/i,a[1]=(o*e[1]+r*e[5]+n*e[9]+e[13])/i,a[2]=(o*e[2]+r*e[6]+n*e[10]+e[14])/i,a},transformDirection:function(e,t,a){a=a||new me(3);var o=t[0],r=t[1],n=t[2];return a[0]=o*e[0]+r*e[4]+n*e[8],a[1]=o*e[1]+r*e[5]+n*e[9],a[2]=o*e[2]+r*e[6]+n*e[10],a},transformNormal:function(e,t,a){a=a||new me(3);var o=je(e),r=t[0],n=t[1],i=t[2];return a[0]=r*o[0]+n*o[1]+i*o[2],a[1]=r*o[4]+n*o[5]+i*o[6],a[2]=r*o[8]+n*o[9]+i*o[10],a},setDefaultType:function(e){var t=me;return me=e,t}},ge=(Math.floor,Math.random),Ce=function(e,t){return e+ge()*(t-e)},_e=function(e,t,a,o){return[].concat(Object(he.a)(e),Object(he.a)(t),Object(he.a)(a),Object(he.a)(e),Object(he.a)(a),Object(he.a)(o))},we=function(e,t,a,o){return[].concat(Object(he.a)(e),Object(he.a)(t),Object(he.a)(a),Object(he.a)(e),Object(he.a)(a),Object(he.a)(o))},Me=function(e){return[].concat(Object(he.a)(e),Object(he.a)(e),Object(he.a)(e),Object(he.a)(e),Object(he.a)(e),Object(he.a)(e))},Se=function(e,t,a,o,r,n){var i=t[0]-e[0],s=a[1]-e[1],c=Ce(.3*i,.7*i),l=Ce(.3*s,.7*s),u=e[0]+(i-c)/2,h=t[0]-(i-c)/2,p=e[1]+(s-l)/2,b=a[1]-(s-l)/2,m=[u,p,e[2]],d=[h,p,e[2]],f=[h,b,e[2]],v=[u,b,e[2]],O=[];return O.push.apply(O,Object(he.a)(_e(m,d,f,v)).concat(Object(he.a)(_e(e,t,d,m)),Object(he.a)(_e(d,t,a,f)),Object(he.a)(_e(v,f,a,o)),Object(he.a)(_e(e,m,v,o)))),{vArr:O,cArr:Te(r,n),uArr:[].concat(Object(he.a)(we([.5,.5],[1,.5],[1,1],[.5,1])),Object(he.a)(we([0,.5],[.5,.5],[.4,.6],[.1,.6])),Object(he.a)(we([.4,.6],[.5,.5],[.5,1],[.4,.9])),Object(he.a)(we([.1,.9],[.4,.9],[.5,1],[0,1])),Object(he.a)(we([0,.5],[.1,.6],[.1,.9],[0,1])))}},Te=function(e,t){return[].concat(Object(he.a)(Me(e)),Object(he.a)(Me(t)),Object(he.a)(Me(t)),Object(he.a)(Me(t)),Object(he.a)(Me(t)))},xe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=ye.yRotation(r);n=ye.translate(n,t,a,o);for(var i=0;i<e.length;i+=3){var s=ye.transformPoint(n,[e[i+0],e[i+1],e[i+2],1]);e[i+0]=s[0],e[i+1]=s[1],e[i+2]=s[2]}},ke=function(e,t){for(var a=ye.yRotation(t),o=0;o<e.length;o+=3){var r=ye.transformPoint(a,[e[o+0],e[o+1],e[o+2],1]);e[o+0]=r[0],e[o+1]=r[1],e[o+2]=r[2]}},Pe=function(e,t){for(var a=ye.yRotation(t),o=0;o<e.length;o+=3){var r=ye.transformPoint(a,[e[o+0],e[o+1],e[o+2],1]);e[o+0]=r[0],e[o+1]=r[1],e[o+2]=r[2]}},Ie=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=ye.translation(t,a,o),n=0;n<e.length;n+=3){var i=ye.transformPoint(r,[e[n+0],e[n+1],e[n+2],1]);e[n+0]=i[0],e[n+1]=i[1],e[n+2]=i[2]}},Ae=function(e){var t=e.h0,a=e.h1,o=e.color1,r=void 0===o?[.2,.1,.1]:o,n=e.color2,i=void 0===n?[1,1,1]:n,s=e.rBase,c=void 0===s?5:s,l=e.hBase,u=void 0===l?5:l,h=e.hBaseToTrunk,p=void 0===h?1:h,b=e.hCapital,m=void 0===b?2:b,d=e.rCapital,O=void 0===d?6:d,j=e.hTrunkToCapital,y=void 0===j?1:j,g=e.rTrunk,C=void 0===g?3:g,_=t,w=t+u,M=_e([-c,_,c],[c,_,c],[c,w,c],[-c,w,c]),S=Me(r),T=we([.5,0],[1,0],[1,.5],[.5,.5]),x=_e([c+v,_-v,c+v],[-c-v,_-v,c+v],[-c-v,w,c+v],[c+v,w,c+v]),k=Me(f),P=we([0,1],[0,1],[0,1],[0,1]);w=(_=w)+p;var I=Object(he.a)(_e([-c,_,c],[c,_,c],[C,w,C],[-C,w,C])),A=Object(he.a)(Me(i)),D=we([0,.5],[.5,.5],[.4,.7],[.1,.7]),F=function(e){for(var t=e.h,a=void 0===t?2:t,o=e.h2,r=void 0===o?30:o,n=e.r,i=void 0===n?10:n,s=e.color1,c=void 0===s?[.2,.1,.1]:s,l=e.color2,u=void 0===l?[1,1,1]:l,h=[],p=r-a,b=a;p>0;){var m=Ce(.5,10),d=Ce(.5,4),f=Ce(.5,4),v=Ce(.5,.2),O=m+d+f+v;(p-=O)>5&&h.push({h0:b,h01:b+m,h02:b+m+d,h03:b+m+d+f,h04:b+m+d+f+v,r:Ce(1,10)}),b+=O}var j=[],y=[],g=[];if(0===h.length)j.push.apply(j,Object(he.a)(_e([-i,a,i],[i,a,i],[i,r,i],[-i,r,i]))),y.push.apply(y,Object(he.a)(Me(c))),g.push.apply(g,Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])));else{for(var C=0;C<h.length;++C){var _=Se([-i,h[C].h0,i],[i,h[C].h0,i],[i,h[C].h01,i],[-i,h[C].h01,i],u,u),w=_.vArr,M=_.cArr,S=_.uArr;j.push.apply(j,Object(he.a)(w)),y.push.apply(y,Object(he.a)(M)),g.push.apply(g,Object(he.a)(S)),j.push.apply(j,Object(he.a)(_e([-i,h[C].h01,i],[i,h[C].h01,i],[h[C].r,h[C].h02,h[C].r],[-h[C].r,h[C].h02,h[C].r]))),y.push.apply(y,Object(he.a)(Me(u))),g.push.apply(g,Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1]))),j.push.apply(j,Object(he.a)(_e([-h[C].r,h[C].h02,h[C].r],[h[C].r,h[C].h02,h[C].r],[h[C].r,h[C].h03,h[C].r],[-h[C].r,h[C].h03,h[C].r]))),y.push.apply(y,Object(he.a)(Me(c))),g.push.apply(g,Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1]))),j.push.apply(j,Object(he.a)(_e([-h[C].r,h[C].h03,h[C].r],[h[C].r,h[C].h03,h[C].r],[i,h[C].h04,i],[-i,h[C].h04,i]))),y.push.apply(y,Object(he.a)(Me(u))),g.push.apply(g,Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])))}var T=Se([-i,h[h.length-1].h04,i],[i,h[h.length-1].h04,i],[i,r,i],[-i,r,i],u,c),x=T.vArr,k=T.cArr,P=T.uArr;j.push.apply(j,Object(he.a)(x)),y.push.apply(y,Object(he.a)(k)),g.push.apply(g,Object(he.a)(P))}return{vert:j,col:y,uv:g}}({color1:r,color2:i,h:_=w,h2:w=a-m-y,r:C}),L=F.vert,E=F.col,N=F.uv;_=w,w=a-m;var B=Object(he.a)(_e([-C,_,C],[C,_,C],[O,w,O],[-O,w,O]));_=w,w=a;var R=Object(he.a)(_e([-O,_,O],[O,_,O],[O,w,O],[-O,w,O])),G=we([.5,.5],[1,.5],[1,0],[.5,0]);return{frontVert:[].concat(Object(he.a)(M),Object(he.a)(x),Object(he.a)(I),Object(he.a)(L),Object(he.a)(B),Object(he.a)(R)),frontColors:[].concat(Object(he.a)(S),Object(he.a)(k),Object(he.a)(A),Object(he.a)(E),Object(he.a)(A),Object(he.a)(S)),frontUV:[].concat(Object(he.a)(T),Object(he.a)(P),Object(he.a)(D),Object(he.a)(N),Object(he.a)(D),Object(he.a)(G))}},De=20,Fe=[0,0,0],Le=[0,.7,0],Ee=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,r=void 0===o?30:o,n=e.rCapital,i=void 0===n?6:n,s=e.rBase,c=void 0===s?5:s,l=e.capTop,u=void 0!==l&&l,h=e.capBottom,p=void 0!==h&&h,b=Ae({h0:a,h1:r,color1:Fe,color2:Le,rCapital:i,rBase:c}),m=b.frontVert,d=b.frontColors,O=b.frontUV,j=Object(he.a)(m);xe(j,0,0,0,Math.PI/2);var y=Object(he.a)(m);xe(y,0,0,0,-Math.PI/2);var g=Object(he.a)(m);xe(g,0,0,0,Math.PI);var C=[].concat(Object(he.a)(m),Object(he.a)(j),Object(he.a)(y),Object(he.a)(g)),_=[].concat(Object(he.a)(d),Object(he.a)(d),Object(he.a)(d),Object(he.a)(d)),w=[].concat(Object(he.a)(O),Object(he.a)(O),Object(he.a)(O),Object(he.a)(O)),M=.6,S=[].concat(Object(he.a)(_e([-c-M,a,c+M],[c+M,a,c+M],[c+M,r,c+M],[-c-M,r,c+M])),Object(he.a)(_e([c+M,a,c+M],[c+M,a,-c-M],[c+M,r,-c-M],[c+M,r,c+M])),Object(he.a)(_e([c+M,a,-c-M],[-c-M,a,-c-M],[-c-M,r,-c-M],[c+M,r,-c-M])),Object(he.a)(_e([-c-M,a,-c-M],[-c-M,a,c+M],[-c-M,r,c+M],[-c-M,r,-c-M]))),T=[].concat(Object(he.a)(_e([-20,a,De],[De,a,De],[De,r,De],[-20,r,De])),Object(he.a)(_e([De,a,De],[De,a,-20],[De,r,-20],[De,r,De])),Object(he.a)(_e([De,a,-20],[-20,a,-20],[-20,r,-20],[De,r,-20])),Object(he.a)(_e([-20,a,-20],[-20,a,De],[-20,r,De],[-20,r,-20])));return p&&(C.push.apply(C,Object(he.a)(_e([-c-v,a-v,c+v],[c+v,a-v,c+v],[c,a-v,-c-v],[-c,a-v,-c-v]))),_.push.apply(_,Object(he.a)(Me(f))),w.push.apply(w,Object(he.a)(we([0,1],[0,1],[0,1],[0,1])))),u&&(C.push.apply(C,Object(he.a)(_e([-i,r,i],[i,r,i],[i,r,-i],[-i,r,-i]))),_.push.apply(_,Object(he.a)(Me(Fe))),w.push.apply(w,Object(he.a)(we([.5,0],[1,0],[1,.5],[.5,.5])))),{v:C,c:_,u:w,collision:S,collisionCar:T}},Ne=function(e){var t=e.isColumn,a=e.h1,o=e.h2,r=e.color1,n=e.color2;if(!t)return{vertColumn:[],colorsColumn:[],uvColumn:[]};var i=[],s=[],c=[],l=o-5;i.push.apply(i,Object(he.a)(_e([-4,a,4],[4,a,4],[4,o,4],[-4,o,4])).concat(Object(he.a)(_e([4,a,4],[4,a,-4],[4,o,-4],[4,o,4])),Object(he.a)(_e([4,a,-4],[-4,a,-4],[-4,o,-4],[4,o,-4])),Object(he.a)(_e([-4,a,-4],[-4,a,4],[-4,o,4],[-4,o,-4])),Object(he.a)(_e([-6,l,6],[6,l,6],[6,o,6],[-6,o,6])),Object(he.a)(_e([6,l,6],[6,l,-6],[6,o,-6],[6,o,6])),Object(he.a)(_e([6,l,-6],[-6,l,-6],[-6,o,-6],[6,o,-6])),Object(he.a)(_e([-6,l,-6],[-6,l,6],[-6,o,6],[-6,o,-6])),Object(he.a)(_e([-6,l,6],[-6,l,-6],[6,l,-6],[6,l,6])),Object(he.a)(_e([-6,o,-6],[-6,o,6],[6,o,6],[6,o,-6])))),s.push.apply(s,Object(he.a)(Me(n)).concat(Object(he.a)(Me(n)),Object(he.a)(Me(n)),Object(he.a)(Me(n)),Object(he.a)(Me(r)),Object(he.a)(Me(r)),Object(he.a)(Me(r)),Object(he.a)(Me(r)),Object(he.a)(Me(r)),Object(he.a)(Me(r))));var u=we([0,.5],[.5,.5],[.5,1],[0,1]);return c.push.apply(c,Object(he.a)(u).concat(Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u),Object(he.a)(u))),{vertColumn:i,colorsColumn:s,uvColumn:c}},Be=Math.PI,Re=Math.cos,Ge=Be/2,We=[0,0,0],ze=Math.sin,Ue=Math.cos,Ke=function(e){var t=e.isTopElem,a=e.color1,o=e.color2,r=e.h2;if(!t)return{vertTopElem:[],colorsTopElem:[],uvTopElem:[]};for(var n=[],i=[],s=[],c=2+12*Math.random(),l=1+4*Math.random(),u=.2+40*Math.random(),h=.1+10*Math.random(),p=.1+10*Math.random(),b=.1+40*Math.random(),m=0;m<6;++m){var d=m+1;d>6&&(d=0);var O=m/6*Math.PI*2,j=d/6*Math.PI*2,y=r,g=y+c,C=6,_=6,w=ze(O),M=Ue(O),S=ze(j),T=Ue(j);n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+l,C=_,_=3,n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+u,_=C=_,n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+h,_=(C=_)+4,n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_]))),g=(y=g)+p,_=C=_,n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_])));var x=v+.5;n.push.apply(n,Object(he.a)(_e([S*(C+x),y,T*(C+x)],[w*(C+x),y,M*(C+x)],[w*(_+x),g,M*(_+x)],[S*(_+x),g,T*(_+x)]))),n.push.apply(n,Object(he.a)(_e([w*_,g,M*_],[S*_,g,T*_],[2*S,g,2*T],[2*ze(O),g,2*M]))),g=(y=g)+b,C=2,_=7,n.push.apply(n,Object(he.a)(_e([w*C,y,M*C],[S*C,y,T*C],[S*_,g,T*_],[w*_,g,M*_])));var k=v;n.push.apply(n,Object(he.a)(_e([S*(C+k),y,T*(C+k)],[w*(C+k),y,M*(C+k)],[w*(_+k),g,M*(_+k)],[S*(_+k),g,T*(_+k)]))),y=g,g+=b,n.push(w*_,y,M*_,S*_,y,T*_,0,g,0),n.push(S*(_+.5),y,T*(_+.5),w*(_+.5),y,M*(_+.5),0,g+3,0),i.push.apply(i,Object(he.a)(Me(a)).concat(Object(he.a)(Me(o)),Object(he.a)(Me(o)),Object(he.a)(Me(o)),Object(he.a)(Me(a)),Object(he.a)(Me(f)),Object(he.a)(Me(a)),Object(he.a)(Me(a)),Object(he.a)(Me(f)),Object(he.a)(a),Object(he.a)(a),Object(he.a)(a),Object(he.a)(f),Object(he.a)(f),Object(he.a)(f))),s.push.apply(s,Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])).concat(Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,1],[0,1],[0,1],[0,1])),Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,.5],[.5,.5],[.5,1],[0,1])),Object(he.a)(we([0,1],[0,1],[0,1],[0,1])),[0,.5],[.5,.5],[.25,1],[0,1],[0,1],[0,1]))}return{vertTopElem:n,colorsTopElem:i,uvTopElem:s}},Ve=[0,0,0],qe=function(e,t,a){var o=e.h,r=e.r,n=e.x,i=e.z,s=e.bridgeL,c=e.bridgeMinusH,l=e.hColumn,u=e.rColumn,h=e.i,p=o-5,b=Math.min(l*(.35*Math.random()+.1),50),m=[],d=[],f=[],v=[],O=[],j=function(e){var t=e.r,a=e.h,o=e.hh,r=e.bridgeMinusH,n=e.bridgeL,i=e.color2,s=e.colorB,c=[],l=[],u=[],h=[],p=we([0,.5],[.5,.5],[.5,1],[0,1]),b=we([0,0],[0,0],[0,0],[0,0]);return c.push.apply(c,Object(he.a)(_e([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(he.a)(_e([-t,o,t],[t,o,t],[t,a,t],[-t,a,t])),Object(he.a)(_e([-t,o,-t],[-t,o,t],[-t,a,t],[-t,a,-t])),Object(he.a)(_e([t,o,t],[t,o,-t],[t,a,-t],[t,a,t])),Object(he.a)(_e([t,o,-t],[-t,o,-t],[-t,a,-t],[t,a,-t])),Object(he.a)(_e([t,o,-t],[t,o,t],[-t,o,t],[-t,o,-t])),Object(he.a)(_e([-t,a,-t],[t,a,-t],[t,a-r,-t-n],[-t,a-r,-t-n])),Object(he.a)(_e([-t,o-r,-t-n],[-t,o,-t],[-t,a,-t],[-t,a-r,-t-n])),Object(he.a)(_e([t,o,-t],[t,o-r,-t-n],[t,a-r,-t-n],[t,a,-t])),Object(he.a)(_e([-t,o-r,-t-n],[t,o-r,-t-n],[t,o,-t],[-t,o,-t])))),l.push.apply(l,Object(he.a)(Me(i)).concat(Object(he.a)(Me(s)),Object(he.a)(Me(s)),Object(he.a)(Me(s)),Object(he.a)(Me(i)),Object(he.a)(Me(i)),Object(he.a)(Me(i)),Object(he.a)(Me(s)),Object(he.a)(Me(s)),Object(he.a)(Me(i)))),u.push.apply(u,Object(he.a)(p).concat(Object(he.a)(b),Object(he.a)(b),Object(he.a)(b),Object(he.a)(b),Object(he.a)(p),Object(he.a)(p),Object(he.a)(b),Object(he.a)(b),Object(he.a)(p))),h.push.apply(h,Object(he.a)(_e([-t,a,t],[t,a,t],[t,a,-t],[-t,a,-t])).concat(Object(he.a)(_e([-t,a,-t],[t,a,-t],[t,a-r,-t-n],[-t,a-r,-t-n])))),{v:c,c:l,u:u,collision:h}}({h:o,hh:p,colorB:Ve,color2:a,bridgeL:s,bridgeMinusH:c,r:r});m.push.apply(m,Object(he.a)(j.v)),d.push.apply(d,Object(he.a)(j.c)),f.push.apply(f,Object(he.a)(j.u)),v.push.apply(v,Object(he.a)(j.collision));var y=Ee({h0:p-l-.1,h1:p-b,capTop:!0,capBottom:!0});Ie(y.v,r,0,r),m.push.apply(m,Object(he.a)(y.v)),d.push.apply(d,Object(he.a)(y.c)),f.push.apply(f,Object(he.a)(y.u)),Ie(y.collision,r,0,r),v.push.apply(v,Object(he.a)(y.collision)),y.collisionCar&&(Ie(y.collisionCar,r,0,r),O.push.apply(O,Object(he.a)(y.collisionCar)));var g=Ne({isColumn:!0,h1:p-b,h2:p,color1:[0,0,0],color2:a});Ie(g.vertColumn,r,0,r),m.push.apply(m,Object(he.a)(g.vertColumn)),d.push.apply(d,Object(he.a)(g.colorsColumn)),f.push.apply(f,Object(he.a)(g.uvColumn));var C=function(e){for(var t=e.hArc,a=void 0===t?15:t,o=e.arcL,r=void 0===o?15:o,n=e.color2,i=[],s=[],c=[],l=r/5,u=0;u<5;++u){var h=Re(u/5*Ge),p=Re((u+1)/5*Ge);i.push(u*l,0+h*a,.1,(u+1)*l,0+p*a,.1,r,a,1),i.push(u*l,0+h*a,-2,r,a,-2,(u+1)*l,0+p*a,-2),s.push.apply(s,Object(he.a)(n).concat(Object(he.a)(n),Object(he.a)(n),Object(he.a)(n),Object(he.a)(n),Object(he.a)(n))),c.push(0,0,.3,0,.3,.3,0,0,.3,0,.3,.3),i.push.apply(i,Object(he.a)(_e([u*l,0+h*a,.1],[u*l,0+h*a,-2],[(u+1)*l,0+p*a,-2],[(u+1)*l,0+p*a,.1]))),s.push.apply(s,Object(he.a)(Me(We))),c.push(0,0,0,0,0,0,0,0,0,0,0,0)}return{v:i,c:s,u:c}}({hArc:b,arcL:40,color2:a});if(Ie(C.v,r-u-40,p-b,r),m.push.apply(m,Object(he.a)(C.v)),d.push.apply(d,Object(he.a)(C.c)),f.push.apply(f,Object(he.a)(C.u)),e.isTop){var _=Ke({isTopElem:!0,color1:[0,0,0],color2:a,h2:p});Ie(_.vertTopElem,r,0,r),m.push.apply(m,Object(he.a)(_.vertTopElem)),d.push.apply(d,Object(he.a)(_.colorsTopElem)),f.push.apply(f,Object(he.a)(_.uvTopElem))}return ke(m,Math.PI-Math.PI/2*h),Ie(m,n,0,i),ke(v,Math.PI-Math.PI/2*h),Ie(v,n,0,i),ke(O,Math.PI-Math.PI/2*h),Ie(O,n,0,i),{v:m,c:d,u:f,collision:v,collisionCar:O}},He=[[30,-30],[70,-30],[70,-70],[30,-70]],Qe=[[30,30],[70,30],[70,-30],[30,-30]],Ye=[[-70,70],[-30,70],[-30,30],[-70,30]],Ze=[[-30,70],[30,70],[30,30],[-30,30]],Xe=[[30,70],[70,70],[70,30],[30,30]],Je={N:[Ye],W:[Ye,Ze,Xe],S:[Ye,Ze,Xe,Qe,He],E:[Ye,Ze,Xe,Qe,He,[[-30,-30],[30,-30],[30,-70],[-30,-70]],[[-70,-30],[-30,-30],[-30,-70],[-70,-70]]]},$e=function(e){var t=e.xCenter,a=e.zCenter,o=e.h,r=e.dir,n=e.color2,i=void 0===n?[0,.7,0]:n,s=e.colorB,c=void 0===s?[0,0,0]:s,l=o-3,u=[],h=[],p=[],b=[],m=we([0,.5],[.5,.5],[.5,1],[0,1]),d=we([0,0],[0,0],[0,0],[0,0]);if(Je[r])for(var f=0;f<Je[r].length;++f){var v=Je[r][f];u.push.apply(u,Object(he.a)(_e([v[0][0],o,v[0][1]],[v[1][0],o,v[1][1]],[v[2][0],o,v[2][1]],[v[3][0],o,v[3][1]])).concat(Object(he.a)(_e([v[3][0],l,v[3][1]],[v[2][0],l,v[2][1]],[v[1][0],l,v[1][1]],[v[0][0],l,v[0][1]])),Object(he.a)(_e([v[0][0],l,v[0][1]],[v[1][0],l,v[1][1]],[v[1][0],o,v[1][1]],[v[0][0],o,v[0][1]])),Object(he.a)(_e([v[1][0],l,v[1][1]],[v[2][0],l,v[2][1]],[v[2][0],o,v[2][1]],[v[1][0],o,v[1][1]])),Object(he.a)(_e([v[2][0],l,v[2][1]],[v[3][0],l,v[3][1]],[v[3][0],o,v[3][1]],[v[2][0],o,v[2][1]])),Object(he.a)(_e([v[3][0],l,v[3][1]],[v[0][0],l,v[0][1]],[v[0][0],o,v[0][1]],[v[3][0],o,v[3][1]])))),h.push.apply(h,Object(he.a)(Me(i)).concat(Object(he.a)(Me(i)),Object(he.a)(Me(c)),Object(he.a)(Me(c)),Object(he.a)(Me(c)),Object(he.a)(Me(c)))),p.push.apply(p,Object(he.a)(m).concat(Object(he.a)(m),Object(he.a)(d),Object(he.a)(d),Object(he.a)(d),Object(he.a)(d))),b.push.apply(b,Object(he.a)(_e([v[0][0],o,v[0][1]],[v[1][0],o,v[1][1]],[v[2][0],o,v[2][1]],[v[3][0],o,v[3][1]])))}return Ie(u,t,0,a),Ie(b,t,0,a),{v:u,c:h,u:p,collision:b}},et=[0,0,0],tt=[0,.7,0],at={N:0,E:.5*-Math.PI,S:Math.PI,W:.5*Math.PI},ot=function(e){for(var t=e.centerBridgeX,a=e.centerBridgeZ,o=e.h,r=e.dir,n=e.lenBridge,i=o-3,s=we([0,.5],[.5,.5],[.5,1],[0,1]),c=we([0,0],[0,0],[0,0],[0,0]),l=20,u=[],h=[],p=[],b=[],m=[],d=0,f=120*Math.random()+30,v=n/2,O=n/2;f<n-20;){v=n/2-d,O=n/2-f;var j=Ee({h0:-20,h1:o-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});Ie(j.v,-20,0,O);for(var y=0;y<j.v.length;++y)u.push(j.v[y]);for(var g=0;g<j.c.length;++g)h.push(j.c[g]);for(var C=0;C<j.u.length;++C)p.push(j.u[C]);Ie(j.collision,-20,0,O);for(var _=0;_<j.collision.length;++_)b.push(j.collision[_]);Ie(j.collisionCar,-20,0,O);for(var w=0;w<j.collisionCar.length;++w)m.push(j.collisionCar[w]);var M=Ee({h0:-20,h1:o-1,rCapital:9,rBase:5,capTop:!0,capBottom:!1});Ie(M.v,20,0,O);for(var S=0;S<M.v.length;++S)u.push(M.v[S]);for(var T=0;T<M.c.length;++T)h.push(M.c[T]);for(var x=0;x<M.u.length;++x)p.push(M.u[x]);Ie(M.collision,20,0,O);for(var k=0;k<M.collision.length;++k)b.push(M.collision[k]);Ie(M.collisionCar,20,0,O);for(var P=0;P<M.collisionCar.length;++P)m.push(M.collisionCar[P]);var I=Ke({isTopElem:!0,color1:et,color2:tt,h2:o-1});Ie(I.vertTopElem,-20,0,O),u.push.apply(u,Object(he.a)(I.vertTopElem)),h.push.apply(h,Object(he.a)(I.colorsTopElem)),p.push.apply(p,Object(he.a)(I.uvTopElem));var A=Ke({isTopElem:!0,color1:et,color2:tt,h2:o-1});Ie(A.vertTopElem,20,0,O),u.push.apply(u,Object(he.a)(A.vertTopElem)),h.push.apply(h,Object(he.a)(A.colorsTopElem)),p.push.apply(p,Object(he.a)(A.uvTopElem)),d=f,f+=120*Math.random()+30,u.push.apply(u,Object(he.a)(_e([-l,o,v],[l,o,v],[l,o,O],[-l,o,O])).concat(Object(he.a)(_e([-l,i,O],[-l,i,v],[-l,o,v],[-l,o,O])),Object(he.a)(_e([l,i,v],[l,i,O],[l,o,O],[l,o,v])),Object(he.a)(_e([l,i,O],[l,i,v],[-l,i,v],[-l,i,O])))),h.push.apply(h,Object(he.a)(Me(tt)).concat(Object(he.a)(Me(et)),Object(he.a)(Me(et)),Object(he.a)(Me(tt)))),p.push.apply(p,Object(he.a)(s).concat(Object(he.a)(c),Object(he.a)(c),Object(he.a)(s))),b.push.apply(b,Object(he.a)(_e([-l,o,v],[l,o,v],[l,o,O],[-l,o,O])))}return u.push.apply(u,Object(he.a)(_e([-l,o,O],[l,o,O],[l,o,-n/2],[-l,o,-n/2])).concat(Object(he.a)(_e([-l,i,-n/2],[-l,i,O],[-l,o,O],[-l,o,-n/2])),Object(he.a)(_e([l,i,O],[l,i,-n/2],[l,o,-n/2],[l,o,O])),Object(he.a)(_e([l,i,-n/2],[l,i,O],[-l,i,O],[-l,i,-n/2])))),h.push.apply(h,Object(he.a)(Me(tt)).concat(Object(he.a)(Me(et)),Object(he.a)(Me(et)),Object(he.a)(Me(tt)))),p.push.apply(p,Object(he.a)(s).concat(Object(he.a)(c),Object(he.a)(c),Object(he.a)(s))),b.push.apply(b,Object(he.a)(_e([-l,o,O],[l,o,O],[l,o,-n/2],[-l,o,-n/2]))),Ie(u,-50,0,0),ke(u,at[r]),Ie(u,t,0,a),Ie(b,-50,0,0),ke(b,at[r]),Ie(b,t,0,a),Ie(m,-50,0,0),ke(m,at[r]),Ie(m,t,0,a),{v:u,c:h,u:p,collision:b,collisionCar:m}},rt=function(e){for(var t=e.xCenter,a=e.zCenter,o=e.hStart,r=e.hEnd,n=e.count,i=(r-o)/n,s=50,c=[],l=0;l<n;++l){var u=4*i;l<4&&(u=o+l*i+15);var h=i*l+o,p=h-7+o,b=t,m=a,d=l%4;d<1?(b=t-s,m=a-s):d<2?(b=t+s,m=a-s):d<3?(b=t+s,m=a+s):d<4&&(b=t-s,m=a+s),c.push({type:"stairs",offset:s,h:h,hh:p,r:20,x:b,z:m,bridgeMinusH:i,bridgeL:60,hColumn:u,rColumn:3,i:l,isTop:n-l<5})}return c},nt=["N","E","S","W"],it={N:1,E:2,S:3,W:4},st={N:[0,-1],E:[1,0],S:[0,1],W:[-1,0]},ct=function(e){for(var t=function(){for(var e=[],t=0,a=0,o=0,r="N",n=0;n<5;++n){var i=nt[Math.floor(Math.random()*nt.length)],s=400*Math.random()+30,c=a+st[i][0]*(140+s),l=o+st[i][1]*(140+s),u=it[i]+4*Math.floor(2*Math.random()),h=t+30*u,p=rt({xCenter:a,zCenter:o,hStart:t,hEnd:h,count:u});if(e.push.apply(e,Object(he.a)(p)),0!==n&&e.push({xCenter:a,zCenter:o,h:t-30,type:"zone",nextDir:i,dir:r}),4!==n){var b=(c-a)/2+a,m=(l-o)/2+o;e.push({centerBridgeX:b,centerBridgeZ:m,h:h-30,dir:i,lenBridge:s,type:"bridge"})}a=c,o=l,t=h,r=i}return e}(),a=[],o=[],r=[],n=[],i=[],s=0;s<t.length;++s){if("stairs"===t[s].type){var c=qe(t[s],0,[0,.7,0]),l=c.v,h=c.c,p=c.u,b=c.collision,m=c.collisionCar;a.push.apply(a,Object(he.a)(l)),o.push.apply(o,Object(he.a)(h)),r.push.apply(r,Object(he.a)(p)),n.push.apply(n,Object(he.a)(b)),m&&i.push.apply(i,Object(he.a)(m))}if("zone"===t[s].type){var d=$e(t[s]),f=d.v,v=d.c,O=d.u,j=d.collision;a.push.apply(a,Object(he.a)(f)),o.push.apply(o,Object(he.a)(v)),r.push.apply(r,Object(he.a)(O)),n.push.apply(n,Object(he.a)(j))}if("bridge"===t[s].type){for(var y=ot(t[s]),g=y.v,C=y.c,_=y.u,w=y.collision,M=y.collisionCar,S=0;S<g.length;++S)a.push(g[S]);for(var T=0;T<C.length;++T)o.push(C[T]);for(var x=0;x<_.length;++x)r.push(_[x]);for(var k=0;k<w.length;++k)n.push(w[k]);if(M)for(var P=0;P<M.length;++P)i.push(M[P])}}n.push(-50,1e3,0,0,1e3,0,0,1e3,-50);var I=new Float32Array(a),A=new Float32Array(o),D=new Float32Array(r),F=new Float32Array(n),L=new u.BufferGeometry;L.setAttribute("position",new u.BufferAttribute(I,3)),L.setAttribute("color",new u.BufferAttribute(A,3)),D&&L.setAttribute("uv",new u.BufferAttribute(D,2)),L.computeVertexNormals();var E=e.materials.wallVirtualColor,N=new u.Mesh(L,E),B=new u.BufferGeometry;B.setAttribute("position",new u.BufferAttribute(F,3));var R=new u.MeshBasicMaterial({color:16711680}),G=new u.Mesh(B,R),W=new Float32Array(i),z=new u.BufferGeometry;z.setAttribute("position",new u.BufferAttribute(W,3));for(var U,K=new u.Mesh(z,R),V=t.length-1;V>-1;--V)if(t[V].type&&"stairs"===t[V].type){U=[t[V].x,t[V].h,t[V].z];var q=Math.floor(t[V].i%4);0===q&&(U[2]-=60),1===q&&(U[0]+=60),2===q&&(U[2]+=60),3===q&&(U[0]-=60);break}var H=new u.Mesh(new u.BoxGeometry(30,30,30),new u.MeshBasicMaterial({color:16711935}));return H.position.set(U[0],U[1],U[2]),{mesh:N,meshCollision:G,meshCollisionCar:K,meshFinish:H,lastXYZ:U}},lt=[0,0,0],ut=[0,.7,0],ht=function(e){var t=e.h0,a=void 0===t?0:t,o=e.h1,r=void 0===o?30:o,n=e.h2,i=void 0===n?60:n,s=e.arc,c=void 0!==s&&s,l=e.isTopElem,u=void 0!==l&&l,h=e.isColumn,p=void 0!==h&&h,b=[],m=[],d=[],f=[],v=[];if(c){var O=function(e){for(var t=e.h1,a=e.h2,o=e.color1,r=void 0===o?[.2,.1,.1]:o,n=e.color2,i=void 0===n?[1,1,1]:n,s=e.r,c=void 0===s?5:s,l=e.rCap,u=void 0===l?7:l,h=e.wCol,p=void 0===h?3:h,b=e.w,m=(void 0===b?40:b)-2*c,d=-c-m,f=t,v=a-Math.min(.1*(a-t),2),O=Object(he.a)(_e([-p,f,c],[p,f,c],[p,v,c],[-p,v,c])),j=Object(he.a)(Me(i)),y=Object(he.a)(Me(r)),g=we([0,.5],[.5,.5],[.5,1],[0,1]),C=[].concat(Object(he.a)(_e([-p,f,-c],[-p,f,c],[-p,v,c],[-p,v,-c])),Object(he.a)(_e([p,f,c],[p,f,-c],[p,v,-c],[p,v,c]))),_=Object(he.a)(_e([p,f,-c],[-p,f,-c],[-p,v,-c],[p,v,-c])),w=[],M=[],S=[],T=2-p,x=p-2,k=14,P=m/k,I=v-f,A=.15*I,D=0;D<k;++D){var F=(1-Math.sin((D+1)/k*Math.PI))*(I-A)+A,L=(1-Math.sin(D/k*Math.PI))*(I-A)+A,E=-c;D+1>7&&(E=-c-m),w.push(T,v-F,-c-(D+1)*P,T,v-L,-c-D*P,T,v,E),M.push.apply(M,Object(he.a)(i).concat(Object(he.a)(i),Object(he.a)(i))),S.push(0,0,.3,0,.3,.3),w.push(x,v-L,-c-D*P,x,v-F,-c-(D+1)*P,x,v,E),M.push.apply(M,Object(he.a)(i).concat(Object(he.a)(i),Object(he.a)(i))),S.push(0,0,.3,0,.3,.3),w.push.apply(w,Object(he.a)(_e([x,v-L,-c-D*P],[T,v-L,-c-D*P],[T,v-F,-c-(D+1)*P],[x,v-F,-c-(D+1)*P]))),M.push.apply(M,Object(he.a)(y)),S.push.apply(S,Object(he.a)(we([0,0],[0,0],[0,0],[0,0])))}w.push(T,v-A,-c-P*k/2,T,v,-c,T,v,-c-P*k),M.push.apply(M,Object(he.a)(i).concat(Object(he.a)(i),Object(he.a)(i))),S.push(.5,.25,.25,.3,.25,.2),w.push(x,v-A,-c-P*k/2,x,v,-c-P*k,x,v,-c),M.push.apply(M,Object(he.a)(i).concat(Object(he.a)(i),Object(he.a)(i))),S.push(.5,.25,.25,.3,.25,.2),f=v,v=a;var N=[].concat(Object(he.a)(_e([-u,f,-u],[u,f,-u],[u,f,u],[-u,f,u])),Object(he.a)(_e([-u,f,u],[u,f,u],[u,v,u],[-u,v,u])),Object(he.a)(_e([-u,f,-u],[-u,f,u],[-u,v,u],[-u,v,-u])),Object(he.a)(_e([u,f,u],[u,f,-u],[u,v,-u],[u,v,u])),Object(he.a)(_e([u,f,-u],[-u,f,-u],[-u,v,-u],[u,v,-u])),Object(he.a)(_e([-u,v,u],[u,v,u],[u,v,-u],[-u,v,-u])),Object(he.a)(_e([2-u,f,d],[u-2,f,d],[u-2,f,-u],[2-u,f,-u])),Object(he.a)(_e([2-u,f,d],[2-u,f,-u],[2-u,v,-u],[2-u,v,d])),Object(he.a)(_e([u-2,f,-u],[u-2,f,d],[u-2,v,d],[u-2,v,-u])),Object(he.a)(_e([2-u,v,-u],[u-2,v,-u],[u-2,v,d],[2-u,v,d])));return{v:[].concat(Object(he.a)(O),Object(he.a)(C),Object(he.a)(_),w,Object(he.a)(N)),c:[].concat(Object(he.a)(j),Object(he.a)(j),Object(he.a)(j),Object(he.a)(j),M,Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y),Object(he.a)(y)),u:[].concat(Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),S,Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g),Object(he.a)(g))}}(Object(I.a)({h1:r,h2:i,color1:lt,color2:ut},c));b.push.apply(b,Object(he.a)(O.v)),m.push.apply(m,Object(he.a)(O.c)),d.push.apply(d,Object(he.a)(O.u))}var j=Ee({h0:a,h1:r,color1:lt,color2:ut,rCapital:6,rBase:5,capTop:!0,capBottom:!0});b.push.apply(b,Object(he.a)(j.v)),m.push.apply(m,Object(he.a)(j.c)),d.push.apply(d,Object(he.a)(j.u)),f.push.apply(f,Object(he.a)(j.collision)),j.collisionCar&&v.push.apply(v,Object(he.a)(j.collisionCar));var y=Ke({h2:i,color1:lt,color2:ut,isTopElem:u}),g=y.vertTopElem,C=y.colorsTopElem,_=y.uvTopElem;b.push.apply(b,Object(he.a)(g)),m.push.apply(m,Object(he.a)(C)),d.push.apply(d,Object(he.a)(_));var w=Ne({isColumn:p,h1:r,h2:i,color1:lt,color2:ut}),M=w.vertColumn,S=w.colorsColumn,T=w.uvColumn;return b.push.apply(b,Object(he.a)(M)),m.push.apply(m,Object(he.a)(S)),d.push.apply(d,Object(he.a)(T)),{v:b,c:m,u:d,collision:f,collisionCar:v}},pt=function(e){for(var t=[],a=[],o=[],r=[],n=[],i=function(){var e=[],t=function t(a){var o=a.angle,r=a.offsetStart,n=a.h0,i=a.h1,s=a.h2,c=a.numFromCenter,l=120*Math.random()+30,u=Math.random()>.5;e.push({id:Math.floor(1e3*Math.random()),x:Math.sin(o)*(r+l),z:Math.cos(o)*(r+l),angle:o,h0:n,h1:i,h2:s,arc:{w:l},isTopElem:!u,numFromCenter:c}),u&&t({angle:o,offsetStart:r+l,h0:n,h1:i,h2:s,numFromCenter:++c})},a=Math.floor(20*Math.random())+3,o=150*Math.random()+30,r=(.4*Math.random()+.5)*o;e.push({id:Math.floor(1e3*Math.random()),x:0,z:0,angle:0,h0:0,h1:r,h2:o,numFromCenter:0,isTopElem:!1,isColumn:!0});for(var n=0;n<a;++n)Math.random()>.3&&t({angle:n/a*(2*Math.PI),offsetStart:0,h0:0,h1:r,h2:o,numFromCenter:1});for(var i=e.length,s=0;s<3;++s)for(var c=e[e.length-1].h2,l=c+150*Math.random()+30,u=c+(.4*Math.random()+.5)*(l-c),h=0;h<i;++h)e[h].isTopElem||e.push(Object(I.a)(Object(I.a)({},e[h]),{},{h0:c,h1:u,h2:l,isTopElem:2===s}));return e}(),s=0;s<i.length;++s){var c=i[s],l=(c.id,c.x),h=c.z,p=c.angle,b=c.h0,m=c.h1,d=c.h2,f=c.arc,v=c.isTopElem,O=c.isColumn,j=ht({h0:b,h1:m,h2:d,arc:f,isTopElem:v,isColumn:O}),y=j.v,g=j.c,C=j.u,_=j.collision,w=j.collisionCar;ke(y,p),Ie(y,l,0,h,p),_&&(ke(_,p),Ie(_,l,0,h),r.push.apply(r,Object(he.a)(_))),w&&(ke(w,p),Ie(w,l,0,h),n.push.apply(n,Object(he.a)(w))),t.push.apply(t,Object(he.a)(y)),a.push.apply(a,Object(he.a)(g)),o.push.apply(o,Object(he.a)(C))}var M=new Float32Array(t),S=new Float32Array(a),T=new Float32Array(o),x=new u.BufferGeometry;x.setAttribute("position",new u.BufferAttribute(M,3)),x.setAttribute("color",new u.BufferAttribute(S,3)),T&&x.setAttribute("uv",new u.BufferAttribute(T,2)),x.computeVertexNormals();var k=e.materials.wallVirtualColor,P=new u.Mesh(x,k),A=new Float32Array(r),D=new u.BufferGeometry;D.setAttribute("position",new u.BufferAttribute(A,3));var F=new u.Mesh(D,e.materials.testRed),L=new Float32Array(n),E=new u.BufferGeometry;return E.setAttribute("position",new u.BufferAttribute(L,3)),{mesh:P,meshCollision:F,meshCollisionCar:new u.Mesh(E,e.materials.testRed)}},bt=function(e){var t=e.studio,a=e.car,o=e.system_PlayerMoveOnLevel,r=e.materials,n=[],i=function(e){for(var t=[],a=0;a<30;++a){var o=pt(e),r="build_"+a;t.push(Object(I.a)(Object(I.a)({},o),{},{id:r,inScene:!1}))}return{getItem:function(){for(var e=0;e<t.length;++e)if(!t[e].inScene)return t[e].inScene=!0,t[e];return null},setFlagAsFree:function(e){for(var a=0;a<t.length;++a)if(t[a].id===e){t[a].inScene=!1;break}}}}(e),s=new u.PlaneGeometry(p,p);r.floorMat.map.wrapS=r.floorMat.map.wrapT=80,r.floorMat.map.repeat.set(50,50);var c=function(e){for(var c=0;c<e.length;++c){var l=e[c].split("_"),h=+l[0]*p,b=+l[1]*p,m=new u.Mesh(s,r.floorMat);m.rotation.x=-Math.PI/2,m.position.set(h,-62,b),t.addToScene(m),n.push({mesh:m,keyLocation:e[c],type:"floor"}),o.addItemToPlayerCollision(m);for(var d=Math.floor(8*Math.random()),f=0;f<d;++f){var v=i.getItem();if(v){var O=v.mesh,j=v.meshCollision,y=v.meshCollisionCar,g=v.id;O.position.set(h+Math.random()*p,-60,b+Math.random()*p),t.addToScene(O),j.visible=!1,j.position.copy(O.position),t.addToScene(j),o.addItemToPlayerCollision(j),y.visible=!1,y.position.copy(O.position),t.addToScene(y),a.setCollisionForDraw(y),n.push({mesh:O,meshCollision:j,meshCollisionCar:y,keyLocation:e[c],type:"build",id:g})}}}};return{updateAreas:function(e,r){!function(e){for(var r=[],s=0;s<e.length;++s)for(var c=0;c<n.length;++c)e[s]===n[c].keyLocation&&r.push(n[c]);n=n.filter((function(t){for(var a=0;a<e.length;++a)if(t.keyLocation===e[a])return!1;return!0}));for(var l=0;l<r.length;++l){var u=r[l],h=u.mesh,p=u.meshCollision,b=u.meshCollisionCar,m=u.type,d=u.id;t.removeFromScene(h),o.removeItemFromPlayerCollision(h),"build"===m&&(o.removeItemFromPlayerCollision(p),t.removeFromScene(p),a.removeCollisionForDraw(b),t.removeFromScene(b),i.setFlagAsFree(d)),"floor"===m&&(r[l].mesh.geometry.dispose(),delete r[l].mesh)}}(e),c(r)},createArea:function(e){c(e)},removeAll:function(){for(var e=0;e<n.length;++e){var r=n[e],i=r.mesh,s=r.meshCollision,c=r.meshCollisionCar;t.removeFromScene(i),o.removeItemFromPlayerCollision(i),n[e].mesh.geometry.dispose(),delete n[e].mesh,s&&(o.removeItemFromPlayerCollision(s),t.removeFromScene(s),n[e].meshCollision.geometry.dispose(),delete n[e].meshCollision),c&&(a.removeCollisionForDraw(c),t.removeFromScene(c),n[e].meshCollisionCar.geometry.dispose(),delete n[e].meshCollisionCar)}}}},mt=function(e){for(var t=[],a=0;a<20;++a)for(var o=3e3*Math.random()-1500,r=400*Math.random()-50,n=3e3*Math.random()-1500,i=0;i<3;++i)t.push(o+3*Math.random(),r+3*Math.random(),n+3*Math.random());var s=new Float32Array(t),c=new u.BufferGeometry;return c.setAttribute("position",new u.BufferAttribute(s,3)),new u.Mesh(c,e.materials.testGreen)},dt=Math.PI,ft=Math.sin,vt=Math.cos,Ot=2*dt,jt=function(e){for(var t=e.hhh||12,a=[],o=[],r=function(e){for(var t=e.count,a=void 0===t?5:t,o=e.hh,r=void 0===o?15:o,n=e.h,i=void 0===n?7:n,s=e.hD,c=void 0===s?-7:s,l=e.hhD,u=void 0===l?-15:l,h=e.r,p=void 0===h?15:h,b=e.cone,m=void 0===b?10:b,d=e.w,f=void 0===d?2:d,v=e.wt,O=void 0===v?3:v,j=e.wtr,y=void 0===j?5:j,g=e.htr,C=void 0===g?5:g,_=e.rInner,w=void 0===_?-5:_,M={tt:[],top:[],bot:[],bb:[]},S=0;S<a;++S){var T=S/a*Ot,x=[0,-f,0,f,0,0,f,f,0,-f,f,0,-f,0,0,0,5,m,-y,1.7*-i,w,y,1.7*-i,w,0,-i+C,w,-y,2*-i,1.5*w,0,2.3*-i,2*w,y,2*-i,1.5*w];Pe(x,T),Ie(x,ft(T)*p,i,vt(T)*p),M.top.push(x);var k=(S+.5)/a*Ot,P=[0,f,0,-f,0,0,-f,-f,0,f,-f,0,f,0,0,0,-5,m,-y,1.7*i,w,0,i-C,w,y,1.7*i,w,-y,2*i,1.5*w,y,2*i,1.5*w,0,2.3*i,2*w];Pe(P,k),Ie(P,ft(k)*p,c,vt(k)*p),M.bot.push(P);var I=(S-.5)/a*Ot;M.tt.push(ft(I)*O,r,vt(I)*O),M.bb.push(ft(T)*O,u,vt(T)*O)}return M}(e),n=[1,1,1],i=[].concat(n,n,n),s=([].concat(Object(he.a)(i),Object(he.a)(i)),[.5,1,.5]),c=[].concat(s,s,s),l=[].concat(Object(he.a)(c),Object(he.a)(c)),u=[0,0,0],h=[].concat(u,u,u),p=([].concat(Object(he.a)(h),Object(he.a)(h)),[0,0,0]),b=[].concat(p,p,p),m=[].concat(Object(he.a)(b),Object(he.a)(b)),d=[0,0,0],f=[].concat(d,d,d),v=([].concat(Object(he.a)(f),Object(he.a)(f)),[0,0,0]),O=[].concat(v,v,v),j=([].concat(Object(he.a)(O),Object(he.a)(O)),function(e,n){var i=r.bot[e],s=r.bot[n],u=r.top[e],h=r.top[n];a.push(r.tt[3*e],r.tt[3*e+1],r.tt[3*e+2],r.tt[3*n],r.tt[3*n+1],r.tt[3*n+2],0,r.tt[3*e+1]+t,0),o.push.apply(o,Object(he.a)(c)),a.push(r.bb[3*n],r.bb[3*n+1],r.bb[3*n+2],r.bb[3*e],r.bb[3*e+1],r.bb[3*e+2],0,r.bb[3*e+1]-t,0),o.push.apply(o,Object(he.a)(c)),a.push.apply(a,Object(he.a)(_e([u[9],u[10],u[11]],[u[6],u[7],u[8]],[r.tt[3*n],r.tt[3*n+1],r.tt[3*n+2]],[r.tt[3*e],r.tt[3*e+1],r.tt[3*e+2]]))),o.push.apply(o,Object(he.a)(m)),a.push.apply(a,Object(he.a)(_e([r.bb[3*e],r.bb[3*e+1],r.bb[3*e+2]],[r.bb[3*n],r.bb[3*n+1],r.bb[3*n+2]],[i[9],i[10],i[11]],[i[6],i[7],i[8]]))),o.push.apply(o,Object(he.a)(m)),a.push.apply(a,Object(he.a)(_e([u[3],u[4],u[5]],[h[12],h[13],h[14]],[h[9],h[10],h[11]],[u[6],u[7],u[8]]))),o.push.apply(o,Object(he.a)(m)),a.push.apply(a,Object(he.a)(_e([i[9],i[10],i[11]],[s[6],s[7],s[8]],[s[3],s[4],s[5]],[i[12],i[13],i[14]]))),o.push.apply(o,Object(he.a)(m)),a.push.apply(a,Object(he.a)(_e([i[3],i[4],i[5]],[i[0],i[1],i[2]],[u[3],u[4],u[5]],[u[0],u[1],u[2]]))),o.push.apply(o,Object(he.a)(m)),a.push.apply(a,Object(he.a)(_e([i[0],i[1],i[2]],[i[12],i[13],i[14]],[h[0],h[1],h[2]],[h[12],h[13],h[14]]))),o.push.apply(o,Object(he.a)(m));for(var p=0;p<15;p+=3)a.push(u[p],u[p+1],u[p+2],u[p+3],u[p+4],u[p+5],u[15],u[16],u[17]),o.push.apply(o,Object(he.a)(c)),a.push(i[p],i[p+1],i[p+2],i[p+3],i[p+4],i[p+5],i[15],i[16],i[17]),o.push.apply(o,Object(he.a)(c));a.push(i[12],i[13],i[14],i[0],i[1],i[2],i[15],i[16],i[17]),o.push.apply(o,Object(he.a)(c)),a.push(u[12],u[13],u[14],u[0],u[1],u[2],u[15],u[16],u[17]),o.push.apply(o,Object(he.a)(c)),a.push.apply(a,Object(he.a)(_e([u[21],u[22],u[23]],[i[3],i[4],i[5]],[u[0],u[1],u[2]],[u[24],u[25],u[26]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[12],i[13],i[14]],[h[18],h[19],h[20]],[h[24],h[25],h[26]],[h[0],h[1],h[2]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[12],i[13],i[14]],[s[3],s[4],s[5]],[h[21],h[22],h[23]],[h[18],h[19],h[20]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([u[30],u[31],u[32]],[r.bb[3*e],r.bb[3*e+1],r.bb[3*e+2]],[i[6],i[7],i[8]],[u[33],u[34],u[35]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([r.bb[3*n],r.bb[3*n+1],r.bb[3*n+2]],[h[30],h[31],h[32]],[h[27],h[28],h[29]],[i[9],i[10],i[11]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([h[27],h[28],h[29]],[h[33],h[34],h[35]],[s[6],s[7],s[8]],[i[9],i[10],i[11]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[0],i[1],i[2]],[i[21],i[22],i[23]],[i[18],i[19],i[20]],[u[3],u[4],u[5]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[0],i[1],i[2]],[h[12],h[13],h[14]],[i[24],i[25],i[26]],[i[21],i[22],i[23]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[18],i[19],i[20]],[i[24],i[25],i[26]],[h[12],h[13],h[14]],[u[3],u[4],u[5]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([u[6],u[7],u[8]],[h[9],h[10],h[11]],[i[30],i[31],i[32]],[i[27],i[28],i[29]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([i[30],i[31],i[32]],[h[9],h[10],h[11]],[r.tt[3*n],r.tt[3*n+1],r.tt[3*n+2]],[i[33],i[34],i[35]]))),o.push.apply(o,Object(he.a)(l)),a.push.apply(a,Object(he.a)(_e([u[6],u[7],u[8]],[i[27],i[28],i[29]],[i[33],i[34],i[35]],[r.tt[3*n],r.tt[3*n+1],r.tt[3*n+2]]))),o.push.apply(o,Object(he.a)(l))}),y=0;y<r.top.length;++y)r.top[y+1]?j(y,y+1):j(y,0);return{v:a,c:o}},yt=function(e,t){for(var a=t.r,o=void 0===a?15:a,r=t.s,n=void 0===r?.5:r,i=t.mKey,s=void 0===i?"testGreen":i,c=[],l=o/2,h=0;h<100;++h)for(var p=Math.random()*o-l,b=Math.random()*o-l,m=Math.random()*o-l,d=0;d<3;++d)c.push(p+Math.random()*n,b+Math.random()*n,m+Math.random()*n);var f=new Float32Array(c),v=new u.BufferGeometry;return v.setAttribute("position",new u.BufferAttribute(f,3)),new u.Mesh(v,e.materials[s])},gt=function(e,t,a){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=Math.floor(t/e),r=Math.floor(a/e),n=o+"_"+r,i=pe(o,r);return{checkChanged:function(t,a){var o=Math.floor(t/e),r=Math.floor(a/e),s=o+"_"+r;if(s===n)return!1;var c=n;n=s;var l=i;i=pe(o,r);var u=be(i,l),h=be(l,i);return{oldKey:c,newKey:s,newEnv:i,removedQs:h,addedQs:u}},getCurrent:function(){return{loc:n,currentEnv:i}}}}(p,t,a),r=function(e){var t=e.studio,a=e.car,o=(e.system_Level,e.system_PlayerMoveOnLevel),r=e.system_PlayerNearLevelItems,n=function(){var t=ct(e);return t.meshCollision.visible=!1,t.meshCollisionCar.visible=!1,t.meshFinish.position.copy(t.mesh.position),t},i={location01:n(),location02:n(),location03:n()},s=function(e){var n=i[e],s=n.mesh,c=n.meshCollision,l=n.meshCollisionCar,u=n.meshFinish;t.removeFromScene(s),o.removeItemFromPlayerCollision(c),t.removeFromScene(c),t.removeFromScene(l),a.removeCollisionForDraw(l),t.removeFromScene(u),r.removeItemFromCheck(u)};return{removeLocationFromScene:s,addLocationToScene:function(n,s,c){var l=i[n],u=l.mesh,h=l.meshCollision,p=l.meshCollisionCar,b=l.meshFinish,m=l.lastXYZ,d=-42;u.position.set(s,d,c),t.addToScene(u),o.addItemToPlayerCollision(h),h.position.set(s,d,c),t.addToScene(h),a.setCollisionForDraw(p),p.visible=!1,p.position.set(s,d,c),t.addToScene(p),b.position.set(s,d,c),b.position.x+=m[0],b.position.y+=m[1],b.position.z+=m[2],t.addToScene(e.unit.mesh),e.unit.mesh.position.copy(b.position),e.unit.mesh.position.y+=20,r.setItemToCheck(b,"nearPerson_"+n,80)},removeAll:function(){for(var e in i)s(e)}}}(e),n=bt(e),i=function(e){var t=e.car.getModel(),a=new u.Object3D;a.position.set(0,0,-3e3),t.add(a);for(var o=new u.Vector3,r=[],n=0;n<50;++n){var i=mt(e);i.position.set(3e3*Math.random()-1500,0,3e3*Math.random()-1500),r.push(i)}return{update:function(){a.getWorldPosition(o);for(var e=0;e<r.length;++e)r[e].position.distanceTo(o)>4e3&&r[e].position.copy(o)},addToScene:function(){for(var t=0;t<r.length;++t)e.studio.addToScene(r[t])},removeAll:function(){for(var t=0;t<r.length;++t)e.studio.removeFromScene(r[t])}}}(e),s=function(e){var t=jt({r:15,cone:12,w:2,wt:3,wtr:5,htr:5,rInner:-5,hhh:8}),a=jt({cone:20,r:13,w:.5,wt:.7,wtr:2,htr:0,rInner:-5,hhh:12,hh:16,hhD:-12}),o=0,r=(Object(he.a)(t.v),new Float32Array(t.v)),n=new Float32Array(a.c),i=new u.BufferGeometry;i.setAttribute("position",new u.BufferAttribute(r,3)),i.setAttribute("color",new u.BufferAttribute(n,3)),i.computeVertexNormals();var s=e.materials.unit,c=new u.Object3D,l=new u.Mesh(i,s);c.add(l);var h=yt(e,{mKey:"testWhite"});c.add(h);var p=yt(e,{mKey:"testWhite"});c.add(p);var b=yt(e,{mKey:"testWhite"});c.add(b);var m=yt(e,{r:50,s:.5});return c.add(m),{mesh:c,update:function(){o+=.05;var e=Math.sin(o);h.rotation.y=2*-o,p.rotation.x=2*-o,b.rotation.z=2*-o,m.rotation.y=o/4,l.rotation.y=o/2,l.rotation.x=o/1.33,l.rotation.z=o/1.88;for(var r=0;r<t.v.length;++r)i.attributes.position.array[r]=t.v[r]*(1-e)+a.v[r]*e;l.geometry.attributes.position.needsUpdate=!0}}}(e);e.unit=s;var c=!1;return{addWorld:function(){var e=o.getCurrent();n.createArea(e.currentEnv),i.addToScene(),c=!0},removeWorld:function(){c=!1,i.removeAll(),r.removeAll(),n.removeAll()},update:function(e,t){if(c){s.update(),i.update();var a=o.checkChanged(e,t);if(a&&(n.updateAreas(a.removedQs,a.addedQs),b[a.oldKey]&&r.removeLocationFromScene(b[a.oldKey]),b[a.newKey])){var l=a.newKey.split("_"),u=+l[0]*p+p/2,h=+l[1]*p+p/2;r.addLocationToScene(b[a.newKey],u,h)}}}}},Ct=function(){function e(t){var a=this;Object(_.a)(this,e),this._root=t,this._isInRealWord=!0,this._isExitFromVirt=!1,this._nextLocation=null,this._finalCountDown=3e3;var o=this._root,r=o.emitter,n=o.car,i=o.dispatcher,s=o.frameUpdater,c=o.studio,l=o.system_PlayerMoveOnLevel;i.dispatch({type:"CHANGE_INFO_CHAPTER",currentChapterIndex:4}),n.onChangeCarStateMove((function(e){"carStart"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1}),"carStop"===e&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!0})})),r.subscribe("checkNear")((function(e){a._isExitFromVirt||("nearStarterDrawCar"===e.item&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:e.is}),e.item.includes("nearPerson")&&t.dispatcher.dispatch({type:"TOGGLE_BUTTON_DIALOG",is:e.is,keyPerson:e.item}))})),this._worldReal=function(e){e.assets;var t=e.materials,a=e.studio,o=e.system_Assets,r=e.system_PlayerMoveOnLevel,n=new u.Mesh(new u.PlaneGeometry(5e3,5e3),t.floorMat1);t.floorMat1.map.repeat.set(180,180),n.rotation.x=-Math.PI/2,n.position.y=-62;var i=o.items.body;i.position.fromArray([-20,-60,-50]),i.rotation.fromArray([0,2,0]),i.material=t.body;var s=o.items.body_shadow;return s.material=t.body_sh,i.add(s),{addWorld:function(){r.addItemToPlayerCollision(n),a.addToScene(n),a.addToScene(i)},removeWorld:function(){r.removeItemFromPlayerCollision(n),a.removeFromScene(n),a.removeFromScene(i)}}}(t),this._worldReal.addWorld(),this._worldVirtual=gt(t,n._model.position.x,n._model.position.z),s.on((function(e){F.b(),a._worldVirtual.update(n._model.position.x,n._model.position.z),n.isFreeze?l.update(e):(n.update(e),a._checkEndPlay()),c.drawFrame()})),this._startPlay()}return Object(w.a)(e,[{key:"clickMachineDraw",value:function(){var e=this._root,t=e.studio,a=e.system_PlayerMoveOnLevel,o=e.car;a.toggleFreeze(!0),o.toggleFreeze(!1),t.setCamera(o.getCamera()),this._isInRealWord&&(this._isInRealWord=!1,o.toggleMat("green"),t.changeEnvironment(y,{updateAmb:!1,time:50}),this._worldVirtual.addWorld(),this._worldReal.removeWorld())}},{key:"clickMachineExit",value:function(){var e=this._root,t=e.system_PlayerMoveOnLevel,a=e.player,o=e.studio,r=e.car,n=(e.CONSTANTS,r.getPosition()),i=r.getQuaternion();o.setCamera(a.getCamera()),r.toggleFreeze(!0),t.toggleFreeze(!1),a.setToPos(n.x,a.mesh.position.y,n.z),a.mesh.setRotationFromQuaternion(i)}},{key:"changeTargetLocation",value:function(e){var t=e.key;this._nextLocation=t,console.log("nextLocation",this._nextLocation);var a=null;for(var o in b)b[o]===t&&(a=o);if(a){var r=a.split("_"),n=+r[0]*p+p/2,i=+r[1]*p+p/2;this._root.car.setTargetPosition(new u.Vector3(n,0,i))}}},{key:"_startPlay",value:function(){var e=this._root,t=e.player,a=e.ui,o=e.studio,r=e.car,n=e.system_PlayerMoveOnLevel,i=e.system_PlayerNearLevelItems,s=e.CONSTANTS;t.setToPos.apply(t,Object(he.a)(s.playerConfig.startPos));var c=s.CONFIG_FOR_INIT.currentSceneConfig.carProps,l=c.position,h=c.rotation,m=r.getModel();m.position.fromArray(l),m.rotation.fromArray(h),m.position.y=-49,i.setItemToCheck(m,"nearStarterDrawCar",28),o.addToScene(m),n.addItemToPlayerCollision(r.getCollision()),setTimeout((function(){var e=0,t=null;for(var a in b)0===e&&(t=a),++e;var o=t.split("_"),n=+o[0]*p+p/2,i=+o[1]*p+p/2;r.setTargetPosition(new u.Vector3(n,0,i))}),500),a.showStartButton((function(){o.changeEnvironment(j,{updateAmb:!1,time:1e3}),t.toggleBlocked(!1)}))}},{key:"_checkEndPlay",value:function(){"locationToFinish"===this._nextLocation&&(--this._finalCountDown,this._finalCountDown<1e3&&this._root.car.updateBattary(),this._finalCountDown<0&&this._endPlay())}},{key:"_endPlay",value:function(){var e=this;this._nextLocation="----",this._isInRealWord=!0,this._isExitFromVirt=!0;var t=this._root,a=t.CONSTANTS,o=t.dispatcher,r=t.car,n=t.studio,i=t.player,s=t.system_PlayerMoveOnLevel;this._root.car.batteryLight(),setTimeout((function(){return o.dispatch({type:"TOGGLE_BUTTON_DRAW_CAR",is:!1})}));var c=a.CONFIG_FOR_INIT.currentSceneConfig.carProps,l=c.position,u=c.rotation,h=r.getModel();r.toggleMat("red"),h.position.fromArray(l),h.rotation.fromArray(u),h.position.y=-49;var p=r.getPosition(),b=r.getQuaternion();n.setCamera(i.getCamera()),r.toggleFreeze(!0),s.toggleFreeze(!1),i.setToPos(p.x,i.mesh.position.y,p.z),i.mesh.setRotationFromQuaternion(b),this._worldReal.addWorld(),this._worldVirtual.removeWorld(),n.changeEnvironment(j,{updateAmb:!1,time:50}),setTimeout((function(){n.changeEnvironment(O,{updateAmb:!1,time:500}),setTimeout((function(){e._root.dispatcher.dispatch({type:"SHOW_FINAL_MESSAGE"})}),1e3)}),35e3)}}]),e}(),_t=a(6),wt=a(18),Mt=a.n(wt),St=a(8),Tt=(a(40),"en"),xt=function(e){return function(t){return e[Tt]&&e[Tt][t]||t}},kt=a(5),Pt=xt({ru:{"Discovery of small android":"\u041f\u0443\u0442\u0435\u0448\u0435\u0441\u0442\u0432\u0438\u044f \u0434\u0440\u043e\u0438\u0434\u0430",Factory:"\u0424\u0430\u0431\u0440\u0438\u043a\u0430",Brige:"\u041c\u043e\u0441\u0442",Cube:"\u041a\u0443\u0431",Endways:"\u041d\u0430\u043f\u0440\u044f\u043c\u0438\u043a",Machine:"\u041c\u0430\u0448\u0438\u043d\u0430","in production":"\u0441\u043a\u043e\u0440\u043e.."," (current)":" (\u0442\u0443\u0442)","Author: ":"\u043e\u0442: ","Github: ":"\u0413\u0438\u0442\u0445\u0430\u0431: "}}),It=Object(St.b)((function(e){return Object(I.a)({},e.controls.infoPanelData)}))((function(e){return Object(kt.jsxs)("div",{className:"info",children:[Object(kt.jsx)("button",{className:"control-small butt-infoClose",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),Object(kt.jsxs)("div",{className:"info-inner",children:[Object(kt.jsx)("p",{children:Pt(e.title)}),Object(kt.jsx)("p",{children:Pt(e.topText)}),Object(kt.jsx)("ul",{children:e.chapters.map((function(t,a){return Object(kt.jsxs)("li",{children:[a+1,".\xa0",t.href?Object(kt.jsx)("span",{children:Object(kt.jsx)("a",{href:t.href,target:"blank",children:Pt(t.text)})}):Object(kt.jsx)("span",{children:Pt(t.text)}),a===e.currentChapterIndex&&Pt(" (current)")]},a)}))}),Object(kt.jsx)("p",{children:e.bottomText}),Object(kt.jsx)("ul",{children:e.afterWords.map((function(e,t){return Object(kt.jsxs)("li",{children:[Pt(e.text),Object(kt.jsx)("a",{href:e.href,target:"blank",children:Pt(e.aText)})]},t)}))})]})]})})),At=(a(42),Object(St.b)((function(e){return{isInfo:e.controls.isInfo,isShowControls:e.controls.isShowControls,isShowControlSound:e.controls.isShowControlSound,isMute:e.controls.isMute}}))((function(e){var t=Object(_t.useState)(!0),a=Object(ie.a)(t,2),o=a[0],r=a[1];return Object(_t.useEffect)((function(){return e.gameContext.emitter.subscribe("screenMode")((function(e){"exitFullScreen"===e&&r(!0)}))})),Object(kt.jsxs)("div",{className:"ui-controls",children:[e.isShowControls&&e.isShowControlSound&&Object(kt.jsx)("button",{className:"".concat(e.isMute?"butt-sound-n":"butt-sound"," control-small"),onMouseUp:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})},onTouchEnd:function(){e.gameContext.emitter.emit("toggleSound")(!e.isMute),e.dispatch({type:"TOGGLE_MUTE",is:!e.isMute})}}),e.isShowControls&&Object(kt.jsx)("button",{className:"butt-left control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-left")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-left")}}),e.isShowControls&&Object(kt.jsx)("button",{className:"butt-right control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-right")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-right")}}),e.isShowControls&&Object(kt.jsx)("button",{className:"butt-front control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-front")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-front")}}),e.isShowControls&&Object(kt.jsx)("button",{className:"butt-back control",onMouseDown:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onTouchStart:function(){return e.gameContext.emitter.emit("mouseDown")("butt-back")},onMouseUp:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")},onTouchEnd:function(){return e.gameContext.emitter.emit("mouseUp")("butt-back")}}),e.isShowControls&&o&&Object(kt.jsx)("button",{className:"butt-fullscreen control-small",onClick:function(){e.gameContext.emitter.emit("mouseDown")("butt-fullscreen"),r(!1)}}),!e.isInfo&&Object(kt.jsx)("button",{className:"butt-info control-small",onClick:function(){return e.dispatch({type:"TOGGLE_INFO"})}}),e.isInfo&&Object(kt.jsx)(It,{})]})})));var Dt={dispatch:null},Ft=Object(St.b)((function(e){return{isShowControls:e.controls.isShowControls,isInfo:e.controls.isInfo}}))((function(e){return!Dt.dispatch&&(Dt.dispatch=e.dispatch),Object(kt.jsxs)("div",{className:"ui",children:[!e.isInfo&&e.gameContext.CustomReactComponent&&Object(kt.jsx)(e.gameContext.CustomReactComponent,{gameContext:e.gameContext}),Object(kt.jsx)(At,{gameContext:e.gameContext})]})})),Lt=a(16),Et=a(26),Nt={isShowControls:!0,isShowControlSound:!1,isMute:!1,isInfo:!1,infoPanelData:{title:"Discovery of small android",topText:"",chapters:[{text:"Factory",href:"./../chapter01"},{text:"Brige",href:"./../chapter02"},{text:"Cube",href:"./../chapter03"},{text:"Endways",href:"./../chapter04"},{text:"Machine",href:"./../chapter05"},{text:"in production"}],currentChapterIndex:null,bottomText:"",afterWords:[{text:"Author: ",aText:"www.otrisovano.ru",href:"http://otrisovano.ru"},{text:"Github: ",aText:"https://github.com/fire888/dark_boss",href:"https://github.com/fire888/dark_boss"}]}};var Bt=document.querySelector(".progress"),Rt=-100,Gt=!0;!function e(){Gt&&setTimeout((function(){0===++Rt&&(Rt-=100),Bt.style.marginLeft=Rt+"%",e()}),30)}();var Wt=function(){function e(t){Object(_.a)(this,e),t.dispatcher=Dt,this._root=t;var a=function(e){e.customStore||(e.customStore={});var t=Object(Lt.b)(Object(I.a)({controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Nt,t=arguments.length>1?arguments[1]:void 0;return"TOGGLE_INFO"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControls:!!e.isInfo,isInfo:!e.isInfo}):"CHANGE_INFO_CHAPTER"===t.type?Object(I.a)(Object(I.a)({},e),{},{infoPanelData:Object(I.a)(Object(I.a)({},e.infoPanelData),{},{currentChapterIndex:t.currentChapterIndex})}):"TOGGLE_CONTROLS"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControls:t.is}):"ENABLE_CONTROL_SOUND"===t.type?Object(I.a)(Object(I.a)({},e),{},{isShowControlSound:!0}):"TOGGLE_MUTE"===t.type?Object(I.a)(Object(I.a)({},e),{},{isMute:t.is}):Object(I.a)({},e)}},e.customStore)),a=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Lt.c;return Object(Lt.d)(t,a(Object(Lt.a)(Et.a)))}(t);a&&Mt.a.render(Object(kt.jsx)(St.a,{store:a,children:Object(kt.jsx)(Ft,{gameContext:t})}),document.getElementById("root"))}return Object(w.a)(e,[{key:"showStartButton",value:function(e){var t=document.querySelector(".startbuttons-wrapper"),a=document.querySelector(".progress-wrapper"),o=function(e){var t;e.target.dataset&&e.target.dataset.lang&&(t=e.target.dataset.lang,Tt=t),document.querySelector(".start-screen").style.display="none"};Gt=!1,t.style.display="flex",t.addEventListener("click",(function(t){e(),o(t)})),a.style.display="none"}}]),e}(),zt=(a(43),{ru:{"What's happening?":"\u0427\u0442\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442?","I am generating the Great Recursion. I need a component. Deliver it to me.":"\u042f \u0433\u0435\u043d\u0435\u0440\u044e \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u044e. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430. \u0414\u043e\u0441\u0442\u0430\u0432\u044c \u043c\u043d\u0435 \u0435\u0435.","Good. Where can I find the component?":"\u0425\u043e\u0440\u043e\u0448\u043e. \u0413\u0434\u0435 \u043c\u043d\u0435 \u043d\u0430\u0439\u0442\u0438 \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443?","I updated the sign in your car, follow it.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435, \u0441\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","I'll be back.":"\u042f \u0432\u0435\u0440\u043d\u0443\u0441\u044c.","For the glory of Recursion.":"\u0412\u043e \u0441\u043b\u0430\u0432\u0443 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438.","Do you have a Great Recursion Component?":"\u0423 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438?","I will generate you a Great Component for the Great Recursion. I need a Component.":"\u042f \u0441\u0433\u0435\u043d\u0435\u0440\u044e \u0442\u0435\u0431\u0435 \u0412\u0435\u043b\u0438\u043a\u0443\u044e \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438. \u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430.","Where can I find her?":"\u0413\u0434\u0435 \u043c\u043d\u0435 \u0435\u0435 \u043d\u0430\u0439\u0442\u0438?","I updated the pointer in the car.":"\u042f \u043e\u0431\u043d\u043e\u0432\u0438\u043b \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u043c\u0430\u0448\u0438\u043d\u0435.","Do you have a Component for the Great Component of the Great Recursion?":"\u0423 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430 \u0434\u043b\u044f \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043f\u043e\u043d\u0435\u043d\u0442\u044b \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u0420\u0435\u043a\u0443\u0440\u0441\u0438\u0438?","Yes. I have finished generating the Component.":"\u0414\u0430. \u042f \u0437\u0430\u043a\u043e\u043d\u0447\u0438\u043b \u0433\u0435\u043d\u0435\u0440\u0438\u0442\u044c \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443.","I need to deliver it to generate the Great Component.":"\u041c\u043d\u0435 \u043d\u0443\u0436\u043d\u043e \u0434\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0435\u0435 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","The pointer in your car has been updated. He will point to the Component of the Great Component.":"\u0423\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u0432 \u0442\u0432\u043e\u0435\u0439 \u043c\u0430\u0448\u0438\u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d. \u041e\u043d \u0443\u043a\u0430\u0436\u0435\u0442 \u043d\u0430 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0443 \u0412\u0435\u043b\u0438\u043a\u043e\u0439 \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u044b.","Is my car the key to Components?":"\u041c\u043e\u044f \u043c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u043a\u043b\u044e\u0447 \u043a \u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430\u043c?","Your Machine is the main Generator. Follow him.":"\u0422\u0432\u043e\u044f \u041c\u0430\u0448\u0438\u043d\u0430 \u044d\u0442\u043e \u0433\u043b\u0430\u0432\u043d\u044b\u0439 \u0413\u0435\u043d\u0435\u0440\u0430\u0442\u043e\u0440. \u0421\u043b\u0435\u0434\u0443\u0439 \u0435\u043c\u0443.","open dialog":"\u043d\u0430\u0447\u0430\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433","close dialog":"\u0437\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c \u0434\u0438\u0430\u043b\u043e\u0433",drive:"\u0443\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u0435",exit:"\u0432\u044b\u0439\u0442\u0438","To be continued":"\u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u0435 \u0441\u043b\u0435\u0434\u0443\u0435\u0442",chapter:"\u0433\u043b\u0430\u0432\u0430",open:"\u043f\u0443\u0441\u043a","Author: ":"\u0410\u0432\u0442\u043e\u0440: ",link:"\u0441\u0441\u044b\u043b\u043a\u0430"}}),Ut=xt(zt),Kt=Object(St.b)((function(e){return{userReplicies:e.ui.userReplicies}}))((function(e){return Object(kt.jsx)("div",{className:"replicies",children:e.userReplicies.map((function(t){return Object(kt.jsx)("button",{onClick:function(){e.dispatch({type:"CLICK_PHRASE",phrase:t}),setTimeout((function(){e.dispatch({type:"PHRASE_EVENT",phrase:t})}),1e3)},children:Ut(t.q)},Math.floor(1e5*Math.random()))}))})})),Vt=xt(zt),qt=Object(St.b)((function(e){return{botAnswers:e.ui.botAnswers}}))((function(e){return Object(kt.jsx)("div",{className:"messages",children:e.botAnswers.map((function(e){return Object(kt.jsxs)("div",{children:[Object(kt.jsx)("div",{className:"q",children:Vt(e.q)}),Object(kt.jsx)("div",{className:"a",children:Vt(e.a)})]},Math.floor(1e5*Math.random()))}))})})),Ht=xt(zt);var Qt=Object(St.b)((function(e){return{isButtonDialog:e.ui.isButtonDialog,isShowFinalMessage:e.ui.isShowFinalMessage,isShowPalleteDialog:e.ui.isShowPalleteDialog,isShowButtonDrawCar:e.ui.isShowButtonDrawCar,valButtonDrawCar:e.ui.valButtonDrawCar,isShowButtonToggleOpenLocationsList:!0,isLocationListOpened:e.ui.isLocationListOpened,currentLocationOfList:e.ui.currentLocationOfList,locationsList:e.ui.locationsList}}))((function(e){return Object(kt.jsxs)(kt.Fragment,{children:[!e.isShowFinalMessage&&e.isButtonDialog&&!e.isShowPalleteDialog&&Object(kt.jsx)("button",{className:"control control-enter",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!0})}}),e.isShowPalleteDialog&&Object(kt.jsx)("div",{className:"dialog-wrapper",children:Object(kt.jsxs)("div",{className:"dialog-content",children:[e.isShowPalleteDialog&&Object(kt.jsxs)("div",{className:"messages-wrapper",children:[Object(kt.jsx)(qt,{}),Object(kt.jsx)(Kt,{})]}),e.isButtonDialog&&Object(kt.jsx)("button",{className:"dialog-button-toggle",onClick:function(){return e.dispatch({type:"TOGGLE_DIALOG",isShowPalleteDialog:!e.isShowPalleteDialog})},children:e.isShowPalleteDialog?Ht("close dialog"):Ht("open dialog")})]})}),e.isShowButtonDrawCar&&Object(kt.jsx)("button",{className:"control ".concat("exit"===e.valButtonDrawCar?"control-exit":"control-enter"),onClick:function(){return e.dispatch({type:"CLICK_DRAW"})}}),e.isShowFinalMessage&&Object(kt.jsx)("div",{className:"final-mess",children:Ht("To be continued")})]})})),Yt=a(7),Zt={location01:"location02",location02:"location03",location03:"locationToFinish"},Xt={botAnswers:[],userReplicies:[],isShowControls:!0,isButtonDialog:!1,isShowPalleteDialog:!1,isShowFinalMessage:!1,isShowButtonDrawCar:!1,valButtonDrawCar:"drive",currentLocation:null,phrasesData:{location01:{isComplete:!1,phraseIndex:0,phrases:[{q:"What's happening?",a:"I am generating the Great Recursion. I need a component. Deliver it to me.",event:"nextReply"},{q:"Good. Where can I find the component?",a:"I updated the sign in your car, follow it.",event:"nextReply"},{q:"I'll be back.",a:"For the glory of Recursion.",event:"close"}]},location02:{isComplete:!1,phraseIndex:0,phrases:[{q:"Do you have a Great Recursion Component?",a:"I will generate you a Great Component for the Great Recursion. I need a Component.",event:"nextReply"},{q:"Where can I find her?",a:"I updated the pointer in the car.",event:"close"}]},location03:{isComplete:!1,phraseIndex:0,phrases:[{q:"Do you have a Component for the Great Component of the Great Recursion?",a:"Yes. I have finished generating the Component.",event:"nextReply"},{q:"I need to deliver it to generate the Great Component.",a:"The pointer in your car has been updated. He will point to the Component of the Great Component.",event:"nextReply"},{q:"Is my car the key to Components?",a:"Your Machine is the main Generator. Follow him.",event:"close"}]}},isShowButtonToggleOpenLocationsList:!1,isLocationListOpened:!1,currentLocationOfList:"location01",locationsList:["location01","location02","location03"]},Jt=[{key:"emitter",constr:k,initStateKey:"pageLoaded"},{key:"deviceResizer",constr:function e(t){Object(_.a)(this,e);var a=t.emitter,o=t.appWrapper;!o&&(o=document.querySelector(".app-wrapper")),a.subscribe("mouseDown")((function(e){"butt-fullscreen"===e&&r()}));var r=function(){o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()},n=function(e){o.style.width=window.innerWidth+"px",o.style.height=window.innerHeight+"px",o.style.fontSize=Math.max(Math.min(Math.min(window.innerWidth,window.innerHeight),400),350)/50+"px",document.fullscreenElement||a.emit("screenMode")("exitFullScreen")};window.addEventListener("resize",n),n()},initStateKey:"pageLoaded"},{key:"loaderAssets",constr:x,initStateKey:"pageLoaded"},{key:"frameUpdater",constr:D,initStateKey:"beforeStartPlay"},{key:"tweenUpdater",constr:function e(t){Object(_.a)(this,e),t.emitter.subscribe("frameUpdate")((function(){return F.b()}))},initStateKey:"beforeStartPlay"},{key:"studio",constr:W,initStateKey:"beforeStartPlay"},{key:"keyBoard",constr:z,initStateKey:"beforeStartPlay"},{key:"player",constr:U,initStateKey:"beforeStartPlay"},{key:"system_PlayerNearLevelItems",constr:ue,initStateKey:"beforeStartPlay"},{key:"materialsLib",constr:function e(t){Object(_.a)(this,e);var a=t.assets,o=t.CONSTANTS;t.materials=K(a,o.MATERIALS_CONFIG)},initStateKey:"beforeStartPlay"},{key:"system_Assets",constr:function e(t){Object(_.a)(this,e),this._root=t;var a=t.assets,o=t.materials;this.items=V(a,o),console.log(this.items)},initStateKey:"beforeStartPlay",assetsToLoad:[{type:"obj",path:q,key:"level-rooms"},{type:"cubeTextures",path:[$,$,$,$,$,$],key:"skyBox"},{type:"cubeTextures",path:[ee,te,ae,oe,re,ne],key:"skyBox2"},{type:"img",path:H,key:"mapFloorOuter",wrap:!0},{type:"img",path:Y,key:"mapTop",wrap:!0},{type:"img",path:Q,key:"mapVirtual2",wrap:!0},{type:"img",path:Z,key:"mapParams"},{type:"img",path:X,key:"mapBody"},{type:"img",path:J,key:"mapBodySh"}]},{key:"car",constr:ce,initStateKey:"beforeStartPlay"},{key:"system_PlayerMoveOnLevel",constr:le,initStateKey:"beforeStartPlay"},{key:"customUi",constr:function e(t){Object(_.a)(this,e),t.appWrapper=document.querySelector(".app-wrapper"),t.CustomReactComponent=Qt,t.customStore=function(e){return{ui:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt,a=arguments.length>1?arguments[1]:void 0;if("TOGGLE_BUTTON_DIALOG"===a.type){var o=a.keyPerson.split("_")[1],r=[];if(t.phrasesData[o])for(var n=t.phrasesData[o],i=n.phraseIndex,s=n.phrases,c=0;c<i;++c)r.push(s[c]);return Object(I.a)(Object(I.a)({},t),{},{isButtonDialog:a.is,currentLocation:o,userReplicies:[],botAnswers:r})}if("TOGGLE_DIALOG"===a.type){var l=[];if(e.player.toggleBlocked(a.isShowPalleteDialog),a.isShowPalleteDialog){var u=t.phrasesData[t.currentLocation],h=u.isComplete,p=u.phraseIndex,b=u.phrases;l=h?[]:[b[p]]}return setTimeout((function(){return e.dispatcher.dispatch({type:"TOGGLE_CONTROLS",is:!a.isShowPalleteDialog})})),Object(I.a)(Object(I.a)({},t),{},{isShowPalleteDialog:a.isShowPalleteDialog,userReplicies:l})}if("CLICK_PHRASE"===a.type)return Object(I.a)(Object(I.a)({},t),{},{botAnswers:[].concat(Object(he.a)(t.botAnswers),[a.phrase]),userReplicies:[]});if("PHRASE_EVENT"===a.type){var m=a.phrase.event;if("nextReply"===m){console.log(JSON.stringify(t));var d=t.phrasesData[t.currentLocation],f=(d.isComplete,d.phraseIndex)+1,v=[d.phrases[f]];return Object(I.a)(Object(I.a)({},t),{},{phrasesData:Object(I.a)(Object(I.a)({},t.phrasesData),{},Object(Yt.a)({},t.currentLocation,Object(I.a)(Object(I.a)({},t.phrasesData[t.currentLocation]),{},{phraseIndex:f}))),userReplicies:v})}if("close"===m){var O=t.phrasesData[t.currentLocation].phraseIndex+1;return setTimeout((function(){e.dispatcher.dispatch({type:"SELECT_LOCATION",location:Zt[t.currentLocation]})}),50),Object(I.a)(Object(I.a)({},t),{},{userReplicies:[],phrasesData:Object(I.a)(Object(I.a)({},t.phrasesData),{},Object(Yt.a)({},t.currentLocation,Object(I.a)(Object(I.a)({},t.phrasesData[t.currentLocation]),{},{isComplete:!0,phraseIndex:O}))),isButtonDialog:!0})}}return"TOGGLE_BUTTON_DRAW_CAR"===a.type?Object(I.a)(Object(I.a)({},t),{},{isShowButtonDrawCar:a.is}):"CLICK_DRAW"===a.type?"drive"===t.valButtonDrawCar?(e.actions.clickMachineDraw(),Object(I.a)(Object(I.a)({},t),{},{valButtonDrawCar:"exit"})):(e.actions.clickMachineExit(),Object(I.a)(Object(I.a)({},t),{},{valButtonDrawCar:"drive"})):"OPEN_LOCATIONS_LIST"===a.type?Object(I.a)(Object(I.a)({},t),{},{isLocationListOpened:!0}):"SELECT_LOCATION"===a.type?(e.actions.changeTargetLocation({key:a.location}),Object(I.a)(Object(I.a)({},t),{},{isLocationListOpened:!1,currentLocationOfList:a.location})):"SHOW_FINAL_MESSAGE"===a.type?Object(I.a)(Object(I.a)({},t),{},{isShowFinalMessage:!0}):t}}}(t);var a=new Wt(t);t.ui=a},initStateKey:"pageLoaded"},{key:"actions",constr:Ct,initStateKey:"beforeStartPlay"}];window.addEventListener("load",(function(){return function(e,t){return s.apply(this,arguments)}(Jt,o)}))}},[[44,1,2]]]);
//# sourceMappingURL=main.39ce3ad0.chunk.js.map